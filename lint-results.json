
> bookfiix@0.1.0 lint
> eslint --format json

[{"filePath":"C:\\Projects\\bookfiix\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\next.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\about\\page.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":118,"column":36,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4452,4753],"text":"\r\n                Founded in 2024, Bookflix started with a simple belief: that everyone should have easy \r\n                access to the world&apos;s collective knowledge. We saw traditional libraries struggling \r\n                with outdated systems and decided to build something better.\r\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4452,4753],"text":"\r\n                Founded in 2024, Bookflix started with a simple belief: that everyone should have easy \r\n                access to the world&lsquo;s collective knowledge. We saw traditional libraries struggling \r\n                with outdated systems and decided to build something better.\r\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4452,4753],"text":"\r\n                Founded in 2024, Bookflix started with a simple belief: that everyone should have easy \r\n                access to the world&#39;s collective knowledge. We saw traditional libraries struggling \r\n                with outdated systems and decided to build something better.\r\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4452,4753],"text":"\r\n                Founded in 2024, Bookflix started with a simple belief: that everyone should have easy \r\n                access to the world&rsquo;s collective knowledge. We saw traditional libraries struggling \r\n                with outdated systems and decided to build something better.\r\n              "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useRef } from 'react';\r\nimport Image from 'next/image';\r\nimport Navbar from '@/components/Navbar';\r\nimport Footer from '@/components/Footer';\r\nimport Features from '@/components/Features';\r\nimport gsap from 'gsap';\r\nimport { ScrollTrigger } from 'gsap/ScrollTrigger';\r\n\r\nif (typeof window !== 'undefined') {\r\n  gsap.registerPlugin(ScrollTrigger);\r\n}\r\n\r\nexport default function AboutPage() {\r\n  const heroRef = useRef(null);\r\n  const storyRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    // Hero Text Animation\r\n    const heroTitle = heroRef.current.querySelector('h1');\r\n    const heroSubtitle = heroRef.current.querySelector('p');\r\n    \r\n    gsap.fromTo(heroTitle,\r\n      { opacity: 0, x: -100 },\r\n      { opacity: 1, x: 0, duration: 1.2, ease: 'power4.out' }\r\n    );\r\n    \r\n    gsap.fromTo(heroSubtitle,\r\n      { opacity: 0, x: 100 },\r\n      { opacity: 1, x: 0, duration: 1.2, ease: 'power4.out', delay: 0.2 }\r\n    );\r\n\r\n\r\n    // Story Section Reveal\r\n    gsap.fromTo(storyRef.current,\r\n      { opacity: 0, y: 100 },\r\n      { \r\n        opacity: 1, \r\n        y: 0, \r\n        duration: 1.5, \r\n        ease: 'power3.out',\r\n        scrollTrigger: {\r\n          trigger: storyRef.current,\r\n          start: 'top 80%',\r\n        }\r\n      }\r\n    );\r\n\r\n    // Global animate-on-scroll elements\r\n    const scrollElements = document.querySelectorAll('.animate-on-scroll');\r\n    scrollElements.forEach((el) => {\r\n      gsap.to(el, {\r\n        opacity: 1,\r\n        y: 0,\r\n        duration: 1,\r\n        ease: 'power3.out',\r\n        scrollTrigger: {\r\n          trigger: el,\r\n          start: 'top 85%',\r\n          toggleActions: 'play none none none'\r\n        }\r\n      });\r\n    });\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"bg-background-dark min-h-screen flex flex-col font-display selection:bg-primary selection:text-white\">\r\n      <Navbar />\r\n\r\n      <main className=\"flex-grow\">\r\n        {/* Hero Section */}\r\n        <section ref={heroRef} className=\"relative h-[80vh] flex items-center justify-center overflow-hidden\">\r\n          <div className=\"absolute inset-0 z-0\">\r\n            <Image \r\n              src=\"https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?auto=format&fit=crop&q=80&w=2070\" \r\n              alt=\"Beautiful library bookshelf\"\r\n              fill\r\n              className=\"object-cover opacity-20 scale-110 blur-[2px]\"\r\n              priority\r\n            />\r\n            <div className=\"absolute inset-0 bg-gradient-to-b from-background-dark/80 via-transparent to-background-dark\"></div>\r\n          </div>\r\n          \r\n          <div className=\"relative z-10 text-center max-w-5xl px-6\">\r\n            <h1 className=\"text-5xl md:text-8xl font-black text-white leading-none tracking-tighter mb-8 opacity-0\">\r\n              Reinventing the <span className=\"text-primary italic\">Library</span> Experience\r\n            </h1>\r\n            <p className=\"text-gray-400 text-xl md:text-2xl font-light leading-relaxed max-w-2xl mx-auto opacity-0\">\r\n              Bookflix bridges the gap between traditional wisdom and modern technology, \r\n              bringing thousands of titles to your doorstep.\r\n            </p>\r\n          </div>\r\n        </section>\r\n\r\n        {/* Story Section */}\r\n        <section ref={storyRef} className=\"py-24 px-6 max-w-7xl mx-auto opacity-0\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-20 items-center\">\r\n            <div className=\"relative aspect-square rounded-[3rem] overflow-hidden group\">\r\n              <Image \r\n                src=\"https://images.unsplash.com/photo-1507842217343-583bb7270b66?auto=format&fit=crop&q=80&w=2190\" \r\n                alt=\"Modern collaborative library\"\r\n                fill\r\n                className=\"object-cover transition-transform duration-700 group-hover:scale-110\"\r\n              />\r\n              <div className=\"absolute inset-0 bg-primary/20 mix-blend-overlay\"></div>\r\n            </div>\r\n            \r\n            <div className=\"space-y-8\">\r\n              <div className=\"space-y-4\">\r\n                <h2 className=\"text-sm font-bold text-primary uppercase tracking-[0.4em]\">Our Story</h2>\r\n                <h3 className=\"text-4xl md:text-6xl font-black text-white leading-tight\">\r\n                  Born from a Passion for <span className=\"text-primary italic\">Reading</span>.\r\n                </h3>\r\n              </div>\r\n              <p className=\"text-gray-400 text-lg leading-relaxed font-light\">\r\n                Founded in 2024, Bookflix started with a simple belief: that everyone should have easy \r\n                access to the world's collective knowledge. We saw traditional libraries struggling \r\n                with outdated systems and decided to build something better.\r\n              </p>\r\n              <div className=\"space-y-6\">\r\n                {[\r\n                  { title: 'Modern Technology', desc: 'Seamless reservation and real-time tracking systems.' },\r\n                  { title: 'Global Collection', desc: 'Curated titles from both local authors and international bestsellers.' },\r\n                  { title: 'Community Focused', desc: 'Spaces designed for collaboration, learning, and quiet reflection.' },\r\n                ].map((item, i) => (\r\n                  <div key={i} className=\"flex gap-4\">\r\n                    <div className=\"mt-1\">\r\n                      <div className=\"w-2 h-2 rounded-full bg-primary\"></div>\r\n                    </div>\r\n                    <div>\r\n                      <h4 className=\"text-white font-bold mb-1\">{item.title}</h4>\r\n                      <p className=\"text-gray-500 text-sm leading-relaxed\">{item.desc}</p>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </section>\r\n\r\n        {/* Mission Section */}\r\n        <Features />\r\n      </main>\r\n\r\n      <Footer />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\admin\\books\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchBooks'. Either include it or remove the dependency array.","line":189,"column":6,"nodeType":"ArrayExpression","endLine":189,"endColumn":71,"suggestions":[{"desc":"Update the dependencies array to be: [searchQuery, languageFilter, categoryFilter, availabilityFilter, fetchBooks]","fix":{"range":[5664,5729],"text":"[searchQuery, languageFilter, categoryFilter, availabilityFilter, fetchBooks]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":894,"column":46,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[34519,34616],"text":"\n                      No genres found. Click &quot;Add New Genre\" to create one.\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[34519,34616],"text":"\n                      No genres found. Click &ldquo;Add New Genre\" to create one.\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[34519,34616],"text":"\n                      No genres found. Click &#34;Add New Genre\" to create one.\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[34519,34616],"text":"\n                      No genres found. Click &rdquo;Add New Genre\" to create one.\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":894,"column":60,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[34519,34616],"text":"\n                      No genres found. Click \"Add New Genre&quot; to create one.\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[34519,34616],"text":"\n                      No genres found. Click \"Add New Genre&ldquo; to create one.\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[34519,34616],"text":"\n                      No genres found. Click \"Add New Genre&#34; to create one.\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[34519,34616],"text":"\n                      No genres found. Click \"Add New Genre&rdquo; to create one.\n                    "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState, useRef, useCallback } from \"react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport AdminHeader from \"@/components/AdminHeader\";\nimport Link from \"next/link\";\nimport Loader from \"@/components/Loader\";\nimport AddBookModal from \"@/components/AddBookModal\";\nimport EditBookModal from \"@/components/EditBookModal\";\nimport { showError, showSuccess, showInput, showConfirm } from \"@/lib/swal\";\nimport swalTheme from \"@/lib/swal\";\nimport Swal from \"sweetalert2\";\n\nexport default function AdminBooksPage() {\n  const { userData } = useAuth();\n  const [books, setBooks] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [languageFilter, setLanguageFilter] = useState(\"all\");\n  const [categoryFilter, setCategoryFilter] = useState(\"\");\n  const [availabilityFilter, setAvailabilityFilter] = useState(\"all\");\n  const [isCategoryDropdownOpen, setIsCategoryDropdownOpen] = useState(false);\n  const [isFilterDropdownOpen, setIsFilterDropdownOpen] = useState(false);\n  const [stats, setStats] = useState({\n    totalInventory: 0,\n    borrowed: 0,\n    available: 0,\n    lowStock: 0,\n    overdueBooks: 0,\n    pendingReservations: 0,\n  });\n  const [pagination, setPagination] = useState({\n    page: 1,\n    limit: 10,\n    total: 0,\n    pages: 0,\n  });\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\n  const [editingBookId, setEditingBookId] = useState(null);\n  const [genres, setGenres] = useState([]);\n  const [genresLoading, setGenresLoading] = useState(true);\n  const categoryDropdownRef = useRef(null);\n  const filterDropdownRef = useRef(null);\n\n  const fetchBooks = useCallback(async () => {\n    try {\n      setLoading(true);\n      const params = new URLSearchParams({\n        page: pagination.page.toString(),\n        limit: pagination.limit.toString(),\n        ...(searchQuery && { search: searchQuery }),\n        ...(languageFilter &&\n          languageFilter !== \"all\" && { language: languageFilter }),\n        ...(categoryFilter && { category: categoryFilter }),\n        ...(availabilityFilter &&\n          availabilityFilter !== \"all\" && { availability: availabilityFilter }),\n      });\n      const response = await fetch(`/api/books?${params}`);\n      if (response.ok) {\n        const data = await response.json();\n        setBooks(data.books || []);\n        if (data.pagination) {\n          setPagination((prev) => ({\n            ...prev,\n            total: data.pagination.total || 0,\n            pages: data.pagination.pages || 0,\n          }));\n        }\n      }\n    } catch (error) {\n      console.error(\"Error fetching books:\", error);\n    } finally {\n      setLoading(false);\n    }\n  }, [\n    searchQuery,\n    languageFilter,\n    categoryFilter,\n    availabilityFilter,\n    pagination.page,\n    pagination.limit,\n  ]);\n\n  // Close dropdowns when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (\n        categoryDropdownRef.current &&\n        !categoryDropdownRef.current.contains(event.target)\n      ) {\n        setIsCategoryDropdownOpen(false);\n      }\n      if (\n        filterDropdownRef.current &&\n        !filterDropdownRef.current.contains(event.target)\n      ) {\n        setIsFilterDropdownOpen(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  // Debounce search query\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      fetchBooks();\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [fetchBooks]);\n\n  useEffect(() => {\n    fetchStats();\n    fetchGenres();\n  }, []);\n\n  const fetchStats = async () => {\n    try {\n      const response = await fetch(\"/api/admin/stats\");\n      if (response.ok) {\n        const data = await response.json();\n        setStats({\n          totalInventory: data.totalCopies || 0,\n          borrowed: data.borrowedCopies || 0,\n          available: data.availableCopies || 0,\n          lowStock: data.lowStock || 0,\n          overdueBooks: data.overdueBooks || 0,\n          pendingReservations: data.pendingReservations || 0,\n        });\n      }\n    } catch (error) {\n      console.error(\"Error fetching stats:\", error);\n    }\n  };\n\n  const fetchGenres = async () => {\n    try {\n      setGenresLoading(true);\n      const response = await fetch(\"/api/categories?isActive=true\");\n      if (response.ok) {\n        const data = await response.json();\n        setGenres(data);\n      } else {\n        showError(\"Error\", \"Failed to fetch genres\");\n      }\n    } catch (error) {\n      console.error(\"Error fetching genres:\", error);\n      showError(\"Error\", \"Failed to fetch genres\");\n    } finally {\n      setGenresLoading(false);\n    }\n  };\n\n  // Close dropdowns when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (\n        categoryDropdownRef.current &&\n        !categoryDropdownRef.current.contains(event.target)\n      ) {\n        setIsCategoryDropdownOpen(false);\n      }\n      if (\n        filterDropdownRef.current &&\n        !filterDropdownRef.current.contains(event.target)\n      ) {\n        setIsFilterDropdownOpen(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  // Debounce search query\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      fetchBooks();\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [searchQuery, languageFilter, categoryFilter, availabilityFilter]);\n\n  useEffect(() => {\n    fetchStats();\n    fetchGenres();\n  }, []);\n\n  const handleEditBook = (bookId) => {\n    setEditingBookId(bookId);\n    setIsEditModalOpen(true);\n  };\n\n  const handleManageStock = async (bookId, bookTitle) => {\n    // Fetch current stock count\n    let currentStock = 0;\n    try {\n      const bookResponse = await fetch(`/api/books/${bookId}`);\n      if (bookResponse.ok) {\n        const bookData = await bookResponse.json();\n        currentStock = bookData.totalCopies || 0;\n      }\n    } catch (error) {\n      console.error(\"Error fetching book stock:\", error);\n    }\n\n    // Show input for stock count with current value\n    const result = await showInput(\n      \"Manage Stock\",\n      `Enter the number of copies for \"${bookTitle}\"`,\n      { input: \"number\" },\n      {\n        inputPlaceholder: \"Enter number of copies...\",\n        inputValue: currentStock.toString(),\n        inputValidator: (value) => {\n          const num = parseInt(value);\n          if (value === \"\" || isNaN(num) || num < 0) {\n            return \"Please enter a valid number (minimum 0)\";\n          }\n          if (num > 1000) {\n            return \"Maximum 1000 copies allowed\";\n          }\n          return null;\n        },\n        confirmButtonText: \"Update Stock\",\n        cancelButtonText: \"Cancel\",\n      },\n    );\n\n    if (result.isConfirmed && result.value) {\n      try {\n        const stockCount = parseInt(result.value);\n\n        const response = await fetch(`/api/books/${bookId}/stock`, {\n          method: \"PATCH\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            copies: stockCount,\n          }),\n        });\n\n        let data;\n        try {\n          data = await response.json();\n        } catch (jsonError) {\n          console.error(\"Error parsing JSON response:\", jsonError);\n          showError(\n            \"Error\",\n            `Server error (${response.status}). Please check the server logs.`,\n          );\n          return;\n        }\n\n        if (response.ok) {\n          showSuccess(\n            \"Stock Updated!\",\n            `Stock count for \"${bookTitle}\" has been updated to ${stockCount} copies.`,\n          );\n          fetchBooks(); // Refresh the books list\n          fetchStats(); // Refresh stats\n        } else {\n          const errorMessage =\n            data?.error ||\n            data?.message ||\n            `Failed to update stock (${response.status})`;\n          showError(\"Error\", errorMessage);\n        }\n      } catch (error) {\n        console.error(\"Error updating stock:\", error);\n        showError(\n          \"Error\",\n          error.message || \"Failed to update stock. Please try again.\",\n        );\n      }\n    }\n  };\n\n  const handleDeleteBook = async (bookId, bookTitle) => {\n    const result = await showConfirm(\n      \"Delete Book\",\n      `Are you sure you want to delete \"${bookTitle}\"? This action will deactivate the book and all its copies.`,\n      {\n        confirmButtonText: \"Delete\",\n        cancelButtonText: \"Cancel\",\n      },\n    );\n\n    if (result.isConfirmed) {\n      try {\n        const response = await fetch(`/api/books/${bookId}`, {\n          method: \"DELETE\",\n        });\n\n        let data;\n        try {\n          data = await response.json();\n        } catch (jsonError) {\n          console.error(\"Error parsing JSON response:\", jsonError);\n          showError(\n            \"Error\",\n            `Server error (${response.status}). Please check the server logs.`,\n          );\n          return;\n        }\n\n        if (response.ok) {\n          showSuccess(\n            \"Book Deleted!\",\n            `\"${bookTitle}\" has been successfully deleted.`,\n          );\n          fetchBooks(); // Refresh the books list\n          fetchStats(); // Refresh stats\n        } else {\n          const errorMessage =\n            data?.error ||\n            data?.message ||\n            `Failed to delete book (${response.status})`;\n          showError(\"Error\", errorMessage);\n        }\n      } catch (error) {\n        console.error(\"Error deleting book:\", error);\n        showError(\n          \"Error\",\n          error.message || \"Failed to delete book. Please try again.\",\n        );\n      }\n    }\n  };\n\n  const handleDeleteGenre = async (genreId, genreName) => {\n    const result = await showConfirm(\n      \"Delete Genre\",\n      `Are you sure you want to delete the genre \"${genreName}\"? This action cannot be undone.`,\n      {\n        confirmButtonText: \"Delete\",\n        cancelButtonText: \"Cancel\",\n      },\n    );\n\n    if (result.isConfirmed) {\n      try {\n        const response = await fetch(`/api/categories?id=${genreId}`, {\n          method: \"DELETE\",\n        });\n\n        let data;\n        try {\n          data = await response.json();\n        } catch (jsonError) {\n          console.error(\"Error parsing JSON response:\", jsonError);\n          showError(\n            \"Error\",\n            `Server error (${response.status}). Please check the server logs.`,\n          );\n          return;\n        }\n\n        if (response.ok) {\n          showSuccess(\n            \"Genre Deleted!\",\n            `The genre \"${genreName}\" has been successfully deleted.`,\n          );\n          fetchGenres(); // Refresh the genres list\n        } else {\n          const errorMessage =\n            data?.error ||\n            data?.message ||\n            `Failed to delete genre (${response.status})`;\n          showError(\"Error\", errorMessage);\n        }\n      } catch (error) {\n        console.error(\"Error deleting genre:\", error);\n        showError(\n          \"Error\",\n          error.message || \"Failed to delete genre. Please try again.\",\n        );\n      }\n    }\n  };\n\n  const handleAddGenre = async () => {\n    const result = await swalTheme.fire({\n      title: \"Add New Genre\",\n      html: `\n        <div style=\"text-align: left; margin-top: 1rem;\">\n          <label style=\"display: block; color: #b791ca; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;\">\n            Genre Name <span style=\"color: #ef4444;\">*</span>\n          </label>\n          <input \n            id=\"swal-genre-name\" \n            class=\"swal-input\" \n            type=\"text\" \n            placeholder=\"e.g. Fiction, Science Fiction, Mystery...\"\n            style=\"width: 100%;\"\n            maxlength=\"100\"\n          />\n        </div>\n      `,\n      focusConfirm: false,\n      showCancelButton: true,\n      confirmButtonText: \"Create Genre\",\n      cancelButtonText: \"Cancel\",\n      confirmButtonColor: \"#aa1fef\",\n      cancelButtonColor: \"#3c2348\",\n      background: \"#1c1c1c\",\n      color: \"#ffffff\",\n      customClass: {\n        popup: \"swal-popup\",\n        confirmButton: \"swal-confirm\",\n        cancelButton: \"swal-cancel\",\n      },\n      preConfirm: () => {\n        const nameInput = document.getElementById(\"swal-genre-name\");\n        const name = nameInput?.value?.trim() || \"\";\n\n        if (!name || name.length === 0) {\n          Swal.showValidationMessage(\"Genre name is required\");\n          return false;\n        }\n        if (name.length < 2) {\n          Swal.showValidationMessage(\n            \"Genre name must be at least 2 characters\",\n          );\n          return false;\n        }\n        if (name.length > 100) {\n          Swal.showValidationMessage(\n            \"Genre name must be no more than 100 characters\",\n          );\n          return false;\n        }\n\n        return { name };\n      },\n    });\n\n    if (result.isConfirmed && result.value) {\n      try {\n        const response = await fetch(\"/api/categories\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            name: result.value.name,\n          }),\n        });\n\n        let data;\n        try {\n          data = await response.json();\n        } catch (jsonError) {\n          console.error(\"Error parsing JSON response:\", jsonError);\n          showError(\n            \"Error\",\n            `Server error (${response.status}). Please check the server logs.`,\n          );\n          return;\n        }\n\n        if (response.ok) {\n          showSuccess(\n            \"Genre Created!\",\n            `The genre \"${data.category.name}\" has been successfully created.`,\n          );\n          fetchGenres(); // Refresh the genres list\n        } else {\n          const errorMessage =\n            data?.error ||\n            data?.message ||\n            `Failed to create genre (${response.status})`;\n          showError(\"Error\", errorMessage);\n        }\n      } catch (error) {\n        console.error(\"Error creating genre:\", error);\n        showError(\n          \"Error\",\n          error.message || \"Failed to create genre. Please try again.\",\n        );\n      }\n    }\n  };\n\n  const getStockStatus = (book) => {\n    const available = book.availableCopies || 0;\n    if (available === 0)\n      return { label: \"Out of Stock\", color: \"red\", textColor: \"red-400\" };\n    if (available <= 3)\n      return { label: \"Low Stock\", color: \"orange\", textColor: \"orange-400\" };\n    return { label: \"Available\", color: \"emerald\", textColor: \"emerald-400\" };\n  };\n\n  return (\n    <>\n      <AdminHeader\n        title=\"Admin Books Management\"\n        subtitle=\"Comprehensive inventory control, stock management, and catalog reporting.\"\n      />\n      <div className=\"flex-1 overflow-y-auto\">\n        <header className=\"px-8 py-6 border-b border-white/5 bg-background-dark z-10\">\n          <div className=\"flex flex-col gap-6\">\n            <div className=\"flex flex-col md:flex-row md:items-start md:justify-between gap-4\">\n              <div className=\"flex flex-col gap-1\">\n                <div className=\"flex items-center gap-2 text-text-secondary text-sm\">\n                  <span className=\"hover:text-white cursor-pointer transition-colors\">\n                    Dashboard\n                  </span>\n                  <span className=\"material-symbols-outlined text-[16px]\">\n                    chevron_right\n                  </span>\n                  <span className=\"text-white font-medium\">\n                    Books Management\n                  </span>\n                </div>\n                <h1 className=\"text-3xl font-bold text-white tracking-tight mt-1\">\n                  Admin Books Management\n                </h1>\n                <p className=\"text-text-secondary text-sm max-w-2xl mt-1\">\n                  Comprehensive inventory control, stock management, and catalog\n                  reporting.\n                </p>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <button className=\"flex items-center gap-2 bg-card-dark hover:bg-white/5 text-text-secondary hover:text-white px-4 py-2.5 rounded-lg font-medium transition-all border border-white/5 shadow-md\">\n                  <span className=\"material-symbols-outlined text-[20px]\">\n                    description\n                  </span>\n                  Reports\n                </button>\n                <button className=\"flex items-center gap-2 bg-card-dark hover:bg-white/5 text-text-secondary hover:text-white px-4 py-2.5 rounded-lg font-medium transition-all border border-white/5 shadow-md\">\n                  <span className=\"material-symbols-outlined text-[20px]\">\n                    upload_file\n                  </span>\n                  Bulk Import\n                </button>\n                <button\n                  onClick={() => setIsAddModalOpen(true)}\n                  className=\"flex items-center gap-2 bg-primary hover:bg-primary-hover text-white px-5 py-2.5 rounded-lg font-semibold transition-all shadow-lg shadow-primary/20\"\n                >\n                  <span className=\"material-symbols-outlined text-[20px]\">\n                    add\n                  </span>\n                  Add New Book\n                </button>\n              </div>\n            </div>\n            {/* Stats Cards */}\n            <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n              <div className=\"bg-card-dark p-4 rounded-xl border border-white/5 flex items-center gap-4 hover:border-primary/50 transition-colors group cursor-pointer shadow-lg\">\n                <div className=\"h-12 w-12 rounded-lg bg-blue-500/10 flex items-center justify-center text-blue-400 group-hover:scale-110 transition-transform\">\n                  <span className=\"material-symbols-outlined\">\n                    library_books\n                  </span>\n                </div>\n                <div>\n                  <p className=\"text-text-secondary text-xs font-medium uppercase tracking-wider\">\n                    Total Inventory\n                  </p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {stats.totalInventory.toLocaleString()}\n                  </p>\n                </div>\n              </div>\n              <div className=\"bg-card-dark p-4 rounded-xl border border-white/5 flex items-center gap-4 hover:border-primary/50 transition-colors group cursor-pointer shadow-lg\">\n                <div className=\"h-12 w-12 rounded-lg bg-amber-500/10 flex items-center justify-center text-amber-400 group-hover:scale-110 transition-transform\">\n                  <span className=\"material-symbols-outlined\">outbound</span>\n                </div>\n                <div>\n                  <p className=\"text-text-secondary text-xs font-medium uppercase tracking-wider\">\n                    Borrowed\n                  </p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {stats.borrowed.toLocaleString()}\n                  </p>\n                </div>\n              </div>\n              <div className=\"bg-card-dark p-4 rounded-xl border border-white/5 flex items-center gap-4 hover:border-primary/50 transition-colors group cursor-pointer shadow-lg\">\n                <div className=\"h-12 w-12 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400 group-hover:scale-110 transition-transform\">\n                  <span className=\"material-symbols-outlined\">\n                    check_circle\n                  </span>\n                </div>\n                <div>\n                  <p className=\"text-text-secondary text-xs font-medium uppercase tracking-wider\">\n                    Available\n                  </p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {stats.available.toLocaleString()}\n                  </p>\n                </div>\n              </div>\n              <div className=\"bg-card-dark p-4 rounded-xl border border-white/5 flex items-center gap-4 hover:border-primary/50 transition-colors group cursor-pointer shadow-lg\">\n                <div className=\"h-12 w-12 rounded-lg bg-red-500/10 flex items-center justify-center text-red-400 group-hover:scale-110 transition-transform\">\n                  <span className=\"material-symbols-outlined\">warning</span>\n                </div>\n                <div>\n                  <p className=\"text-text-secondary text-xs font-medium uppercase tracking-wider\">\n                    Low Stock\n                  </p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {stats.lowStock}\n                  </p>\n                </div>\n              </div>\n              <div className=\"bg-card-dark p-4 rounded-xl border border-white/5 flex items-center gap-4 hover:border-red-500/50 transition-colors group cursor-pointer shadow-lg\">\n                <div className=\"h-12 w-12 rounded-lg bg-red-500/10 flex items-center justify-center text-red-400 group-hover:scale-110 transition-transform\">\n                  <span className=\"material-symbols-outlined\">schedule</span>\n                </div>\n                <div>\n                  <p className=\"text-text-secondary text-xs font-medium uppercase tracking-wider\">\n                    Overdue Books\n                  </p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {stats.overdueBooks.toLocaleString()}\n                  </p>\n                </div>\n              </div>\n              <div className=\"bg-card-dark p-4 rounded-xl border border-white/5 flex items-center gap-4 hover:border-yellow-500/50 transition-colors group cursor-pointer shadow-lg\">\n                <div className=\"h-12 w-12 rounded-lg bg-yellow-500/10 flex items-center justify-center text-yellow-400 group-hover:scale-110 transition-transform\">\n                  <span className=\"material-symbols-outlined\">bookmark</span>\n                </div>\n                <div>\n                  <p className=\"text-text-secondary text-xs font-medium uppercase tracking-wider\">\n                    Pending Reservations\n                  </p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {stats.pendingReservations.toLocaleString()}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        <div className=\"px-8 py-4 bg-background-dark/90 border-b border-white/5 flex flex-col sm:flex-row gap-4 items-center justify-between sticky top-0 z-10 backdrop-blur-md shadow-md\">\n          <div className=\"flex-1 w-full sm:w-auto relative max-w-md\">\n            <span className=\"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary\">\n              search\n            </span>\n            <input\n              className=\"w-full bg-card-dark border border-white/5 text-white placeholder-text-secondary pl-10 pr-4 py-2.5 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:outline-none text-sm transition-all shadow-sm\"\n              placeholder=\"Search by title, ISBN, author...\"\n              type=\"text\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n            />\n          </div>\n          <div className=\"flex items-center gap-3 w-full sm:w-auto overflow-x-auto pb-2 sm:pb-0\">\n            <div className=\"flex items-center gap-2 bg-card-dark rounded-lg p-1 border border-white/5 shadow-sm\">\n              <button\n                onClick={() => setLanguageFilter(\"all\")}\n                className={`px-3 py-1.5 rounded text-sm font-medium transition-colors ${\n                  languageFilter === \"all\"\n                    ? \"bg-primary/20 text-white\"\n                    : \"hover:bg-white/5 text-text-secondary hover:text-white\"\n                }`}\n              >\n                All\n              </button>\n              <button\n                onClick={() => setLanguageFilter(\"en\")}\n                className={`px-3 py-1.5 rounded text-sm font-medium transition-colors ${\n                  languageFilter === \"en\"\n                    ? \"bg-primary/20 text-white\"\n                    : \"hover:bg-white/5 text-text-secondary hover:text-white\"\n                }`}\n              >\n                English\n              </button>\n              <button\n                onClick={() => setLanguageFilter(\"bn\")}\n                className={`px-3 py-1.5 rounded text-sm font-medium transition-colors ${\n                  languageFilter === \"bn\"\n                    ? \"bg-primary/20 text-white\"\n                    : \"hover:bg-white/5 text-text-secondary hover:text-white\"\n                }`}\n              >\n                Bangla\n              </button>\n            </div>\n            <div className=\"h-6 w-px bg-white/5 mx-1 hidden sm:block\"></div>\n            <div className=\"relative\" ref={categoryDropdownRef}>\n              <button\n                onClick={() =>\n                  setIsCategoryDropdownOpen(!isCategoryDropdownOpen)\n                }\n                className=\"flex items-center gap-2 px-3 py-2 bg-card-dark hover:bg-white/5 rounded-lg text-text-secondary hover:text-white text-sm font-medium transition-colors border border-white/5 whitespace-nowrap shadow-sm\"\n              >\n                <span className=\"material-symbols-outlined text-[18px]\">\n                  category\n                </span>\n                Categories\n                <span className=\"material-symbols-outlined text-[14px]\">\n                  {isCategoryDropdownOpen ? \"expand_less\" : \"expand_more\"}\n                </span>\n              </button>\n              {isCategoryDropdownOpen && (\n                <div className=\"absolute right-0 mt-2 w-64 rounded-lg bg-card-dark border border-white/5 shadow-xl z-50 max-h-80 overflow-y-auto\">\n                  <div className=\"p-2\">\n                    <button\n                      onClick={() => {\n                        setCategoryFilter(\"\");\n                        setIsCategoryDropdownOpen(false);\n                      }}\n                      className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${\n                        categoryFilter === \"\"\n                          ? \"bg-primary/20 text-white\"\n                          : \"text-text-secondary hover:bg-white/5 hover:text-white\"\n                      }`}\n                    >\n                      All Categories\n                    </button>\n                    {genres.map((genre) => (\n                      <button\n                        key={genre._id}\n                        onClick={() => {\n                          setCategoryFilter(genre._id);\n                          setIsCategoryDropdownOpen(false);\n                        }}\n                        className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${\n                          categoryFilter === genre._id\n                            ? \"bg-primary/20 text-white\"\n                            : \"text-text-secondary hover:bg-white/5 hover:text-white\"\n                        }`}\n                      >\n                        {genre.name}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n            <div className=\"relative\" ref={filterDropdownRef}>\n              <button\n                onClick={() => setIsFilterDropdownOpen(!isFilterDropdownOpen)}\n                className=\"flex items-center gap-2 px-3 py-2 bg-card-dark hover:bg-white/5 rounded-lg text-text-secondary hover:text-white text-sm font-medium transition-colors border border-white/5 whitespace-nowrap shadow-sm\"\n              >\n                <span className=\"material-symbols-outlined text-[18px]\">\n                  filter_list\n                </span>\n                Filters\n                <span className=\"material-symbols-outlined text-[14px]\">\n                  {isFilterDropdownOpen ? \"expand_less\" : \"expand_more\"}\n                </span>\n              </button>\n              {isFilterDropdownOpen && (\n                <div className=\"absolute right-0 mt-2 w-56 rounded-lg bg-card-dark border border-white/5 shadow-xl z-50\">\n                  <div className=\"p-2\">\n                    <div className=\"px-3 py-2 text-xs font-semibold text-text-secondary uppercase tracking-wider mb-1\">\n                      Availability\n                    </div>\n                    <button\n                      onClick={() => {\n                        setAvailabilityFilter(\"all\");\n                        setIsFilterDropdownOpen(false);\n                      }}\n                      className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${\n                        availabilityFilter === \"all\"\n                          ? \"bg-primary/20 text-white\"\n                          : \"text-text-secondary hover:bg-white/5 hover:text-white\"\n                      }`}\n                    >\n                      All Books\n                    </button>\n                    <button\n                      onClick={() => {\n                        setAvailabilityFilter(\"available\");\n                        setIsFilterDropdownOpen(false);\n                      }}\n                      className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${\n                        availabilityFilter === \"available\"\n                          ? \"bg-primary/20 text-white\"\n                          : \"text-text-secondary hover:bg-white/5 hover:text-white\"\n                      }`}\n                    >\n                      Available\n                    </button>\n                    <button\n                      onClick={() => {\n                        setAvailabilityFilter(\"waitlist\");\n                        setIsFilterDropdownOpen(false);\n                      }}\n                      className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${\n                        availabilityFilter === \"waitlist\"\n                          ? \"bg-primary/20 text-white\"\n                          : \"text-text-secondary hover:bg-white/5 hover:text-white\"\n                      }`}\n                    >\n                      Waitlist Only\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n            <div className=\"flex items-center gap-2 bg-card-dark border border-white/5 rounded-lg px-3 py-2 shadow-sm\">\n              <span className=\"text-xs text-text-secondary uppercase font-semibold\">\n                Rows:\n              </span>\n              <select\n                className=\"bg-transparent text-white text-sm outline-none cursor-pointer\"\n                value={pagination.limit}\n                onChange={(e) => {\n                  setPagination((prev) => ({\n                    ...prev,\n                    limit: parseInt(e.target.value),\n                    page: 1,\n                  }));\n                }}\n              >\n                <option value=\"10\" className=\"bg-card-dark\">\n                  10\n                </option>\n                <option value=\"20\" className=\"bg-card-dark\">\n                  20\n                </option>\n                <option value=\"50\" className=\"bg-card-dark\">\n                  50\n                </option>\n                <option value=\"100\" className=\"bg-card-dark\">\n                  100\n                </option>\n              </select>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-auto p-8 pt-6 space-y-6\">\n          {/* Genres Table Section */}\n          <div className=\"bg-card-dark rounded-xl border border-white/5 shadow-xl overflow-hidden\">\n            <div className=\"px-6 py-4 bg-background-dark border-b border-white/5 flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-xl font-bold text-white\">Genres</h2>\n                <p className=\"text-text-secondary text-sm mt-1\">\n                  Manage book genres and categories\n                </p>\n              </div>\n              <button\n                onClick={handleAddGenre}\n                className=\"flex items-center gap-2 bg-primary hover:bg-primary-hover text-white px-4 py-2 rounded-lg font-semibold transition-all shadow-lg shadow-primary/20\"\n              >\n                <span className=\"material-symbols-outlined text-[20px]\">\n                  add\n                </span>\n                Add New Genre\n              </button>\n            </div>\n            <table className=\"w-full text-left border-collapse\">\n              <thead className=\"bg-background-dark\">\n                <tr className=\"border-b border-white/5\">\n                  <th className=\"px-6 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider\">\n                    Name\n                  </th>\n                  <th className=\"px-6 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider\">\n                    Slug\n                  </th>\n                  <th className=\"px-6 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider\">\n                    Status\n                  </th>\n                  <th className=\"px-6 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider text-right\">\n                    Created\n                  </th>\n                  <th className=\"px-6 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider text-right\">\n                    Actions\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-white/5\">\n                {genresLoading ? (\n                  <tr>\n                    <td\n                      colSpan=\"5\"\n                      className=\"px-6 py-8 text-center text-text-secondary\"\n                    >\n                      <div className=\"flex justify-center\">\n                        <Loader />\n                      </div>\n                    </td>\n                  </tr>\n                ) : genres.length === 0 ? (\n                  <tr>\n                    <td\n                      colSpan=\"5\"\n                      className=\"px-6 py-8 text-center text-text-secondary\"\n                    >\n                      No genres found. Click \"Add New Genre\" to create one.\n                    </td>\n                  </tr>\n                ) : (\n                  genres.map((genre) => (\n                    <tr\n                      key={genre._id}\n                      className=\"group hover:bg-white/5 transition-colors\"\n                    >\n                      <td className=\"px-6 py-4\">\n                        <div className=\"flex items-center gap-2\">\n                          {genre.icon && (\n                            <span className=\"material-symbols-outlined text-text-secondary text-[18px]\">\n                              {genre.icon}\n                            </span>\n                          )}\n                          <span className=\"text-white font-semibold text-sm\">\n                            {genre.name.charAt(0).toUpperCase() +\n                              genre.name.slice(1)}\n                          </span>\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <span className=\"font-mono text-xs text-text-secondary tracking-wide\">\n                          {genre.slug}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <span\n                          className={`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${\n                            genre.isActive\n                              ? \"bg-emerald-500/10 text-emerald-300 border border-emerald-500/20\"\n                              : \"bg-red-500/10 text-red-300 border border-red-500/20\"\n                          }`}\n                        >\n                          {genre.isActive ? \"Active\" : \"Inactive\"}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 text-right\">\n                        <span className=\"text-text-secondary text-xs\">\n                          {genre.createdAt\n                            ? new Date(genre.createdAt).toLocaleDateString()\n                            : \"N/A\"}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 text-right\">\n                        <button\n                          onClick={() =>\n                            handleDeleteGenre(genre._id, genre.name)\n                          }\n                          className=\"p-1.5 rounded-lg text-text-secondary hover:text-red-400 hover:bg-red-500/10 transition-colors opacity-60 group-hover:opacity-100\"\n                          title=\"Delete Genre\"\n                        >\n                          <span className=\"material-symbols-outlined text-[18px]\">\n                            delete\n                          </span>\n                        </button>\n                      </td>\n                    </tr>\n                  ))\n                )}\n              </tbody>\n            </table>\n          </div>\n\n          {/* Books Table Section */}\n          <div className=\"bg-card-dark rounded-xl border border-white/5 shadow-xl overflow-hidden\">\n            <table className=\"w-full text-left border-collapse\">\n              <thead className=\"bg-background-dark\">\n                <tr className=\"border-b border-white/5\">\n                  <th className=\"px-6 py-4 w-12 text-center\">\n                    <input\n                      className=\"rounded border-white/5 bg-background-dark text-primary focus:ring-primary/50 cursor-pointer\"\n                      type=\"checkbox\"\n                    />\n                  </th>\n                  <th className=\"px-4 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider w-20\">\n                    Thumbnail\n                  </th>\n                  <th className=\"px-4 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider\">\n                    Book Details\n                  </th>\n                  <th className=\"px-4 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider w-36\">\n                    ISBN\n                  </th>\n                  <th className=\"px-4 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider w-24 text-center\">\n                    Total\n                  </th>\n                  <th className=\"px-4 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider w-24 text-center\">\n                    Available\n                  </th>\n                  <th className=\"px-4 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider w-32\">\n                    Shelf\n                  </th>\n                  <th className=\"px-6 py-4 text-xs font-bold text-text-secondary uppercase tracking-wider w-44 text-right\">\n                    Actions\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-white/5\">\n                {loading ? (\n                  <tr>\n                    <td\n                      colSpan=\"8\"\n                      className=\"px-6 py-8 text-center text-text-secondary\"\n                    >\n                      <div className=\"flex justify-center\">\n                        <Loader />\n                      </div>\n                    </td>\n                  </tr>\n                ) : books.length === 0 ? (\n                  <tr>\n                    <td\n                      colSpan=\"8\"\n                      className=\"px-6 py-8 text-center text-text-secondary\"\n                    >\n                      No books found\n                    </td>\n                  </tr>\n                ) : (\n                  books.map((book) => {\n                    const stockStatus = getStockStatus(book);\n                    return (\n                      <tr\n                        key={book._id}\n                        className=\"group hover:bg-white/5 transition-colors\"\n                      >\n                        <td className=\"px-6 py-4 text-center\">\n                          <input\n                            className=\"rounded border-white/5 bg-background-dark text-primary focus:ring-primary/50 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer\"\n                            type=\"checkbox\"\n                          />\n                        </td>\n                        <td className=\"px-4 py-4\">\n                          <div\n                            className=\"h-16 w-11 rounded bg-gray-700 bg-cover bg-center shadow-lg border border-white/5\"\n                            style={{\n                              backgroundImage: book.coverImage\n                                ? `url('${book.coverImage}')`\n                                : \"none\",\n                            }}\n                          ></div>\n                        </td>\n                        <td className=\"px-4 py-4\">\n                          <div className=\"flex flex-col\">\n                            <span className=\"text-white font-semibold text-sm group-hover:text-primary transition-colors cursor-pointer\">\n                              {book.title}\n                            </span>\n                            <span className=\"text-text-secondary text-xs mt-0.5\">\n                              {book.author}\n                            </span>\n                            {book.category && (\n                              <span className=\"inline-flex items-center gap-1.5 mt-1.5\">\n                                <span className=\"px-2 py-0.5 rounded text-[10px] font-medium bg-purple-500/10 text-purple-300 border border-purple-500/20\">\n                                  {book.category.name}\n                                </span>\n                              </span>\n                            )}\n                          </div>\n                        </td>\n                        <td className=\"px-4 py-4\">\n                          <span className=\"font-mono text-xs text-text-secondary tracking-wide\">\n                            {book.isbn || \"N/A\"}\n                          </span>\n                        </td>\n                        <td className=\"px-4 py-4 text-center\">\n                          <span className=\"text-white font-bold text-sm\">\n                            {book.totalCopies || 0}\n                          </span>\n                        </td>\n                        <td className=\"px-4 py-4 text-center\">\n                          {stockStatus.color === \"red\" ? (\n                            <div className=\"flex flex-col items-center\">\n                              <span className=\"text-red-400 font-bold text-sm\">\n                                0\n                              </span>\n                              <span className=\"text-[10px] text-red-400/70\">\n                                Out of Stock\n                              </span>\n                            </div>\n                          ) : stockStatus.color === \"orange\" ? (\n                            <div className=\"flex flex-col items-center\">\n                              <span className=\"text-orange-400 font-bold text-sm\">\n                                {book.availableCopies || 0}\n                              </span>\n                              <span className=\"text-[10px] text-orange-400/70\">\n                                Low Stock\n                              </span>\n                            </div>\n                          ) : (\n                            <span className=\"text-emerald-400 font-bold text-sm\">\n                              {book.availableCopies || 0}\n                            </span>\n                          )}\n                        </td>\n                        <td className=\"px-4 py-4\">\n                          <div className=\"flex items-center gap-1.5\">\n                            <span className=\"material-symbols-outlined text-text-secondary text-[16px]\">\n                              shelves\n                            </span>\n                            <span className=\"text-white text-sm\">A4-102</span>\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 text-right\">\n                          <div className=\"flex items-center justify-end gap-2 opacity-60 group-hover:opacity-100 transition-opacity\">\n                            <button\n                              onClick={() => handleEditBook(book._id)}\n                              className=\"p-1.5 rounded-lg text-text-secondary hover:text-white hover:bg-white/5 transition-colors\"\n                              title=\"Edit Details\"\n                            >\n                              <span className=\"material-symbols-outlined text-[18px]\">\n                                edit\n                              </span>\n                            </button>\n                            <button\n                              onClick={() =>\n                                handleManageStock(book._id, book.title)\n                              }\n                              className=\"p-1.5 rounded-lg text-text-secondary hover:text-blue-400 hover:bg-blue-500/10 transition-colors\"\n                              title=\"Manage Stock\"\n                            >\n                              <span className=\"material-symbols-outlined text-[18px]\">\n                                inventory_2\n                              </span>\n                            </button>\n                            <button\n                              onClick={() =>\n                                handleDeleteBook(book._id, book.title)\n                              }\n                              className=\"p-1.5 rounded-lg text-text-secondary hover:text-red-400 hover:bg-red-500/10 transition-colors\"\n                              title=\"Delete Book\"\n                            >\n                              <span className=\"material-symbols-outlined text-[18px]\">\n                                delete\n                              </span>\n                            </button>\n                          </div>\n                        </td>\n                      </tr>\n                    );\n                  })\n                )}\n              </tbody>\n            </table>\n            <div className=\"px-6 py-4 bg-background-dark border-t border-white/5 flex flex-wrap items-center justify-between gap-4\">\n              <div className=\"text-sm text-text-secondary\">\n                Showing{\" \"}\n                <span className=\"font-semibold text-white\">\n                  {pagination.total > 0\n                    ? (pagination.page - 1) * pagination.limit + 1\n                    : 0}\n                </span>{\" \"}\n                to{\" \"}\n                <span className=\"font-semibold text-white\">\n                  {Math.min(\n                    pagination.page * pagination.limit,\n                    pagination.total,\n                  )}\n                </span>{\" \"}\n                of{\" \"}\n                <span className=\"font-semibold text-white\">\n                  {pagination.total.toLocaleString()}\n                </span>{\" \"}\n                entries\n              </div>\n              {pagination.total > 0 && (\n                <div className=\"flex items-center gap-1.5\">\n                  <button\n                    onClick={() =>\n                      setPagination((prev) => ({ ...prev, page: 1 }))\n                    }\n                    disabled={pagination.page === 1}\n                    className=\"flex items-center justify-center h-8 w-8 rounded hover:bg-white/5 text-text-secondary disabled:opacity-50 transition-colors\"\n                  >\n                    <span className=\"material-symbols-outlined text-[18px]\">\n                      first_page\n                    </span>\n                  </button>\n                  <button\n                    onClick={() =>\n                      setPagination((prev) => ({\n                        ...prev,\n                        page: Math.max(1, prev.page - 1),\n                      }))\n                    }\n                    disabled={pagination.page === 1}\n                    className=\"flex items-center justify-center h-8 w-8 rounded hover:bg-white/5 text-text-secondary disabled:opacity-50 transition-colors\"\n                  >\n                    <span className=\"material-symbols-outlined text-[18px]\">\n                      chevron_left\n                    </span>\n                  </button>\n\n                  {Array.from(\n                    { length: Math.min(5, pagination.pages) },\n                    (_, i) => {\n                      let pageNum;\n                      if (pagination.pages <= 5) {\n                        pageNum = i + 1;\n                      } else if (pagination.page <= 3) {\n                        pageNum = i + 1;\n                      } else if (pagination.page >= pagination.pages - 2) {\n                        pageNum = pagination.pages - 4 + i;\n                      } else {\n                        pageNum = pagination.page - 2 + i;\n                      }\n\n                      return (\n                        <button\n                          key={pageNum}\n                          onClick={() =>\n                            setPagination((prev) => ({\n                              ...prev,\n                              page: pageNum,\n                            }))\n                          }\n                          className={`h-8 w-8 rounded text-sm font-medium flex items-center justify-center transition-colors ${\n                            pagination.page === pageNum\n                              ? \"bg-primary text-white shadow-lg shadow-primary/20\"\n                              : \"hover:bg-white/5 text-text-secondary\"\n                          }`}\n                        >\n                          {pageNum}\n                        </button>\n                      );\n                    },\n                  )}\n\n                  <button\n                    onClick={() =>\n                      setPagination((prev) => ({\n                        ...prev,\n                        page: Math.min(prev.pages, prev.page + 1),\n                      }))\n                    }\n                    disabled={pagination.page >= pagination.pages}\n                    className=\"flex items-center justify-center h-8 w-8 rounded hover:bg-white/5 text-text-secondary disabled:opacity-50 transition-colors\"\n                  >\n                    <span className=\"material-symbols-outlined text-[18px]\">\n                      chevron_right\n                    </span>\n                  </button>\n                  <button\n                    onClick={() =>\n                      setPagination((prev) => ({\n                        ...prev,\n                        page: pagination.pages,\n                      }))\n                    }\n                    disabled={pagination.page >= pagination.pages}\n                    className=\"flex items-center justify-center h-8 w-8 rounded hover:bg-white/5 text-text-secondary disabled:opacity-50 transition-colors\"\n                  >\n                    <span className=\"material-symbols-outlined text-[18px]\">\n                      last_page\n                    </span>\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Add Book Modal */}\n      <AddBookModal\n        isOpen={isAddModalOpen}\n        onClose={() => setIsAddModalOpen(false)}\n        onBookAdded={() => {\n          fetchBooks();\n          fetchStats();\n        }}\n      />\n\n      {/* Edit Book Modal */}\n      <EditBookModal\n        isOpen={isEditModalOpen}\n        onClose={() => {\n          setIsEditModalOpen(false);\n          setEditingBookId(null);\n        }}\n        onBookUpdated={() => {\n          fetchBooks();\n          fetchStats();\n        }}\n        bookId={editingBookId}\n      />\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\admin\\config\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\admin\\finance\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchFinanceData'. Either include it or remove the dependency array.","line":51,"column":6,"nodeType":"ArrayExpression","endLine":51,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [fetchFinanceData, timePeriod]","fix":{"range":[1786,1798],"text":"[fetchFinanceData, timePeriod]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState, useRef, useCallback } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport AdminHeader from '@/components/AdminHeader';\nimport { formatCurrency, formatDate, debounce } from '@/lib/utils';\nimport Loader from '@/components/Loader';\nimport { showSuccess, showError } from '@/lib/swal';\n\nexport default function AdminFinancePage() {\n  const { userData } = useAuth();\n  const [stats, setStats] = useState({\n    totalRevenue: 0,\n    finesCollected: 0,\n    subscriptionARR: 0,\n    payingMembers: 0,\n    revenueGrowth: 0,\n    pendingFines: 0,\n  });\n  const [transactions, setTransactions] = useState([]);\n  const [allTransactions, setAllTransactions] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [statusFilter, setStatusFilter] = useState('all');\n  const [isFilterDropdownOpen, setIsFilterDropdownOpen] = useState(false);\n  const [timePeriod, setTimePeriod] = useState('7d');\n  const [revenueData, setRevenueData] = useState([]);\n  const [revenueBreakdown, setRevenueBreakdown] = useState({\n    subscriptions: { percentage: 0, amount: 0 },\n    fines: { percentage: 0, amount: 0 },\n    replacement: { percentage: 0, amount: 0 },\n  });\n  const filterDropdownRef = useRef(null);\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (filterDropdownRef.current && !filterDropdownRef.current.contains(event.target)) {\n        setIsFilterDropdownOpen(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, []);\n\n  useEffect(() => {\n    fetchFinanceData();\n  }, [timePeriod]);\n\n  // Filter transactions based on search and status\n  useEffect(() => {\n    let filtered = [...allTransactions];\n\n    // Apply search filter\n    if (searchQuery.trim()) {\n      const query = searchQuery.toLowerCase();\n      filtered = filtered.filter((tx) => {\n        const memberName = tx.member?.name?.toLowerCase() || '';\n        const memberEmail = tx.member?.email?.toLowerCase() || '';\n        const txId = tx._id?.toString().toLowerCase() || '';\n        return memberName.includes(query) || memberEmail.includes(query) || txId.includes(query);\n      });\n    }\n\n    // Apply status filter\n    if (statusFilter !== 'all') {\n      filtered = filtered.filter((tx) => tx.status === statusFilter);\n    }\n\n    setTransactions(filtered);\n  }, [searchQuery, statusFilter, allTransactions]);\n\n  const fetchFinanceData = async () => {\n    try {\n      setLoading(true);\n      const [statsRes, paymentsRes] = await Promise.all([\n        fetch('/api/admin/stats'),\n        fetch('/api/payments?limit=1000'),\n      ]);\n\n      if (statsRes.ok) {\n        const statsData = await statsRes.json();\n        \n        // Calculate subscription ARR (Annual Recurring Revenue)\n        const monthlyPrice = 9.99;\n        const subscriptionARR = (statsData.premiumUsers || 0) * monthlyPrice * 12;\n\n        setStats(prev => ({\n          totalRevenue: statsData.totalRevenue || 0,\n          finesCollected: prev.finesCollected || 0, // Will be updated when payments are loaded\n          subscriptionARR: subscriptionARR,\n          payingMembers: statsData.premiumUsers || 0,\n          revenueGrowth: parseFloat(statsData.revenueGrowth || 0),\n          pendingFines: statsData.pendingFines || 0,\n        }));\n\n        // Calculate revenue breakdown\n        if (statsData.revenueBreakdown && statsData.revenueBreakdown.length > 0) {\n          const subscriptionBreakdown = statsData.revenueBreakdown.find(r => r.type === 'subscription');\n          const fineBreakdown = statsData.revenueBreakdown.find(r => r.type === 'fine');\n          \n          setRevenueBreakdown({\n            subscriptions: {\n              percentage: subscriptionBreakdown?.percentage || 0,\n              amount: (statsData.totalRevenue || 0) * (subscriptionBreakdown?.percentage || 0) / 100,\n            },\n            fines: {\n              percentage: fineBreakdown?.percentage || 0,\n              amount: (statsData.totalRevenue || 0) * (fineBreakdown?.percentage || 0) / 100,\n            },\n            replacement: {\n              percentage: 0,\n              amount: 0,\n            },\n          });\n        }\n\n        // Calculate revenue chart data based on time period\n        calculateRevenueChart(statsData.monthlyRevenue || [], timePeriod);\n      }\n\n      if (paymentsRes.ok) {\n        const paymentsData = await paymentsRes.json();\n        const payments = paymentsData.payments || [];\n        setAllTransactions(payments);\n        setTransactions(payments);\n        \n        // Calculate fines collected from completed payments after transactions are loaded\n        const finesCollected = payments\n          .filter(tx => tx.status === 'completed' && (tx.fine || tx.type === 'fine'))\n          .reduce((sum, tx) => sum + (tx.amount || 0), 0);\n        \n        setStats(prev => ({\n          ...prev,\n          finesCollected: finesCollected,\n        }));\n      }\n    } catch (error) {\n      console.error('Error fetching finance data:', error);\n      showError('Error', 'Failed to fetch finance data. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const calculateRevenueChart = (monthlyRevenue, period) => {\n    const now = new Date();\n    const days = 7;\n    const dataPoints = 7; // Show daily for 7 days\n\n    // Generate daily data points\n    const chartData = [];\n    for (let i = days - 1; i >= 0; i--) {\n      const date = new Date(now);\n      date.setDate(date.getDate() - i);\n      \n      // For simplicity, distribute monthly revenue evenly across days\n      // In a real app, you'd fetch daily payment data\n      const monthIndex = monthlyRevenue.length - Math.floor(i / 30);\n      const monthData = monthlyRevenue[monthIndex] || { total: 0 };\n      const dailyAmount = monthData.total / 30;\n      \n      chartData.push({\n        date: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),\n        amount: dailyAmount,\n      });\n    }\n\n    setRevenueData(chartData);\n  };\n\n  const handleExportReport = () => {\n    try {\n      // Create CSV content\n      const headers = ['Transaction ID', 'Date', 'Member', 'Email', 'Type', 'Method', 'Amount', 'Status'];\n      const rows = transactions.map(tx => [\n        tx._id?.toString().slice(-6) || '',\n        formatDate(tx.createdAt),\n        tx.member?.name || 'Unknown',\n        tx.member?.email || 'N/A',\n        tx.type || 'Payment',\n        tx.paymentMethod || 'Card',\n        formatCurrency(tx.amount || 0),\n        tx.status || 'Pending',\n      ]);\n\n      const csvContent = [\n        headers.join(','),\n        ...rows.map(row => row.map(cell => `\"${cell}\"`).join(','))\n      ].join('\\n');\n\n      // Create blob and download\n      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n      const link = document.createElement('a');\n      const url = URL.createObjectURL(blob);\n      link.setAttribute('href', url);\n      link.setAttribute('download', `finance-report-${new Date().toISOString().split('T')[0]}.csv`);\n      link.style.visibility = 'hidden';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n\n      showSuccess('Export Successful', 'Finance report has been downloaded.');\n    } catch (error) {\n      console.error('Error exporting report:', error);\n      showError('Export Failed', 'Failed to export report. Please try again.');\n    }\n  };\n\n  return (\n    <>\n      <AdminHeader title=\"Finance Overview\" subtitle=\"Monitor revenue streams, fines collection, and subscription growth.\" />\n      <div className=\"flex-1 overflow-y-auto p-6 lg:p-10 scroll-smooth\">\n        <div className=\"max-w-7xl mx-auto space-y-8\">\n          <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-4\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-white tracking-tight mb-2\">Finance Overview</h1>\n              <p className=\"text-text-secondary\">Monitor revenue streams, fines collection, and subscription growth.</p>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <span className=\"text-sm text-text-secondary mr-2\">Last updated: Today, {new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</span>\n              <button className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-card-dark hover:bg-white/5 border border-white/5 text-white transition-all text-sm font-medium\">\n                <span className=\"material-symbols-outlined text-[18px]\">calendar_today</span>\n                {new Date().toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}\n              </button>\n              <button \n                onClick={handleExportReport}\n                className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary hover:bg-primary-hover text-white shadow-lg shadow-primary/25 transition-all text-sm font-medium\"\n              >\n                <span className=\"material-symbols-outlined text-[18px]\">download</span>\n                Export Report\n              </button>\n            </div>\n          </div>\n\n          {/* Stats Cards */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4\">\n            <div className=\"bg-card-dark border border-white/5 rounded-xl p-5 hover:border-primary/30 transition-colors shadow-sm relative overflow-hidden group\">\n              <div className=\"absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity\">\n                <span className=\"material-symbols-outlined text-6xl text-primary\">payments</span>\n              </div>\n              <p className=\"text-text-secondary text-sm font-medium mb-1\">Total Revenue</p>\n              <div className=\"flex items-baseline gap-2 mb-2\">\n                <h3 className=\"text-2xl font-bold text-white\">{loading ? '...' : formatCurrency(stats.totalRevenue)}</h3>\n              </div>\n              <div className=\"flex items-center gap-1.5 text-xs\">\n                <span className=\"bg-success-green/10 text-success-green px-1.5 py-0.5 rounded flex items-center gap-1 font-medium border border-success-green/20\">\n                  <span className=\"material-symbols-outlined text-[12px]\">trending_up</span> {stats.revenueGrowth}%\n                </span>\n                <span className=\"text-text-secondary\">vs last month</span>\n              </div>\n            </div>\n            <div className=\"bg-card-dark border border-white/5 rounded-xl p-5 hover:border-primary/30 transition-colors shadow-sm relative overflow-hidden group\">\n              <div className=\"absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity\">\n                <span className=\"material-symbols-outlined text-6xl text-orange-400\">gavel</span>\n              </div>\n              <p className=\"text-text-secondary text-sm font-medium mb-1\">Fines Collected</p>\n              <div className=\"flex items-baseline gap-2 mb-2\">\n                <h3 className=\"text-2xl font-bold text-white\">{loading ? '...' : formatCurrency(stats.finesCollected)}</h3>\n              </div>\n              <div className=\"flex items-center gap-1.5 text-xs\">\n                <span className=\"bg-red-500/10 text-red-400 px-1.5 py-0.5 rounded flex items-center gap-1 font-medium border border-red-500/20\">\n                  <span className=\"material-symbols-outlined text-[12px]\">trending_down</span> 2.1%\n                </span>\n                <span className=\"text-text-secondary\">vs last month</span>\n              </div>\n            </div>\n            <div className=\"bg-card-dark border border-white/5 rounded-xl p-5 hover:border-primary/30 transition-colors shadow-sm relative overflow-hidden group\">\n              <div className=\"absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity\">\n                <span className=\"material-symbols-outlined text-6xl text-blue-400\">card_membership</span>\n              </div>\n              <p className=\"text-text-secondary text-sm font-medium mb-1\">Subscription ARR</p>\n              <div className=\"flex items-baseline gap-2 mb-2\">\n                <h3 className=\"text-2xl font-bold text-white\">{loading ? '...' : formatCurrency(stats.subscriptionARR)}</h3>\n              </div>\n              <div className=\"flex items-center gap-1.5 text-xs\">\n                <span className=\"bg-success-green/10 text-success-green px-1.5 py-0.5 rounded flex items-center gap-1 font-medium border border-success-green/20\">\n                  <span className=\"material-symbols-outlined text-[12px]\">trending_up</span> 8.4%\n                </span>\n                <span className=\"text-text-secondary\">vs last year</span>\n              </div>\n            </div>\n            <div className=\"bg-card-dark border border-white/5 rounded-xl p-5 hover:border-primary/30 transition-colors shadow-sm relative overflow-hidden group\">\n              <div className=\"absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity\">\n                <span className=\"material-symbols-outlined text-6xl text-primary\">group</span>\n              </div>\n              <p className=\"text-text-secondary text-sm font-medium mb-1\">Paying Members</p>\n              <div className=\"flex items-baseline gap-2 mb-2\">\n                <h3 className=\"text-2xl font-bold text-white\">{loading ? '...' : stats.payingMembers.toLocaleString()}</h3>\n              </div>\n              <div className=\"flex items-center gap-1.5 text-xs\">\n                <span className=\"bg-success-green/10 text-success-green px-1.5 py-0.5 rounded flex items-center gap-1 font-medium border border-success-green/20\">\n                  <span className=\"material-symbols-outlined text-[12px]\">trending_up</span> 142\n                </span>\n                <span className=\"text-text-secondary\">new this month</span>\n              </div>\n            </div>\n            <div className=\"bg-card-dark border border-white/5 rounded-xl p-5 hover:border-orange-500/30 transition-colors shadow-sm relative overflow-hidden group\">\n              <div className=\"absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity\">\n                <span className=\"material-symbols-outlined text-6xl text-orange-400\">pending</span>\n              </div>\n              <p className=\"text-text-secondary text-sm font-medium mb-1\">Pending Fines</p>\n              <div className=\"flex items-baseline gap-2 mb-2\">\n                <h3 className=\"text-2xl font-bold text-white\">{loading ? '...' : stats.pendingFines.toLocaleString()}</h3>\n              </div>\n              <div className=\"flex items-center gap-1.5 text-xs\">\n                <span className=\"bg-orange-500/10 text-orange-400 px-1.5 py-0.5 rounded flex items-center gap-1 font-medium border border-orange-500/20\">\n                  <span className=\"material-symbols-outlined text-[12px]\">info</span> Unpaid\n                </span>\n                <span className=\"text-text-secondary\">requires action</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Revenue Chart and Breakdown */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            <div className=\"lg:col-span-2 bg-card-dark border border-white/5 rounded-xl p-6 shadow-sm\">\n              <div className=\"flex items-center justify-between mb-6\">\n                <div>\n                  <h3 className=\"text-lg font-bold text-white\">Revenue Analytics</h3>\n                  <p className=\"text-sm text-text-secondary\">Income from all sources over time</p>\n                </div>\n              </div>\n              <div className=\"h-[300px] w-full relative flex items-end justify-between gap-2\">\n                {revenueData.length > 0 ? (\n                  revenueData.map((data, index) => {\n                    const maxAmount = Math.max(...revenueData.map(d => d.amount), 1);\n                    const height = (data.amount / maxAmount) * 100;\n                    return (\n                      <div key={index} className=\"flex-1 flex flex-col items-center gap-2\" style={{ height: '100%' }}>\n                        <div className=\"w-full flex flex-col items-end justify-end\" style={{ height: '100%' }}>\n                          <div\n                            className=\"w-full bg-primary rounded-t transition-all hover:bg-primary-hover cursor-pointer\"\n                            style={{ height: `${Math.max(height, 5)}%`, minHeight: '4px' }}\n                            title={formatCurrency(data.amount)}\n                          ></div>\n                        </div>\n                        <span className=\"text-xs text-text-secondary font-medium\">\n                          {data.date}\n                        </span>\n                      </div>\n                    );\n                  })\n                ) : (\n                  <div className=\"w-full h-full flex items-center justify-center text-text-secondary\">\n                    No revenue data available\n                  </div>\n                )}\n              </div>\n            </div>\n            <div className=\"bg-card-dark border border-white/5 rounded-xl p-6 shadow-sm flex flex-col\">\n              <div className=\"mb-4\">\n                <h3 className=\"text-lg font-bold text-white\">Revenue Sources</h3>\n                <p className=\"text-sm text-text-secondary\">Breakdown by payment type</p>\n              </div>\n              <div className=\"flex-1 flex flex-col justify-center gap-6\">\n                <div className=\"space-y-4\">\n                  <div className=\"group\">\n                    <div className=\"flex justify-between text-sm mb-1\">\n                      <span className=\"text-white/70\">Subscriptions</span>\n                      <span className=\"text-white font-semibold\">{revenueBreakdown.subscriptions.percentage.toFixed(1)}%</span>\n                    </div>\n                    <div className=\"w-full bg-background-dark rounded-full h-2\">\n                      <div \n                        className=\"bg-primary h-2 rounded-full shadow-[0_0_10px_rgba(170,31,239,0.4)] transition-all\" \n                        style={{ width: `${revenueBreakdown.subscriptions.percentage}%` }}\n                      ></div>\n                    </div>\n                    <p className=\"text-xs text-text-secondary mt-1\">{formatCurrency(revenueBreakdown.subscriptions.amount)} total</p>\n                  </div>\n                  <div className=\"group\">\n                    <div className=\"flex justify-between text-sm mb-1\">\n                      <span className=\"text-white/70\">Late Fines</span>\n                      <span className=\"text-white font-semibold\">{revenueBreakdown.fines.percentage.toFixed(1)}%</span>\n                    </div>\n                    <div className=\"w-full bg-background-dark rounded-full h-2\">\n                      <div \n                        className=\"bg-orange-400 h-2 rounded-full transition-all\" \n                        style={{ width: `${revenueBreakdown.fines.percentage}%` }}\n                      ></div>\n                    </div>\n                    <p className=\"text-xs text-text-secondary mt-1\">{formatCurrency(revenueBreakdown.fines.amount)} total</p>\n                  </div>\n                  {revenueBreakdown.replacement.percentage > 0 && (\n                    <div className=\"group\">\n                      <div className=\"flex justify-between text-sm mb-1\">\n                        <span className=\"text-white/70\">Book Replacement</span>\n                        <span className=\"text-white font-semibold\">{revenueBreakdown.replacement.percentage.toFixed(1)}%</span>\n                      </div>\n                      <div className=\"w-full bg-background-dark rounded-full h-2\">\n                        <div \n                          className=\"bg-blue-400 h-2 rounded-full transition-all\" \n                          style={{ width: `${revenueBreakdown.replacement.percentage}%` }}\n                        ></div>\n                      </div>\n                      <p className=\"text-xs text-text-secondary mt-1\">{formatCurrency(revenueBreakdown.replacement.amount)} total</p>\n                    </div>\n                  )}\n                </div>\n                <div className=\"pt-4 border-t border-white/5\">\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-text-secondary\">Total processed</span>\n                    <span className=\"text-white font-bold\">{formatCurrency(stats.totalRevenue)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Recent Transactions */}\n          <div className=\"space-y-4\">\n            <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n              <h2 className=\"text-xl font-bold text-white\">Recent Transactions</h2>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"relative group\">\n                  <span className=\"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary transition-colors group-focus-within:text-primary\">search</span>\n                  <input\n                    className=\"bg-card-dark border border-white/5 rounded-lg py-2 pl-10 pr-4 text-sm text-white placeholder-text-secondary focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 w-full sm:w-64 transition-all\"\n                    placeholder=\"Search by user, ID...\"\n                    type=\"text\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                  />\n                </div>\n                <div className=\"relative\" ref={filterDropdownRef}>\n                  <button \n                    onClick={() => setIsFilterDropdownOpen(!isFilterDropdownOpen)}\n                    className=\"flex items-center gap-2 px-3 py-2 rounded-lg border border-white/5 bg-card-dark hover:bg-white/5 text-white text-sm transition-colors\"\n                  >\n                    <span className=\"material-symbols-outlined text-[18px]\">filter_list</span>\n                    Filter\n                    <span className=\"material-symbols-outlined text-[14px]\">{isFilterDropdownOpen ? 'expand_less' : 'expand_more'}</span>\n                  </button>\n                  {isFilterDropdownOpen && (\n                    <div className=\"absolute right-0 mt-2 w-48 rounded-lg bg-card-dark border border-white/5 shadow-xl z-50\">\n                      <div className=\"p-2\">\n                        <div className=\"px-3 py-2 text-xs font-semibold text-text-secondary uppercase tracking-wider mb-1\">Status</div>\n                        <button\n                          onClick={() => {\n                            setStatusFilter('all');\n                            setIsFilterDropdownOpen(false);\n                          }}\n                          className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${\n                            statusFilter === 'all'\n                              ? 'bg-primary/20 text-white'\n                              : 'text-text-secondary hover:bg-white/5 hover:text-white'\n                          }`}\n                        >\n                          All Transactions\n                        </button>\n                        <button\n                          onClick={() => {\n                            setStatusFilter('completed');\n                            setIsFilterDropdownOpen(false);\n                          }}\n                          className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${\n                            statusFilter === 'completed'\n                              ? 'bg-primary/20 text-white'\n                              : 'text-text-secondary hover:bg-white/5 hover:text-white'\n                          }`}\n                        >\n                          Completed\n                        </button>\n                        <button\n                          onClick={() => {\n                            setStatusFilter('pending');\n                            setIsFilterDropdownOpen(false);\n                          }}\n                          className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${\n                            statusFilter === 'pending'\n                              ? 'bg-primary/20 text-white'\n                              : 'text-text-secondary hover:bg-white/5 hover:text-white'\n                          }`}\n                        >\n                          Pending\n                        </button>\n                        <button\n                          onClick={() => {\n                            setStatusFilter('failed');\n                            setIsFilterDropdownOpen(false);\n                          }}\n                          className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${\n                            statusFilter === 'failed'\n                              ? 'bg-primary/20 text-white'\n                              : 'text-text-secondary hover:bg-white/5 hover:text-white'\n                          }`}\n                        >\n                          Failed\n                        </button>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n            <div className=\"bg-card-dark border border-white/5 rounded-xl overflow-hidden shadow-sm\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full text-left border-collapse\">\n                  <thead>\n                    <tr className=\"bg-background-dark/50 border-b border-white/5\">\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider\">Transaction ID</th>\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider\">Date</th>\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider\">Member</th>\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider\">Type</th>\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider\">Method</th>\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider\">Amount</th>\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider\">Status</th>\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider text-right\">Invoice</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-white/5\">\n                    {loading ? (\n                      <tr>\n                        <td colSpan=\"8\" className=\"p-4 text-center text-text-secondary\">\n                          <div className=\"flex justify-center\">\n                            <Loader />\n                          </div>\n                        </td>\n                      </tr>\n                    ) : transactions.length === 0 ? (\n                      <tr>\n                        <td colSpan=\"8\" className=\"p-4 text-center text-text-secondary\">No transactions found</td>\n                      </tr>\n                    ) : (\n                      transactions.slice(0, 10).map((transaction) => (\n                        <tr key={transaction._id} className=\"group hover:bg-white/5 transition-colors\">\n                          <td className=\"p-4 text-sm font-medium text-white font-mono\">#{transaction._id.toString().slice(-6)}</td>\n                          <td className=\"p-4 text-sm text-text-secondary\">\n                            {formatDate(transaction.createdAt)}\n                            <br />\n                            <span className=\"text-xs text-text-secondary/70\">\n                              {new Date(transaction.createdAt).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}\n                            </span>\n                          </td>\n                          <td className=\"p-4\">\n                            <div className=\"flex items-center gap-3\">\n                              <div className=\"size-8 rounded-full bg-primary/20 flex items-center justify-center text-xs font-bold text-primary\">\n                                {transaction.member?.name?.charAt(0) || transaction.memberId?.name?.charAt(0) || 'U'}\n                              </div>\n                              <div>\n                                <p className=\"text-sm font-medium text-white\">{transaction.member?.name || transaction.memberId?.name || 'Unknown'}</p>\n                                <p className=\"text-xs text-text-secondary\">{transaction.member?.email || transaction.memberId?.email || 'N/A'}</p>\n                              </div>\n                            </div>\n                          </td>\n                          <td className=\"p-4 text-sm text-white/70\">{transaction.type || (transaction.fine ? 'Fine Payment' : 'Payment')}</td>\n                          <td className=\"p-4\">\n                            <div className=\"flex items-center gap-2 text-sm text-text-secondary\">\n                              <span className=\"material-symbols-outlined text-[16px]\">credit_card</span> Card\n                            </div>\n                          </td>\n                          <td className=\"p-4 text-sm font-bold text-white\">{formatCurrency(transaction.amount || 0)}</td>\n                          <td className=\"p-4\">\n                            <span className={`inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium ${\n                              transaction.status === 'completed'\n                                ? 'bg-success-green/10 text-success-green border border-success-green/20'\n                                : transaction.status === 'pending'\n                                ? 'bg-yellow-500/10 text-yellow-400 border border-yellow-500/20'\n                                : 'bg-red-500/10 text-red-400 border border-red-500/20'\n                            }`}>\n                              {transaction.status || 'Pending'}\n                            </span>\n                          </td>\n                          <td className=\"p-4 text-right\">\n                            <button className=\"text-text-secondary hover:text-primary transition-colors\">\n                              <span className=\"material-symbols-outlined text-[20px]\">receipt_long</span>\n                            </button>\n                          </td>\n                        </tr>\n                      ))\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\admin\\layout.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\admin\\members\\[id]\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMemberDetails'. Either include it or remove the dependency array.","line":45,"column":6,"nodeType":"ArrayExpression","endLine":45,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMemberDetails, memberId]","fix":{"range":[1204,1214],"text":"[fetchMemberDetails, memberId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter, useParams } from 'next/navigation';\nimport { useAuth } from '@/contexts/AuthContext';\nimport AdminHeader from '@/components/AdminHeader';\nimport Loader from '@/components/Loader';\nimport { formatDate } from '@/lib/utils';\nimport { showError, showSuccess, showConfirm } from '@/lib/swal';\n\nexport default function MemberDetailsPage() {\n  const { userData } = useAuth();\n  const router = useRouter();\n  const params = useParams();\n  const memberId = params.id;\n\n  const [member, setMember] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [uploadingPhoto, setUploadingPhoto] = useState(false);\n  const [photoPreview, setPhotoPreview] = useState(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    profilePhoto: '',\n    role: 'member',\n    isActive: true,\n    subscription: {\n      type: 'free',\n      status: 'active',\n    },\n    address: {\n      division: '',\n      city: '',\n      area: '',\n      landmark: '',\n    },\n  });\n\n  useEffect(() => {\n    if (memberId) {\n      fetchMemberDetails();\n    }\n  }, [memberId]);\n\n  const fetchMemberDetails = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch(`/api/admin/members?userId=${memberId}`);\n      if (response.ok) {\n        const data = await response.json();\n        if (data.member) {\n          setMember(data.member);\n          setFormData({\n            name: data.member.name || '',\n            email: data.member.email || '',\n            phone: data.member.phone || '',\n            profilePhoto: data.member.profilePhoto || '',\n            role: data.member.role || 'member',\n            isActive: data.member.isActive !== false,\n            subscription: {\n              type: data.member.subscription?.type || 'free',\n              status: data.member.subscription?.status || 'active',\n            },\n            address: {\n              division: data.member.address?.division || '',\n              city: data.member.address?.city || '',\n              area: data.member.address?.area || '',\n              landmark: data.member.address?.landmark || '',\n            },\n          });\n        } else {\n          // Try fetching from members list API\n          const listResponse = await fetch('/api/admin/members?limit=1000');\n          if (listResponse.ok) {\n            const listData = await listResponse.json();\n            const foundMember = listData.members?.find(m => m._id === memberId);\n            if (foundMember) {\n              setMember(foundMember);\n              setFormData({\n                name: foundMember.name || '',\n                email: foundMember.email || '',\n                phone: foundMember.phone || '',\n                profilePhoto: foundMember.profilePhoto || '',\n                role: foundMember.role || 'member',\n                isActive: foundMember.isActive !== false,\n                subscription: {\n                  type: foundMember.subscription?.type || 'free',\n                  status: foundMember.subscription?.status || 'active',\n                },\n                address: {\n                  division: foundMember.address?.division || '',\n                  city: foundMember.address?.city || '',\n                  area: foundMember.address?.area || '',\n                  landmark: foundMember.address?.landmark || '',\n                },\n              });\n            } else {\n              showError('Member not found');\n              router.push('/admin/members');\n            }\n          }\n        }\n      } else {\n        showError('Failed to fetch member details');\n        router.push('/admin/members');\n      }\n    } catch (error) {\n      console.error('Error fetching member details:', error);\n      showError('Failed to fetch member details');\n      router.push('/admin/members');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleInputChange = (e) => {\n    const { name, value } = e.target;\n    if (name.startsWith('address.')) {\n      const addressField = name.split('.')[1];\n      setFormData(prev => ({\n        ...prev,\n        address: {\n          ...prev.address,\n          [addressField]: value,\n        },\n      }));\n    } else if (name.startsWith('subscription.')) {\n      const subField = name.split('.')[1];\n      setFormData(prev => ({\n        ...prev,\n        subscription: {\n          ...prev.subscription,\n          [subField]: value,\n        },\n      }));\n    } else {\n      setFormData(prev => ({\n        ...prev,\n        [name]: value,\n      }));\n      // Clear preview if profile photo URL is cleared\n      if (name === 'profilePhoto' && !value) {\n        setPhotoPreview(null);\n      }\n    }\n  };\n\n  const handleCheckboxChange = (e) => {\n    const { name, checked } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: checked,\n    }));\n  };\n\n  const handlePhotoUpload = async (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    if (!file.type.startsWith('image/')) {\n      showError('Please select a valid image file');\n      return;\n    }\n\n    // Validate file size (5MB max)\n    if (file.size > 5 * 1024 * 1024) {\n      showError('Image size must be less than 5MB');\n      return;\n    }\n\n    // Create preview\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setPhotoPreview(reader.result);\n    };\n    reader.readAsDataURL(file);\n\n    // Upload to ImgBB\n    try {\n      setUploadingPhoto(true);\n      const uploadFormData = new FormData();\n      uploadFormData.append('image', file);\n\n      const response = await fetch('/api/upload', {\n        method: 'POST',\n        body: uploadFormData,\n      });\n\n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || 'Failed to upload image');\n      }\n\n      const data = await response.json();\n      if (data.url) {\n        setFormData(prev => ({\n          ...prev,\n          profilePhoto: data.url,\n        }));\n        showSuccess('Photo uploaded successfully');\n      } else {\n        throw new Error('No URL returned from upload');\n      }\n    } catch (error) {\n      console.error('Error uploading photo:', error);\n      showError('Failed to upload photo', error.message);\n      setPhotoPreview(null);\n    } finally {\n      setUploadingPhoto(false);\n      // Reset file input\n      e.target.value = '';\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    \n    const result = await showConfirm(\n      'Save Changes',\n      'Are you sure you want to save these changes?',\n      {\n        confirmButtonText: 'Save',\n        cancelButtonText: 'Cancel',\n      }\n    );\n\n    if (!result.isConfirmed) return;\n\n    try {\n      setSaving(true);\n      const updates = {\n        name: formData.name,\n        phone: formData.phone,\n        profilePhoto: formData.profilePhoto,\n        isActive: formData.isActive,\n        subscription: formData.subscription,\n        address: formData.address,\n      };\n\n      const response = await fetch(`/api/admin/members?userId=${memberId}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          userId: memberId,\n          updates,\n        }),\n      });\n\n      if (response.ok) {\n        showSuccess('Member updated successfully');\n        fetchMemberDetails();\n      } else {\n        const data = await response.json();\n        showError('Failed to update member', data.error || '');\n      }\n    } catch (error) {\n      console.error('Error updating member:', error);\n      showError('Failed to update member');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const getInitials = (name) => {\n    if (!name) return 'U';\n    const parts = name.split(' ');\n    if (parts.length >= 2) {\n      return (parts[0][0] + parts[1][0]).toUpperCase();\n    }\n    return name[0].toUpperCase();\n  };\n\n  if (loading) {\n    return (\n      <>\n        <AdminHeader title=\"Member Details\" subtitle=\"View and edit member information\" />\n        <div className=\"flex-1 overflow-y-auto flex items-center justify-center\">\n          <Loader />\n        </div>\n      </>\n    );\n  }\n\n  if (!member) {\n    return null;\n  }\n\n  return (\n    <>\n      <AdminHeader \n        title=\"Member Details\" \n        subtitle={`Manage ${member.name}'s account information and settings`}\n      />\n      <div className=\"flex-1 overflow-y-auto\">\n        <div className=\"px-8 pt-8 pb-8 max-w-4xl mx-auto w-full\">\n          <div className=\"mb-6\">\n            <button\n              onClick={() => router.push('/admin/members')}\n              className=\"flex items-center gap-2 text-text-secondary hover:text-white transition-colors mb-4\"\n            >\n              <span className=\"material-symbols-outlined text-sm\">arrow_back</span>\n              <span className=\"text-sm font-medium\">Back to Members</span>\n            </button>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/* Profile Section */}\n            <div className=\"bg-card-dark border border-white/5 rounded-xl p-6 shadow-xl\">\n              <h2 className=\"text-lg font-bold text-white mb-6 flex items-center gap-2\">\n                <span className=\"material-symbols-outlined\">person</span>\n                Profile Information\n              </h2>\n              \n              <div className=\"space-y-4\">\n                <div className=\"flex items-start gap-6 mb-6\">\n                  <div className=\"flex flex-col items-center gap-3\">\n                    <div\n                      className=\"h-24 w-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-2xl shadow-inner relative overflow-hidden border-4 border-card-dark\"\n                      style={{\n                        backgroundImage: (photoPreview || formData.profilePhoto) ? `url('${photoPreview || formData.profilePhoto}')` : 'none',\n                        backgroundSize: (photoPreview || formData.profilePhoto) ? 'cover' : 'auto',\n                        backgroundPosition: (photoPreview || formData.profilePhoto) ? 'center' : 'center',\n                        backgroundColor: (photoPreview || formData.profilePhoto) ? 'transparent' : undefined,\n                      }}\n                    >\n                      {!(photoPreview || formData.profilePhoto) && getInitials(formData.name)}\n                    </div>\n                    <label className=\"cursor-pointer\">\n                      <input\n                        type=\"file\"\n                        accept=\"image/*\"\n                        onChange={handlePhotoUpload}\n                        disabled={uploadingPhoto}\n                        className=\"hidden\"\n                      />\n                      <div className=\"px-4 py-2 rounded-lg border border-white/5 bg-background-dark text-text-secondary hover:text-white hover:border-primary transition-colors text-sm font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\">\n                        {uploadingPhoto ? (\n                          <>\n                            <span className=\"material-symbols-outlined text-sm animate-spin\">sync</span>\n                            Uploading...\n                          </>\n                        ) : (\n                          <>\n                            <span className=\"material-symbols-outlined text-sm\">upload</span>\n                            Upload Photo\n                          </>\n                        )}\n                      </div>\n                    </label>\n                  </div>\n                  <div className=\"flex-1\">\n                    <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                      Profile Photo URL\n                    </label>\n                    <input\n                      type=\"text\"\n                      name=\"profilePhoto\"\n                      value={formData.profilePhoto}\n                      onChange={handleInputChange}\n                      placeholder=\"https://example.com/photo.jpg\"\n                      className=\"w-full h-11 px-4 bg-background-dark border border-white/5 rounded-lg text-white placeholder:text-text-secondary/50 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all\"\n                    />\n                    <p className=\"text-xs text-text-secondary mt-1\">Or enter a photo URL directly</p>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                      Full Name *\n                    </label>\n                    <input\n                      type=\"text\"\n                      name=\"name\"\n                      value={formData.name}\n                      onChange={handleInputChange}\n                      required\n                      className=\"w-full h-11 px-4 bg-background-dark border border-white/5 rounded-lg text-white placeholder:text-text-secondary/50 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                      Email\n                    </label>\n                    <input\n                      type=\"email\"\n                      value={formData.email}\n                      disabled\n                      className=\"w-full h-11 px-4 bg-background-dark/50 border border-white/5 rounded-lg text-text-secondary cursor-not-allowed\"\n                    />\n                    <p className=\"text-xs text-text-secondary mt-1\">Email cannot be changed</p>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                      Phone\n                    </label>\n                    <input\n                      type=\"tel\"\n                      name=\"phone\"\n                      value={formData.phone}\n                      onChange={handleInputChange}\n                      className=\"w-full h-11 px-4 bg-background-dark border border-white/5 rounded-lg text-white placeholder:text-text-secondary/50 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                      Account Status\n                    </label>\n                    <div className=\"flex items-center gap-3 h-11\">\n                      <label className=\"flex items-center gap-2 cursor-pointer\">\n                        <input\n                          type=\"checkbox\"\n                          name=\"isActive\"\n                          checked={formData.isActive}\n                          onChange={handleCheckboxChange}\n                          className=\"rounded border-white/5 bg-background-dark text-primary focus:ring-primary/50 cursor-pointer h-4 w-4\"\n                        />\n                        <span className=\"text-sm text-white\">\n                          {formData.isActive ? 'Active' : 'Suspended'}\n                        </span>\n                      </label>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Subscription Section */}\n            <div className=\"bg-card-dark border border-white/5 rounded-xl p-6 shadow-xl\">\n              <h2 className=\"text-lg font-bold text-white mb-6 flex items-center gap-2\">\n                <span className=\"material-symbols-outlined\">workspace_premium</span>\n                Subscription\n              </h2>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                    Subscription Type\n                  </label>\n                  <select\n                    name=\"subscription.type\"\n                    value={formData.subscription.type}\n                    onChange={handleInputChange}\n                    className=\"w-full h-11 px-4 bg-background-dark border border-white/5 rounded-lg text-white appearance-none cursor-pointer focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all\"\n                  >\n                    <option value=\"free\">Standard (Free)</option>\n                    <option value=\"monthly\">Premium (Monthly)</option>\n                    <option value=\"yearly\">Premium (Yearly)</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                    Subscription Status\n                  </label>\n                  <select\n                    name=\"subscription.status\"\n                    value={formData.subscription.status}\n                    onChange={handleInputChange}\n                    className=\"w-full h-11 px-4 bg-background-dark border border-white/5 rounded-lg text-white appearance-none cursor-pointer focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all\"\n                  >\n                    <option value=\"active\">Active</option>\n                    <option value=\"cancelled\">Cancelled</option>\n                    <option value=\"expired\">Expired</option>\n                  </select>\n                </div>\n              </div>\n            </div>\n\n            {/* Address Section */}\n            <div className=\"bg-card-dark border border-white/5 rounded-xl p-6 shadow-xl\">\n              <h2 className=\"text-lg font-bold text-white mb-6 flex items-center gap-2\">\n                <span className=\"material-symbols-outlined\">location_on</span>\n                Address\n              </h2>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                    Division\n                  </label>\n                  <input\n                    type=\"text\"\n                    name=\"address.division\"\n                    value={formData.address.division}\n                    onChange={handleInputChange}\n                    className=\"w-full h-11 px-4 bg-background-dark border border-white/5 rounded-lg text-white placeholder:text-text-secondary/50 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                    City\n                  </label>\n                  <input\n                    type=\"text\"\n                    name=\"address.city\"\n                    value={formData.address.city}\n                    onChange={handleInputChange}\n                    className=\"w-full h-11 px-4 bg-background-dark border border-white/5 rounded-lg text-white placeholder:text-text-secondary/50 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                    Area\n                  </label>\n                  <input\n                    type=\"text\"\n                    name=\"address.area\"\n                    value={formData.address.area}\n                    onChange={handleInputChange}\n                    className=\"w-full h-11 px-4 bg-background-dark border border-white/5 rounded-lg text-white placeholder:text-text-secondary/50 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n                    Landmark\n                  </label>\n                  <input\n                    type=\"text\"\n                    name=\"address.landmark\"\n                    value={formData.address.landmark}\n                    onChange={handleInputChange}\n                    className=\"w-full h-11 px-4 bg-background-dark border border-white/5 rounded-lg text-white placeholder:text-text-secondary/50 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* Action Buttons */}\n            <div className=\"flex items-center justify-end gap-4\">\n              <button\n                type=\"button\"\n                onClick={() => router.push('/admin/members')}\n                className=\"h-11 px-6 rounded-lg border border-white/5 bg-background-dark text-text-secondary hover:text-white hover:border-primary transition-colors font-medium\"\n              >\n                Cancel\n              </button>\n              <button\n                type=\"submit\"\n                disabled={saving}\n                className=\"h-11 px-6 rounded-lg bg-primary text-white hover:bg-primary-hover transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n              >\n                {saving ? (\n                  <>\n                    <span className=\"material-symbols-outlined text-sm animate-spin\">sync</span>\n                    Saving...\n                  </>\n                ) : (\n                  <>\n                    <span className=\"material-symbols-outlined text-sm\">save</span>\n                    Save Changes\n                  </>\n                )}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\admin\\members\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMembers'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMembers, page, searchQuery, statusFilter, tierFilter]","fix":{"range":[1240,1285],"text":"[fetchMembers, page, searchQuery, statusFilter, tierFilter]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":505,"column":37,"nodeType":"JSXOpeningElement","endLine":512,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/contexts/AuthContext';\nimport AdminHeader from '@/components/AdminHeader';\nimport Loader from '@/components/Loader';\nimport { formatDate, getSubscriptionDisplayName } from '@/lib/utils';\nimport { showError, showSuccess, showConfirm, showInput } from '@/lib/swal';\nimport swalTheme from '@/lib/swal';\n\nexport default function AdminMembersPage() {\n  const { userData } = useAuth();\n  const router = useRouter();\n  const [members, setMembers] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [statusFilter, setStatusFilter] = useState('all');\n  const [tierFilter, setTierFilter] = useState('all');\n  const [page, setPage] = useState(1);\n  const [stats, setStats] = useState({\n    totalMembers: 0,\n    premiumUsers: 0,\n    activeNow: 0,\n  });\n  const [pagination, setPagination] = useState({\n    page: 1,\n    limit: 10,\n    total: 0,\n    totalPages: 0,\n  });\n  const [selectedMembers, setSelectedMembers] = useState(new Set());\n  const [imageErrors, setImageErrors] = useState(new Set());\n\n  useEffect(() => {\n    fetchMembers();\n  }, [page, searchQuery, statusFilter, tierFilter]);\n\n  const fetchMembers = async () => {\n    try {\n      setLoading(true);\n      const params = new URLSearchParams({\n        page: page.toString(),\n        limit: '10',\n        ...(searchQuery && { search: searchQuery }),\n        ...(statusFilter !== 'all' && { status: statusFilter }),\n        ...(tierFilter !== 'all' && { tier: tierFilter }),\n      });\n\n      const response = await fetch(`/api/admin/members?${params}`);\n      if (response.ok) {\n        const data = await response.json();\n        setMembers(data.members || []);\n        setPagination(data.pagination || pagination);\n        setStats(data.stats || stats);\n        setImageErrors(new Set()); // Reset image errors when fetching new data\n      }\n    } catch (error) {\n      console.error('Error fetching members:', error);\n      showError('Failed to fetch members');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleEdit = (member) => {\n    router.push(`/admin/members/${member._id}`);\n  };\n\n  const handleDelete = async (member) => {\n    const result = await showConfirm(\n      'Delete Member Permanently',\n      `Are you sure you want to permanently delete ${member.name}? This action cannot be undone and will remove all data from the database.`,\n      {\n        confirmButtonText: 'Yes, Delete Permanently',\n        cancelButtonText: 'Cancel',\n        icon: 'warning',\n        confirmButtonColor: '#ef4444',\n      }\n    );\n\n    if (result.isConfirmed) {\n      try {\n        const response = await fetch(`/api/admin/members?userId=${member._id}`, {\n          method: 'DELETE',\n        });\n\n        if (response.ok) {\n          showSuccess('Member deleted permanently');\n          fetchMembers();\n        } else {\n          const data = await response.json();\n          showError('Failed to delete member', data.error || '');\n        }\n      } catch (error) {\n        console.error('Error deleting member:', error);\n        showError('Failed to delete member');\n      }\n    }\n  };\n\n  const handleUpgrade = async (member) => {\n    const isCurrentlyActive = member.isActive !== false;\n    const isSuspended = !isCurrentlyActive;\n    \n    // First, ask if they want to activate or suspend\n    // Default to 'suspend' if user is already suspended\n    const actionResult = await swalTheme.fire({\n      icon: 'question',\n      iconColor: '#aa1fef',\n      title: 'Manage Member Status',\n      text: `Current status: ${isCurrentlyActive ? 'Active' : 'Suspended'}. What would you like to do?`,\n      input: 'select',\n      inputOptions: {\n        activate: 'Activate User',\n        suspend: 'Suspend User',\n      },\n      inputValue: isSuspended ? 'suspend' : 'suspend', // Default to suspend option\n      inputPlaceholder: 'Select action',\n      showCancelButton: true,\n      confirmButtonText: 'Continue',\n      cancelButtonText: 'Cancel',\n      confirmButtonColor: '#aa1fef',\n      cancelButtonColor: '#3c2348',\n    });\n\n    if (!actionResult.isConfirmed) return;\n\n    if (actionResult.value === 'activate') {\n      // Activate user\n      try {\n        const response = await fetch(`/api/admin/members?userId=${member._id}`, {\n          method: 'PATCH',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            userId: member._id,\n            updates: {\n              suspendedUntil: null,\n              isActive: true,\n            },\n          }),\n        });\n\n        if (response.ok) {\n          showSuccess('Member activated successfully');\n          fetchMembers();\n        } else {\n          showError('Failed to activate member');\n        }\n      } catch (error) {\n        console.error('Error activating member:', error);\n        showError('Failed to activate member');\n      }\n    } else if (actionResult.value === 'suspend') {\n      // Suspend user - ask for duration\n      const durationResult = await swalTheme.fire({\n        icon: 'warning',\n        iconColor: '#f59e0b',\n        title: 'Suspend Member',\n        text: `How long should ${member.name} be suspended?`,\n        input: 'select',\n        inputOptions: {\n          '1': '1 day',\n          '3': '3 days',\n          '7': '7 days',\n          'custom': 'Custom (Enter days)',\n          'forever': 'Forever (Permanent)',\n        },\n        inputValue: '7',\n        inputPlaceholder: 'Select duration',\n        showCancelButton: true,\n        confirmButtonText: 'Continue',\n        cancelButtonText: 'Cancel',\n        confirmButtonColor: '#f59e0b',\n        cancelButtonColor: '#3c2348',\n      });\n\n      if (!durationResult.isConfirmed || !durationResult.value) return;\n\n      let suspendDays = null;\n\n      // Handle custom duration\n      if (durationResult.value === 'custom') {\n        // Use a small delay to ensure the previous dialog is fully closed\n        await new Promise(resolve => setTimeout(resolve, 100));\n        \n        const customResult = await swalTheme.fire({\n          icon: 'question',\n          iconColor: '#f59e0b',\n          title: 'Custom Suspension Duration',\n          text: `Enter the number of days to suspend ${member.name}`,\n          input: 'text',\n          inputValue: '',\n          inputPlaceholder: 'Enter number of days (e.g., 15, 30, 60)',\n          inputAttributes: {\n            type: 'number',\n            min: '1',\n            autocomplete: 'off',\n          },\n          showCancelButton: true,\n          confirmButtonText: 'Suspend',\n          cancelButtonText: 'Cancel',\n          confirmButtonColor: '#f59e0b',\n          cancelButtonColor: '#3c2348',\n          inputValidator: (value) => {\n            if (!value || value.trim() === '') {\n              return 'Please enter a number of days';\n            }\n            const days = parseInt(value.trim());\n            if (isNaN(days) || days < 1) {\n              return 'Please enter a valid number (minimum 1 day)';\n            }\n            return null;\n          },\n          didOpen: () => {\n            // Focus the input field when dialog opens\n            const input = document.querySelector('.swal2-input');\n            if (input) {\n              input.focus();\n              input.select();\n            }\n          },\n        });\n\n        if (!customResult.isConfirmed || !customResult.value) return;\n        suspendDays = parseInt(customResult.value.trim());\n      } else if (durationResult.value === 'forever') {\n        suspendDays = 'forever';\n      } else {\n        suspendDays = parseInt(durationResult.value);\n      }\n\n      // Apply suspension\n      try {\n        const updates = {\n          isActive: false,\n        };\n\n        if (suspendDays === 'forever') {\n          updates.suspendedUntil = 'forever';\n        } else {\n          updates.suspendedUntil = suspendDays;\n        }\n\n        const response = await fetch(`/api/admin/members?userId=${member._id}`, {\n          method: 'PATCH',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            userId: member._id,\n            updates,\n          }),\n        });\n\n        if (response.ok) {\n          let durationText;\n          if (suspendDays === 'forever') {\n            durationText = 'permanently';\n          } else {\n            durationText = `for ${suspendDays} day${suspendDays !== 1 ? 's' : ''}`;\n          }\n          showSuccess(`Member suspended ${durationText}`);\n          fetchMembers();\n        } else {\n          showError('Failed to suspend member');\n        }\n      } catch (error) {\n        console.error('Error suspending member:', error);\n        showError('Failed to suspend member');\n      }\n    }\n  };\n\n  const handleSelectAll = (e) => {\n    if (e.target.checked) {\n      setSelectedMembers(new Set(members.map((m) => m._id)));\n    } else {\n      setSelectedMembers(new Set());\n    }\n  };\n\n  const handleSelectMember = (memberId) => {\n    const newSelected = new Set(selectedMembers);\n    if (newSelected.has(memberId)) {\n      newSelected.delete(memberId);\n    } else {\n      newSelected.add(memberId);\n    }\n    setSelectedMembers(newSelected);\n  };\n\n  const isAllSelected = members.length > 0 && selectedMembers.size === members.length;\n\n  const getInitials = (name) => {\n    if (!name) return 'U';\n    const parts = name.split(' ');\n    if (parts.length >= 2) {\n      return (parts[0][0] + parts[1][0]).toUpperCase();\n    }\n    return name[0].toUpperCase();\n  };\n\n  const getStatusBadge = (member) => {\n    if (!member.isActive) {\n      return {\n        label: 'Suspended',\n        color: 'red',\n        dot: 'red-400',\n      };\n    }\n    return {\n      label: 'Active',\n      color: 'green',\n      dot: 'green-400',\n    };\n  };\n\n  const getTierInfo = (member) => {\n    const subscriptionType = member.subscription?.type || 'free';\n    const isPremium = subscriptionType === 'monthly' || subscriptionType === 'yearly';\n    \n    return {\n      label: isPremium ? 'Premium' : subscriptionType === 'free' ? 'Standard' : 'Student',\n      isPremium,\n      subscriptionType,\n    };\n  };\n\n  return (\n    <>\n      <AdminHeader title=\"Member Management\" subtitle=\"Manage your member database, monitor subscription tiers, and handle account statuses.\" />\n      <div className=\"flex-1 overflow-y-auto\">\n        <div className=\"px-8 pt-8 pb-2 max-w-[1440px] mx-auto w-full\">\n          {/* Stats Cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n            <div className=\"bg-card-dark border border-white/5 p-4 rounded-xl flex items-start justify-between\">\n              <div>\n                <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider mb-1\">Total Members</p>\n                <h3 className=\"text-2xl font-black text-white\">{stats.totalMembers.toLocaleString()}</h3>\n                <p className=\"text-success-green text-xs font-medium flex items-center gap-1 mt-1\">\n                  <span className=\"material-symbols-outlined text-sm\">trending_up</span> +12% this month\n                </p>\n              </div>\n              <div className=\"p-2 bg-primary/10 rounded-lg text-primary\">\n                <span className=\"material-symbols-outlined\">groups</span>\n              </div>\n            </div>\n            <div className=\"bg-card-dark border border-white/5 p-4 rounded-xl flex items-start justify-between\">\n              <div>\n                <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider mb-1\">Premium Users</p>\n                <h3 className=\"text-2xl font-black text-white\">{stats.premiumUsers.toLocaleString()}</h3>\n                <p className=\"text-text-secondary text-xs font-medium mt-1\">\n                  {stats.totalMembers > 0 ? Math.round((stats.premiumUsers / stats.totalMembers) * 100) : 0}% of total base\n                </p>\n              </div>\n              <div className=\"p-2 bg-amber-500/10 rounded-lg text-amber-500\">\n                <span className=\"material-symbols-outlined\">workspace_premium</span>\n              </div>\n            </div>\n            <div className=\"bg-card-dark border border-white/5 p-4 rounded-xl flex items-start justify-between\">\n              <div>\n                <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider mb-1\">Active Now</p>\n                <h3 className=\"text-2xl font-black text-white\">{stats.activeNow.toLocaleString()}</h3>\n                <p className=\"text-success-green text-xs font-medium mt-1\">Peak time approaching</p>\n              </div>\n              <div className=\"p-2 bg-green-500/10 rounded-lg text-green-500\">\n                <span className=\"material-symbols-outlined\">bolt</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto px-8 py-6\">\n          <div className=\"max-w-[1440px] mx-auto w-full flex flex-col gap-6\">\n            {/* Search and Filters */}\n            <div className=\"w-full bg-card-dark rounded-xl border border-white/5 p-4 shadow-xl\">\n              <div className=\"flex flex-col lg:flex-row gap-4 items-center justify-between\">\n                <label className=\"relative flex-1 w-full lg:max-w-md group\">\n                  <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-text-secondary group-focus-within:text-primary transition-colors\">\n                    <span className=\"material-symbols-outlined\">search</span>\n                  </span>\n                  <input\n                    className=\"w-full h-11 pl-12 pr-4 bg-background-dark border border-white/5 rounded-lg text-white placeholder:text-text-secondary/50 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all\"\n                    placeholder=\"Search by name, email, or ID...\"\n                    type=\"text\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                  />\n                </label>\n                <div className=\"flex w-full lg:w-auto gap-3 overflow-x-auto pb-2 lg:pb-0\">\n                  <label className=\"relative min-w-[160px]\">\n                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary pointer-events-none\">\n                      <span className=\"material-symbols-outlined text-[18px]\">filter_alt</span>\n                    </span>\n                    <select\n                      className=\"w-full h-11 pl-10 pr-10 bg-background-dark border border-white/5 rounded-lg text-sm text-white appearance-none cursor-pointer focus:ring-1 focus:ring-primary focus:border-primary outline-none transition-all hover:border-text-secondary/50\"\n                      value={statusFilter}\n                      onChange={(e) => setStatusFilter(e.target.value)}\n                    >\n                      <option value=\"all\">Status: All</option>\n                      <option value=\"active\">Active</option>\n                      <option value=\"inactive\">Inactive</option>\n                      <option value=\"suspended\">Suspended</option>\n                    </select>\n                    <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary pointer-events-none\">\n                      <span className=\"material-symbols-outlined text-sm\">expand_more</span>\n                    </span>\n                  </label>\n                  <label className=\"relative min-w-[160px]\">\n                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary pointer-events-none\">\n                      <span className=\"material-symbols-outlined text-[18px]\">workspace_premium</span>\n                    </span>\n                    <select\n                      className=\"w-full h-11 pl-10 pr-10 bg-background-dark border border-white/5 rounded-lg text-sm text-white appearance-none cursor-pointer focus:ring-1 focus:ring-primary focus:border-primary outline-none transition-all hover:border-text-secondary/50\"\n                      value={tierFilter}\n                      onChange={(e) => setTierFilter(e.target.value)}\n                    >\n                      <option value=\"all\">Tier: All</option>\n                      <option value=\"premium\">Premium</option>\n                      <option value=\"standard\">Standard</option>\n                    </select>\n                    <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary pointer-events-none\">\n                      <span className=\"material-symbols-outlined text-sm\">expand_more</span>\n                    </span>\n                  </label>\n                  <button className=\"h-11 px-4 flex items-center gap-2 justify-center rounded-lg border border-white/5 bg-background-dark text-text-secondary hover:text-white hover:border-primary transition-colors text-sm font-medium whitespace-nowrap\">\n                    <span className=\"material-symbols-outlined text-[18px]\">tune</span>\n                    <span>More Filters</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            {/* Members Table */}\n            <div className=\"rounded-xl border border-white/5 bg-card-dark overflow-hidden shadow-2xl flex flex-col\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full text-left border-collapse\">\n                  <thead>\n                    <tr className=\"bg-card-dark/50 border-b border-white/5\">\n                      <th className=\"p-4 pl-6 w-14\">\n                        <input\n                          className=\"rounded border-white/5 bg-background-dark text-primary focus:ring-primary/50 cursor-pointer h-4 w-4\"\n                          type=\"checkbox\"\n                          checked={isAllSelected}\n                          onChange={handleSelectAll}\n                        />\n                      </th>\n                      <th className=\"p-4 text-xs font-bold uppercase tracking-wider text-text-secondary cursor-pointer hover:text-white group transition-colors\">\n                        <div className=\"flex items-center gap-1\">\n                          Member <span className=\"material-symbols-outlined text-sm opacity-0 group-hover:opacity-100\">unfold_more</span>\n                        </div>\n                      </th>\n                      <th className=\"p-4 text-xs font-bold uppercase tracking-wider text-text-secondary hidden md:table-cell cursor-pointer hover:text-white group transition-colors\">\n                        <div className=\"flex items-center gap-1\">\n                          Status <span className=\"material-symbols-outlined text-sm opacity-0 group-hover:opacity-100\">unfold_more</span>\n                        </div>\n                      </th>\n                      <th className=\"p-4 text-xs font-bold uppercase tracking-wider text-text-secondary cursor-pointer hover:text-white group transition-colors\">\n                        <div className=\"flex items-center gap-1\">\n                          Plan Tier <span className=\"material-symbols-outlined text-sm opacity-0 group-hover:opacity-100\">unfold_more</span>\n                        </div>\n                      </th>\n                      <th className=\"p-4 text-xs font-bold uppercase tracking-wider text-text-secondary hidden lg:table-cell cursor-pointer hover:text-white group transition-colors\">\n                        <div className=\"flex items-center gap-1\">\n                          Last Active <span className=\"material-symbols-outlined text-sm opacity-0 group-hover:opacity-100\">unfold_more</span>\n                        </div>\n                      </th>\n                      <th className=\"p-4 text-xs font-bold uppercase tracking-wider text-text-secondary text-right pr-6\">Manage</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-white/5\">\n                    {loading ? (\n                      <tr>\n                        <td colSpan=\"6\" className=\"p-8 text-center text-text-secondary\">\n                          <div className=\"flex justify-center\">\n                            <Loader />\n                          </div>\n                        </td>\n                      </tr>\n                    ) : members.length === 0 ? (\n                      <tr>\n                        <td colSpan=\"6\" className=\"p-8 text-center text-text-secondary\">No members found</td>\n                      </tr>\n                    ) : (\n                      members.map((member) => {\n                        const status = getStatusBadge(member);\n                        const tier = getTierInfo(member);\n                        return (\n                          <tr key={member._id} className=\"group hover:bg-white/5 transition-colors\">\n                            <td className=\"p-4 pl-6\">\n                              <input\n                                className=\"rounded border-white/5 bg-background-dark text-primary focus:ring-primary/50 cursor-pointer h-4 w-4\"\n                                type=\"checkbox\"\n                                checked={selectedMembers.has(member._id)}\n                                onChange={() => handleSelectMember(member._id)}\n                              />\n                            </td>\n                            <td className=\"p-4\">\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm shadow-inner relative overflow-hidden flex-shrink-0 border-2 border-card-dark group-hover:border-primary/50 transition-colors\">\n                                  {member.profilePhoto && member.profilePhoto.trim() !== '' && !imageErrors.has(member._id) ? (\n                                    <img\n                                      src={`/api/image-proxy?url=${encodeURIComponent(member.profilePhoto)}`}\n                                      alt={member.name}\n                                      className=\"w-full h-full rounded-full object-cover\"\n                                      onError={(e) => {\n                                        setImageErrors(prev => new Set(prev).add(member._id));\n                                      }}\n                                    />\n                                  ) : (\n                                    <span>{getInitials(member.name)}</span>\n                                  )}\n                                </div>\n                                <div className=\"min-w-0\">\n                                  <p className=\"text-white text-sm font-semibold truncate\">{member.name}</p>\n                                  <p className=\"text-text-secondary text-xs truncate\">{member.email}</p>\n                                </div>\n                              </div>\n                            </td>\n                            <td className=\"p-4 hidden md:table-cell\">\n                              {status.color === 'green' ? (\n                                <span className=\"inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full text-[10px] font-semibold bg-green-500/10 text-green-400 border border-green-500/20\">\n                                  <span className=\"w-1 h-1 rounded-full bg-green-400\"></span> {status.label}\n                                </span>\n                              ) : (\n                                <span className=\"inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full text-[10px] font-semibold bg-red-500/10 text-red-400 border border-red-500/20\">\n                                  <span className=\"w-1 h-1 rounded-full bg-red-400\"></span> {status.label}\n                                </span>\n                              )}\n                            </td>\n                            <td className=\"p-4\">\n                              <div className=\"flex flex-col\">\n                                <span className=\"text-white text-sm font-medium flex items-center gap-1\">\n                                  {tier.label}\n                                  {tier.isPremium && <span className=\"material-symbols-outlined text-amber-400 text-[16px]\">star</span>}\n                                </span>\n                                <span className=\"text-text-secondary text-xs\">\n                                  {tier.subscriptionType === 'monthly' ? 'Monthly' : tier.subscriptionType === 'yearly' ? 'Yearly' : 'Free'}\n                                </span>\n                              </div>\n                            </td>\n                            <td className=\"p-4 hidden lg:table-cell\">\n                              <p className=\"text-text-secondary text-sm\">{formatDate(member.updatedAt)}</p>\n                            </td>\n                            <td className=\"p-4 text-right pr-6\">\n                              <div className=\"flex items-center justify-end gap-2\">\n                                <button\n                                  onClick={() => handleUpgrade(member)}\n                                  className=\"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/5 text-text-secondary hover:text-white transition-colors\"\n                                  title=\"Suspend/Activate\"\n                                >\n                                  <span className=\"material-symbols-outlined text-[18px]\">block</span>\n                                </button>\n                                <button\n                                  onClick={() => handleEdit(member)}\n                                  className=\"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-primary/20 hover:text-primary text-text-secondary transition-colors\"\n                                  title=\"Edit Profile\"\n                                >\n                                  <span className=\"material-symbols-outlined text-[18px]\">edit</span>\n                                </button>\n                                <button\n                                  onClick={() => handleDelete(member)}\n                                  className=\"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-red-500/20 hover:text-red-400 text-text-secondary transition-colors\"\n                                  title=\"Remove Member\"\n                                >\n                                  <span className=\"material-symbols-outlined text-[18px]\">delete</span>\n                                </button>\n                              </div>\n                            </td>\n                          </tr>\n                        );\n                      })\n                    )}\n                  </tbody>\n                </table>\n              </div>\n              {/* Pagination */}\n              <div className=\"flex flex-col sm:flex-row items-center justify-between p-4 border-t border-white/5 bg-card-dark gap-4\">\n                <p className=\"text-text-secondary text-sm\">\n                  Showing <span className=\"text-white font-bold\">{((page - 1) * pagination.limit) + 1}</span> to{' '}\n                  <span className=\"text-white font-bold\">{Math.min(page * pagination.limit, pagination.total)}</span> of{' '}\n                  <span className=\"text-white font-bold\">{pagination.total}</span> members\n                </p>\n                <div className=\"flex items-center gap-2\">\n                  <button\n                    onClick={() => setPage((p) => Math.max(1, p - 1))}\n                    disabled={page === 1}\n                    className=\"h-9 px-3 rounded-lg border border-white/5 bg-white/5 text-text-secondary hover:text-white hover:border-primary disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-1\"\n                  >\n                    <span className=\"material-symbols-outlined text-sm\">chevron_left</span>\n                    <span className=\"text-sm font-medium\">Previous</span>\n                  </button>\n                  <div className=\"flex gap-1\">\n                    {Array.from({ length: Math.min(5, pagination.totalPages) }, (_, i) => {\n                      const pageNum = i + 1;\n                      return (\n                        <button\n                          key={pageNum}\n                          onClick={() => setPage(pageNum)}\n                          className={`h-9 w-9 rounded-lg font-medium text-sm flex items-center justify-center transition-colors ${\n                            page === pageNum\n                              ? 'bg-primary text-white shadow-lg shadow-primary/30'\n                              : 'border border-white/5 hover:bg-white/5 text-text-secondary hover:text-white'\n                          }`}\n                        >\n                          {pageNum}\n                        </button>\n                      );\n                    })}\n                    {pagination.totalPages > 5 && (\n                      <>\n                        <span className=\"h-9 w-9 flex items-center justify-center text-text-secondary\">...</span>\n                        <button\n                          onClick={() => setPage(pagination.totalPages)}\n                          className=\"h-9 w-9 rounded-lg border border-white/5 hover:bg-white/5 text-text-secondary hover:text-white font-medium text-sm flex items-center justify-center transition-colors\"\n                        >\n                          {pagination.totalPages}\n                        </button>\n                      </>\n                    )}\n                  </div>\n                  <button\n                    onClick={() => setPage((p) => Math.min(pagination.totalPages, p + 1))}\n                    disabled={page === pagination.totalPages}\n                    className=\"h-9 px-3 rounded-lg border border-white/5 bg-white/5 text-text-secondary hover:text-white hover:border-primary disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-1\"\n                  >\n                    <span className=\"text-sm font-medium\">Next</span>\n                    <span className=\"material-symbols-outlined text-sm\">chevron_right</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\admin\\overview\\page.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":514,"column":37,"nodeType":"JSXOpeningElement","endLine":521,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport AdminHeader from '@/components/AdminHeader';\nimport { formatDate, formatCurrency, formatDateTime } from '@/lib/utils';\nimport Loader from '@/components/Loader';\nimport { BORROWING_STATUS, RESERVATION_STATUS, PAYMENT_STATUS } from '@/lib/constants';\n\nexport default function AdminOverviewPage() {\n  const { userData } = useAuth();\n  const [stats, setStats] = useState({\n    totalRevenue: 0,\n    revenueGrowth: 0,\n    activeMembers: 0,\n    newMembersThisMonth: 0,\n    premiumUsers: 0,\n    premiumPercentage: 0,\n    activeBorrowings: 0,\n    booksDueToday: 0,\n    totalBooks: 0,\n    totalCopies: 0,\n    borrowedCopies: 0,\n    availableCopies: 0,\n    monthlyRevenue: [],\n    revenueBreakdown: [],\n    recentActivity: [],\n  });\n  const [loading, setLoading] = useState(true);\n  const [imageErrors, setImageErrors] = useState(new Set());\n\n  useEffect(() => {\n    fetchStats();\n    const interval = setInterval(fetchStats, 30000);\n    return () => clearInterval(interval);\n  }, []);\n\n  const fetchStats = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch('/api/admin/stats');\n      if (response.ok) {\n        const data = await response.json();\n        // Merge with defaults to ensure all fields exist\n        setStats(prev => ({\n          ...prev,\n          ...data,\n          activeMembers: data.activeMembers ?? prev.activeMembers ?? 0,\n          newMembersThisMonth: data.newMembersThisMonth ?? prev.newMembersThisMonth ?? 0,\n          totalRevenue: data.totalRevenue ?? prev.totalRevenue ?? 0,\n          revenueGrowth: data.revenueGrowth ?? prev.revenueGrowth ?? 0,\n          premiumUsers: data.premiumUsers ?? prev.premiumUsers ?? 0,\n          premiumPercentage: data.premiumPercentage ?? prev.premiumPercentage ?? 0,\n          activeBorrowings: data.activeBorrowings ?? prev.activeBorrowings ?? 0,\n          booksDueToday: data.booksDueToday ?? prev.booksDueToday ?? 0,\n          totalBooks: data.totalBooks ?? prev.totalBooks ?? 0,\n          totalCopies: data.totalCopies ?? prev.totalCopies ?? 0,\n          borrowedCopies: data.borrowedCopies ?? prev.borrowedCopies ?? 0,\n          availableCopies: data.availableCopies ?? prev.availableCopies ?? 0,\n          monthlyRevenue: data.monthlyRevenue ?? prev.monthlyRevenue ?? [],\n          revenueBreakdown: data.revenueBreakdown ?? prev.revenueBreakdown ?? [],\n          recentActivity: data.recentActivity ?? prev.recentActivity ?? [],\n        }));\n      }\n    } catch (error) {\n      console.error('Error fetching stats:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getDaysAgo = (date) => {\n    if (!date) return 'N/A';\n    const days = Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60 * 24));\n    return `${days}d ago`;\n  };\n\n  const getInitials = (name) => {\n    if (!name) return 'U';\n    const parts = name.split(' ');\n    if (parts.length >= 2) {\n      return (parts[0][0] + parts[1][0]).toUpperCase();\n    }\n    return name.substring(0, 2).toUpperCase();\n  };\n\n  const getActivityIcon = (activityType) => {\n    switch (activityType) {\n      case 'borrowing':\n        return 'menu_book';\n      case 'payment':\n        return 'payments';\n      case 'reservation':\n        return 'bookmark';\n      case 'new_member':\n        return 'person_add';\n      default:\n        return 'event';\n    }\n  };\n\n  const getActivityLabel = (activityType) => {\n    switch (activityType) {\n      case 'borrowing':\n        return 'Book Borrowing';\n      case 'payment':\n        return 'Payment';\n      case 'reservation':\n        return 'Book Reservation';\n      case 'new_member':\n        return 'New Member';\n      default:\n        return 'Activity';\n    }\n  };\n\n  const getActivityIconBg = (activityType) => {\n    switch (activityType) {\n      case 'borrowing':\n        return 'bg-blue-500/20';\n      case 'payment':\n        return 'bg-success-green/20';\n      case 'reservation':\n        return 'bg-yellow-500/20';\n      case 'new_member':\n        return 'bg-primary/20';\n      default:\n        return 'bg-primary/20';\n    }\n  };\n\n  const getActivityIconColor = (activityType) => {\n    switch (activityType) {\n      case 'borrowing':\n        return 'text-blue-400';\n      case 'payment':\n        return 'text-success-green';\n      case 'reservation':\n        return 'text-yellow-400';\n      case 'new_member':\n        return 'text-primary';\n      default:\n        return 'text-primary';\n    }\n  };\n\n  const getStatusBadge = (activity) => {\n    const status = (activity?.status || '').toLowerCase();\n    const activityType = activity?.type || '';\n\n    // Borrowing status\n    if (activityType === 'borrowing') {\n      if (status === BORROWING_STATUS.ACTIVE) {\n        return {\n          label: 'Active',\n          className: 'bg-blue-500/10 text-blue-400 border-blue-500/20',\n        };\n      } else if (status === BORROWING_STATUS.RETURNED) {\n        return {\n          label: 'Returned',\n          className: 'bg-success-green/10 text-success-green border-success-green/20',\n        };\n      } else if (status === BORROWING_STATUS.OVERDUE) {\n        return {\n          label: 'Overdue',\n          className: 'bg-red-500/10 text-red-400 border-red-500/20',\n        };\n      }\n    }\n\n    // Payment status\n    if (activityType === 'payment') {\n      if (status === PAYMENT_STATUS.COMPLETED) {\n        return {\n          label: 'Completed',\n          className: 'bg-success-green/10 text-success-green border-success-green/20',\n        };\n      } else if (status === PAYMENT_STATUS.PENDING) {\n        return {\n          label: 'Pending',\n          className: 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20',\n        };\n      } else if (status === PAYMENT_STATUS.FAILED) {\n        return {\n          label: 'Failed',\n          className: 'bg-red-500/10 text-red-400 border-red-500/20',\n        };\n      } else if (status === PAYMENT_STATUS.REFUNDED) {\n        return {\n          label: 'Refunded',\n          className: 'bg-gray-500/10 text-gray-400 border-gray-500/20',\n        };\n      }\n    }\n\n    // Reservation status\n    if (activityType === 'reservation') {\n      if (status === RESERVATION_STATUS.PENDING) {\n        return {\n          label: 'Pending',\n          className: 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20',\n        };\n      } else if (status === RESERVATION_STATUS.READY) {\n        return {\n          label: 'Ready',\n          className: 'bg-blue-500/10 text-blue-400 border-blue-500/20',\n        };\n      } else if (status === RESERVATION_STATUS.COMPLETED) {\n        return {\n          label: 'Completed',\n          className: 'bg-success-green/10 text-success-green border-success-green/20',\n        };\n      } else if (status === RESERVATION_STATUS.EXPIRED) {\n        return {\n          label: 'Expired',\n          className: 'bg-red-500/10 text-red-400 border-red-500/20',\n        };\n      } else if (status === RESERVATION_STATUS.CANCELLED) {\n        return {\n          label: 'Cancelled',\n          className: 'bg-gray-500/10 text-gray-400 border-gray-500/20',\n        };\n      }\n    }\n\n    // New member status\n    if (activityType === 'new_member') {\n      return {\n        label: 'Completed',\n        className: 'bg-success-green/10 text-success-green border-success-green/20',\n      };\n    }\n\n    // Default\n    return {\n      label: status ? status.charAt(0).toUpperCase() + status.slice(1) : 'Unknown',\n      className: 'bg-gray-500/10 text-gray-400 border-gray-500/20',\n    };\n  };\n\n  return (\n    <>\n      <AdminHeader title=\"Admin Overview\" subtitle=\"System performance, revenue metrics, and activity logs.\" />\n      <div className=\"flex-1 overflow-y-auto p-4 md:p-8 lg:p-10 scroll-smooth\">\n        <div className=\"max-w-[1400px] mx-auto flex flex-col gap-8\">\n          {/* Header Actions */}\n          <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n            <div>\n              <h2 className=\"text-white text-3xl md:text-4xl font-black tracking-tight mb-1\">Admin Overview</h2>\n              <p className=\"text-text-secondary text-base\">System performance, revenue metrics, and activity logs.</p>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-full bg-surface-dark border border-white/5\">\n                <span className=\"relative flex h-2.5 w-2.5\">\n                  <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-success-green opacity-75\"></span>\n                  <span className=\"relative inline-flex rounded-full h-2.5 w-2.5 bg-success-green\"></span>\n                </span>\n                <span className=\"text-xs font-medium text-success-green uppercase tracking-wider\">System Operational</span>\n              </div>\n              <button\n                onClick={fetchStats}\n                className=\"flex items-center justify-center h-10 px-4 rounded-lg bg-primary hover:bg-primary-hover text-white text-sm font-bold tracking-wide shadow-[0_0_20px_rgba(170,31,239,0.4)] transition-all\"\n              >\n                <span className=\"material-symbols-outlined text-[20px] mr-2\">refresh</span>\n                Refresh Data\n              </button>\n            </div>\n          </div>\n\n          {/* Stats Cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6\">\n            {/* Total Revenue */}\n            <div className=\"flex flex-col justify-between gap-3 rounded-xl p-6 bg-card-dark border border-white/5 hover:border-primary/50 transition-colors group relative overflow-hidden\">\n              <div className=\"absolute right-0 top-0 p-3 opacity-5 group-hover:opacity-10 transition-opacity\">\n                <span className=\"material-symbols-outlined text-[80px] text-primary\">payments</span>\n              </div>\n              <div className=\"flex justify-between items-start z-10\">\n                <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider\">Total Revenue</p>\n                <span className=\"material-symbols-outlined text-primary text-xl\">payments</span>\n              </div>\n              <div className=\"z-10\">\n                <p className=\"text-white text-3xl font-bold tracking-tight mb-1\">\n                  {loading ? '...' : formatCurrency(stats.totalRevenue)}\n                </p>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"flex items-center text-success-green bg-success-green/10 px-1.5 py-0.5 rounded text-xs font-bold\">\n                    <span className=\"material-symbols-outlined text-[14px]\">trending_up</span>\n                    {stats.revenueGrowth ?? 0}%\n                  </span>\n                  <span className=\"text-text-secondary text-xs\">vs last month</span>\n                </div>\n              </div>\n            </div>\n\n            {/* Active Members */}\n            <div className=\"flex flex-col justify-between gap-3 rounded-xl p-6 bg-card-dark border border-white/5 hover:border-primary/50 transition-colors group relative overflow-hidden\">\n              <div className=\"absolute right-0 top-0 p-3 opacity-5 group-hover:opacity-10 transition-opacity\">\n                <span className=\"material-symbols-outlined text-[80px] text-primary\">groups</span>\n              </div>\n              <div className=\"flex justify-between items-start z-10\">\n                <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider\">Active Members</p>\n                <span className=\"material-symbols-outlined text-primary text-xl\">groups</span>\n              </div>\n              <div className=\"z-10\">\n                <p className=\"text-white text-3xl font-bold tracking-tight mb-1\">\n                  {loading ? '...' : (stats.activeMembers ?? 0).toLocaleString()}\n                </p>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"flex items-center text-success-green bg-success-green/10 px-1.5 py-0.5 rounded text-xs font-bold\">\n                    <span className=\"material-symbols-outlined text-[14px]\">person_add</span>\n                    +{stats.newMembersThisMonth ?? 0}\n                  </span>\n                  <span className=\"text-text-secondary text-xs\">new this month</span>\n                </div>\n              </div>\n            </div>\n\n            {/* Books Due Today */}\n            <div className=\"flex flex-col justify-between gap-3 rounded-xl p-6 bg-card-dark border border-white/5 hover:border-blue-500/50 transition-colors group relative overflow-hidden\">\n              <div className=\"absolute right-0 top-0 p-3 opacity-5 group-hover:opacity-10 transition-opacity\">\n                <span className=\"material-symbols-outlined text-[80px] text-blue-400\">event</span>\n              </div>\n              <div className=\"flex justify-between items-start z-10\">\n                <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider\">Books Due Today</p>\n                <span className=\"material-symbols-outlined text-blue-400 text-xl\">event</span>\n              </div>\n              <div className=\"z-10\">\n                <p className=\"text-white text-3xl font-bold tracking-tight mb-1\">\n                  {loading ? '...' : (stats.booksDueToday ?? 0).toLocaleString()}\n                </p>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-blue-400 text-xs font-bold\">Due today</span>\n                  <span className=\"text-text-secondary text-xs\"> Action required</span>\n                </div>\n              </div>\n            </div>\n\n            {/* Active Borrowings */}\n            <div className=\"flex flex-col justify-between gap-3 rounded-xl p-6 bg-card-dark border border-white/5 hover:border-primary/50 transition-colors group relative overflow-hidden\">\n              <div className=\"absolute right-0 top-0 p-3 opacity-5 group-hover:opacity-10 transition-opacity\">\n                <span className=\"material-symbols-outlined text-[80px] text-primary\">menu_book</span>\n              </div>\n              <div className=\"flex justify-between items-start z-10\">\n                <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider\">Active Borrowings</p>\n                <span className=\"material-symbols-outlined text-primary text-xl\">menu_book</span>\n              </div>\n              <div className=\"z-10\">\n                <p className=\"text-white text-3xl font-bold tracking-tight mb-1\">\n                  {loading ? '...' : (stats.activeBorrowings ?? 0).toLocaleString()}\n                </p>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-success-green text-xs font-bold\">Currently borrowed</span>\n                  <span className=\"text-text-secondary text-xs\"> On time</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Revenue Trends and Sources */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {/* Revenue Trends Chart */}\n            <div className=\"lg:col-span-2 flex flex-col rounded-xl bg-card-dark border border-white/5 p-6\">\n              <div className=\"flex justify-between items-end mb-6\">\n                <div>\n                  <h3 className=\"text-white text-lg font-bold mb-1\">Revenue Trends</h3>\n                  <p className=\"text-text-secondary text-sm\">Monthly recurring revenue (MRR)</p>\n                </div>\n                <div className=\"text-right\">\n                  <p className=\"text-white text-2xl font-bold\">\n                    {loading ? '...' : formatCurrency((stats.monthlyRevenue && stats.monthlyRevenue.length > 0) ? (stats.monthlyRevenue[stats.monthlyRevenue.length - 1]?.total || 0) : 0)}\n                  </p>\n                  <p className=\"text-success-green text-sm font-medium\">This month so far</p>\n                </div>\n              </div>\n              <div className=\"flex-1 w-full min-h-[250px] relative\">\n                {/* Simple chart visualization */}\n                <div className=\"h-full flex items-end justify-between gap-2\">\n                  {(stats.monthlyRevenue || []).slice(-6).map((month, index) => {\n                    const maxValue = Math.max(...(stats.monthlyRevenue || []).map((m) => m?.total || 0), 1);\n                    const height = ((month?.total || 0) / maxValue) * 100;\n                    return (\n                      <div key={index} className=\"flex-1 flex flex-col items-center gap-2\">\n                        <div className=\"w-full flex flex-col items-center justify-end\" style={{ height: '200px' }}>\n                          <div\n                            className=\"w-full bg-primary rounded-t transition-all hover:bg-primary-hover\"\n                            style={{ height: `${height}%`, minHeight: '4px' }}\n                          ></div>\n                        </div>\n                        <span className=\"text-xs text-text-secondary font-medium\">\n                          {['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'][index]}\n                        </span>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            </div>\n\n            {/* Revenue Sources */}\n            <div className=\"flex flex-col rounded-xl bg-card-dark border border-white/5 p-6\">\n              <h3 className=\"text-white text-lg font-bold mb-1\">Revenue Sources</h3>\n              <p className=\"text-text-secondary text-sm mb-6\">Income distribution by plan</p>\n              <div className=\"flex flex-col items-center justify-center flex-1\">\n                {/* Simple pie chart representation */}\n                <div className=\"relative size-48 rounded-full flex items-center justify-center mb-6\">\n                  <div className=\"absolute inset-0 rounded-full\" style={{\n                    background: `conic-gradient(\n                      #aa1fef 0% ${(stats.revenueBreakdown || []).find(r => r?.type === 'subscription')?.percentage || 0}%,\n                      #10b981 ${(stats.revenueBreakdown || []).find(r => r?.type === 'subscription')?.percentage || 0}% ${((stats.revenueBreakdown || []).find(r => r?.type === 'subscription')?.percentage || 0) + ((stats.revenueBreakdown || []).find(r => r?.type === 'fine')?.percentage || 0)}%,\n                      #facc15 ${((stats.revenueBreakdown || []).find(r => r?.type === 'subscription')?.percentage || 0) + ((stats.revenueBreakdown || []).find(r => r?.type === 'fine')?.percentage || 0)}% 100%\n                    )`\n                  }}></div>\n                  <div className=\"absolute inset-0 m-auto size-32 bg-card-dark rounded-full flex flex-col items-center justify-center shadow-inner\">\n                    <p className=\"text-text-secondary text-xs uppercase font-bold tracking-widest\">Main</p>\n                    <p className=\"text-white text-xl font-bold\">Premium</p>\n                  </div>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-1 gap-3 mt-6\">\n                {(stats.revenueBreakdown || []).map((source, index) => (\n                  <div key={index} className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <div\n                        className=\"w-3 h-3 rounded-full\"\n                        style={{\n                          backgroundColor:\n                            source?.type === 'subscription'\n                              ? '#aa1fef'\n                              : source?.type === 'fine'\n                              ? '#10b981'\n                              : '#facc15',\n                        }}\n                      ></div>\n                      <p className=\"text-text-secondary text-xs font-medium capitalize\">\n                        {source?.type === 'subscription' ? 'Premium Plan' : source?.type === 'fine' ? 'Institutional' : 'Late Fees / Other'}\n                      </p>\n                    </div>\n                    <span className=\"text-white text-xs font-bold\">{(source.percentage ?? 0).toFixed(0)}%</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          {/* Recent System Activity */}\n          <div className=\"flex flex-col gap-4\">\n            <div className=\"flex justify-between items-center px-2\">\n              <h3 className=\"text-white text-lg font-bold\">Recent System Activity</h3>\n              <a className=\"text-primary text-sm font-medium hover:text-primary-light\" href=\"#\">\n                View full log\n              </a>\n            </div>\n            <div className=\"bg-card-dark rounded-xl border border-white/5 overflow-hidden\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full text-left border-collapse\">\n                  <thead>\n                    <tr className=\"border-b border-white/5\">\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider\">Event Type</th>\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider\">Source / User</th>\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider\">Status</th>\n                      <th className=\"p-4 text-xs font-semibold text-text-secondary uppercase tracking-wider text-right\">Time</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-white/5\">\n                    {loading ? (\n                      <tr>\n                        <td colSpan=\"4\" className=\"p-4 text-center text-text-secondary\">\n                          <div className=\"flex justify-center\">\n                            <Loader />\n                          </div>\n                        </td>\n                      </tr>\n                    ) : !stats.recentActivity || stats.recentActivity.length === 0 ? (\n                      <tr>\n                        <td colSpan=\"4\" className=\"p-4 text-center text-text-secondary\">No recent activity</td>\n                      </tr>\n                    ) : (\n                      (stats.recentActivity || []).slice(0, 5).map((activity, index) => {\n                        const activityType = activity?.type || 'unknown';\n                        const icon = getActivityIcon(activityType);\n                        const label = getActivityLabel(activityType);\n                        const iconBg = getActivityIconBg(activityType);\n                        const iconColor = getActivityIconColor(activityType);\n                        const statusBadge = getStatusBadge(activity);\n                        const displayName = activity?.member || activity?.memberEmail || 'N/A';\n                        const additionalInfo = activityType === 'payment' && activity?.amount \n                          ? `  ${formatCurrency(activity.amount)}`\n                          : activityType === 'borrowing' && activity?.bookTitle\n                          ? `  ${activity.bookTitle}`\n                          : activityType === 'reservation' && activity?.bookTitle\n                          ? `  ${activity.bookTitle}`\n                          : '';\n\n                        const memberPhoto = activity?.memberPhoto;\n                        const memberName = activity?.member || 'Unknown';\n                        const activityKey = activity?._id || index;\n\n                        return (\n                          <tr key={activityKey} className=\"group hover:bg-white/5 transition-colors\">\n                            <td className=\"p-4\">\n                              <div className=\"flex items-center gap-3\">\n                                {/* Activity Icon */}\n                                <div className={`size-8 rounded ${iconBg} flex items-center justify-center`}>\n                                  <span className={`material-symbols-outlined ${iconColor} text-sm`}>{icon}</span>\n                                </div>\n                                <span className=\"text-white font-medium text-sm\">{label}</span>\n                              </div>\n                            </td>\n                            <td className=\"p-4\">\n                              <div className=\"flex items-center gap-3\">\n                                {/* User Profile Photo */}\n                                <div className=\"size-9 rounded-full bg-[#3c2348] flex items-center justify-center text-white text-xs font-bold overflow-hidden flex-shrink-0\">\n                                  {memberPhoto && memberPhoto.trim() !== '' && !imageErrors.has(activityKey) ? (\n                                    <img\n                                      src={`${memberPhoto}${memberPhoto.includes('?') ? '&' : '?'}t=${Date.now()}`}\n                                      alt={memberName}\n                                      className=\"w-full h-full rounded-full object-cover\"\n                                      onError={() => {\n                                        setImageErrors(prev => new Set(prev).add(activityKey));\n                                      }}\n                                    />\n                                  ) : (\n                                    <span>{getInitials(memberName)}</span>\n                                  )}\n                                </div>\n                                <div className=\"flex flex-col gap-1\">\n                                  <span className=\"text-white text-sm font-medium\">{displayName}</span>\n                                  {additionalInfo && (\n                                    <span className=\"text-text-secondary text-xs\">{additionalInfo}</span>\n                                  )}\n                                </div>\n                              </div>\n                            </td>\n                            <td className=\"p-4\">\n                              <span className={`inline-flex items-center px-2 py-1 rounded text-xs font-medium border ${statusBadge.className}`}>\n                                {statusBadge.label}\n                              </span>\n                            </td>\n                            <td className=\"p-4 text-right text-text-secondary text-sm\">\n                              {activity?.createdAt ? formatDateTime(activity.createdAt) : 'N/A'}\n                            </td>\n                          </tr>\n                        );\n                      })\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\admin\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\admin\\staff\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchStaff'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [searchQuery, roleFilter, fetchStaff]","fix":{"range":[1420,1445],"text":"[searchQuery, roleFilter, fetchStaff]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":294,"column":39,"nodeType":"JSXOpeningElement","endLine":302,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport AdminHeader from '@/components/AdminHeader';\r\nimport AddStaffModal from '@/components/AddStaffModal';\r\nimport EditStaffModal from '@/components/EditStaffModal';\r\nimport ManageRoleModal from '@/components/ManageRoleModal';\r\nimport { formatDate } from '@/lib/utils';\r\nimport Loader from '@/components/Loader';\r\nimport { showError, showSuccess, showConfirm } from '@/lib/swal';\r\n\r\nexport default function AdminStaffPage() {\r\n  const { userData } = useAuth();\r\n  const [staff, setStaff] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [roleFilter, setRoleFilter] = useState('all');\r\n  const [stats, setStats] = useState({\r\n    totalStaff: 0,\r\n    administrators: 0,\r\n    activeToday: 0,\r\n  });\r\n  const [imageErrors, setImageErrors] = useState(new Set());\r\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\r\n  const [isManageRoleModalOpen, setIsManageRoleModalOpen] = useState(false);\r\n  const [editingStaffId, setEditingStaffId] = useState(null);\r\n  const [activities, setActivities] = useState([]);\r\n  const [activitiesLoading, setActivitiesLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchStaff();\r\n    fetchActivities();\r\n  }, [searchQuery, roleFilter]);\r\n\r\n  const fetchActivities = async () => {\r\n    try {\r\n      setActivitiesLoading(true);\r\n      const response = await fetch('/api/admin/staff/activity?limit=10');\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setActivities(data.activities || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching activities:', error);\r\n    } finally {\r\n      setActivitiesLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchStaff = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const params = new URLSearchParams({\r\n        ...(searchQuery && { search: searchQuery }),\r\n        ...(roleFilter !== 'all' && { role: roleFilter }),\r\n      });\r\n      const response = await fetch(`/api/admin/staff?${params}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setStaff(data.staff || []);\r\n        if (data.stats) {\r\n          setStats({\r\n            totalStaff: data.stats.totalStaff || 0,\r\n            administrators: data.stats.administrators || 0,\r\n            activeToday: data.stats.activeToday || 0,\r\n          });\r\n        }\r\n        // Clear image errors to allow new images to load\r\n        setImageErrors(new Set());\r\n      } else {\r\n        const error = await response.json();\r\n        showError('Error', error.error || 'Failed to fetch staff');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching staff:', error);\r\n      showError('Error', 'Failed to fetch staff. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleEditStaff = (staffId) => {\r\n    setEditingStaffId(staffId);\r\n    setIsEditModalOpen(true);\r\n  };\r\n\r\n  const handleDeleteStaff = async (staffId, staffName) => {\r\n    const result = await showConfirm(\r\n      'Delete Staff Member',\r\n      `Are you sure you want to permanently delete \"${staffName}\"? This action cannot be undone and all their data will be removed from the system.`,\r\n      {\r\n        confirmButtonText: 'Delete',\r\n        cancelButtonText: 'Cancel',\r\n        confirmButtonColor: '#ef4444',\r\n      }\r\n    );\r\n\r\n    if (result.isConfirmed) {\r\n      try {\r\n        const response = await fetch(`/api/admin/staff?userId=${staffId}`, {\r\n          method: 'DELETE',\r\n        });\r\n\r\n        let data;\r\n        try {\r\n          data = await response.json();\r\n        } catch (jsonError) {\r\n          console.error('Error parsing JSON response:', jsonError);\r\n          showError('Error', `Server error (${response.status}). Please check the server logs.`);\r\n          return;\r\n        }\r\n\r\n        if (response.ok) {\r\n          showSuccess('Staff Deleted!', `\"${staffName}\" has been permanently deleted from the system.`);\r\n          fetchStaff(); // Refresh the staff list\r\n          fetchActivities(); // Refresh activity log\r\n        } else {\r\n          const errorMessage = data?.error || data?.message || `Failed to deactivate staff (${response.status})`;\r\n          showError('Error', errorMessage);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error deleting staff:', error);\r\n        showError('Error', error.message || 'Failed to deactivate staff. Please try again.');\r\n      }\r\n    }\r\n  };\r\n\r\n  const getRoleBadge = (role) => {\r\n    const badges = {\r\n      admin: { label: 'Admin', color: 'primary', bg: 'primary/10', border: 'primary/20', text: 'primary' },\r\n      librarian: { label: 'Librarian', color: 'emerald', bg: 'emerald-500/10', border: 'emerald-500/20', text: 'emerald-400' },\r\n      manager: { label: 'Manager', color: 'purple', bg: 'purple-500/10', border: 'purple-500/20', text: 'purple-400' },\r\n    };\r\n    return badges[role] || badges.librarian;\r\n  };\r\n\r\n  const getInitials = (name) => {\r\n    if (!name) return 'U';\r\n    const parts = name.split(' ');\r\n    if (parts.length >= 2) {\r\n      return (parts[0][0] + parts[1][0]).toUpperCase();\r\n    }\r\n    return name[0].toUpperCase();\r\n  };\r\n\r\n  const filteredStaff = staff.filter((member) => {\r\n    if (searchQuery) {\r\n      const query = searchQuery.toLowerCase();\r\n      if (!member.name?.toLowerCase().includes(query) && !member.email?.toLowerCase().includes(query)) {\r\n        return false;\r\n      }\r\n    }\r\n    if (roleFilter !== 'all' && member.role !== roleFilter) {\r\n      return false;\r\n    }\r\n    return true;\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <AdminHeader title=\"Staff Management\" subtitle=\"Manage access, permissions, and view activity logs.\" />\r\n      <div className=\"flex-1 overflow-y-auto p-4 md:p-8 lg:p-10 scroll-smooth\">\r\n        <div className=\"max-w-[1600px] mx-auto flex flex-col gap-8\">\r\n          <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n            <div>\r\n              <h2 className=\"text-white text-3xl font-black tracking-tight mb-1\">Staff Management</h2>\r\n              <p className=\"text-text-secondary\">Manage access, permissions, and view activity logs.</p>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              <button \r\n                onClick={() => setIsManageRoleModalOpen(true)}\r\n                className=\"flex items-center gap-2 px-5 py-2.5 rounded-lg border border-white/5 bg-card-dark hover:bg-white/5 text-text-secondary hover:text-white transition-all font-medium text-sm\"\r\n              >\r\n                <span className=\"material-symbols-outlined text-[18px]\">security</span>\r\n                Manage Roles\r\n              </button>\r\n              <button \r\n                onClick={() => setIsAddModalOpen(true)}\r\n                className=\"flex items-center gap-2 px-5 py-2.5 rounded-lg bg-primary hover:bg-primary-hover text-white shadow-lg shadow-primary/20 transition-all font-bold text-sm hover:scale-105 active:scale-95\"\r\n              >\r\n                <span className=\"material-symbols-outlined text-[20px]\">add</span>\r\n                Add Staff\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Stats Cards */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div className=\"bg-card-dark border border-white/5 p-5 rounded-2xl flex items-center gap-4 relative overflow-hidden group\">\r\n              <div className=\"absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\r\n                <span className=\"material-symbols-outlined text-6xl text-primary\">group</span>\r\n              </div>\r\n              <div className=\"size-12 rounded-xl bg-primary/10 flex items-center justify-center text-primary border border-primary/20\">\r\n                <span className=\"material-symbols-outlined\">badge</span>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-text-secondary text-xs font-semibold uppercase tracking-wider\">Total Staff</p>\r\n                <p className=\"text-white text-2xl font-bold\">{stats.totalStaff}</p>\r\n              </div>\r\n            </div>\r\n            <div className=\"bg-card-dark border border-white/5 p-5 rounded-2xl flex items-center gap-4 relative overflow-hidden group\">\r\n              <div className=\"absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\r\n                <span className=\"material-symbols-outlined text-6xl text-emerald-500\">verified_user</span>\r\n              </div>\r\n              <div className=\"size-12 rounded-xl bg-emerald-500/10 flex items-center justify-center text-emerald-400 border border-emerald-500/20\">\r\n                <span className=\"material-symbols-outlined\">admin_panel_settings</span>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-text-secondary text-xs font-semibold uppercase tracking-wider\">Administrators</p>\r\n                <p className=\"text-white text-2xl font-bold\">{stats.administrators}</p>\r\n              </div>\r\n            </div>\r\n            <div className=\"bg-card-dark border border-white/5 p-5 rounded-2xl flex items-center gap-4 relative overflow-hidden group\">\r\n              <div className=\"absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\r\n                <span className=\"material-symbols-outlined text-6xl text-blue-500\">history</span>\r\n              </div>\r\n              <div className=\"size-12 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-400 border border-blue-500/20\">\r\n                <span className=\"material-symbols-outlined\">bolt</span>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-text-secondary text-xs font-semibold uppercase tracking-wider\">Active Today</p>\r\n                <p className=\"text-white text-2xl font-bold\">{stats.activeToday}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Staff Table */}\r\n          <div className=\"grid grid-cols-1 xl:grid-cols-3 gap-6\">\r\n            <div className=\"xl:col-span-2 flex flex-col gap-4\">\r\n              <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                <div className=\"relative flex-1\">\r\n                  <span className=\"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary\">search</span>\r\n                  <input\r\n                    className=\"w-full bg-card-dark border border-white/5 rounded-xl py-2.5 pl-10 pr-4 text-white text-sm focus:ring-1 focus:ring-primary focus:border-primary transition-all placeholder-text-secondary/60\"\r\n                    placeholder=\"Search staff by name, email...\"\r\n                    type=\"text\"\r\n                    value={searchQuery}\r\n                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                  />\r\n                </div>\r\n                <div className=\"flex gap-3\">\r\n                  <div className=\"relative min-w-[140px]\">\r\n                    <select\r\n                      className=\"w-full bg-card-dark border border-white/5 rounded-xl py-2.5 pl-3 pr-8 text-white text-sm appearance-none focus:ring-1 focus:ring-primary focus:border-primary cursor-pointer\"\r\n                      value={roleFilter}\r\n                      onChange={(e) => setRoleFilter(e.target.value)}\r\n                    >\r\n                      <option value=\"all\">All Roles</option>\r\n                      <option value=\"admin\">Admin</option>\r\n                      <option value=\"librarian\">Librarian</option>\r\n                    </select>\r\n                    <span className=\"material-symbols-outlined absolute right-2 top-1/2 -translate-y-1/2 text-text-secondary pointer-events-none text-lg\">expand_more</span>\r\n                  </div>\r\n                  <button className=\"p-2.5 rounded-xl border border-white/5 bg-card-dark text-text-secondary hover:text-white hover:border-primary/50 transition-colors\" title=\"Export\">\r\n                    <span className=\"material-symbols-outlined text-[20px]\">download</span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              <div className=\"bg-card-dark border border-white/5 rounded-2xl overflow-hidden shadow-xl shadow-black/20 flex-1\">\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full text-left border-collapse\">\r\n                    <thead>\r\n                      <tr className=\"bg-background-dark/50 border-b border-white/5\">\r\n                        <th className=\"px-5 py-4 text-xs font-semibold uppercase tracking-wider text-text-secondary\">Details</th>\r\n                        <th className=\"px-5 py-4 text-xs font-semibold uppercase tracking-wider text-text-secondary\">Role</th>\r\n                        <th className=\"px-5 py-4 text-xs font-semibold uppercase tracking-wider text-text-secondary\">Status</th>\r\n                        <th className=\"px-5 py-4 text-xs font-semibold uppercase tracking-wider text-text-secondary text-right\">Actions</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-white/5\">\r\n                      {loading ? (\r\n                        <tr>\r\n                          <td colSpan=\"4\" className=\"px-5 py-8 text-center text-text-secondary\">\r\n                            <div className=\"flex justify-center\">\r\n                              <Loader />\r\n                            </div>\r\n                          </td>\r\n                        </tr>\r\n                      ) : filteredStaff.length === 0 ? (\r\n                        <tr>\r\n                          <td colSpan=\"4\" className=\"px-5 py-8 text-center text-text-secondary\">No staff found</td>\r\n                        </tr>\r\n                      ) : (\r\n                        filteredStaff.map((member) => {\r\n                          const roleBadge = getRoleBadge(member.role);\r\n                          return (\r\n                            <tr key={member._id} className=\"group hover:bg-white/5 transition-colors\">\r\n                              <td className=\"px-5 py-3.5\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                  <div className=\"size-9 rounded-full bg-[#3c2348] flex items-center justify-center text-white text-xs font-bold overflow-hidden\">\r\n                                    {member.profilePhoto && member.profilePhoto.trim() !== '' && !imageErrors.has(member._id) ? (\r\n                                      <img\r\n                                        src={`${member.profilePhoto}${member.profilePhoto.includes('?') ? '&' : '?'}t=${member.updatedAt ? new Date(member.updatedAt).getTime() : Date.now()}`}\r\n                                        alt={member.name}\r\n                                        className=\"w-full h-full rounded-full object-cover\"\r\n                                        onError={(e) => {\r\n                                          setImageErrors(prev => new Set(prev).add(member._id));\r\n                                        }}\r\n                                        key={`img-${member._id}-${member.profilePhoto}-${member.updatedAt ? new Date(member.updatedAt).getTime() : Date.now()}`}\r\n                                      />\r\n                                    ) : (\r\n                                      <span>{getInitials(member.name)}</span>\r\n                                    )}\r\n                                  </div>\r\n                                  <div className=\"flex flex-col\">\r\n                                    <span className=\"text-white text-sm font-medium\">{member.name}</span>\r\n                                    <span className=\"text-text-secondary text-xs\">{member.email}</span>\r\n                                  </div>\r\n                                </div>\r\n                              </td>\r\n                              <td className=\"px-5 py-3.5\">\r\n                                {member.role === 'admin' ? (\r\n                                  <span className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-medium bg-primary/10 text-primary border border-primary/20\">\r\n                                    {roleBadge.label}\r\n                                  </span>\r\n                                ) : member.role === 'librarian' ? (\r\n                                  <span className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-medium bg-emerald-500/10 text-emerald-400 border border-emerald-500/20\">\r\n                                    {roleBadge.label}\r\n                                  </span>\r\n                                ) : (\r\n                                  <span className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-medium bg-purple-500/10 text-purple-400 border border-purple-500/20\">\r\n                                    {roleBadge.label}\r\n                                  </span>\r\n                                )}\r\n                              </td>\r\n                              <td className=\"px-5 py-3.5\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <div className={`h-2 w-2 rounded-full ${member.isActive ? 'bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.5)]' : 'bg-slate-600'}`}></div>\r\n                                  <span className=\"text-text-secondary text-xs\">{member.isActive ? 'Active' : 'Inactive'}</span>\r\n                                </div>\r\n                              </td>\r\n                              <td className=\"px-5 py-3.5 text-right\">\r\n                                <div className=\"flex justify-end gap-1\">\r\n                                  <button \r\n                                    onClick={() => handleEditStaff(member._id)}\r\n                                    className=\"p-1.5 rounded-lg hover:bg-primary/10 hover:text-primary text-text-secondary transition-colors\" \r\n                                    title=\"Edit Staff\"\r\n                                  >\r\n                                    <span className=\"material-symbols-outlined text-[18px]\">edit</span>\r\n                                  </button>\r\n                                  <button \r\n                                    onClick={() => handleDeleteStaff(member._id, member.name)}\r\n                                    className=\"p-1.5 rounded-lg hover:bg-red-500/10 hover:text-red-400 text-text-secondary transition-colors\"\r\n                                    title=\"Deactivate Staff\"\r\n                                  >\r\n                                    <span className=\"material-symbols-outlined text-[18px]\">delete</span>\r\n                                  </button>\r\n                                </div>\r\n                              </td>\r\n                            </tr>\r\n                          );\r\n                        })\r\n                      )}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            {/* Activity Log Sidebar */}\r\n            <div className=\"xl:col-span-1 flex flex-col gap-4\">\r\n              <div className=\"bg-card-dark border border-white/5 rounded-2xl overflow-hidden shadow-xl shadow-black/20 h-full flex flex-col\">\r\n                <div className=\"p-5 border-b border-white/5 flex items-center justify-between bg-background-dark/30\">\r\n                  <h3 className=\"text-white font-bold flex items-center gap-2\">\r\n                    <span className=\"material-symbols-outlined text-primary text-[20px]\">manage_history</span>\r\n                    Activity Log\r\n                  </h3>\r\n                  <button className=\"text-xs text-primary hover:text-primary-light font-medium transition-colors\">View All</button>\r\n                </div>\r\n                <div className=\"p-0 flex-1 overflow-y-auto max-h-[600px]\">\r\n                  {activitiesLoading ? (\r\n                    <div className=\"flex items-center justify-center p-8\">\r\n                      <Loader />\r\n                    </div>\r\n                  ) : activities.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-text-secondary text-sm\">No recent activity</div>\r\n                  ) : (\r\n                    <div className=\"flex flex-col divide-y divide-white/5/50\">\r\n                      {activities.map((activity, index) => (\r\n                        <div key={index} className=\"p-4 hover:bg-white/5 transition-colors group\">\r\n                          <div className=\"flex gap-3\">\r\n                            <div className=\"mt-1\">\r\n                              <div className=\"size-8 rounded-full bg-primary/20 flex items-center justify-center text-primary border border-primary/20\">\r\n                                <span className=\"material-symbols-outlined text-[16px]\">\r\n                                  {activity.type === 'created' ? 'person_add' : activity.type === 'updated' ? 'edit' : 'delete'}\r\n                                </span>\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"flex flex-col gap-1 flex-1\">\r\n                              <p className=\"text-sm text-white leading-snug\">{activity.message}</p>\r\n                              <span className=\"text-[11px] text-text-secondary flex items-center gap-1\">\r\n                                <span className=\"material-symbols-outlined text-[12px]\">schedule</span>\r\n                                {activity.timeAgo}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Add Staff Modal */}\r\n      <AddStaffModal \r\n        isOpen={isAddModalOpen}\r\n        onClose={() => setIsAddModalOpen(false)}\r\n        onStaffAdded={() => {\r\n          fetchStaff();\r\n          fetchActivities();\r\n        }}\r\n      />\r\n\r\n      {/* Edit Staff Modal */}\r\n      <EditStaffModal \r\n        isOpen={isEditModalOpen}\r\n        onClose={() => {\r\n          setIsEditModalOpen(false);\r\n          setEditingStaffId(null);\r\n          // Clear image errors to allow refreshed images to load\r\n          setImageErrors(new Set());\r\n        }}\r\n        onStaffUpdated={async () => {\r\n          // Clear image errors for the updated staff member specifically\r\n          if (editingStaffId) {\r\n            setImageErrors(prev => {\r\n              const newSet = new Set(prev);\r\n              newSet.delete(editingStaffId);\r\n              return newSet;\r\n            });\r\n          } else {\r\n            setImageErrors(new Set());\r\n          }\r\n          // Force refresh with a small delay to ensure database is updated\r\n          await new Promise(resolve => setTimeout(resolve, 100));\r\n          await fetchStaff();\r\n          fetchActivities();\r\n        }}\r\n        staffId={editingStaffId}\r\n      />\r\n\r\n      {/* Manage Role Modal */}\r\n      <ManageRoleModal \r\n        isOpen={isManageRoleModalOpen}\r\n        onClose={() => setIsManageRoleModalOpen(false)}\r\n        onRoleUpdated={() => {\r\n          fetchStaff();\r\n          fetchActivities();\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\admin\\config\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\admin\\members\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\admin\\staff\\activity\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\admin\\staff\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\admin\\stats\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\books\\[id]\\reviews\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\books\\[id]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\books\\[id]\\stock\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\books\\by-language\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\books\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\books\\top-borrowed\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\borrowings\\[id]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\borrowings\\borrow\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\borrowings\\member\\[memberId]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\borrowings\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\categories\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\cron\\calculate-fines\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\cron\\send-notifications\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\fines\\[id]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\fines\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\image-proxy\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\librarian\\activity\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\librarian\\inventory\\stats\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\librarian\\stats\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\member\\stats\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\notifications\\[id]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\notifications\\mark-all-read\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\notifications\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\notifications\\unread-count\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\payments\\[id]\\checkout\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\payments\\[id]\\create-intent\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\payments\\[id]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\payments\\create-subscription-payment\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\payments\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\reservations\\[id]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\reservations\\book\\[bookId]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\reservations\\member\\[memberId]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\reservations\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\reviews\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\stats\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\subscriptions\\cancel\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\subscriptions\\create-checkout\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\subscriptions\\reactivate\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\subscriptions\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\subscriptions\\sync\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\support\\tickets\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\upload\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\users\\[uid]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\users\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\webhooks\\stripe\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\api\\wishlist\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\auth-error\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\book\\[id]\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchReviews'. Either include it or remove the dependency array.","line":120,"column":6,"nodeType":"ArrayExpression","endLine":120,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [bookId, fetchReviews, router]","fix":{"range":[4262,4278],"text":"[bookId, fetchReviews, router]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport Image from 'next/image';\nimport { useAuth } from '@/contexts/AuthContext';\nimport UserProfile from '@/components/UserProfile';\nimport Loader from '@/components/Loader';\nimport { showError, showSuccess } from '@/lib/swal';\nimport Swal from 'sweetalert2';\nimport { USER_ROLES, RESERVATION_STATUS } from '@/lib/constants';\nimport BookStatusInfo from '@/components/BookStatusInfo';\n\nexport default function BookDetailsPage() {\n  const params = useParams();\n  const router = useRouter();\n  const { user, userData } = useAuth();\n  const bookId = params.id;\n\n  const [book, setBook] = useState(null);\n  const [similarBooks, setSimilarBooks] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [reserving, setReserving] = useState(false);\n  const [isFavorite, setIsFavorite] = useState(false);\n  const [showLightbox, setShowLightbox] = useState(false);\n  const [checkingWishlist, setCheckingWishlist] = useState(false);\n  const [isReserved, setIsReserved] = useState(false);\n  const [checkingReservation, setCheckingReservation] = useState(false);\n  const [realReviews, setRealReviews] = useState([]);\n  const [loadingReviews, setLoadingReviews] = useState(true);\n  const [actionProcessing, setActionProcessing] = useState(false);\n\n  // Role checks\n  const isMember = userData?.role === USER_ROLES.MEMBER;\n  const isAdmin = userData?.role === USER_ROLES.ADMIN;\n  const isLibrarian = userData?.role === USER_ROLES.LIBRARIAN;\n  const isStaff = isAdmin || isLibrarian;\n  const isPremium = userData?.subscription?.status === 'active' && \n                    ['monthly', 'yearly'].includes(userData?.subscription?.type);\n\n  // Check if book is in wishlist\n  useEffect(() => {\n    const checkWishlist = async () => {\n      if (!user || !userData || !bookId) return;\n      \n      try {\n        setCheckingWishlist(true);\n        const response = await fetch(`/api/wishlist?userId=${userData._id}`);\n        if (response.ok) {\n          const data = await response.json();\n          const isInWishlist = data.wishlists?.some(w => w.book._id === bookId);\n          setIsFavorite(isInWishlist);\n        }\n      } catch (error) {\n        console.error('Error checking wishlist:', error);\n      } finally {\n        setCheckingWishlist(false);\n      }\n    };\n\n    checkWishlist();\n  }, [user, userData, bookId]);\n\n  // Check if book is already reserved by the user\n  useEffect(() => {\n    const checkReservation = async () => {\n      if (!user || !userData || !bookId || !isMember) return;\n      \n      try {\n        setCheckingReservation(true);\n        const response = await fetch(`/api/reservations?memberId=${userData._id}&bookId=${bookId}`);\n        if (response.ok) {\n          const data = await response.json();\n          // Check if there's an active reservation (pending or ready status)\n          const activeReservation = data.reservations?.some(\n            r => r.status === RESERVATION_STATUS.PENDING || r.status === RESERVATION_STATUS.READY\n          );\n          setIsReserved(activeReservation || false);\n        }\n      } catch (error) {\n        console.error('Error checking reservation:', error);\n      } finally {\n        setCheckingReservation(false);\n      }\n    };\n\n    checkReservation();\n  }, [user, userData, bookId, isMember]);\n\n  // Fetch book details\n  useEffect(() => {\n    const fetchBook = async () => {\n      try {\n        const response = await fetch(`/api/books/${bookId}`);\n        if (response.ok) {\n          const data = await response.json();\n          setBook(data);\n          \n          // Fetch similar books (same category)\n          if (data.category) {\n            fetchSimilarBooks(data.category._id, data._id);\n          }\n        } else {\n          showError('Book Not Found', 'The book you are looking for does not exist.');\n          router.push('/explore');\n        }\n      } catch (error) {\n        console.error('Error fetching book:', error);\n        showError('Error', 'Failed to load book details. Please try again.');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    if (bookId) {\n      fetchBook();\n      fetchReviews();\n    }\n  }, [bookId, router]);\n\n  // Fetch reviews\n  const fetchReviews = async () => {\n    try {\n      setLoadingReviews(true);\n      const response = await fetch(`/api/books/${bookId}/reviews`);\n      if (response.ok) {\n        const data = await response.json();\n        setRealReviews(data || []);\n      }\n    } catch (error) {\n      console.error('Error fetching reviews:', error);\n    } finally {\n      setLoadingReviews(false);\n    }\n  };\n\n  // Fetch similar books\n  const fetchSimilarBooks = async (categoryId, excludeId) => {\n    try {\n      const response = await fetch(`/api/books?category=${categoryId}&limit=5`);\n      if (response.ok) {\n        const data = await response.json();\n        // Filter out current book\n        const similar = (data.books || []).filter(b => b._id !== excludeId).slice(0, 5);\n        setSimilarBooks(similar);\n      }\n    } catch (error) {\n      console.error('Error fetching similar books:', error);\n    }\n  };\n\n  // Handle borrow\n  const handleBorrow = async () => {\n    if (!user) {\n      showError('Login Required', 'You need to login first to borrow a book.');\n      sessionStorage.setItem('returnAfterLogin', `/book/${bookId}`);\n      router.push('/login');\n      return;\n    }\n\n    // Only members can borrow books\n    if (!isMember) {\n      showError('Borrowing Not Available', 'Book borrowing is only available for members. Please contact support if you need assistance.');\n      return;\n    }\n\n    if (actionProcessing) return;\n\n    const result = await showConfirm(\n      'Borrow Book',\n      'Are you sure you want to borrow this book?',\n      {\n        confirmButtonText: 'Yes, borrow it',\n        cancelButtonText: 'Cancel'\n      }\n    );\n\n    if (!result.isConfirmed) return;\n\n    try {\n      setReserving(true);\n      setActionProcessing(true);\n      const response = await fetch('/api/borrowings/borrow', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          memberId: userData._id,\n          bookId: book._id,\n        }),\n      });\n\n      if (response.ok) {\n        showSuccess('Success!', 'Book borrowed successfully!');\n        // Refresh book data to update available copies\n        const bookResponse = await fetch(`/api/books/${bookId}`);\n        if (bookResponse.ok) {\n          const bookData = await bookResponse.json();\n          setBook(bookData);\n        }\n      } else {\n        const errorData = await response.json();\n        showError('Borrowing Failed', errorData.error || 'Could not borrow book. Please try again.');\n      }\n    } catch (error) {\n      console.error('Error borrowing book:', error);\n      showError('Error', 'Failed to borrow book. Please try again.');\n    } finally {\n      setReserving(false);\n    }\n  };\n\n  // Handle reservation\n  const handleReserve = async () => {\n    if (!user) {\n      showError('Login Required', 'You need to login first to reserve a book.');\n      // Store current page in sessionStorage to return after login\n      sessionStorage.setItem('returnAfterLogin', `/book/${bookId}`);\n      router.push('/login');\n      return;\n    }\n\n    // Only members can reserve books\n    if (!isMember) {\n      showError('Reservation Not Available', 'Book reservations are only available for members. Please contact support if you need assistance.');\n      return;\n    }\n\n    // Check if user is premium\n    if (!isPremium) {\n      showError('Premium Feature', 'Reservations are only available for premium members. Please upgrade your plan to access this feature.');\n      router.push('/member/upgrade');\n      return;\n    }\n\n    // Check if book is already reserved\n    if (book.currentReserver) {\n      if (book.currentReserver.member._id === userData._id) {\n        showError('Already Reserved', 'You have already reserved this book.');\n      } else {\n        showError('Already Reserved', `This book is already reserved by ${book.currentReserver.member.name}.`);\n      }\n      return;\n    }\n\n    try {\n      setReserving(true);\n      const response = await fetch('/api/reservations', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          memberId: userData._id,\n          bookId: book._id,\n        }),\n      });\n\n      if (response.ok) {\n        setIsReserved(true);\n        showSuccess('Reserved!', 'Book has been reserved successfully. You will be notified when it\\'s available.');\n        // Refresh book data to update currentReserver\n        const bookResponse = await fetch(`/api/books/${bookId}`);\n        if (bookResponse.ok) {\n          const bookData = await bookResponse.json();\n          setBook(bookData);\n        }\n      } else {\n        const errorData = await response.json();\n        if (errorData.reserver) {\n          showError('Already Reserved', `This book is already reserved by ${errorData.reserver.name}.`);\n        } else {\n          showError('Reservation Failed', errorData.error || 'Could not reserve book. Please try again.');\n        }\n      }\n    } catch (error) {\n      console.error('Error reserving book:', error);\n      showError('Error', 'Failed to reserve book. Please try again.');\n    } finally {\n      setReserving(false);\n    }\n  };\n\n  // Handle home delivery (premium feature)\n  const handleHomeDelivery = async () => {\n    if (!user || !userData) {\n      showError('Login Required', 'You need to login first to request home delivery.');\n      sessionStorage.setItem('returnAfterLogin', `/book/${bookId}`);\n      router.push('/login');\n      return;\n    }\n\n    // Only members can request home delivery\n    if (!isMember) {\n      showError('Home Delivery Not Available', 'Home delivery is only available for members. Please contact support if you need assistance.');\n      return;\n    }\n\n    if (!isPremium) {\n      router.push('/member/upgrade');\n      return;\n    }\n\n    // TODO: Implement home delivery reservation API\n    // For now, treat it as a reservation with delivery option\n    try {\n      setReserving(true);\n      setActionProcessing(true);\n      const response = await fetch('/api/reservations', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          memberId: userData._id,\n          bookId: book._id,\n          // Note: Add delivery flag when API supports it\n        }),\n      });\n\n      if (response.ok) {\n        showSuccess('Home Delivery Requested!', 'Your home delivery request has been submitted successfully. You will be notified when the book is ready for delivery.');\n      } else {\n        const errorData = await response.json();\n        showError('Request Failed', errorData.error || 'Could not request home delivery. Please try again.');\n      }\n    } catch (error) {\n      console.error('Error requesting home delivery:', error);\n      showError('Error', 'Failed to request home delivery. Please try again.');\n    } finally {\n      setReserving(false);\n    }\n  };\n\n  // Toggle wishlist\n  const toggleFavorite = async () => {\n    if (!user || !userData) {\n      showError('Login Required', 'You need to login first to add books to your wishlist.');\n      sessionStorage.setItem('returnAfterLogin', `/book/${bookId}`);\n      router.push('/login');\n      return;\n    }\n\n    try {\n      setActionProcessing(true);\n      if (isFavorite) {\n        // Remove from wishlist\n        const response = await fetch(`/api/wishlist?userId=${userData._id}&bookId=${book._id}`, {\n          method: 'DELETE',\n        });\n\n        if (response.ok) {\n          setIsFavorite(false);\n          showSuccess('Removed from Wishlist', 'Book has been removed from your wishlist.');\n        } else {\n          const errorData = await response.json();\n          showError('Error', errorData.error || 'Failed to remove from wishlist.');\n        }\n      } else {\n        // Add to wishlist\n        const response = await fetch('/api/wishlist', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            userId: userData._id,\n            bookId: book._id,\n          }),\n        });\n\n        if (response.ok) {\n          setIsFavorite(true);\n          const result = await showSuccess(\n            'Added to Wishlist', \n            'Book has been added to your wishlist successfully!',\n            {\n              showCancelButton: true,\n              confirmButtonText: 'OK',\n              cancelButtonText: 'Go to My Wishlist',\n            }\n          );\n          \n          // If user clicked \"Go to My Wishlist\" (cancel button), navigate to wishlist page\n          if (result.isDismissed && result.dismiss === Swal.DismissReason.cancel) {\n            router.push('/member/wishlist');\n          }\n        } else {\n          const errorData = await response.json();\n          showError('Error', errorData.error || 'Failed to add to wishlist.');\n        }\n      }\n    } catch (error) {\n      console.error('Error toggling wishlist:', error);\n      showError('Error', 'Failed to update wishlist. Please try again.');\n    } finally {\n      setActionProcessing(false);\n    }\n  };\n\n  // Format date\n  const formatDate = (date) => {\n    if (!date) return null;\n    return new Date(date).getFullYear();\n  };\n\n  // Render star rating\n  const renderStars = (rating) => {\n    const fullStars = Math.floor(rating);\n    const hasHalfStar = rating % 1 >= 0.5;\n    const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);\n    \n    return (\n      <div className=\"flex items-center gap-1 text-yellow-400\">\n        {[...Array(fullStars)].map((_, i) => (\n          <span key={`full-${i}`} className=\"material-symbols-outlined !text-[16px] fill-current\">star</span>\n        ))}\n        {hasHalfStar && (\n          <span className=\"material-symbols-outlined !text-[16px] fill-current\">star_half</span>\n        )}\n        {[...Array(emptyStars)].map((_, i) => (\n          <span key={`empty-${i}`} className=\"material-symbols-outlined !text-[16px] text-surface-border\">star</span>\n        ))}\n      </div>\n    );\n  };\n\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background-light dark:bg-background-dark flex items-center justify-center\">\n        <Loader />\n      </div>\n    );\n  }\n\n  if (!book) {\n    return null;\n  }\n\n  const isAvailable = book.availableCopies > 0;\n\n  return (\n    <div className=\"relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white overflow-x-hidden\">\n      {/* Top Navigation */}\n      <div className=\"w-full border-b border-solid border-surface-border bg-background-dark/80 backdrop-blur-md sticky top-0 z-50\">\n        <div className=\"px-6 md:px-10 lg:px-40 flex justify-center py-3\">\n          <div className=\"flex w-full max-w-[1200px] items-center justify-between whitespace-nowrap\">\n            <div className=\"flex items-center gap-8\">\n              <Link href=\"/\" className=\"flex items-center gap-4 text-white cursor-pointer hover:opacity-80 transition-opacity\">\n                <div className=\"size-6 text-primary\">\n                  <span className=\"material-symbols-outlined !text-[28px]\">auto_stories</span>\n                </div>\n                <h2 className=\"text-white text-xl font-bold leading-tight tracking-[-0.015em]\">Bookflix</h2>\n              </Link>\n              <div className=\"hidden md:flex items-center gap-9\">\n                <Link className=\"text-white text-sm font-medium leading-normal hover:text-primary transition-colors\" href=\"/explore\">\n                  Browse\n                </Link>\n              </div>\n            </div>\n            <div className=\"flex flex-1 justify-end gap-6 items-center\">\n              {user ? (\n                <UserProfile />\n              ) : (\n                <div className=\"flex items-center gap-3\">\n                  <Link\n                    href=\"/login\"\n                    className=\"text-white/80 hover:text-white text-sm font-medium transition-colors\"\n                  >\n                    Sign In\n                  </Link>\n                  <Link\n                    href=\"/register\"\n                    className=\"bg-primary hover:bg-primary-hover text-white px-5 py-2 rounded-md text-sm font-bold transition-all\"\n                  >\n                    Join Now\n                  </Link>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content Container */}\n      <div className=\"flex flex-col items-center flex-1 w-full px-4 md:px-10 lg:px-40 py-8\">\n        <div className=\"flex flex-col max-w-[1200px] w-full gap-8\">\n          {/* Breadcrumbs */}\n          <div className=\"flex flex-wrap gap-2 items-center text-sm\">\n            <Link href=\"/\" className=\"text-text-secondary font-medium hover:text-white transition-colors flex items-center gap-1\">\n              <span className=\"material-symbols-outlined !text-[16px]\">home</span>\n              Home\n            </Link>\n            <span className=\"text-text-secondary/50\">/</span>\n            <Link href=\"/explore\" className=\"text-text-secondary font-medium hover:text-white transition-colors\">\n              Browse\n            </Link>\n            {book.category && (\n              <>\n                <span className=\"text-text-secondary/50\">/</span>\n                <Link href={`/explore?category=${book.category._id}`} className=\"text-text-secondary font-medium hover:text-white transition-colors capitalize\">\n                  {book.category.name}\n                </Link>\n              </>\n            )}\n            <span className=\"text-text-secondary/50\">/</span>\n            <span className=\"text-white font-medium\">{book.title}</span>\n          </div>\n\n          {/* Hero Section */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-16\">\n            {/* Left Column: Cover Image */}\n            <div className=\"lg:col-span-4 relative group\">\n              <div className=\"absolute -inset-4 bg-primary/30 rounded-2xl blur-2xl opacity-50 group-hover:opacity-75 transition-opacity duration-500\"></div>\n              <div className=\"relative w-full aspect-[2/3] rounded-xl overflow-hidden shadow-2xl shadow-black border border-white/5 bg-surface-dark\">\n                <Image\n                  src={book.coverImage || '/placeholder-book.png'}\n                  alt={`Cover of ${book.title}`}\n                  fill\n                  className=\"object-cover transition-transform duration-700 group-hover:scale-105\"\n                  sizes=\"(max-width: 1024px) 100vw, 33vw\"\n                />\n                <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent flex flex-col justify-end p-6\">\n                  {book.publisher && (\n                    <span className=\"text-white/40 text-xs font-mono uppercase tracking-widest mb-1\">\n                      {book.publisher}\n                    </span>\n                  )}\n                </div>\n              </div>\n              <button\n                onClick={() => setShowLightbox(true)}\n                className=\"absolute bottom-6 right-6 size-12 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-white flex items-center justify-center hover:bg-white hover:text-black transition-all shadow-lg opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0 duration-300 cursor-pointer\"\n              >\n                <span className=\"material-symbols-outlined\">visibility</span>\n              </button>\n            </div>\n\n            {/* Right Column: Details */}\n            <div className=\"lg:col-span-8 flex flex-col justify-start\">\n              {/* Header */}\n              <div className=\"flex flex-col gap-4 mb-6\">\n                <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold text-white tracking-tight\">{book.title}</h1>\n                <div className=\"flex flex-wrap items-center gap-x-6 gap-y-2 text-text-secondary text-base\">\n                  <Link href={`/explore?search=${encodeURIComponent(book.author)}`} className=\"font-medium text-white hover:text-primary transition-colors flex items-center gap-1\">\n                    <span className=\"material-symbols-outlined !text-[18px]\">person</span>\n                    {book.author}\n                  </Link>\n                  <span className=\"size-1 rounded-full bg-surface-border\"></span>\n                  {formatDate(book.publishedDate) && <span>{formatDate(book.publishedDate)}</span>}\n                  {book.pages && (\n                    <>\n                      <span className=\"size-1 rounded-full bg-surface-border\"></span>\n                      <span>{book.pages} Pages</span>\n                    </>\n                  )}\n                  {book.rating > 0 && (\n                    <>\n                      <span className=\"size-1 rounded-full bg-surface-border\"></span>\n                      <div className=\"flex items-center gap-1\">\n                        {renderStars(book.rating)}\n                        <span className=\"text-white font-bold\">{book.rating.toFixed(1)}</span>\n                        <span className=\"text-text-secondary font-normal\">\n                          ({book.ratingCount > 0 ? `${book.ratingCount}${book.ratingCount >= 1000 ? 'k' : ''} reviews` : 'No reviews'})\n                        </span>\n                      </div>\n                    </>\n                  )}\n                </div>\n              </div>\n\n              {/* Tags/Chips */}\n              <div className=\"flex flex-wrap gap-2 mb-8\">\n                {book.category && (\n                  <div className=\"flex h-7 items-center justify-center rounded-full border border-surface-border bg-surface-dark/50 px-3 hover:border-primary/50 transition-colors cursor-default\">\n                    <p className=\"text-text-secondary text-xs font-medium uppercase tracking-wide capitalize\">\n                      {book.category.name}\n                    </p>\n                  </div>\n                )}\n                {book.tags && book.tags.slice(0, 3).map((tag, index) => (\n                  <div key={index} className=\"flex h-7 items-center justify-center rounded-full border border-surface-border bg-surface-dark/50 px-3 hover:border-primary/50 transition-colors cursor-default\">\n                    <p className=\"text-text-secondary text-xs font-medium uppercase tracking-wide\">\n                      {tag}\n                    </p>\n                  </div>\n                ))}\n              </div>\n\n              {/* Synopsis */}\n              {book.description && (\n                <div className=\"prose prose-invert max-w-none mb-8\">\n                  <h3 className=\"text-white text-lg font-bold mb-2\">Synopsis</h3>\n                  <p className=\"text-gray-300 leading-relaxed text-lg font-light whitespace-pre-line\">\n                    {book.description}\n                  </p>\n                </div>\n              )}\n\n              {/* Availability & Actions */}\n              <div className=\"bg-surface-dark/40 border border-surface-border rounded-xl p-6 backdrop-blur-sm\">\n                {/* Borrower/Reserver Info */}\n                {book.currentBorrower || book.currentReserver ? (\n                  <BookStatusInfo \n                    currentBorrower={book.currentBorrower}\n                    currentReserver={book.currentReserver}\n                    isPremium={isPremium}\n                  />\n                ) : null}\n\n                {/* Status Line */}\n                <div className=\"flex items-center justify-between mb-6 pb-6 border-b border-surface-border/50\">\n                  <div className=\"flex flex-col gap-1\">\n                    <span className=\"text-xs font-semibold uppercase text-text-secondary tracking-wider\">Status</span>\n                    <div className=\"flex items-center gap-2\">\n                      {isAvailable ? (\n                        <>\n                          <span className=\"relative flex h-3 w-3\">\n                            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75\"></span>\n                            <span className=\"relative inline-flex rounded-full h-3 w-3 bg-green-500\"></span>\n                          </span>\n                          <span className=\"text-white font-medium\">Available for Pickup</span>\n                          <span className=\"text-text-secondary text-sm ml-2\">\n                            {book.availableCopies} {book.availableCopies === 1 ? 'copy' : 'copies'} available\n                          </span>\n                        </>\n                      ) : book.currentReserver ? (\n                        <>\n                          <span className=\"relative flex h-3 w-3\">\n                            <span className=\"relative inline-flex rounded-full h-3 w-3 bg-amber-500\"></span>\n                          </span>\n                          <span className=\"text-white font-medium\">Reserved</span>\n                          <span className=\"text-text-secondary text-sm ml-2\">\n                            {book.currentReserver.member._id === userData?._id \n                              ? 'You have reserved this book'\n                              : `Reserved by ${book.currentReserver.member.name}`\n                            }\n                          </span>\n                        </>\n                      ) : (\n                        <>\n                          <span className=\"relative flex h-3 w-3\">\n                            <span className=\"relative inline-flex rounded-full h-3 w-3 bg-orange-500\"></span>\n                          </span>\n                          <span className=\"text-white font-medium\">Waitlist Only</span>\n                          <span className=\"text-text-secondary text-sm ml-2\">\n                            {isPremium ? 'Reserve this book' : 'Premium members can reserve'}\n                          </span>\n                        </>\n                      )}\n                    </div>\n                  </div>\n                  {book.isbn && (\n                    <div className=\"text-right hidden sm:block\">\n                      <span className=\"text-xs font-semibold uppercase text-text-secondary tracking-wider block mb-1\">ISBN</span>\n                      <p className=\"text-white font-mono text-sm\">{book.isbn}</p>\n                    </div>\n                  )}\n                </div>\n\n                {/* Action Buttons */}\n                <div className=\"flex flex-col sm:flex-row gap-4 items-stretch sm:items-center\">\n                  {isStaff ? (\n                    /* Staff Actions (Admin/Librarian) */\n                    <>\n                      <Link\n                        href={isAdmin ? '/admin/books' : '/librarian/books'}\n                        className=\"flex-1 bg-primary hover:bg-primary-hover text-white font-bold h-12 px-6 rounded-lg shadow-[0_0_20px_-5px_rgba(170,31,239,0.4)] transition-all flex items-center justify-center gap-2 group/btn\"\n                      >\n                        <span className=\"material-symbols-outlined\">edit</span>\n                        <span>Manage Book</span>\n                        <span className=\"material-symbols-outlined opacity-0 group-hover/btn:translate-x-1 group-hover/btn:opacity-100 transition-all text-sm\">arrow_forward</span>\n                      </Link>\n                      <Link\n                        href={isAdmin ? '/admin/overview' : '/librarian/circulation'}\n                        className=\"flex-1 h-12 px-6 rounded-lg border border-surface-border bg-surface-dark text-text-secondary hover:border-primary hover:text-white transition-all flex items-center justify-center gap-2\"\n                      >\n                        <span className=\"material-symbols-outlined text-sm\">{isAdmin ? 'dashboard' : 'history'}</span>\n                        <span>{isAdmin ? 'View Dashboard' : 'View Circulation'}</span>\n                      </Link>\n                      <button\n                        onClick={toggleFavorite}\n                        className=\"h-12 w-12 rounded-lg border border-surface-border bg-surface-dark text-white hover:bg-surface-border hover:text-red-400 transition-colors flex items-center justify-center shrink-0\"\n                      >\n                        <span className={`material-symbols-outlined ${isFavorite ? 'fill text-red-400' : ''}`}>\n                          favorite\n                        </span>\n                      </button>\n                    </>\n                  ) : (\n                    /* Member Actions */\n                    <>\n                      {/* Primary Action - Show Borrow for available books, Reserve for unavailable (premium only) */}\n                      {isAvailable ? (\n                        // Book is available - show Borrow button for all members\n                        <button\n                          onClick={handleBorrow}\n                          disabled={reserving || !isMember || actionProcessing}\n                          className=\"flex-1 bg-primary hover:bg-primary-hover text-white font-bold h-12 px-6 rounded-lg shadow-[0_0_20px_-5px_rgba(170,31,239,0.4)] transition-all flex items-center justify-center gap-2 group/btn disabled:opacity-50 disabled:cursor-not-allowed\"\n                        >\n                          {reserving || actionProcessing ? (\n                            <>\n                              <Loader />\n                              <span>{reserving ? 'Processing...' : 'Wait...'}</span>\n                            </>\n                          ) : (\n                            <>\n                              <span className=\"material-symbols-outlined\">local_library</span>\n                              <span>Borrow</span>\n                              <span className=\"material-symbols-outlined opacity-0 group-hover/btn:translate-x-1 group-hover/btn:opacity-100 transition-all text-sm\">arrow_forward</span>\n                            </>\n                          )}\n                        </button>\n                      ) : (\n                        // Book is unavailable - show Reserve button only for premium members\n                        isPremium ? (\n                          book.currentReserver ? (\n                            // Already reserved by someone\n                            <div className=\"flex-1 relative group/tooltip\">\n                              <button\n                                disabled\n                                className=\"flex-1 bg-surface-dark/50 text-text-secondary font-bold h-12 px-6 rounded-lg border border-surface-border cursor-not-allowed flex items-center justify-center gap-2\"\n                              >\n                                <span className=\"material-symbols-outlined\">lock</span>\n                                <span>Already Reserved</span>\n                              </button>\n                              <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 bg-black border border-surface-border rounded text-center opacity-0 group-hover/tooltip:opacity-100 transition-opacity pointer-events-none z-10\">\n                                <p className=\"text-xs text-primary font-bold\">Reserved</p>\n                                <p className=\"text-xs text-gray-400\">\n                                  {book.currentReserver.member._id === userData?._id \n                                    ? 'You have reserved this book'\n                                    : `Reserved by ${book.currentReserver.member.name}`\n                                  }\n                                </p>\n                              </div>\n                            </div>\n                          ) : (\n                            <button\n                              onClick={handleReserve}\n                              disabled={reserving || isReserved || !user || !isMember || checkingReservation || actionProcessing}\n                              className=\"flex-1 bg-primary hover:bg-primary-hover text-white font-bold h-12 px-6 rounded-lg shadow-[0_0_20px_-5px_rgba(170,31,239,0.4)] transition-all flex items-center justify-center gap-2 group/btn disabled:opacity-50 disabled:cursor-not-allowed\"\n                            >\n                              {reserving ? (\n                                <>\n                                  <Loader />\n                                  <span>Reserving...</span>\n                                </>\n                              ) : isReserved ? (\n                                <>\n                                  <span className=\"material-symbols-outlined\">check_circle</span>\n                                  <span>Already Reserved</span>\n                                </>\n                              ) : (\n                                <>\n                                  <span className=\"material-symbols-outlined\">local_library</span>\n                                  <span>Reserve Book</span>\n                                  <span className=\"material-symbols-outlined opacity-0 group-hover/btn:translate-x-1 group-hover/btn:opacity-100 transition-all text-sm\">arrow_forward</span>\n                                </>\n                              )}\n                            </button>\n                          )\n                        ) : (\n                          <div className=\"flex-1 relative group/tooltip\">\n                            <button\n                              disabled\n                              className=\"flex-1 bg-surface-dark/50 text-text-secondary font-bold h-12 px-6 rounded-lg border border-surface-border cursor-not-allowed flex items-center justify-center gap-2\"\n                            >\n                              <span className=\"material-symbols-outlined\">lock</span>\n                              <span>Premium Feature</span>\n                            </button>\n                            <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 bg-black border border-surface-border rounded text-center opacity-0 group-hover/tooltip:opacity-100 transition-opacity pointer-events-none z-10\">\n                              <p className=\"text-xs text-primary font-bold\">Premium Feature</p>\n                              <p className=\"text-xs text-gray-400\">Upgrade to reserve books</p>\n                            </div>\n                          </div>\n                        )\n                      )}\n\n                      {/* Secondary Action (Premium) */}\n                      <div className=\"flex-1 relative group/tooltip\">\n                        <button\n                          onClick={handleHomeDelivery}\n                          disabled={!isPremium || reserving || !isMember || actionProcessing}\n                          className={`w-full h-12 px-6 rounded-lg border border-surface-border bg-surface-dark text-text-secondary flex items-center justify-center gap-2 transition-all ${\n                            isPremium && !reserving && isMember && !actionProcessing\n                              ? 'hover:border-primary hover:text-white cursor-pointer' \n                              : 'disabled:cursor-not-allowed disabled:opacity-70 hover:opacity-100 hover:border-surface-border'\n                          }`}\n                        >\n                          {reserving || actionProcessing ? (\n                            <>\n                              <Loader />\n                              <span>{reserving ? 'Processing...' : 'Wait...'}</span>\n                            </>\n                          ) : (\n                            <>\n                              <span className=\"material-symbols-outlined text-sm\">{isPremium ? 'local_shipping' : 'lock'}</span>\n                              <span>Request Home Delivery</span>\n                            </>\n                          )}\n                        </button>\n                        {!isPremium && (\n                          <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 bg-black border border-surface-border rounded text-center opacity-0 group-hover/tooltip:opacity-100 transition-opacity pointer-events-none z-10\">\n                            <p className=\"text-xs text-primary font-bold\">Premium Feature</p>\n                            <p className=\"text-xs text-gray-400\">Upgrade to unlock delivery</p>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Favorite Action */}\n                      <button\n                        onClick={toggleFavorite}\n                        disabled={actionProcessing}\n                        className=\"h-12 w-12 rounded-lg border border-surface-border bg-surface-dark text-white hover:bg-surface-border hover:text-red-400 transition-colors flex items-center justify-center shrink-0 disabled:opacity-50\"\n                      >\n                        <span className={`material-symbols-outlined ${isFavorite ? 'fill text-red-400' : ''}`}>\n                          favorite\n                        </span>\n                      </button>\n                    </>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"w-full h-px bg-surface-border my-4\"></div>\n\n          {/* Reviews Section */}\n          <div className=\"flex flex-col gap-6\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-white text-xl font-bold\">Community Reviews</h3>\n              {book.ratingCount > 0 && (\n                <span className=\"text-sm text-text-secondary font-medium\">\n                  {book.ratingCount} {book.ratingCount === 1 ? 'review' : 'reviews'}\n                </span>\n              )}\n            </div>\n            \n            {loadingReviews ? (\n              <div className=\"py-12 flex justify-center\">\n                <Loader />\n              </div>\n            ) : realReviews.length > 0 ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {realReviews.map((review) => (\n                  <div key={review._id} className=\"bg-surface-dark border border-surface-border p-5 rounded-xl flex flex-col gap-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div\n                          className=\"size-8 rounded-full bg-cover bg-center bg-surface-border overflow-hidden\"\n                          style={review.user?.profileImage ? { backgroundImage: `url(${review.user.profileImage})` } : {}}\n                        >\n                          {!review.user?.profileImage && (\n                            <span className=\"material-symbols-outlined text-gray-500 w-full h-full flex items-center justify-center text-xl\">person</span>\n                          )}\n                        </div>\n                        <span className=\"text-white font-medium text-sm\">{review.user?.name || 'Anonymous User'}</span>\n                      </div>\n                      <span className=\"text-text-secondary text-xs\">{new Date(review.createdAt).toLocaleDateString()}</span>\n                    </div>\n                    <div className=\"flex text-yellow-400 text-xs\">\n                      {renderStars(review.rating)}\n                    </div>\n                    <p className=\"text-gray-400 text-sm leading-relaxed\">{review.comment}</p>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"bg-surface-dark/40 border border-white/5 p-12 rounded-2xl text-center\">\n                <span className=\"material-symbols-outlined text-gray-600 text-5xl mb-4\">rate_review</span>\n                <p className=\"text-gray-500 text-lg\">No review found for this book.</p>\n                <p className=\"text-gray-600 text-sm mt-1\">Be the first to share your thoughts!</p>\n              </div>\n            )}\n          </div>\n\n          {/* More Like This Section */}\n          {similarBooks.length > 0 && (\n            <div className=\"flex flex-col gap-6 pt-8\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"material-symbols-outlined text-primary\">auto_awesome</span>\n                <h3 className=\"text-white text-xl font-bold\">More Like This</h3>\n              </div>\n              <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4\">\n                {similarBooks.map((similarBook) => (\n                  <Link\n                    key={similarBook._id}\n                    href={`/book/${similarBook._id}`}\n                    className=\"group cursor-pointer flex flex-col gap-2\"\n                  >\n                    <div className=\"aspect-[2/3] w-full rounded-lg bg-surface-dark overflow-hidden relative border border-surface-border/50 transition-all duration-300 group-hover:border-primary group-hover:shadow-[0_0_20px_-5px_rgba(170,31,239,0.3)]\">\n                      <Image\n                        src={similarBook.coverImage || '/placeholder-book.png'}\n                        alt={`Cover of ${similarBook.title}`}\n                        fill\n                        className=\"object-cover transition-transform duration-500 group-hover:scale-110\"\n                        sizes=\"(max-width: 768px) 50vw, (max-width: 1024px) 33vw, 20vw\"\n                      />\n                      {similarBook.rating > 0 && (\n                        <div className=\"absolute top-2 right-2 bg-black/60 backdrop-blur-sm px-2 py-1 rounded text-xs font-bold text-white flex items-center gap-1\">\n                          <span className=\"material-symbols-outlined !text-[12px] text-yellow-400 fill-current\">star</span>\n                          {similarBook.rating.toFixed(1)}\n                        </div>\n                      )}\n                    </div>\n                    <div>\n                      <h4 className=\"text-white font-medium text-sm truncate group-hover:text-primary transition-colors\">\n                        {similarBook.title}\n                      </h4>\n                      <p className=\"text-text-secondary text-xs\">\n                        {similarBook.author}\n                        {similarBook.publishedDate && `  ${new Date(similarBook.publishedDate).getFullYear()}`}\n                      </p>\n                    </div>\n                  </Link>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Lightbox Modal */}\n      {showLightbox && book && (\n        <div\n          className=\"fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in-up\"\n          onClick={() => setShowLightbox(false)}\n        >\n          <div className=\"relative max-w-4xl w-full max-h-[90vh] flex items-center justify-center\">\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                setShowLightbox(false);\n              }}\n              className=\"absolute top-4 right-4 text-white hover:text-primary transition-colors z-10 bg-black/50 rounded-full p-2 hover:bg-black/70\"\n            >\n              <span className=\"material-symbols-outlined text-3xl\">close</span>\n            </button>\n            <div\n              onClick={(e) => e.stopPropagation()}\n              className=\"relative w-full h-full flex items-center justify-center\"\n            >\n              <Image\n                src={book.coverImage || '/placeholder-book.png'}\n                alt={`Cover of ${book.title}`}\n                width={600}\n                height={900}\n                className=\"object-contain max-h-[90vh] rounded-lg shadow-2xl\"\n                priority\n              />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\books-not-found\\page.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":68,"column":22,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2639,2682],"text":"\n            We couldn&apos;t find a match for \""},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2639,2682],"text":"\n            We couldn&lsquo;t find a match for \""},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2639,2682],"text":"\n            We couldn&#39;t find a match for \""},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2639,2682],"text":"\n            We couldn&rsquo;t find a match for \""},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":68,"column":42,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2639,2682],"text":"\n            We couldn't find a match for &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2639,2682],"text":"\n            We couldn't find a match for &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2639,2682],"text":"\n            We couldn't find a match for &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2639,2682],"text":"\n            We couldn't find a match for &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":68,"column":56,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2695,2783],"text":"&quot;. Try adjusting your keywords, checking for typos, or browse our categories.\n          "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2695,2783],"text":"&ldquo;. Try adjusting your keywords, checking for typos, or browse our categories.\n          "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2695,2783],"text":"&#34;. Try adjusting your keywords, checking for typos, or browse our categories.\n          "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2695,2783],"text":"&rdquo;. Try adjusting your keywords, checking for typos, or browse our categories.\n          "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":130,"column":24,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[6479,6555],"text":"\n              While you&apos;re here, check out these popular reads\n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[6479,6555],"text":"\n              While you&lsquo;re here, check out these popular reads\n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[6479,6555],"text":"\n              While you&#39;re here, check out these popular reads\n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[6479,6555],"text":"\n              While you&rsquo;re here, check out these popular reads\n            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useSearchParams, useRouter } from 'next/navigation';\nimport { useState, useEffect, Suspense } from 'react';\nimport Link from 'next/link';\nimport ErrorNavbar from '@/components/ErrorNavbar';\nimport Lottie from 'lottie-react';\n\nfunction BooksNotFoundContent() {\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const searchQuery = searchParams.get('q') || searchParams.get('query') || 'your search';\n  const [searchValue, setSearchValue] = useState(searchQuery === 'your search' ? '' : searchQuery);\n  const [animationData, setAnimationData] = useState(null);\n\n  useEffect(() => {\n    // Load Lottie animation from public directory\n    fetch('/animations/empty-books.json')\n      .then((res) => res.json())\n      .then((data) => setAnimationData(data))\n      .catch((err) => {\n        console.error('Failed to load animation:', err);\n        // Fallback: set null to hide animation\n        setAnimationData(null);\n      });\n  }, []);\n\n  const handleSearch = (e) => {\n    e.preventDefault();\n    if (searchValue.trim()) {\n      router.push(`/explore?q=${encodeURIComponent(searchValue.trim())}`);\n    }\n  };\n\n  const handleClearFilters = () => {\n    router.push('/explore');\n  };\n\n  return (\n    <div className=\"bg-background-light dark:bg-background-dark min-h-screen flex flex-col font-display text-gray-900 dark:text-white overflow-x-hidden\">\n      <ErrorNavbar />\n      \n      {/* Main Content Container */}\n      <main className=\"flex-grow flex flex-col items-center justify-center px-4 py-12 relative w-full\">\n        {/* Background Ambient Glow */}\n        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-primary/10 blur-[120px] rounded-full pointer-events-none z-0\"></div>\n        \n        <div className=\"relative z-10 w-full max-w-[960px] flex flex-col items-center text-center\">\n          {/* Empty State Illustration */}\n          {animationData && (\n            <div className=\"mb-8 relative\">\n              <div className=\"w-[240px] h-[180px] opacity-80 mx-auto\">\n                <Lottie\n                  animationData={animationData}\n                  loop={true}\n                  autoplay={true}\n                  style={{ width: '100%', height: '100%' }}\n                />\n              </div>\n            </div>\n          )}\n          \n          {/* Hero Message */}\n          <h1 className=\"text-white text-3xl md:text-4xl font-bold leading-tight tracking-tight mb-3\">\n            No books found\n          </h1>\n          <p className=\"text-white/60 text-base md:text-lg font-normal leading-relaxed max-w-[540px] mb-10\">\n            We couldn't find a match for \"{searchQuery}\". Try adjusting your keywords, checking for typos, or browse our categories.\n          </p>\n          \n          {/* Search Bar */}\n          <div className=\"w-full max-w-[580px] mb-8\">\n            <form onSubmit={handleSearch} className=\"relative flex flex-col w-full group\">\n              <div className=\"flex w-full items-stretch rounded-xl h-14 bg-surface-dark border border-border-dark group-focus-within:border-primary group-focus-within:ring-2 group-focus-within:ring-primary/30 transition-all duration-200 overflow-hidden shadow-lg shadow-black/20\">\n                <div className=\"text-primary/70 flex items-center justify-center pl-5 pr-2\">\n                  <span className=\"material-symbols-outlined text-[24px]\">search</span>\n                </div>\n                <input\n                  type=\"text\"\n                  value={searchValue}\n                  onChange={(e) => setSearchValue(e.target.value)}\n                  className=\"flex w-full min-w-0 flex-1 resize-none bg-transparent text-white focus:outline-0 placeholder:text-white/30 px-2 text-lg font-normal leading-normal\"\n                  placeholder=\"Search for titles, authors, or genres...\"\n                />\n                {/* Clear/Search Action */}\n                <button\n                  type=\"submit\"\n                  className=\"pr-2 flex items-center justify-center\"\n                >\n                  <div className=\"h-9 px-4 rounded-lg bg-primary hover:bg-primary/90 text-white font-medium text-sm flex items-center justify-center transition-colors\">\n                    Search\n                  </div>\n                </button>\n              </div>\n            </form>\n          </div>\n          \n          {/* Chips / Suggestions */}\n          <div className=\"flex flex-wrap justify-center gap-3 w-full max-w-[700px]\">\n            <button\n              onClick={handleClearFilters}\n              className=\"flex h-9 items-center justify-center gap-x-2 rounded-full border border-border-dark bg-white/5 hover:bg-white/10 px-5 transition-all cursor-pointer group\"\n            >\n              <span className=\"text-white/80 group-hover:text-white text-sm font-medium\">Clear Filters</span>\n              <span className=\"material-symbols-outlined text-[16px] text-white/50 group-hover:text-white\">close</span>\n            </button>\n            <Link\n              href=\"/explore\"\n              className=\"flex h-9 items-center justify-center gap-x-2 rounded-full border border-border-dark bg-white/5 hover:bg-white/10 px-5 transition-all cursor-pointer group\"\n            >\n              <span className=\"text-white/80 group-hover:text-white text-sm font-medium\">Browse Categories</span>\n              <span className=\"material-symbols-outlined text-[16px] text-white/50 group-hover:text-white\">category</span>\n            </Link>\n            <Link\n              href=\"/explore?sort=rating\"\n              className=\"flex h-9 items-center justify-center gap-x-2 rounded-full border border-border-dark bg-white/5 hover:bg-white/10 px-5 transition-all cursor-pointer group\"\n            >\n              <span className=\"text-white/80 group-hover:text-white text-sm font-medium\">View Top Rated</span>\n              <span className=\"material-symbols-outlined text-[16px] text-white/50 group-hover:text-white\">trending_up</span>\n            </Link>\n          </div>\n        </div>\n      </main>\n      \n      {/* Recommendations Footer */}\n      <section className=\"w-full bg-gradient-to-t from-black/40 to-transparent py-12 border-t border-border-dark/50\">\n        <div className=\"max-w-[1200px] mx-auto px-6 lg:px-10 flex flex-col\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h3 className=\"text-white tracking-tight text-xl md:text-2xl font-bold leading-tight\">\n              While you're here, check out these popular reads\n            </h3>\n            <div className=\"flex gap-2\">\n              <button className=\"w-8 h-8 rounded-full bg-surface-dark hover:bg-primary/20 flex items-center justify-center text-white transition-colors border border-border-dark\">\n                <span className=\"material-symbols-outlined text-[20px]\">chevron_left</span>\n              </button>\n              <button className=\"w-8 h-8 rounded-full bg-surface-dark hover:bg-primary/20 flex items-center justify-center text-white transition-colors border border-border-dark\">\n                <span className=\"material-symbols-outlined text-[20px]\">chevron_right</span>\n              </button>\n            </div>\n          </div>\n          \n          {/* Book Grid/Carousel - Placeholder */}\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 md:gap-6\">\n            <div className=\"text-center text-white/50 text-sm py-8 col-span-full\">\n              Popular books will be displayed here\n            </div>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}\n\nexport default function BooksNotFound() {\n  return (\n    <Suspense fallback={\n      <div className=\"bg-background-light dark:bg-background-dark min-h-screen flex flex-col font-display text-gray-900 dark:text-white overflow-x-hidden\">\n        <ErrorNavbar />\n        <main className=\"flex-grow flex flex-col items-center justify-center px-4 py-12\">\n          <div className=\"text-center\">\n            <h1 className=\"text-3xl md:text-4xl font-bold text-white mb-3\">Loading...</h1>\n          </div>\n        </main>\n      </div>\n    }>\n      <BooksNotFoundContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\explore\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\layout.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\librarian\\circulation\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMemberFines'. Either include it or remove the dependency array.","line":42,"column":6,"nodeType":"ArrayExpression","endLine":42,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMemberFines, member]","fix":{"range":[1533,1541],"text":"[fetchMemberFines, member]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":379,"column":23,"nodeType":"JSXOpeningElement","endLine":383,"endColumn":25},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":508,"column":35,"nodeType":"JSXOpeningElement","endLine":515,"endColumn":37},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":611,"column":37,"nodeType":"JSXOpeningElement","endLine":618,"endColumn":39},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":715,"column":27,"nodeType":"JSXOpeningElement","endLine":722,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport LibrarianHeader from '@/components/LibrarianHeader';\r\nimport { showSuccess, showError, showConfirm } from '@/lib/swal';\r\nimport Link from 'next/link';\r\n\r\n// Helper function to check if a string is a valid MongoDB ObjectId\r\nconst isValidObjectId = (str) => {\r\n  return /^[0-9a-fA-F]{24}$/.test(str);\r\n};\r\n\r\nexport default function CirculationDeskPage() {\r\n  const { userData } = useAuth();\r\n  const router = useRouter();\r\n  const [activeTab, setActiveTab] = useState('checkout'); // checkout, return, renew\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [returnQuery, setReturnQuery] = useState('');\r\n  const [memberSearch, setMemberSearch] = useState('');\r\n  const [member, setMember] = useState(null);\r\n  const [cart, setCart] = useState([]);\r\n  const [books, setBooks] = useState([]);\r\n  const [renewableBooks, setRenewableBooks] = useState([]);\r\n  const [recentReturns, setRecentReturns] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [processing, setProcessing] = useState(false);\r\n  const [totalFines, setTotalFines] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (userData?.role !== 'librarian' && userData?.role !== 'admin') {\r\n      router.push('/member/overview');\r\n    }\r\n    fetchRecentReturns();\r\n  }, [userData, router]);\r\n\r\n  useEffect(() => {\r\n    if (member?._id) {\r\n      fetchMemberFines();\r\n    }\r\n  }, [member]);\r\n\r\n  const fetchRecentReturns = async () => {\r\n    try {\r\n      const response = await fetch('/api/borrowings?status=returned&limit=5&sort=returnedDate');\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setRecentReturns(data.borrowings || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching recent returns:', error);\r\n    }\r\n  };\r\n\r\n  const fetchMemberFines = async () => {\r\n    try {\r\n      const response = await fetch(`/api/fines?memberId=${member._id}&status=pending`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const total = (data.fines || []).reduce((sum, fine) => sum + (fine.amount || 0), 0);\r\n        setTotalFines(total);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching fines:', error);\r\n    }\r\n  };\r\n\r\n  const searchMember = async () => {\r\n    if (!memberSearch) return;\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Check if it's a valid ObjectId (member ID)\r\n      const isObjectId = isValidObjectId(memberSearch.trim());\r\n      \r\n      let response;\r\n      if (isObjectId) {\r\n        // Try to fetch by ID using admin members API\r\n        response = await fetch(`/api/admin/members?userId=${memberSearch.trim()}`);\r\n      } else {\r\n        // Search by email\r\n        response = await fetch(`/api/users?email=${encodeURIComponent(memberSearch)}`);\r\n      }\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const foundMember = data.member || data.user || data;\r\n        \r\n        if (foundMember) {\r\n          setMember(foundMember);\r\n          // Fetch member's borrowings\r\n          if (foundMember._id) {\r\n            const borrowingsResponse = await fetch(`/api/borrowings/member/${foundMember._id}`);\r\n            if (borrowingsResponse.ok) {\r\n              const borrowingsData = await borrowingsResponse.json();\r\n              setBooks(borrowingsData.borrowings || []);\r\n              \r\n              // Filter renewable books (active, not overdue, renewal count < 2)\r\n              const renewable = (borrowingsData.borrowings || []).filter(\r\n                (b) => b.status === 'active' && b.renewalCount < 2\r\n              );\r\n              setRenewableBooks(renewable);\r\n            }\r\n          }\r\n          fetchMemberFines();\r\n        } else {\r\n          showError('Member Not Found', 'No member found with that email or ID');\r\n          setMember(null);\r\n        }\r\n      } else {\r\n        showError('Error', 'Error searching member');\r\n        setMember(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching member:', error);\r\n      showError('Error', 'Error searching member');\r\n      setMember(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const searchBook = async (isbn) => {\r\n    if (!isbn || !member) {\r\n      if (!member) {\r\n        showError('Member Required', 'Please search for a member first');\r\n      }\r\n      return;\r\n    }\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch(`/api/books?search=${encodeURIComponent(isbn)}&limit=1`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.books && data.books.length > 0) {\r\n          const book = data.books[0];\r\n          // Check if already in cart\r\n          if (!cart.find((b) => b._id === book._id)) {\r\n            // Check if member already has this book borrowed\r\n            const alreadyBorrowed = books.some(\r\n              (b) => b.book?._id === book._id && (b.status === 'active' || b.status === 'overdue')\r\n            );\r\n            if (alreadyBorrowed) {\r\n              showError('Already Borrowed', 'Member already has this book borrowed');\r\n              return;\r\n            }\r\n            \r\n            // Check borrowing limit\r\n            const activeCount = books.filter((b) => b.status === 'active' || b.status === 'overdue').length;\r\n            const maxBooks = member.subscription?.type === 'free' ? 1 : 4;\r\n            if (activeCount + cart.length >= maxBooks) {\r\n              showError('Borrowing Limit', `Member can borrow maximum ${maxBooks} book(s) at a time`);\r\n              return;\r\n            }\r\n            \r\n            setCart([...cart, { ...book, dueDate: calculateDueDate() }]);\r\n            setSearchQuery('');\r\n            showSuccess('Book Added', 'Book added to cart successfully');\r\n          } else {\r\n            showError('Already in Cart', 'This book is already in the cart');\r\n          }\r\n        } else {\r\n          showError('Book Not Found', 'No book found with that ISBN');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching book:', error);\r\n      showError('Error', 'Error searching for book');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const calculateDueDate = () => {\r\n    const dueDate = new Date();\r\n    const subscriptionType = member?.subscription?.type || 'free';\r\n    const maxDays = subscriptionType === 'free' ? 7 : 20;\r\n    dueDate.setDate(dueDate.getDate() + maxDays);\r\n    return dueDate;\r\n  };\r\n\r\n  const handleCheckout = async () => {\r\n    if (!member?._id || cart.length === 0) return;\r\n\r\n    try {\r\n      setProcessing(true);\r\n      const results = [];\r\n      \r\n      for (const book of cart) {\r\n        const response = await fetch('/api/borrowings', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ memberId: member._id, bookId: book._id }),\r\n        });\r\n\r\n        if (!response.ok) {\r\n          const error = await response.json();\r\n          results.push({ book: book.title, success: false, error: error.error });\r\n        } else {\r\n          results.push({ book: book.title, success: true });\r\n        }\r\n      }\r\n\r\n      const failed = results.filter((r) => !r.success);\r\n      const succeeded = results.filter((r) => r.success);\r\n\r\n      if (failed.length > 0) {\r\n        showError(\r\n          'Checkout Incomplete',\r\n          `Failed to checkout: ${failed.map((f) => f.book).join(', ')}\\n${failed.map((f) => f.error).join('\\n')}`\r\n        );\r\n      } else {\r\n        showSuccess('Success!', `All ${succeeded.length} book(s) checked out successfully`);\r\n      }\r\n\r\n      setCart([]);\r\n      setSearchQuery('');\r\n      \r\n      // Refresh member's borrowings\r\n      if (member._id) {\r\n        const borrowingsResponse = await fetch(`/api/borrowings/member/${member._id}`);\r\n        if (borrowingsResponse.ok) {\r\n          const borrowingsData = await borrowingsResponse.json();\r\n          setBooks(borrowingsData.borrowings || []);\r\n          \r\n          const renewable = (borrowingsData.borrowings || []).filter(\r\n            (b) => b.status === 'active' && (b.renewalCount || 0) < 2\r\n          );\r\n          setRenewableBooks(renewable);\r\n        }\r\n        fetchMemberFines();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking out books:', error);\r\n      showError('Error', error.message || 'Failed to checkout books');\r\n    } finally {\r\n      setProcessing(false);\r\n    }\r\n  };\r\n\r\n  const handleReturn = async (isbn) => {\r\n    if (!isbn) return;\r\n    try {\r\n      setProcessing(true);\r\n      // Find the borrowing by book ISBN\r\n      const response = await fetch(`/api/borrowings?status=active&limit=100`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const borrowing = data.borrowings?.find((b) => b.book?.isbn === isbn);\r\n        if (borrowing) {\r\n          const returnResponse = await fetch(`/api/borrowings/${borrowing._id}`, {\r\n            method: 'PATCH',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ action: 'return', returnedBy: userData?._id }),\r\n          });\r\n\r\n          if (returnResponse.ok) {\r\n            showSuccess('Success!', 'Book returned successfully');\r\n            fetchRecentReturns();\r\n            setReturnQuery('');\r\n            \r\n            // Refresh member's borrowings if member is loaded\r\n            if (member?._id) {\r\n              const borrowingsResponse = await fetch(`/api/borrowings/member/${member._id}`);\r\n              if (borrowingsResponse.ok) {\r\n                const borrowingsData = await borrowingsResponse.json();\r\n                setBooks(borrowingsData.borrowings || []);\r\n              }\r\n              fetchMemberFines();\r\n            }\r\n          } else {\r\n            const error = await returnResponse.json();\r\n            showError('Error', error.error || 'Failed to return book');\r\n          }\r\n        } else {\r\n          showError('Not Found', 'No active borrowing found for this ISBN');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error returning book:', error);\r\n      showError('Error', 'Failed to return book');\r\n    } finally {\r\n      setProcessing(false);\r\n    }\r\n  };\r\n\r\n  const handleRenew = async (borrowingId) => {\r\n    try {\r\n      setProcessing(true);\r\n      const response = await fetch(`/api/borrowings/${borrowingId}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'renew' }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        showSuccess('Success!', 'Book renewed successfully');\r\n        \r\n        // Refresh member's borrowings\r\n        if (member._id) {\r\n          const borrowingsResponse = await fetch(`/api/borrowings/member/${member._id}`);\r\n          if (borrowingsResponse.ok) {\r\n            const borrowingsData = await borrowingsResponse.json();\r\n            setBooks(borrowingsData.borrowings || []);\r\n            \r\n            const renewable = (borrowingsData.borrowings || []).filter(\r\n              (b) => b.status === 'active' && (b.renewalCount || 0) < 2\r\n            );\r\n            setRenewableBooks(renewable);\r\n          }\r\n        }\r\n      } else {\r\n        const error = await response.json();\r\n        showError('Error', error.error || 'Failed to renew book');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error renewing book:', error);\r\n      showError('Error', 'Failed to renew book');\r\n    } finally {\r\n      setProcessing(false);\r\n    }\r\n  };\r\n\r\n  const removeFromCart = (bookId) => {\r\n    setCart(cart.filter((b) => b._id !== bookId));\r\n  };\r\n\r\n  const getInitials = (name) => {\r\n    if (!name) return 'U';\r\n    const parts = name.split(' ');\r\n    if (parts.length >= 2) {\r\n      return (parts[0][0] + parts[1][0]).toUpperCase();\r\n    }\r\n    return name[0].toUpperCase();\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <LibrarianHeader title=\"Circulation Desk\" />\r\n      <div className=\"flex-1 grid grid-cols-1 lg:grid-cols-12 overflow-hidden\">\r\n        {/* Left Column - Main Checkout Area */}\r\n        <div className=\"lg:col-span-8 flex flex-col border-r border-[#3c2348] bg-background-dark relative\">\r\n          <div className=\"p-6 pb-6 bg-[#23142b] border-b border-[#3c2348]\">\r\n            <div className=\"flex flex-col md:flex-row gap-6\">\r\n              {/* Member Search */}\r\n              <div className=\"flex-1 flex flex-col gap-2\">\r\n                <label className=\"text-xs text-primary font-bold uppercase tracking-widest flex justify-between\">\r\n                  Check Member Status <span className=\"text-text-muted font-normal normal-case\">[F1 Focus]</span>\r\n                </label>\r\n                <div className=\"relative group\">\r\n                  <span className=\"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-text-muted group-focus-within:text-primary transition-colors\">search</span>\r\n                  <div className=\"flex gap-2\">\r\n                    <input\r\n                      className=\"w-full bg-[#2b1934] border border-[#553267] text-white text-lg font-mono h-12 pl-12 pr-4 rounded-xl focus:outline-none focus:border-primary placeholder:text-text-muted/50 transition-all\"\r\n                      placeholder=\"Scan Member ID or Search Email...\"\r\n                      type=\"text\"\r\n                      value={memberSearch}\r\n                      onChange={(e) => setMemberSearch(e.target.value)}\r\n                      onKeyPress={(e) => e.key === 'Enter' && searchMember()}\r\n                    />\r\n                    <button\r\n                      onClick={searchMember}\r\n                      disabled={loading}\r\n                      className=\"bg-[#3c2348] hover:bg-primary text-white px-4 rounded-xl transition-colors border border-[#553267] hover:border-primary disabled:opacity-50\"\r\n                    >\r\n                      Check\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Member Info Display */}\r\n              {member && (\r\n                <div className=\"flex-[1.5] bg-[#2b1934]/50 border border-[#3c2348] rounded-xl p-3 flex items-center gap-4 relative overflow-hidden group\">\r\n                  <div className=\"absolute top-0 right-0 p-1 bg-emerald-500/10 rounded-bl-xl border-b border-l border-emerald-500/20 text-[10px] text-emerald-400 font-bold uppercase px-2\">Active</div>\r\n                  <div className=\"size-12 rounded-full bg-cover bg-center shrink-0 border border-[#553267] overflow-hidden\">\r\n                    {member.profilePhoto ? (\r\n                      <img\r\n                        src={member.profilePhoto}\r\n                        alt={member.name}\r\n                        className=\"w-full h-full object-cover\"\r\n                      />\r\n                    ) : (\r\n                      <div className=\"w-full h-full flex items-center justify-center bg-[#3c2348] text-white text-sm font-bold\">\r\n                        {getInitials(member.name)}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"min-w-0 flex-1\">\r\n                    <h4 className=\"text-white font-bold leading-tight truncate\">{member.name}</h4>\r\n                    <p className=\"text-text-muted text-xs truncate\">ID: #{member._id.toString().slice(-4)}  {member.subscription?.type || 'free'}</p>\r\n                  </div>\r\n                  <div className=\"flex gap-3 text-xs border-l border-[#3c2348] pl-3\">\r\n                    <div className=\"text-center\">\r\n                      <div className=\"text-text-muted uppercase text-[9px]\">Loans</div>\r\n                      <div className=\"text-white font-bold text-lg\">\r\n                        {books.filter((b) => b.status === 'active' || b.status === 'overdue').length}\r\n                        <span className=\"text-text-muted text-sm font-normal\">/{member.subscription?.type === 'free' ? '1' : '4'}</span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-center\">\r\n                      <div className=\"text-text-muted uppercase text-[9px]\">Fines</div>\r\n                      <div className={`font-bold text-lg ${totalFines > 0 ? 'text-red-400' : 'text-emerald-400'}`}>\r\n                        ${totalFines.toFixed(2)}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => {\r\n                      setMember(null);\r\n                      setCart([]);\r\n                      setBooks([]);\r\n                      setRenewableBooks([]);\r\n                      setTotalFines(0);\r\n                    }}\r\n                    className=\"absolute bottom-2 right-2 p-1 text-text-muted hover:text-white rounded hover:bg-white/10\"\r\n                    title=\"Clear Member\"\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-[16px]\">close</span>\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Checkout/Renew Tabs */}\r\n          <div className=\"flex-1 flex flex-col min-h-0 bg-background-dark\">\r\n            <div className=\"flex items-center border-b border-[#3c2348] px-6 pt-2 gap-1 bg-[#23142b]\">\r\n              <button\r\n                onClick={() => setActiveTab('checkout')}\r\n                className={`relative px-6 py-3 rounded-t-lg font-medium text-sm flex items-center gap-2 transition-all ${\r\n                  activeTab === 'checkout'\r\n                    ? 'bg-primary/10 text-white border border-primary/20 border-b-transparent'\r\n                    : 'text-text-muted hover:text-white hover:bg-white/5'\r\n                }`}\r\n              >\r\n                <span className=\"material-symbols-outlined text-[18px]\">shopping_bag</span>\r\n                Borrow Book\r\n                {activeTab === 'checkout' && (\r\n                  <span className=\"absolute bottom-[-2px] left-0 w-full h-[2px] bg-primary shadow-[0_-2px_10px_rgba(170,31,239,0.5)]\"></span>\r\n                )}\r\n              </button>\r\n              <button\r\n                onClick={() => setActiveTab('renew')}\r\n                className={`px-6 py-3 rounded-t-lg font-medium text-sm flex items-center gap-2 transition-all ${\r\n                  activeTab === 'renew'\r\n                    ? 'bg-primary/10 text-white border border-primary/20 border-b-transparent'\r\n                    : 'text-text-muted hover:text-white hover:bg-white/5'\r\n                }`}\r\n              >\r\n                <span className=\"material-symbols-outlined text-[18px]\">autorenew</span>\r\n                Renew Book\r\n              </button>\r\n              <div className=\"ml-auto text-xs text-text-muted flex gap-2\">\r\n                <span className=\"bg-[#2b1934] px-2 py-1 rounded border border-[#3c2348]\">Session: #{Date.now().toString().slice(-4)}</span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Checkout Tab Content */}\r\n            {activeTab === 'checkout' && (\r\n              <div className=\"flex-1 flex flex-col p-6 overflow-hidden\">\r\n                <div className=\"mb-6\">\r\n                  <label className=\"text-xs text-text-muted font-bold uppercase tracking-widest mb-2 block\">Add Item to Cart</label>\r\n                  <div className=\"relative\">\r\n                    <span className=\"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-primary\">qr_code_scanner</span>\r\n                    <input\r\n                      autoFocus\r\n                      className=\"w-full bg-[#2b1934] border border-[#553267] text-white text-xl font-mono h-14 pl-12 pr-24 rounded-xl focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-text-muted/40 transition-all\"\r\n                      placeholder={member ? \"Scan Book ISBN to borrow...\" : \"Search for member first...\"}\r\n                      type=\"text\"\r\n                      value={searchQuery}\r\n                      onChange={(e) => setSearchQuery(e.target.value)}\r\n                      onKeyPress={(e) => {\r\n                        if (e.key === 'Enter' && searchQuery && member) {\r\n                          searchBook(searchQuery);\r\n                        }\r\n                      }}\r\n                      disabled={!member}\r\n                    />\r\n                    <kbd className=\"absolute right-4 top-1/2 -translate-y-1/2 px-2 py-1 bg-[#3c2348] text-text-muted text-xs rounded font-mono border border-[#553267]\">Enter</kbd>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto bg-[#23142b] rounded-xl border border-[#3c2348]\">\r\n                  <table className=\"w-full text-left border-collapse\">\r\n                    <thead className=\"bg-[#2b1934] text-xs uppercase text-text-muted font-semibold sticky top-0 z-10\">\r\n                      <tr>\r\n                        <th className=\"p-4 border-b border-[#3c2348]\">Book Title</th>\r\n                        <th className=\"p-4 border-b border-[#3c2348]\">Author</th>\r\n                        <th className=\"p-4 border-b border-[#3c2348]\">Due Date</th>\r\n                        <th className=\"p-4 border-b border-[#3c2348] text-right\">Action</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"text-sm divide-y divide-[#3c2348]\">\r\n                      {cart.length === 0 ? (\r\n                        <tr>\r\n                          <td colSpan=\"4\" className=\"p-8 text-center text-text-muted\">\r\n                            No items in cart. Scan a book ISBN to add.\r\n                          </td>\r\n                        </tr>\r\n                      ) : (\r\n                        cart.map((book) => (\r\n                          <tr key={book._id} className=\"hover:bg-white/5 group transition-colors\">\r\n                            <td className=\"p-4 text-white font-medium flex items-center gap-3\">\r\n                              <div className=\"w-8 h-10 bg-gray-700 rounded overflow-hidden shrink-0\">\r\n                                {book.coverImage ? (\r\n                                  <img\r\n                                    src={book.coverImage}\r\n                                    alt={book.title}\r\n                                    className=\"w-full h-full object-cover\"\r\n                                    onError={(e) => {\r\n                                      e.target.style.display = 'none';\r\n                                    }}\r\n                                  />\r\n                                ) : (\r\n                                  <div className=\"w-full h-full flex items-center justify-center\">\r\n                                    <span className=\"material-symbols-outlined text-gray-500 text-sm\">book</span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                              {book.title}\r\n                            </td>\r\n                            <td className=\"p-4 text-text-muted\">{book.author}</td>\r\n                            <td className=\"p-4 text-emerald-400 font-mono\">\r\n                              {new Date(book.dueDate).toLocaleDateString('en-US', {\r\n                                month: 'short',\r\n                                day: 'numeric',\r\n                                year: 'numeric',\r\n                              })}\r\n                            </td>\r\n                            <td className=\"p-4 text-right\">\r\n                              <button\r\n                                onClick={() => removeFromCart(book._id)}\r\n                                className=\"text-text-muted hover:text-red-400 transition-colors\"\r\n                              >\r\n                                <span className=\"material-symbols-outlined text-[18px]\">delete</span>\r\n                              </button>\r\n                            </td>\r\n                          </tr>\r\n                        ))\r\n                      )}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n\r\n                <div className=\"mt-4 flex justify-between items-center\">\r\n                  <div className=\"text-sm text-text-muted\">\r\n                    Items: <span className=\"text-white font-bold\">{cart.length}</span>\r\n                  </div>\r\n                  <div className=\"flex gap-3\">\r\n                    <button\r\n                      onClick={() => setCart([])}\r\n                      className=\"px-5 py-2.5 rounded-lg border border-[#3c2348] text-text-muted hover:text-white hover:bg-[#3c2348] transition-colors font-medium text-sm\"\r\n                    >\r\n                      Cancel\r\n                    </button>\r\n                    <button\r\n                      onClick={handleCheckout}\r\n                      disabled={cart.length === 0 || !member || processing}\r\n                      className=\"px-6 py-2.5 rounded-lg bg-primary hover:bg-primary-hover text-white font-bold shadow-[0_0_15px_rgba(170,31,239,0.3)] transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                      <span className=\"material-symbols-outlined text-[18px]\">print</span>\r\n                      Complete Checkout\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Renew Tab Content */}\r\n            {activeTab === 'renew' && (\r\n              <div className=\"flex-1 flex flex-col p-6 overflow-hidden\">\r\n                {!member ? (\r\n                  <div className=\"flex-1 flex items-center justify-center\">\r\n                    <div className=\"text-center text-text-muted\">\r\n                      <span className=\"material-symbols-outlined text-6xl mb-4 block\">person_search</span>\r\n                      <p className=\"text-lg\">Please search for a member first</p>\r\n                    </div>\r\n                  </div>\r\n                ) : renewableBooks.length === 0 ? (\r\n                  <div className=\"flex-1 flex items-center justify-center\">\r\n                    <div className=\"text-center text-text-muted\">\r\n                      <span className=\"material-symbols-outlined text-6xl mb-4 block\">library_books</span>\r\n                      <p className=\"text-lg\">No renewable books found</p>\r\n                      <p className=\"text-sm mt-2\">All books are either renewed or overdue</p>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <>\r\n                    <div className=\"mb-4 text-sm text-text-muted\">\r\n                      Books eligible for renewal (can renew up to 2 times)\r\n                    </div>\r\n                    <div className=\"flex-1 overflow-y-auto bg-[#23142b] rounded-xl border border-[#3c2348]\">\r\n                      <table className=\"w-full text-left border-collapse\">\r\n                        <thead className=\"bg-[#2b1934] text-xs uppercase text-text-muted font-semibold sticky top-0 z-10\">\r\n                          <tr>\r\n                            <th className=\"p-4 border-b border-[#3c2348]\">Book Title</th>\r\n                            <th className=\"p-4 border-b border-[#3c2348]\">Author</th>\r\n                            <th className=\"p-4 border-b border-[#3c2348]\">Current Due Date</th>\r\n                            <th className=\"p-4 border-b border-[#3c2348]\">Renewals</th>\r\n                            <th className=\"p-4 border-b border-[#3c2348] text-right\">Action</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody className=\"text-sm divide-y divide-[#3c2348]\">\r\n                          {renewableBooks.map((borrowing) => (\r\n                            <tr key={borrowing._id} className=\"hover:bg-white/5 group transition-colors\">\r\n                              <td className=\"p-4 text-white font-medium flex items-center gap-3\">\r\n                                <div className=\"w-8 h-10 bg-gray-700 rounded overflow-hidden shrink-0\">\r\n                                  {borrowing.book?.coverImage ? (\r\n                                    <img\r\n                                      src={borrowing.book.coverImage}\r\n                                      alt={borrowing.book.title}\r\n                                      className=\"w-full h-full object-cover\"\r\n                                      onError={(e) => {\r\n                                        e.target.style.display = 'none';\r\n                                      }}\r\n                                    />\r\n                                  ) : (\r\n                                    <div className=\"w-full h-full flex items-center justify-center\">\r\n                                      <span className=\"material-symbols-outlined text-gray-500 text-sm\">book</span>\r\n                                    </div>\r\n                                  )}\r\n                                </div>\r\n                                {borrowing.book?.title || 'Unknown Book'}\r\n                              </td>\r\n                              <td className=\"p-4 text-text-muted\">{borrowing.book?.author || 'Unknown Author'}</td>\r\n                              <td className=\"p-4 text-emerald-400 font-mono\">\r\n                                {borrowing.dueDate\r\n                                  ? new Date(borrowing.dueDate).toLocaleDateString('en-US', {\r\n                                      month: 'short',\r\n                                      day: 'numeric',\r\n                                      year: 'numeric',\r\n                                    })\r\n                                  : 'N/A'}\r\n                              </td>\r\n                              <td className=\"p-4 text-text-muted\">\r\n                                {borrowing.renewalCount || 0}/2\r\n                              </td>\r\n                              <td className=\"p-4 text-right\">\r\n                                <button\r\n                                  onClick={() => handleRenew(borrowing._id)}\r\n                                  disabled={processing}\r\n                                  className=\"px-4 py-2 rounded-lg bg-primary/20 hover:bg-primary/30 text-primary border border-primary/30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                                >\r\n                                  <span className=\"material-symbols-outlined text-[16px]\">autorenew</span>\r\n                                  Renew\r\n                                </button>\r\n                              </td>\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right Column - Quick Return */}\r\n        <div className=\"lg:col-span-4 flex flex-col bg-[#160c1b] border-l border-[#3c2348]\">\r\n          <div className=\"p-6 border-b border-[#3c2348] bg-[#1e1024]\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <h3 className=\"text-lg font-bold text-white flex items-center gap-2\">\r\n                <span className=\"p-1.5 bg-blue-500/10 rounded-md text-blue-400 border border-blue-500/20\">\r\n                  <span className=\"material-symbols-outlined text-[20px]\">move_to_inbox</span>\r\n                </span>\r\n                Quick Return\r\n              </h3>\r\n              <span className=\"text-[10px] font-mono text-text-muted bg-[#2b1934] px-1.5 py-0.5 rounded border border-[#3c2348]\">[F2]</span>\r\n            </div>\r\n          </div>\r\n          <div className=\"p-6 border-b border-[#3c2348] bg-gradient-to-b from-[#1e1024] to-[#160c1b]\">\r\n            <div className=\"flex flex-col gap-3\">\r\n              <label className=\"text-xs text-text-muted font-bold uppercase tracking-widest\">Scan Item to Return</label>\r\n              <div className=\"relative\">\r\n                <input\r\n                  className=\"w-full bg-[#2b1934] border border-[#3c2348] text-white text-lg font-mono h-14 pl-4 pr-12 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 placeholder:text-text-muted/40 transition-all\"\r\n                  placeholder=\"ISBN...\"\r\n                  type=\"text\"\r\n                  value={returnQuery}\r\n                  onChange={(e) => setReturnQuery(e.target.value)}\r\n                  onKeyPress={(e) => {\r\n                    if (e.key === 'Enter' && returnQuery) {\r\n                      handleReturn(returnQuery);\r\n                    }\r\n                  }}\r\n                />\r\n                <button\r\n                  onClick={() => handleReturn(returnQuery)}\r\n                  disabled={processing}\r\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors disabled:opacity-50\"\r\n                >\r\n                  <span className=\"material-symbols-outlined text-[20px]\">arrow_forward</span>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex-1 overflow-y-auto p-4\">\r\n            <h4 className=\"text-xs font-bold text-text-muted uppercase tracking-widest mb-3 px-2\">Recently Returned</h4>\r\n            <div className=\"flex flex-col gap-3\">\r\n              {recentReturns.length === 0 ? (\r\n                <div className=\"text-center py-8 text-text-muted text-sm\">No recent returns</div>\r\n              ) : (\r\n                recentReturns.map((returnItem) => (\r\n                  <div\r\n                    key={returnItem._id}\r\n                    className=\"p-3 rounded-xl bg-[#2b1934] border-l-4 border-l-blue-500 border-y border-r border-[#3c2348] hover:border-blue-500/30 transition-all\"\r\n                  >\r\n                    <div className=\"flex gap-3\">\r\n                      <div className=\"w-10 h-14 bg-gray-700 rounded shadow-sm bg-cover shrink-0 overflow-hidden\">\r\n                        {returnItem.book?.coverImage ? (\r\n                          <img\r\n                            src={returnItem.book.coverImage}\r\n                            alt={returnItem.book.title}\r\n                            className=\"w-full h-full object-cover\"\r\n                            onError={(e) => {\r\n                              e.target.style.display = 'none';\r\n                            }}\r\n                          />\r\n                        ) : (\r\n                          <div className=\"w-full h-full flex items-center justify-center\">\r\n                            <span className=\"material-symbols-outlined text-gray-500 text-xs\">book</span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <p className=\"text-white text-sm font-bold truncate\">{returnItem.book?.title || 'Unknown Book'}</p>\r\n                        <p className=\"text-xs text-text-muted mb-2\">{returnItem.book?.author || 'Unknown Author'}</p>\r\n                        <span className=\"px-2 py-0.5 rounded text-[10px] font-bold bg-blue-500/20 text-blue-300 border border-blue-500/30 uppercase\">Shelving Cart A</span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"mt-2 pt-2 border-t border-white/5 flex justify-between items-center\">\r\n                      <span className=\"text-[10px] text-text-muted font-mono\">\r\n                        {returnItem.returnedDate\r\n                          ? new Date(returnItem.returnedDate).toLocaleTimeString('en-US', {\r\n                              hour: '2-digit',\r\n                              minute: '2-digit',\r\n                            })\r\n                          : 'N/A'}\r\n                      </span>\r\n                      <span className=\"text-[10px] text-emerald-400 flex items-center gap-1\">\r\n                        <span className=\"material-symbols-outlined text-[12px]\">check_circle</span>\r\n                        Processed\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\librarian\\help\\page.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":220,"column":69,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[9835,9857],"text":"No results found for &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[9835,9857],"text":"No results found for &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[9835,9857],"text":"No results found for &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[9835,9857],"text":"No results found for &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":220,"column":83,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[9870,9871],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[9870,9871],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[9870,9871],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[9870,9871],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport LibrarianHeader from '@/components/LibrarianHeader';\r\nimport { showSuccess, showError } from '@/lib/swal';\r\nimport Link from 'next/link';\r\n\r\nexport default function LibrarianHelpPage() {\r\n  const [activeSection, setActiveSection] = useState('getting-started');\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [supportForm, setSupportForm] = useState({\r\n    subject: '',\r\n    category: 'technical',\r\n    priority: 'medium',\r\n    message: '',\r\n  });\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  const faqCategories = [\r\n    {\r\n      id: 'getting-started',\r\n      title: 'Getting Started',\r\n      icon: 'rocket_launch',\r\n      items: [\r\n        {\r\n          q: 'How do I access the librarian dashboard?',\r\n          a: 'Once you log in with your librarian credentials, you will be automatically directed to the librarian overview dashboard. From there, you can access all library management features.',\r\n        },\r\n        {\r\n          q: 'What are the main features available?',\r\n          a: 'The librarian dashboard includes: Overview/Statistics, Circulation Desk (checkout/returns), Inventory Management, Member Management, and Settings. Each section is accessible from the sidebar navigation.',\r\n        },\r\n        {\r\n          q: 'How do I navigate between different sections?',\r\n          a: 'Use the sidebar navigation menu on the left side of the screen. Click on any menu item to navigate to that section. The active page will be highlighted.',\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      id: 'circulation',\r\n      title: 'Circulation & Checkout',\r\n      icon: 'shopping_bag',\r\n      items: [\r\n        {\r\n          q: 'How do I check out a book to a member?',\r\n          a: 'Go to the Circulation Desk page. First, search for the member by email or member ID. Then scan or search for the book ISBN. The book will be added to the cart. Click \"Complete Checkout\" to finalize the transaction.',\r\n        },\r\n        {\r\n          q: 'How do I process a book return?',\r\n          a: 'On the Circulation Desk page, use the Quick Return section on the right. Enter the book ISBN and click the return button. The system will automatically update the book status and member records.',\r\n        },\r\n        {\r\n          q: 'Can I renew a book for a member?',\r\n          a: 'Yes, go to the Circulation Desk and select the \"Renew Book\" tab. Search for the member, then select the book you want to renew. Books can be renewed up to 2 times, and overdue books cannot be renewed.',\r\n        },\r\n        {\r\n          q: 'What are the borrowing limits?',\r\n          a: 'Free members can borrow 1 book for 7 days. Premium members can borrow up to 4 books for 20 days each. The system will automatically enforce these limits.',\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      id: 'inventory',\r\n      title: 'Inventory Management',\r\n      icon: 'library_books',\r\n      items: [\r\n        {\r\n          q: 'How do I add a new book to the inventory?',\r\n          a: 'Go to Inventory Management and click \"Add New Book\". Fill in the book details including title, author, ISBN, category, and cover image. You can specify the number of copies to create.',\r\n        },\r\n        {\r\n          q: 'How do I check inventory status?',\r\n          a: 'The Inventory Management page shows real-time statistics including In Stock, Low Stock, and Out of Stock counts. You can filter books by category and availability status.',\r\n        },\r\n        {\r\n          q: 'What does \"Low Stock\" mean?',\r\n          a: 'A book is considered low stock when there are 2 or fewer available copies. This helps you identify books that may need reordering.',\r\n        },\r\n        {\r\n          q: 'How do I edit book information?',\r\n          a: 'In the Inventory Management table, click the edit icon next to any book. This opens a modal where you can update book details, cover image, and other information.',\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      id: 'members',\r\n      title: 'Member Management',\r\n      icon: 'people',\r\n      items: [\r\n        {\r\n          q: 'How do I add a new member?',\r\n          a: 'Go to Members page and click \"Add New Member\". Fill in the member details including name, email, phone, address, and membership tier. The system will create the member account.',\r\n        },\r\n        {\r\n          q: 'How do I view a member\\'s borrowing history?',\r\n          a: 'On the Members page, click the \"View History\" button next to any member. This shows their complete borrowing history, current loans, and account details.',\r\n        },\r\n        {\r\n          q: 'Can I edit member information?',\r\n          a: 'Yes, click the \"Edit Info\" button next to any member on the Members page. You can update their personal information, address, and subscription details.',\r\n        },\r\n        {\r\n          q: 'How do I check member fines?',\r\n          a: 'When viewing a member\\'s details, you can see their current fines. Fines are automatically calculated for overdue books at $0.50 per day.',\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      id: 'fines',\r\n      title: 'Fines & Payments',\r\n      icon: 'payments',\r\n      items: [\r\n        {\r\n          q: 'How are fines calculated?',\r\n          a: 'Fines are automatically calculated at $0.50 per day for each overdue book. Fines start accruing the day after the due date.',\r\n        },\r\n        {\r\n          q: 'Can I waive a fine?',\r\n          a: 'Yes, fines can be waived by authorized staff. Go to the member\\'s profile and access their fines section to waive specific fines.',\r\n        },\r\n        {\r\n          q: 'How do members pay fines?',\r\n          a: 'Members can pay fines through their account dashboard using Stripe payment integration. Librarians can also process payments manually if needed.',\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      id: 'technical',\r\n      title: 'Technical Support',\r\n      icon: 'support_agent',\r\n      items: [\r\n        {\r\n          q: 'The page is not loading correctly',\r\n          a: 'Try refreshing the page (Ctrl+R or Cmd+R). Clear your browser cache if the issue persists. If problems continue, contact technical support.',\r\n        },\r\n        {\r\n          q: 'I cannot upload images',\r\n          a: 'Ensure images are in JPG, PNG, or WEBP format and under 5MB. Check your internet connection. If issues persist, try a different browser.',\r\n        },\r\n        {\r\n          q: 'Search is not working',\r\n          a: 'Check your internet connection. Try refreshing the page. If search still doesn\\'t work, contact support with details about what you\\'re searching for.',\r\n        },\r\n        {\r\n          q: 'I\\'m logged out automatically',\r\n          a: 'This might be due to inactivity or session expiration. Simply log in again. If this happens frequently, check your browser settings or contact support.',\r\n        },\r\n      ],\r\n    },\r\n  ];\r\n\r\n  const handleSupportSubmit = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      setSubmitting(true);\r\n      const response = await fetch('/api/support/tickets', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          ...supportForm,\r\n          userRole: 'librarian',\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        showSuccess('Support Request Submitted', 'Your support request has been sent. We will get back to you soon.');\r\n        setSupportForm({\r\n          subject: '',\r\n          category: 'technical',\r\n          priority: 'medium',\r\n          message: '',\r\n        });\r\n      } else {\r\n        const error = await response.json();\r\n        showError('Submission Failed', error.error || 'Failed to submit support request');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error submitting support request:', error);\r\n      showError('Error', 'Failed to submit support request');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const filteredFAQs = faqCategories.map((category) => ({\r\n    ...category,\r\n    items: category.items.filter(\r\n      (item) =>\r\n        item.q.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        item.a.toLowerCase().includes(searchQuery.toLowerCase())\r\n    ),\r\n  })).filter((category) => category.items.length > 0);\r\n\r\n  return (\r\n    <>\r\n      <LibrarianHeader title=\"Help & Support\" subtitle=\"Find answers and get assistance\" />\r\n      <div className=\"flex-1 overflow-y-auto p-6 md:p-8\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n            {/* Left Column - Documentation & FAQ */}\r\n            <div className=\"lg:col-span-2 space-y-6\">\r\n              {/* Search */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 shadow-lg\">\r\n                <div className=\"relative\">\r\n                  <span className=\"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-white/40\">search</span>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={searchQuery}\r\n                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                    placeholder=\"Search for help articles...\"\r\n                    className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg pl-12 pr-4 py-3 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* FAQ Sections */}\r\n              {filteredFAQs.length === 0 ? (\r\n                <div className=\"bg-card-dark rounded-2xl border border-white/5 p-12 text-center shadow-lg\">\r\n                  <span className=\"material-symbols-outlined text-6xl text-white/20 mb-4 block\">search_off</span>\r\n                  <p className=\"text-white/60\">No results found for \"{searchQuery}\"</p>\r\n                </div>\r\n              ) : (\r\n                filteredFAQs.map((category) => (\r\n                  <div\r\n                    key={category.id}\r\n                    className=\"bg-card-dark rounded-2xl border border-white/5 overflow-hidden shadow-lg\"\r\n                  >\r\n                    <div\r\n                      className=\"p-6 border-b border-white/5 cursor-pointer hover:bg-white/5 transition-colors\"\r\n                      onClick={() => setActiveSection(activeSection === category.id ? null : category.id)}\r\n                    >\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <span className=\"material-symbols-outlined text-primary text-2xl\">{category.icon}</span>\r\n                          <h3 className=\"text-white text-lg font-bold\">{category.title}</h3>\r\n                        </div>\r\n                        <span className=\"material-symbols-outlined text-white/40\">\r\n                          {activeSection === category.id ? 'expand_less' : 'expand_more'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    {activeSection === category.id && (\r\n                      <div className=\"p-6 space-y-4\">\r\n                        {category.items.map((item, idx) => (\r\n                          <div key={idx} className=\"border-b border-white/5 last:border-0 pb-4 last:pb-0\">\r\n                            <h4 className=\"text-white font-semibold mb-2\">{item.q}</h4>\r\n                            <p className=\"text-white/60 text-sm leading-relaxed\">{item.a}</p>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                ))\r\n              )}\r\n\r\n              {/* Quick Links */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 shadow-lg\">\r\n                <h3 className=\"text-white text-lg font-bold mb-4 flex items-center gap-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">link</span>\r\n                  Quick Links\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                  <Link\r\n                    href=\"/librarian/circulation\"\r\n                    className=\"p-4 bg-surface-dark/50 hover:bg-surface-dark border border-white/5 rounded-lg transition-colors flex items-center gap-3\"\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-primary\">qr_code_scanner</span>\r\n                    <div>\r\n                      <p className=\"text-white font-medium\">Circulation Desk</p>\r\n                      <p className=\"text-white/50 text-xs\">Check out and return books</p>\r\n                    </div>\r\n                  </Link>\r\n                  <Link\r\n                    href=\"/librarian/inventory\"\r\n                    className=\"p-4 bg-surface-dark/50 hover:bg-surface-dark border border-white/5 rounded-lg transition-colors flex items-center gap-3\"\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-primary\">library_books</span>\r\n                    <div>\r\n                      <p className=\"text-white font-medium\">Inventory</p>\r\n                      <p className=\"text-white/50 text-xs\">Manage book catalog</p>\r\n                    </div>\r\n                  </Link>\r\n                  <Link\r\n                    href=\"/librarian/members\"\r\n                    className=\"p-4 bg-surface-dark/50 hover:bg-surface-dark border border-white/5 rounded-lg transition-colors flex items-center gap-3\"\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-primary\">people</span>\r\n                    <div>\r\n                      <p className=\"text-white font-medium\">Members</p>\r\n                      <p className=\"text-white/50 text-xs\">Manage member accounts</p>\r\n                    </div>\r\n                  </Link>\r\n                  <Link\r\n                    href=\"/librarian/settings\"\r\n                    className=\"p-4 bg-surface-dark/50 hover:bg-surface-dark border border-white/5 rounded-lg transition-colors flex items-center gap-3\"\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-primary\">settings</span>\r\n                    <div>\r\n                      <p className=\"text-white font-medium\">Settings</p>\r\n                      <p className=\"text-white/50 text-xs\">Account preferences</p>\r\n                    </div>\r\n                  </Link>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Right Column - Contact Support & Info */}\r\n            <div className=\"space-y-6\">\r\n              {/* Contact Support */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 shadow-lg\">\r\n                <h3 className=\"text-white text-lg font-bold mb-4 flex items-center gap-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">support_agent</span>\r\n                  Contact Support\r\n                </h3>\r\n                <form onSubmit={handleSupportSubmit} className=\"space-y-4\">\r\n                  <div>\r\n                    <label className=\"text-white/80 text-sm font-medium mb-2 block\">Subject</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={supportForm.subject}\r\n                      onChange={(e) => setSupportForm((prev) => ({ ...prev, subject: e.target.value }))}\r\n                      required\r\n                      className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-2 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\"\r\n                      placeholder=\"Brief description of your issue\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-white/80 text-sm font-medium mb-2 block\">Category</label>\r\n                    <select\r\n                      value={supportForm.category}\r\n                      onChange={(e) => setSupportForm((prev) => ({ ...prev, category: e.target.value }))}\r\n                      className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-2 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\"\r\n                    >\r\n                      <option value=\"technical\">Technical Issue</option>\r\n                      <option value=\"feature\">Feature Request</option>\r\n                      <option value=\"bug\">Bug Report</option>\r\n                      <option value=\"other\">Other</option>\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-white/80 text-sm font-medium mb-2 block\">Priority</label>\r\n                    <select\r\n                      value={supportForm.priority}\r\n                      onChange={(e) => setSupportForm((prev) => ({ ...prev, priority: e.target.value }))}\r\n                      className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-2 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\"\r\n                    >\r\n                      <option value=\"low\">Low</option>\r\n                      <option value=\"medium\">Medium</option>\r\n                      <option value=\"high\">High</option>\r\n                      <option value=\"urgent\">Urgent</option>\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-white/80 text-sm font-medium mb-2 block\">Message</label>\r\n                    <textarea\r\n                      value={supportForm.message}\r\n                      onChange={(e) => setSupportForm((prev) => ({ ...prev, message: e.target.value }))}\r\n                      required\r\n                      rows={5}\r\n                      className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-2 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all resize-none\"\r\n                      placeholder=\"Describe your issue or question in detail...\"\r\n                    />\r\n                  </div>\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={submitting}\r\n                    className=\"w-full px-4 py-2.5 bg-primary hover:bg-primary-hover text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                  >\r\n                    {submitting ? (\r\n                      <>\r\n                        <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent\"></div>\r\n                        Submitting...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <span className=\"material-symbols-outlined text-[18px]\">send</span>\r\n                        Submit Request\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                </form>\r\n                <div className=\"mt-4 pt-4 border-t border-white/5\">\r\n                  <p className=\"text-white/50 text-xs\">\r\n                    <span className=\"material-symbols-outlined text-[14px] inline align-middle mr-1\">mail</span>\r\n                    Email: support@bookfiix.com\r\n                  </p>\r\n                  <p className=\"text-white/50 text-xs mt-2\">\r\n                    <span className=\"material-symbols-outlined text-[14px] inline align-middle mr-1\">schedule</span>\r\n                    Support Hours: Mon-Fri, 9AM-5PM\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* System Information */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 shadow-lg\">\r\n                <h3 className=\"text-white text-lg font-bold mb-4 flex items-center gap-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">info</span>\r\n                  System Information\r\n                </h3>\r\n                <div className=\"space-y-3 text-sm\">\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-white/60\">Application Version</span>\r\n                    <span className=\"text-white font-medium\">1.0.0</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-white/60\">Status</span>\r\n                    <span className=\"text-emerald-400 font-medium flex items-center gap-1\">\r\n                      <span className=\"size-2 rounded-full bg-emerald-400\"></span>\r\n                      Operational\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-white/60\">Last Updated</span>\r\n                    <span className=\"text-white/80\">{new Date().toLocaleDateString()}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Keyboard Shortcuts */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 shadow-lg\">\r\n                <h3 className=\"text-white text-lg font-bold mb-4 flex items-center gap-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">keyboard</span>\r\n                  Keyboard Shortcuts\r\n                </h3>\r\n                <div className=\"space-y-2 text-sm\">\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <span className=\"text-white/60\">Search</span>\r\n                    <kbd className=\"px-2 py-1 bg-surface-dark border border-white/5 rounded text-white/80 font-mono text-xs\">K</kbd>\r\n                  </div>\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <span className=\"text-white/60\">Member Search (Circulation)</span>\r\n                    <kbd className=\"px-2 py-1 bg-surface-dark border border-white/5 rounded text-white/80 font-mono text-xs\">F1</kbd>\r\n                  </div>\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <span className=\"text-white/60\">Quick Return</span>\r\n                    <kbd className=\"px-2 py-1 bg-surface-dark border border-white/5 rounded text-white/80 font-mono text-xs\">F2</kbd>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Policies */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 shadow-lg\">\r\n                <h3 className=\"text-white text-lg font-bold mb-4\">Policies</h3>\r\n                <div className=\"space-y-2\">\r\n                  <Link href=\"#\" className=\"text-primary hover:text-primary-hover text-sm block\">\r\n                    Privacy Policy\r\n                  </Link>\r\n                  <Link href=\"#\" className=\"text-primary hover:text-primary-hover text-sm block\">\r\n                    Terms of Service\r\n                  </Link>\r\n                  <Link href=\"#\" className=\"text-primary hover:text-primary-hover text-sm block\">\r\n                    Cookie Policy\r\n                  </Link>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\librarian\\inventory\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchBooks'. Either include it or remove the dependency array.","line":43,"column":6,"nodeType":"ArrayExpression","endLine":49,"endColumn":4,"suggestions":[{"desc":"Update the dependencies array to be: [pagination.page, searchQuery, categoryFilter, availabilityFilter, languageSort, fetchBooks]","fix":{"range":[1471,1582],"text":"[pagination.page, searchQuery, categoryFilter, availabilityFilter, languageSort, fetchBooks]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":656,"column":33,"nodeType":"JSXOpeningElement","endLine":663,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport LibrarianHeader from \"@/components/LibrarianHeader\";\r\nimport Loader from \"@/components/Loader\";\r\nimport AddBookModal from \"@/components/AddBookModal\";\r\nimport EditBookModal from \"@/components/EditBookModal\";\r\nimport { showError, showSuccess, showInput, showConfirm } from \"@/lib/swal\";\r\n\r\nexport default function LibrarianInventoryPage() {\r\n  const { userData } = useAuth();\r\n  const [books, setBooks] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [categoryFilter, setCategoryFilter] = useState(\"\");\r\n  const [availabilityFilter, setAvailabilityFilter] = useState(\"\");\r\n  const [languageSort, setLanguageSort] = useState(\"\");\r\n  const [categories, setCategories] = useState([]);\r\n  const [pagination, setPagination] = useState({\r\n    page: 1,\r\n    limit: 10,\r\n    total: 0,\r\n    pages: 0,\r\n  });\r\n  const [stats, setStats] = useState({\r\n    inStock: 0,\r\n    lowStock: 0,\r\n    outOfStock: 0,\r\n  });\r\n  const [addBookModalOpen, setAddBookModalOpen] = useState(false);\r\n  const [editBookModalOpen, setEditBookModalOpen] = useState(false);\r\n  const [editingBookId, setEditingBookId] = useState(null);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    fetchCategories();\r\n    fetchStats();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchBooks();\r\n  }, [\r\n    pagination.page,\r\n    searchQuery,\r\n    categoryFilter,\r\n    availabilityFilter,\r\n    languageSort,\r\n  ]);\r\n\r\n  const fetchCategories = async () => {\r\n    try {\r\n      const response = await fetch(\"/api/categories\");\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setCategories(data.categories || []);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching categories:\", error);\r\n    }\r\n  };\r\n\r\n  const fetchStats = async () => {\r\n    try {\r\n      const response = await fetch(\"/api/librarian/inventory/stats\");\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setStats({\r\n          inStock: data.inStock || 0,\r\n          lowStock: data.lowStock || 0,\r\n          outOfStock: data.outOfStock || 0,\r\n        });\r\n      } else {\r\n        console.error(\"Error fetching stats:\", response.statusText);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching stats:\", error);\r\n    }\r\n  };\r\n\r\n  const fetchBooks = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      // When availability filter is active, fetch more books for client-side filtering\r\n      const fetchLimit = availabilityFilter ? 1000 : pagination.limit;\r\n      const fetchPage = availabilityFilter ? 1 : pagination.page;\r\n\r\n      const params = new URLSearchParams({\r\n        page: fetchPage.toString(),\r\n        limit: fetchLimit.toString(),\r\n      });\r\n      if (searchQuery) params.append(\"search\", searchQuery);\r\n      if (categoryFilter) params.append(\"category\", categoryFilter);\r\n\r\n      const response = await fetch(`/api/books?${params.toString()}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        let allBooks = data.books || [];\r\n\r\n        // Apply availability filter client-side\r\n        let filteredBooks = allBooks;\r\n        if (availabilityFilter) {\r\n          filteredBooks = allBooks.filter((book) => {\r\n            const stockStatus = getStockStatus(book);\r\n            if (availabilityFilter === \"instock\" && stockStatus.status === \"in\")\r\n              return true;\r\n            if (\r\n              availabilityFilter === \"lowstock\" &&\r\n              stockStatus.status === \"low\"\r\n            )\r\n              return true;\r\n            if (\r\n              availabilityFilter === \"outstock\" &&\r\n              stockStatus.status === \"out\"\r\n            )\r\n              return true;\r\n            return false;\r\n          });\r\n\r\n          // Apply client-side pagination when filtering\r\n          const startIndex = (pagination.page - 1) * pagination.limit;\r\n          const endIndex = startIndex + pagination.limit;\r\n          const paginatedBooks = filteredBooks.slice(startIndex, endIndex);\r\n\r\n          // Update pagination with filtered results\r\n          setPagination((prev) => ({\r\n            ...prev,\r\n            total: filteredBooks.length,\r\n            pages: Math.ceil(filteredBooks.length / prev.limit),\r\n          }));\r\n\r\n          filteredBooks = paginatedBooks;\r\n        } else {\r\n          // Use server-side pagination\r\n          setPagination((prev) => ({\r\n            ...prev,\r\n            total: data.pagination?.total || 0,\r\n            pages: data.pagination?.pages || 0,\r\n          }));\r\n        }\r\n\r\n        // Apply language sort if selected\r\n        if (languageSort) {\r\n          filteredBooks.sort((a, b) => {\r\n            const langA = a.bookLanguage || \"en\";\r\n            const langB = b.bookLanguage || \"en\";\r\n\r\n            if (languageSort === \"en-first\") {\r\n              // English first, then Bangla\r\n              if (langA === \"en\" && langB === \"bn\") return -1;\r\n              if (langA === \"bn\" && langB === \"en\") return 1;\r\n              return 0;\r\n            } else if (languageSort === \"bn-first\") {\r\n              // Bangla first, then English\r\n              if (langA === \"bn\" && langB === \"en\") return -1;\r\n              if (langA === \"en\" && langB === \"bn\") return 1;\r\n              return 0;\r\n            }\r\n            return 0;\r\n          });\r\n        }\r\n\r\n        setBooks(filteredBooks);\r\n      } else {\r\n        setError(\"Failed to fetch books. Please try again.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching books:\", error);\r\n      setError(\"An error occurred while fetching books. Please try again.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getStockStatus = (book) => {\r\n    const available = book.availableCopies || 0;\r\n    const total = book.totalCopies || 0;\r\n\r\n    if (total === 0)\r\n      return { status: \"out\", label: \"Out of Stock\", color: \"red\" };\r\n    if (available === 0)\r\n      return { status: \"out\", label: \"Out of Stock\", color: \"red\" };\r\n    if (available <= 2)\r\n      return { status: \"low\", label: \"Low Stock\", color: \"amber\" };\r\n    return { status: \"in\", label: \"In Stock\", color: \"emerald\" };\r\n  };\r\n\r\n  const handleBookAdded = () => {\r\n    fetchBooks();\r\n    fetchStats();\r\n  };\r\n\r\n  const handleBookUpdated = () => {\r\n    fetchBooks();\r\n    fetchStats();\r\n  };\r\n\r\n  const handleEditBook = (bookId) => {\r\n    setEditingBookId(bookId);\r\n    setEditBookModalOpen(true);\r\n  };\r\n\r\n  const handleManageStock = async (bookId, bookTitle) => {\r\n    // Fetch current stock count\r\n    let currentStock = 0;\r\n    try {\r\n      const bookResponse = await fetch(`/api/books/${bookId}`);\r\n      if (bookResponse.ok) {\r\n        const bookData = await bookResponse.json();\r\n        currentStock = bookData.totalCopies || 0;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching book stock:\", error);\r\n    }\r\n\r\n    // Show input for stock count with current value\r\n    const result = await showInput(\r\n      \"Manage Stock\",\r\n      `Enter the number of copies for \"${bookTitle}\"`,\r\n      { input: \"number\" },\r\n      {\r\n        inputPlaceholder: \"Enter number of copies...\",\r\n        inputValue: currentStock.toString(),\r\n        inputValidator: (value) => {\r\n          const num = parseInt(value);\r\n          if (value === \"\" || isNaN(num) || num < 0) {\r\n            return \"Please enter a valid number (minimum 0)\";\r\n          }\r\n          if (num > 1000) {\r\n            return \"Maximum 1000 copies allowed\";\r\n          }\r\n          return null;\r\n        },\r\n        confirmButtonText: \"Update Stock\",\r\n        cancelButtonText: \"Cancel\",\r\n      },\r\n    );\r\n\r\n    if (result.isConfirmed && result.value) {\r\n      try {\r\n        const stockCount = parseInt(result.value);\r\n\r\n        const response = await fetch(`/api/books/${bookId}/stock`, {\r\n          method: \"PATCH\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n          body: JSON.stringify({\r\n            copies: stockCount,\r\n          }),\r\n        });\r\n\r\n        let data;\r\n        try {\r\n          data = await response.json();\r\n        } catch (jsonError) {\r\n          console.error(\"Error parsing JSON response:\", jsonError);\r\n          showError(\r\n            \"Error\",\r\n            `Server error (${response.status}). Please check the server logs.`,\r\n          );\r\n          return;\r\n        }\r\n\r\n        if (response.ok) {\r\n          showSuccess(\r\n            \"Stock Updated!\",\r\n            `Stock count for \"${bookTitle}\" has been updated to ${stockCount} copies.`,\r\n          );\r\n          fetchBooks(); // Refresh the books list\r\n          fetchStats(); // Refresh stats\r\n        } else {\r\n          const errorMessage =\r\n            data?.error ||\r\n            data?.message ||\r\n            `Failed to update stock (${response.status})`;\r\n          showError(\"Error\", errorMessage);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error updating stock:\", error);\r\n        showError(\r\n          \"Error\",\r\n          error.message || \"Failed to update stock. Please try again.\",\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDeleteBook = async (bookId, bookTitle) => {\r\n    const result = await showConfirm(\r\n      \"Delete Book\",\r\n      `Are you sure you want to delete \"${bookTitle}\"? This action will deactivate the book and all its copies.`,\r\n      {\r\n        confirmButtonText: \"Delete\",\r\n        cancelButtonText: \"Cancel\",\r\n      },\r\n    );\r\n\r\n    if (result.isConfirmed) {\r\n      try {\r\n        const response = await fetch(`/api/books/${bookId}`, {\r\n          method: \"DELETE\",\r\n        });\r\n\r\n        let data;\r\n        try {\r\n          data = await response.json();\r\n        } catch (jsonError) {\r\n          console.error(\"Error parsing JSON response:\", jsonError);\r\n          showError(\r\n            \"Error\",\r\n            `Server error (${response.status}). Please check the server logs.`,\r\n          );\r\n          return;\r\n        }\r\n\r\n        if (response.ok) {\r\n          showSuccess(\r\n            \"Book Deleted!\",\r\n            `\"${bookTitle}\" has been successfully deleted.`,\r\n          );\r\n          fetchBooks(); // Refresh the books list\r\n          fetchStats(); // Refresh stats\r\n        } else {\r\n          const errorMessage =\r\n            data?.error ||\r\n            data?.message ||\r\n            `Failed to delete book (${response.status})`;\r\n          showError(\"Error\", errorMessage);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error deleting book:\", error);\r\n        showError(\r\n          \"Error\",\r\n          error.message || \"Failed to delete book. Please try again.\",\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  const getLocationDisplay = (book) => {\r\n    // Use actual shelfLocation or location from book, fallback to generated location\r\n    if (book.shelfLocation && book.shelfLocation.trim()) {\r\n      return book.shelfLocation.trim();\r\n    }\r\n    if (book.location && book.location.trim()) {\r\n      return book.location.trim();\r\n    }\r\n    // Fallback: generate a location based on category if no shelf location exists\r\n    if (book.category?.slug) {\r\n      const categorySlug = book.category.slug.toUpperCase();\r\n      const bookId = book._id.toString().slice(-2);\r\n      return `${categorySlug}-${bookId}`;\r\n    }\r\n    return \"N/A\";\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <LibrarianHeader\r\n        title=\"Inventory Management\"\r\n        subtitle=\"Catalog new entries, manage stock levels, and audit shelf locations.\"\r\n      />\r\n      <div className=\"flex-1 flex flex-col h-full overflow-hidden relative bg-background-dark\">\r\n        <header className=\"flex-none px-8 py-6 border-b border-white/5 bg-background-dark/95 backdrop-blur-sm sticky top-0 z-20\">\r\n          <div className=\"flex flex-col gap-6 max-w-[1600px] mx-auto w-full\">\r\n            <div className=\"flex flex-wrap items-center justify-between gap-4\">\r\n              <div>\r\n                <h2 className=\"text-3xl font-bold text-white tracking-tight\">\r\n                  Inventory Management\r\n                </h2>\r\n                <p className=\"text-gray-400 text-sm mt-1\">\r\n                  Catalog new entries, manage stock levels, and audit shelf\r\n                  locations.\r\n                </p>\r\n              </div>\r\n              <div className=\"flex gap-3\">\r\n                <button className=\"flex items-center gap-2 bg-surface-dark border border-white/10 hover:bg-surface-dark/80 text-white text-sm font-medium px-5 py-2.5 rounded-lg transition-all\">\r\n                  <span className=\"material-symbols-outlined text-[20px]\">\r\n                    qr_code_scanner\r\n                  </span>\r\n                  Scan Barcode\r\n                </button>\r\n                <button\r\n                  onClick={() => setAddBookModalOpen(true)}\r\n                  className=\"flex items-center gap-2 bg-primary hover:bg-primary-hover text-white text-sm font-medium px-5 py-2.5 rounded-lg shadow-lg shadow-primary/20 transition-all hover:scale-[1.02] active:scale-[0.98]\"\r\n                >\r\n                  <span className=\"material-symbols-outlined text-[20px]\">\r\n                    add\r\n                  </span>\r\n                  Add New Book\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n              <div className=\"bg-[#1c1022] border border-white/5 p-4 rounded-xl flex items-center gap-4\">\r\n                <div className=\"size-12 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400\">\r\n                  <span className=\"material-symbols-outlined text-[24px]\">\r\n                    check_circle\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-gray-400 text-xs uppercase font-semibold\">\r\n                    In Stock\r\n                  </p>\r\n                  <p className=\"text-white text-xl font-bold\">\r\n                    {stats.inStock.toLocaleString()}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <div className=\"bg-[#1c1022] border border-white/5 p-4 rounded-xl flex items-center gap-4\">\r\n                <div className=\"size-12 rounded-lg bg-amber-500/10 flex items-center justify-center text-amber-400\">\r\n                  <span className=\"material-symbols-outlined text-[24px]\">\r\n                    warning\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-gray-400 text-xs uppercase font-semibold\">\r\n                    Low Stock\r\n                  </p>\r\n                  <p className=\"text-white text-xl font-bold\">\r\n                    {stats.lowStock}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <div className=\"bg-[#1c1022] border border-white/5 p-4 rounded-xl flex items-center gap-4\">\r\n                <div className=\"size-12 rounded-lg bg-red-500/10 flex items-center justify-center text-red-400\">\r\n                  <span className=\"material-symbols-outlined text-[24px]\">\r\n                    remove_shopping_cart\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-gray-400 text-xs uppercase font-semibold\">\r\n                    Out of Stock\r\n                  </p>\r\n                  <p className=\"text-white text-xl font-bold\">\r\n                    {stats.outOfStock}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <div className=\"bg-surface-darker border border-white/5 p-4 rounded-xl flex items-center gap-4 cursor-pointer hover:bg-white/5 transition-colors group\">\r\n                <div className=\"size-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary group-hover:scale-110 transition-transform\">\r\n                  <span className=\"material-symbols-outlined text-[24px]\">\r\n                    barcode_reader\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-gray-400 text-xs uppercase font-semibold\">\r\n                    Quick Scan\r\n                  </p>\r\n                  <p className=\"text-primary text-sm font-bold\">\r\n                    Ready to scan...\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex flex-wrap items-center gap-4 pt-2\">\r\n              <div className=\"relative flex-1 min-w-[280px] max-w-lg\">\r\n                <span className=\"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\">\r\n                  search\r\n                </span>\r\n                <input\r\n                  className=\"w-full bg-surface-dark border border-white/5 text-white placeholder-gray-400 text-sm rounded-xl py-3 pl-12 pr-4 focus:ring-2 focus:ring-primary/50 focus:bg-[#34243b] transition-all outline-none\"\r\n                  placeholder=\"Search by title, ISBN, author or scan barcode...\"\r\n                  type=\"text\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => {\r\n                    setSearchQuery(e.target.value);\r\n                    setPagination((prev) => ({ ...prev, page: 1 }));\r\n                  }}\r\n                />\r\n              </div>\r\n              <div className=\"relative min-w-[160px]\">\r\n                <select\r\n                  className=\"w-full appearance-none bg-surface-dark border border-white/5 text-white text-sm rounded-xl py-3 pl-4 pr-10 focus:ring-2 focus:ring-primary/50 cursor-pointer transition-all outline-none\"\r\n                  value={languageSort}\r\n                  onChange={(e) => {\r\n                    setLanguageSort(e.target.value);\r\n                    setPagination((prev) => ({ ...prev, page: 1 }));\r\n                  }}\r\n                >\r\n                  <option value=\"\">Sort by Language</option>\r\n                  <option value=\"en-first\">English First</option>\r\n                  <option value=\"bn-first\">Bangla First</option>\r\n                </select>\r\n                <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none\">\r\n                  expand_more\r\n                </span>\r\n              </div>\r\n              <div className=\"flex gap-3 overflow-x-auto pb-1 md:pb-0\">\r\n                <div className=\"relative min-w-[160px]\">\r\n                  <select\r\n                    className=\"w-full appearance-none bg-surface-dark border border-white/5 text-white text-sm rounded-xl py-3 pl-4 pr-10 focus:ring-2 focus:ring-primary/50 cursor-pointer transition-all outline-none\"\r\n                    value={categoryFilter}\r\n                    onChange={(e) => {\r\n                      setCategoryFilter(e.target.value);\r\n                      setPagination((prev) => ({ ...prev, page: 1 }));\r\n                    }}\r\n                  >\r\n                    <option value=\"\">All Genres</option>\r\n                    {categories.map((cat) => (\r\n                      <option key={cat._id} value={cat._id}>\r\n                        {cat.name}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none\">\r\n                    expand_more\r\n                  </span>\r\n                </div>\r\n                <div className=\"relative min-w-[160px]\">\r\n                  <select\r\n                    className=\"w-full appearance-none bg-surface-dark border border-white/5 text-white text-sm rounded-xl py-3 pl-4 pr-10 focus:ring-2 focus:ring-primary/50 cursor-pointer transition-all outline-none\"\r\n                    value={availabilityFilter}\r\n                    onChange={(e) => {\r\n                      setAvailabilityFilter(e.target.value);\r\n                      setPagination((prev) => ({ ...prev, page: 1 }));\r\n                    }}\r\n                  >\r\n                    <option value=\"\">Availability: All</option>\r\n                    <option value=\"instock\">In Stock</option>\r\n                    <option value=\"lowstock\">Low Stock</option>\r\n                    <option value=\"outstock\">Out of Stock</option>\r\n                  </select>\r\n                  <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none\">\r\n                    expand_more\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div className=\"ml-auto flex gap-2\">\r\n                <button\r\n                  className=\"flex items-center justify-center size-11 rounded-xl bg-primary/20 text-primary border border-primary/30 transition-colors\"\r\n                  title=\"List View\"\r\n                >\r\n                  <span className=\"material-symbols-outlined text-[20px]\">\r\n                    view_list\r\n                  </span>\r\n                </button>\r\n              </div>\r\n              <div className=\"flex items-center gap-2 bg-surface-dark border border-white/5 rounded-xl px-3 py-2\">\r\n                <span className=\"text-xs text-gray-400 uppercase font-semibold\">\r\n                  Rows:\r\n                </span>\r\n                <select\r\n                  className=\"bg-transparent text-white text-sm outline-none cursor-pointer\"\r\n                  value={pagination.limit}\r\n                  onChange={(e) => {\r\n                    setPagination((prev) => ({\r\n                      ...prev,\r\n                      limit: parseInt(e.target.value),\r\n                      page: 1,\r\n                    }));\r\n                  }}\r\n                >\r\n                  <option value=\"10\" className=\"bg-surface-dark\">\r\n                    10\r\n                  </option>\r\n                  <option value=\"20\" className=\"bg-surface-dark\">\r\n                    20\r\n                  </option>\r\n                  <option value=\"50\" className=\"bg-surface-dark\">\r\n                    50\r\n                  </option>\r\n                  <option value=\"100\" className=\"bg-surface-dark\">\r\n                    100\r\n                  </option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </header>\r\n        <section className=\"flex-1 overflow-y-auto px-8 py-6\">\r\n          <div className=\"max-w-[1600px] mx-auto w-full\">\r\n            <div className=\"w-full overflow-hidden rounded-xl border border-white/10 bg-[#1c1022] shadow-2xl\">\r\n              <table className=\"w-full text-left border-collapse\">\r\n                <thead className=\"bg-[#24152b]\">\r\n                  <tr>\r\n                    <th className=\"px-6 py-4 text-xs font-semibold uppercase tracking-wider text-gray-400 w-16\">\r\n                      <input\r\n                        className=\"rounded bg-white/10 border-white/20 text-primary focus:ring-offset-0 focus:ring-primary/50\"\r\n                        type=\"checkbox\"\r\n                      />\r\n                    </th>\r\n                    <th className=\"px-6 py-4 text-xs font-semibold uppercase tracking-wider text-gray-400 w-24\">\r\n                      Cover\r\n                    </th>\r\n                    <th className=\"px-6 py-4 text-xs font-semibold uppercase tracking-wider text-gray-400 w-[25%]\">\r\n                      Book Details\r\n                    </th>\r\n                    <th className=\"px-6 py-4 text-xs font-semibold uppercase tracking-wider text-gray-400\">\r\n                      ISBN / Barcode\r\n                    </th>\r\n                    <th className=\"px-6 py-4 text-xs font-semibold uppercase tracking-wider text-gray-400 text-center\">\r\n                      Copies\r\n                    </th>\r\n                    <th className=\"px-6 py-4 text-xs font-semibold uppercase tracking-wider text-gray-400\">\r\n                      Status\r\n                    </th>\r\n                    <th className=\"px-6 py-4 text-xs font-semibold uppercase tracking-wider text-gray-400\">\r\n                      Location\r\n                    </th>\r\n                    <th className=\"px-6 py-4 text-xs font-semibold uppercase tracking-wider text-gray-400 text-right\">\r\n                      Actions\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-white/5\">\r\n                  {loading ? (\r\n                    <tr>\r\n                      <td\r\n                        colSpan=\"8\"\r\n                        className=\"px-6 py-12 text-center text-gray-400\"\r\n                      >\r\n                        <div className=\"flex justify-center\">\r\n                          <Loader />\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ) : error ? (\r\n                    <tr>\r\n                      <td\r\n                        colSpan=\"8\"\r\n                        className=\"px-6 py-12 text-center text-red-400\"\r\n                      >\r\n                        {error}\r\n                      </td>\r\n                    </tr>\r\n                  ) : books.length === 0 ? (\r\n                    <tr>\r\n                      <td\r\n                        colSpan=\"8\"\r\n                        className=\"px-6 py-12 text-center text-gray-400\"\r\n                      >\r\n                        No books found\r\n                      </td>\r\n                    </tr>\r\n                  ) : (\r\n                    books.map((book) => {\r\n                      const stockStatus = getStockStatus(book);\r\n                      return (\r\n                        <tr\r\n                          key={book._id}\r\n                          className=\"hover:bg-white/5 transition-colors group\"\r\n                        >\r\n                          <td className=\"px-6 py-4\">\r\n                            <input\r\n                              className=\"rounded bg-white/10 border-white/20 text-primary focus:ring-offset-0 focus:ring-primary/50\"\r\n                              type=\"checkbox\"\r\n                            />\r\n                          </td>\r\n                          <td className=\"px-6 py-4\">\r\n                            <div className=\"relative h-16 w-11 rounded overflow-hidden bg-gray-700 shadow-md group-hover:scale-110 transition-transform duration-300\">\r\n                              {book.coverImage ? (\r\n                                <img\r\n                                  src={book.coverImage}\r\n                                  alt={book.title}\r\n                                  className=\"w-full h-full object-cover\"\r\n                                  onError={(e) => {\r\n                                    e.target.style.display = \"none\";\r\n                                  }}\r\n                                />\r\n                              ) : (\r\n                                <div className=\"w-full h-full flex items-center justify-center bg-gray-700\">\r\n                                  <span className=\"material-symbols-outlined text-gray-500 text-xl\">\r\n                                    book\r\n                                  </span>\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          </td>\r\n                          <td className=\"px-6 py-4\">\r\n                            <div className=\"flex flex-col\">\r\n                              <span className=\"text-white font-semibold text-base\">\r\n                                {book.title}\r\n                              </span>\r\n                              <span className=\"text-gray-400 text-sm\">\r\n                                {book.author}\r\n                              </span>\r\n                              <div className=\"flex gap-2 mt-1\">\r\n                                {book.category && (\r\n                                  <span className=\"text-primary text-[10px] uppercase font-bold px-1.5 py-0.5 bg-primary/10 rounded border border-primary/20\">\r\n                                    {book.category.name}\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </td>\r\n                          <td className=\"px-6 py-4\">\r\n                            <div className=\"flex flex-col gap-1\">\r\n                              <span className=\"text-gray-300 text-sm font-mono tracking-wide\">\r\n                                {book.isbn || \"N/A\"}\r\n                              </span>\r\n                              <div className=\"flex items-center gap-1 text-xs text-gray-500\">\r\n                                <span className=\"material-symbols-outlined text-[14px]\">\r\n                                  barcode\r\n                                </span>\r\n                                <span>Scan ready</span>\r\n                              </div>\r\n                            </div>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 text-center\">\r\n                            <div className=\"flex flex-col items-center\">\r\n                              <span className=\"text-white font-bold text-lg\">\r\n                                {book.totalCopies || 0}\r\n                              </span>\r\n                              <span className=\"text-gray-500 text-xs\">\r\n                                Total Copies\r\n                              </span>\r\n                            </div>\r\n                          </td>\r\n                          <td className=\"px-6 py-4\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <div\r\n                                className={`flex items-center justify-center size-2 rounded-full ${\r\n                                  stockStatus.color === \"emerald\"\r\n                                    ? \"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]\"\r\n                                    : stockStatus.color === \"amber\"\r\n                                      ? \"bg-amber-500\"\r\n                                      : \"bg-red-500\"\r\n                                }`}\r\n                              ></div>\r\n                              <div className=\"flex flex-col\">\r\n                                <span\r\n                                  className={`text-sm font-medium ${\r\n                                    stockStatus.color === \"emerald\"\r\n                                      ? \"text-emerald-400\"\r\n                                      : stockStatus.color === \"amber\"\r\n                                        ? \"text-amber-400\"\r\n                                        : \"text-red-400\"\r\n                                  }`}\r\n                                >\r\n                                  {stockStatus.label}\r\n                                </span>\r\n                                <span className=\"text-xs text-gray-500\">\r\n                                  {stockStatus.status === \"in\" &&\r\n                                    `${book.availableCopies || 0} on shelf`}\r\n                                  {stockStatus.status === \"low\" &&\r\n                                    `${book.availableCopies || 0} Available`}\r\n                                  {stockStatus.status === \"out\" &&\r\n                                    \"Expected: 2 days\"}\r\n                                </span>\r\n                              </div>\r\n                            </div>\r\n                          </td>\r\n                          <td className=\"px-6 py-4\">\r\n                            <div className=\"flex items-center gap-2 text-gray-300 bg-surface-dark px-3 py-1.5 rounded-lg border border-white/5 w-fit\">\r\n                              <span className=\"material-symbols-outlined text-[18px] text-primary\">\r\n                                shelves\r\n                              </span>\r\n                              <span className=\"text-sm font-medium\">\r\n                                {getLocationDisplay(book)}\r\n                              </span>\r\n                            </div>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 text-right\">\r\n                            <div className=\"flex items-center justify-end gap-1 opacity-80 group-hover:opacity-100 transition-opacity\">\r\n                              <button\r\n                                onClick={(e) => {\r\n                                  e.stopPropagation();\r\n                                  handleManageStock(book._id, book.title);\r\n                                }}\r\n                                className=\"p-2 rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors cursor-pointer\"\r\n                                title=\"Manage Copies\"\r\n                              >\r\n                                <span className=\"material-symbols-outlined text-[20px]\">\r\n                                  library_books\r\n                                </span>\r\n                              </button>\r\n                              <button\r\n                                onClick={(e) => {\r\n                                  e.stopPropagation();\r\n                                  handleEditBook(book._id);\r\n                                }}\r\n                                className=\"p-2 rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors cursor-pointer\"\r\n                                title=\"Edit Details\"\r\n                              >\r\n                                <span className=\"material-symbols-outlined text-[20px]\">\r\n                                  edit_square\r\n                                </span>\r\n                              </button>\r\n                              <button\r\n                                onClick={(e) => {\r\n                                  e.stopPropagation();\r\n                                  handleDeleteBook(book._id, book.title);\r\n                                }}\r\n                                className=\"p-2 rounded-lg hover:bg-red-500/10 text-gray-400 hover:text-red-400 transition-colors cursor-pointer\"\r\n                                title=\"Delete Book\"\r\n                              >\r\n                                <span className=\"material-symbols-outlined text-[20px]\">\r\n                                  delete\r\n                                </span>\r\n                              </button>\r\n                            </div>\r\n                          </td>\r\n                        </tr>\r\n                      );\r\n                    })\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n            {pagination.total > 0 && (\r\n              <div className=\"flex flex-wrap items-center justify-between py-6 px-2 gap-4\">\r\n                <div className=\"text-sm text-gray-400\">\r\n                  Showing{\" \"}\r\n                  <span className=\"font-medium text-white\">\r\n                    {(pagination.page - 1) * pagination.limit + 1}\r\n                  </span>{\" \"}\r\n                  to{\" \"}\r\n                  <span className=\"font-medium text-white\">\r\n                    {Math.min(\r\n                      pagination.page * pagination.limit,\r\n                      pagination.total,\r\n                    )}\r\n                  </span>{\" \"}\r\n                  of{\" \"}\r\n                  <span className=\"font-medium text-white\">\r\n                    {pagination.total}\r\n                  </span>{\" \"}\r\n                  books\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button\r\n                    onClick={() =>\r\n                      setPagination((prev) => ({\r\n                        ...prev,\r\n                        page: prev.page - 1,\r\n                      }))\r\n                    }\r\n                    disabled={pagination.page === 1}\r\n                    className=\"flex items-center justify-center size-9 rounded-lg border border-white/10 text-gray-400 hover:bg-white/5 hover:text-white disabled:opacity-50 transition-colors\"\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-[18px]\">\r\n                      chevron_left\r\n                    </span>\r\n                  </button>\r\n                  {Array.from(\r\n                    { length: Math.min(5, pagination.pages) },\r\n                    (_, i) => {\r\n                      let pageNum;\r\n                      if (pagination.pages <= 5) {\r\n                        pageNum = i + 1;\r\n                      } else if (pagination.page <= 3) {\r\n                        pageNum = i + 1;\r\n                      } else if (pagination.page >= pagination.pages - 2) {\r\n                        pageNum = pagination.pages - 4 + i;\r\n                      } else {\r\n                        pageNum = pagination.page - 2 + i;\r\n                      }\r\n                      return (\r\n                        <button\r\n                          key={pageNum}\r\n                          onClick={() =>\r\n                            setPagination((prev) => ({\r\n                              ...prev,\r\n                              page: pageNum,\r\n                            }))\r\n                          }\r\n                          className={`flex items-center justify-center size-9 rounded-lg text-sm font-medium transition-colors ${\r\n                            pagination.page === pageNum\r\n                              ? \"bg-primary text-white shadow-lg shadow-primary/20\"\r\n                              : \"border border-white/10 text-gray-400 hover:bg-white/5 hover:text-white\"\r\n                          }`}\r\n                        >\r\n                          {pageNum}\r\n                        </button>\r\n                      );\r\n                    },\r\n                  )}\r\n                  <button\r\n                    onClick={() =>\r\n                      setPagination((prev) => ({\r\n                        ...prev,\r\n                        page: prev.page + 1,\r\n                      }))\r\n                    }\r\n                    disabled={pagination.page >= pagination.pages}\r\n                    className=\"flex items-center justify-center size-9 rounded-lg border border-white/10 text-gray-400 hover:bg-white/5 hover:text-white transition-colors\"\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-[18px]\">\r\n                      chevron_right\r\n                    </span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </section>\r\n      </div>\r\n      <AddBookModal\r\n        isOpen={addBookModalOpen}\r\n        onClose={() => setAddBookModalOpen(false)}\r\n        onBookAdded={handleBookAdded}\r\n      />\r\n      <EditBookModal\r\n        isOpen={editBookModalOpen}\r\n        onClose={() => {\r\n          setEditBookModalOpen(false);\r\n          setEditingBookId(null);\r\n        }}\r\n        onBookUpdated={handleBookUpdated}\r\n        bookId={editingBookId}\r\n      />\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\librarian\\layout.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\librarian\\members\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMembers'. Either include it or remove the dependency array.","line":25,"column":6,"nodeType":"ArrayExpression","endLine":25,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [searchQuery, tierFilter, statusFilter, fetchMembers]","fix":{"range":[1061,1100],"text":"[searchQuery, tierFilter, statusFilter, fetchMembers]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":223,"column":33,"nodeType":"JSXOpeningElement","endLine":227,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport LibrarianHeader from '@/components/LibrarianHeader';\r\nimport Loader from '@/components/Loader';\r\nimport AddNewMemberModal from '@/components/AddNewMemberModal';\r\nimport EditMemberModal from '@/components/EditMemberModal';\r\nimport ViewMemberModal from '@/components/ViewMemberModal';\r\n\r\nexport default function LibrarianMembersPage() {\r\n  const { userData } = useAuth();\r\n  const [members, setMembers] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [tierFilter, setTierFilter] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState('');\r\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\r\n  const [isViewModalOpen, setIsViewModalOpen] = useState(false);\r\n  const [selectedMember, setSelectedMember] = useState(null);\r\n\r\n  useEffect(() => {\r\n    fetchMembers();\r\n  }, [searchQuery, tierFilter, statusFilter]);\r\n\r\n  const fetchMembers = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const params = new URLSearchParams();\r\n      if (searchQuery) params.append('search', searchQuery);\r\n      if (tierFilter) {\r\n        const tier = tierFilter === 'free' ? 'standard' : tierFilter === 'monthly' || tierFilter === 'yearly' ? 'premium' : tierFilter;\r\n        if (tier !== 'all') params.append('tier', tier);\r\n      }\r\n      if (statusFilter && statusFilter !== 'all') params.append('status', statusFilter);\r\n      params.append('limit', '50');\r\n      \r\n      const response = await fetch(`/api/admin/members?${params.toString()}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setMembers(data.members || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching members:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getTierBadge = (subscriptionType) => {\r\n    const badges = {\r\n      free: { label: 'Standard', color: 'gray', bgColor: 'gray-500/10', borderColor: 'gray-500/20', textColor: 'gray-300' },\r\n      monthly: { label: 'Premium', color: 'amber', bgColor: 'amber-500/10', borderColor: 'amber-500/20', textColor: 'amber-300' },\r\n      yearly: { label: 'Premium', color: 'amber', bgColor: 'amber-500/10', borderColor: 'amber-500/20', textColor: 'amber-300' },\r\n    };\r\n    // Handle premium subscription types\r\n    if (subscriptionType === 'monthly' || subscriptionType === 'yearly') {\r\n      return badges.monthly;\r\n    }\r\n    return badges.free;\r\n  };\r\n\r\n  const getStatusBadge = (member) => {\r\n    // This would need to check for active borrowings, overdue items, etc.\r\n    // For now, placeholder\r\n    return {\r\n      label: 'Active',\r\n      color: 'emerald',\r\n      dot: 'emerald-500',\r\n    };\r\n  };\r\n\r\n  const getInitials = (name) => {\r\n    if (!name) return 'U';\r\n    const parts = name.split(' ');\r\n    if (parts.length >= 2) {\r\n      return (parts[0][0] + parts[1][0]).toUpperCase();\r\n    }\r\n    return name[0].toUpperCase();\r\n  };\r\n\r\n  // Filtering is now handled server-side via API, but keep for client-side filtering if needed\r\n  const filteredMembers = members;\r\n\r\n  const handleMemberAdded = () => {\r\n    setIsAddModalOpen(false);\r\n    fetchMembers(); // Refresh the members list\r\n  };\r\n\r\n  const handleMemberUpdated = () => {\r\n    setIsEditModalOpen(false);\r\n    setSelectedMember(null);\r\n    fetchMembers(); // Refresh the members list\r\n  };\r\n\r\n  const handleEdit = (member) => {\r\n    setSelectedMember(member);\r\n    setIsEditModalOpen(true);\r\n  };\r\n\r\n  const handleView = (member) => {\r\n    setSelectedMember(member);\r\n    setIsViewModalOpen(true);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <LibrarianHeader title=\"Member Management\" subtitle=\"Manage patrons, update details, and handle tiers.\" />\r\n      {isAddModalOpen && (\r\n        <AddNewMemberModal\r\n          isOpen={isAddModalOpen}\r\n          onClose={() => setIsAddModalOpen(false)}\r\n          onMemberAdded={handleMemberAdded}\r\n        />\r\n      )}\r\n      {isEditModalOpen && selectedMember && (\r\n        <EditMemberModal\r\n          isOpen={isEditModalOpen}\r\n          onClose={() => {\r\n            setIsEditModalOpen(false);\r\n            setSelectedMember(null);\r\n          }}\r\n          member={selectedMember}\r\n          onMemberUpdated={handleMemberUpdated}\r\n        />\r\n      )}\r\n      {isViewModalOpen && selectedMember && (\r\n        <ViewMemberModal\r\n          isOpen={isViewModalOpen}\r\n          onClose={() => {\r\n            setIsViewModalOpen(false);\r\n            setSelectedMember(null);\r\n          }}\r\n          memberId={selectedMember._id}\r\n        />\r\n      )}\r\n      <div className=\"flex-1 flex overflow-hidden\">\r\n        <div className=\"flex-1 flex flex-col overflow-y-auto p-8\">\r\n          <div className=\"flex items-center justify-between mb-6 gap-4 flex-wrap\">\r\n            <div className=\"relative flex-1 max-w-md min-w-[300px]\">\r\n              <span className=\"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary text-[20px]\">search</span>\r\n              <input\r\n                className=\"w-full bg-surface-dark border border-surface-border rounded-lg h-10 pl-10 pr-4 text-sm text-white placeholder-text-secondary focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all\"\r\n                placeholder=\"Search by name, email, or member ID...\"\r\n                type=\"text\"\r\n                value={searchQuery}\r\n                onChange={(e) => setSearchQuery(e.target.value)}\r\n              />\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              <select\r\n                className=\"bg-surface-dark border border-surface-border rounded-lg h-10 px-3 text-sm text-white focus:ring-1 focus:ring-primary outline-none cursor-pointer hover:border-text-secondary/50 transition-colors\"\r\n                value={tierFilter}\r\n                onChange={(e) => setTierFilter(e.target.value)}\r\n              >\r\n                <option value=\"\">All Tiers</option>\r\n                <option value=\"standard\">Standard</option>\r\n                <option value=\"premium\">Premium</option>\r\n              </select>\r\n              <select\r\n                className=\"bg-surface-dark border border-surface-border rounded-lg h-10 px-3 text-sm text-white focus:ring-1 focus:ring-primary outline-none cursor-pointer hover:border-text-secondary/50 transition-colors\"\r\n                value={statusFilter}\r\n                onChange={(e) => setStatusFilter(e.target.value)}\r\n              >\r\n                <option value=\"\">All Status</option>\r\n                <option value=\"active\">Active</option>\r\n                <option value=\"suspended\">Suspended</option>\r\n                <option value=\"overdue\">Overdue</option>\r\n              </select>\r\n            </div>\r\n            <div className=\"flex items-center gap-4\">\r\n              <button className=\"bg-surface-dark hover:bg-surface-border border border-surface-border text-white text-sm font-medium h-10 px-4 rounded-lg flex items-center gap-2 transition-colors\">\r\n                <span className=\"material-symbols-outlined text-[18px]\">file_download</span>\r\n                Export CSV\r\n              </button>\r\n              <button\r\n                onClick={() => setIsAddModalOpen(true)}\r\n                className=\"bg-primary hover:bg-primary-hover text-white text-sm font-bold h-10 px-4 rounded-lg flex items-center gap-2 shadow-[0_0_20px_rgba(170,31,239,0.3)] transition-all hover:shadow-[0_0_25px_rgba(170,31,239,0.5)]\"\r\n              >\r\n                <span className=\"material-symbols-outlined text-[20px]\">add</span>\r\n                Add New Member\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div className=\"rounded-xl border border-surface-border bg-surface-dark overflow-hidden shadow-sm\">\r\n            <table className=\"w-full text-left border-collapse\">\r\n              <thead>\r\n                <tr className=\"border-b border-surface-border bg-white/5\">\r\n                  <th className=\"px-6 py-4 text-xs font-semibold text-text-secondary uppercase tracking-wider w-[25%]\">Member</th>\r\n                  <th className=\"px-6 py-4 text-xs font-semibold text-text-secondary uppercase tracking-wider w-[25%]\">Contact Info</th>\r\n                  <th className=\"px-6 py-4 text-xs font-semibold text-text-secondary uppercase tracking-wider w-[15%]\">Tier</th>\r\n                  <th className=\"px-6 py-4 text-xs font-semibold text-text-secondary uppercase tracking-wider w-[15%]\">Active Loans</th>\r\n                  <th className=\"px-6 py-4 text-xs font-semibold text-text-secondary uppercase tracking-wider w-[10%]\">Status</th>\r\n                  <th className=\"px-6 py-4 text-xs font-semibold text-text-secondary uppercase tracking-wider text-right w-[10%]\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-surface-border\">\r\n                {loading ? (\r\n                  <tr>\r\n                    <td colSpan=\"6\" className=\"px-6 py-12 text-center text-text-secondary\">\r\n                      <div className=\"flex justify-center\">\r\n                        <Loader />\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ) : filteredMembers.length === 0 ? (\r\n                  <tr>\r\n                    <td colSpan=\"6\" className=\"px-6 py-12 text-center text-text-secondary\">\r\n                      No members found\r\n                    </td>\r\n                  </tr>\r\n                ) : (\r\n                  filteredMembers.map((member) => {\r\n                    const tierBadge = getTierBadge(member.subscription?.type || 'free');\r\n                    const statusBadge = getStatusBadge(member);\r\n                    return (\r\n                      <tr key={member._id} className=\"group hover:bg-white/5 transition-colors cursor-pointer border-l-2 border-l-transparent hover:border-l-primary\">\r\n                        <td className=\"px-6 py-4\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <div className=\"relative size-10 shrink-0\">\r\n                              {member.profilePhoto ? (\r\n                                <img\r\n                                  src={member.profilePhoto}\r\n                                  alt={member.name || 'Member'}\r\n                                  className=\"size-10 rounded-full object-cover border-2 border-primary/50 shadow-lg\"\r\n                                />\r\n                              ) : (\r\n                                <div className=\"size-10 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-sm font-bold text-white shadow-lg shadow-blue-500/20\">\r\n                                  {getInitials(member.name)}\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                            <div>\r\n                              <p className=\"text-sm font-semibold text-white group-hover:text-primary transition-colors\">\r\n                                {member.name || 'Unknown Member'}\r\n                              </p>\r\n                              <p className=\"text-xs text-text-secondary\">ID: #{member._id.toString().slice(-4)}</p>\r\n                            </div>\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-6 py-4\">\r\n                          <p className=\"text-sm text-text-secondary flex items-center gap-2\">\r\n                            <span className=\"material-symbols-outlined text-[16px] text-text-secondary/70\">mail</span>\r\n                            {member.email || 'N/A'}\r\n                          </p>\r\n                          {member.phone && (\r\n                            <p className=\"text-xs text-text-secondary mt-1 pl-6\">{member.phone}</p>\r\n                          )}\r\n                        </td>\r\n                        <td className=\"px-6 py-4\">\r\n                          <span\r\n                  className={`inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium border ${\r\n                    tierBadge.color === 'gray'\r\n                      ? 'bg-gray-500/10 text-gray-300 border-gray-500/20'\r\n                      : 'bg-amber-500/10 text-amber-300 border-amber-500/20'\r\n                  }`}\r\n                >\r\n                            {tierBadge.label}\r\n                          </span>\r\n                        </td>\r\n                        <td className=\"px-6 py-4\">\r\n                          <span className=\"text-sm font-medium text-white\">--</span>\r\n                        </td>\r\n                        <td className=\"px-6 py-4\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <div className=\"size-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]\"></div>\r\n                            <span className=\"text-sm text-white\">{statusBadge.label}</span>\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-6 py-4 text-right\">\r\n                          <div className=\"flex items-center justify-end gap-1 opacity-60 group-hover:opacity-100 transition-opacity\">\r\n                            <button\r\n                              onClick={() => handleView(member)}\r\n                              className=\"p-2 rounded-lg hover:bg-surface-border text-text-secondary hover:text-white transition-all\"\r\n                              title=\"View Details\"\r\n                            >\r\n                              <span className=\"material-symbols-outlined text-[20px]\">history</span>\r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleEdit(member)}\r\n                              className=\"p-2 rounded-lg hover:bg-primary/20 text-text-secondary hover:text-primary transition-all\"\r\n                              title=\"Edit Info\"\r\n                            >\r\n                              <span className=\"material-symbols-outlined text-[20px]\">edit</span>\r\n                            </button>\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className=\"mt-4 flex items-center justify-between text-xs text-text-secondary px-2\">\r\n            <p>Showing {filteredMembers.length} of {members.length} members</p>\r\n            <div className=\"flex gap-2\">\r\n              <button className=\"px-3 py-1.5 rounded-md hover:bg-surface-border transition-colors disabled:opacity-50\" disabled>\r\n                Previous\r\n              </button>\r\n              <button className=\"px-3 py-1.5 rounded-md hover:bg-surface-border transition-colors\">Next</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\librarian\\overview\\page.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":101,"column":102,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3833,3851],"text":"Today&apos;s Activities"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3833,3851],"text":"Today&lsquo;s Activities"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3833,3851],"text":"Today&#39;s Activities"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3833,3851],"text":"Today&rsquo;s Activities"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":296,"column":37,"nodeType":"JSXOpeningElement","endLine":303,"endColumn":39},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":468,"column":31,"nodeType":"JSXOpeningElement","endLine":476,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport LibrarianHeader from '@/components/LibrarianHeader';\r\nimport Link from 'next/link';\r\nimport { formatDate, formatDateTime } from '@/lib/utils';\r\nimport Loader from '@/components/Loader';\r\n\r\nexport default function LibrarianOverviewPage() {\r\n  const { userData } = useAuth();\r\n  const [stats, setStats] = useState({\r\n    todayActivities: 0,\r\n    pendingReturns: 0,\r\n    returnsDueToday: 0,\r\n    overdueBooks: 0,\r\n    recentlyOverdue: 0,\r\n    recentReservations: 0,\r\n    reservationsAwaitingPickup: 0,\r\n    totalCatalog: 0,\r\n    recentActivity: [],\r\n    newMembers: [],\r\n    inventoryStatus: [],\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [activityFilter, setActivityFilter] = useState('all');\r\n\r\n  useEffect(() => {\r\n    fetchStats();\r\n    // Refresh stats every 30 seconds\r\n    const interval = setInterval(fetchStats, 30000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  const fetchStats = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch('/api/librarian/stats');\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setStats(data);\r\n      } else {\r\n        console.error('Error fetching stats:', response.statusText);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching stats:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const filteredActivity = stats.recentActivity.filter((activity) => {\r\n    if (activityFilter === 'returns') {\r\n      return activity.status === 'Returned';\r\n    }\r\n    if (activityFilter === 'overdue') {\r\n      return activity.status === 'Overdue Notice';\r\n    }\r\n    return true;\r\n  });\r\n\r\n  const getStatusBadgeClass = (statusColor) => {\r\n    const classes = {\r\n      emerald: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/10',\r\n      blue: 'bg-blue-500/10 text-blue-400 border-blue-500/10',\r\n      red: 'bg-red-500/10 text-red-400 border-red-500/10',\r\n      orange: 'bg-orange-500/10 text-orange-400 border-orange-500/10',\r\n    };\r\n    return classes[statusColor] || classes.emerald;\r\n  };\r\n\r\n  const getInitials = (name) => {\r\n    if (!name) return 'U';\r\n    const parts = name.split(' ');\r\n    if (parts.length >= 2) {\r\n      return (parts[0][0] + parts[1][0]).toUpperCase();\r\n    }\r\n    return name[0].toUpperCase();\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <LibrarianHeader title=\"Overview\" />\r\n      <div className=\"flex-1 overflow-y-auto p-6 md:p-8\">\r\n        <div className=\"max-w-7xl mx-auto flex flex-col gap-8\">\r\n          {/* Stats Cards */}\r\n          <section className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n            {/* Today's Activities */}\r\n            <div className=\"bg-card-dark p-6 rounded-2xl border border-white/5 relative overflow-hidden group hover:border-primary/30 transition-all shadow-lg shadow-black/20\">\r\n              <div className=\"absolute right-0 top-0 p-24 bg-primary/5 rounded-full blur-3xl -mr-12 -mt-12 group-hover:bg-primary/10 transition-all duration-500\"></div>\r\n              <div className=\"relative z-10 flex flex-col h-full justify-between\">\r\n                <div className=\"flex justify-between items-start mb-4\">\r\n                  <div className=\"p-2.5 bg-surface-dark rounded-xl border border-white/5 shadow-inner\">\r\n                    <span className=\"material-symbols-outlined text-primary\">swap_horiz</span>\r\n                  </div>\r\n                  <span className=\"text-white/40 text-[10px] font-bold uppercase tracking-wider bg-white/5 px-2 py-1 rounded-md\">\r\n                    Daily\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-white/50 text-xs font-medium uppercase tracking-wide mb-1\">Today's Activities</p>\r\n                  <div className=\"flex items-baseline gap-2\">\r\n                    <h3 className=\"text-white text-3xl font-bold tracking-tight\">{stats.todayActivities}</h3>\r\n                    <span className=\"text-emerald-400 text-xs font-semibold flex items-center gap-0.5\">\r\n                      <span className=\"material-symbols-outlined text-[14px]\">arrow_upward</span>\r\n                      12%\r\n                    </span>\r\n                  </div>\r\n                  <p className=\"text-white/30 text-[11px] mt-1\">Check-ins & Check-outs processed</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Pending Returns */}\r\n            <div className=\"bg-card-dark p-6 rounded-2xl border border-white/5 relative overflow-hidden group hover:border-blue-500/30 transition-all shadow-lg shadow-black/20\">\r\n              <div className=\"absolute right-0 top-0 p-24 bg-blue-500/5 rounded-full blur-3xl -mr-12 -mt-12 group-hover:bg-blue-500/10 transition-all duration-500\"></div>\r\n              <div className=\"relative z-10 flex flex-col h-full justify-between\">\r\n                <div className=\"flex justify-between items-start mb-4\">\r\n                  <div className=\"p-2.5 bg-surface-dark rounded-xl border border-white/5 shadow-inner\">\r\n                    <span className=\"material-symbols-outlined text-blue-400\">keyboard_return</span>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-white/50 text-xs font-medium uppercase tracking-wide mb-1\">Pending Returns</p>\r\n                  <div className=\"flex items-baseline gap-2\">\r\n                    <h3 className=\"text-white text-3xl font-bold tracking-tight\">{stats.pendingReturns}</h3>\r\n                  </div>\r\n                  <p className=\"text-blue-400/80 text-[11px] mt-1 font-medium bg-blue-400/10 inline-block px-2 py-0.5 rounded\">\r\n                    {stats.returnsDueToday} Due Today\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Overdue Books */}\r\n            <div className=\"bg-card-dark p-6 rounded-2xl border border-white/5 relative overflow-hidden group hover:border-red-500/30 transition-all shadow-lg shadow-black/20\">\r\n              <div className=\"absolute right-0 top-0 p-24 bg-red-500/5 rounded-full blur-3xl -mr-12 -mt-12 group-hover:bg-red-500/10 transition-all duration-500\"></div>\r\n              <div className=\"relative z-10 flex flex-col h-full justify-between\">\r\n                <div className=\"flex justify-between items-start mb-4\">\r\n                  <div className=\"p-2.5 bg-surface-dark rounded-xl border border-white/5 shadow-inner\">\r\n                    <span className=\"material-symbols-outlined text-red-400\">warning</span>\r\n                  </div>\r\n                  <span className=\"text-red-400/20 text-[10px] font-bold uppercase tracking-wider bg-red-400/10 px-2 py-1 rounded-md border border-red-400/10\">\r\n                    Alert\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-white/50 text-xs font-medium uppercase tracking-wide mb-1\">Overdue Books</p>\r\n                  <div className=\"flex items-baseline gap-2\">\r\n                    <h3 className=\"text-white text-3xl font-bold tracking-tight\">{stats.overdueBooks}</h3>\r\n                    {stats.recentlyOverdue > 0 && (\r\n                      <span className=\"text-red-400 text-xs font-semibold flex items-center gap-0.5\">\r\n                        +{stats.recentlyOverdue} New\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  <p className=\"text-white/30 text-[11px] mt-1\">Requiring immediate attention</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Recent Reservations */}\r\n            <div className=\"bg-card-dark p-6 rounded-2xl border border-white/5 relative overflow-hidden group hover:border-orange-500/30 transition-all shadow-lg shadow-black/20\">\r\n              <div className=\"absolute right-0 top-0 p-24 bg-orange-500/5 rounded-full blur-3xl -mr-12 -mt-12 group-hover:bg-orange-500/10 transition-all duration-500\"></div>\r\n              <div className=\"relative z-10 flex flex-col h-full justify-between\">\r\n                <div className=\"flex justify-between items-start mb-4\">\r\n                  <div className=\"p-2.5 bg-surface-dark rounded-xl border border-white/5 shadow-inner\">\r\n                    <span className=\"material-symbols-outlined text-orange-400\">bookmark</span>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-white/50 text-xs font-medium uppercase tracking-wide mb-1\">Recent Reservations</p>\r\n                  <div className=\"flex items-baseline gap-2\">\r\n                    <h3 className=\"text-white text-3xl font-bold tracking-tight\">{stats.recentReservations}</h3>\r\n                  </div>\r\n                  <p className=\"text-orange-400/80 text-[11px] mt-1 font-medium bg-orange-400/10 inline-block px-2 py-0.5 rounded\">\r\n                    {stats.reservationsAwaitingPickup} Awaiting Pickup\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </section>\r\n\r\n          {/* Main Content Grid */}\r\n          <div className=\"grid grid-cols-1 xl:grid-cols-3 gap-6 md:gap-8\">\r\n            {/* Left Column - 2/3 width */}\r\n            <div className=\"xl:col-span-2 flex flex-col gap-6\">\r\n              {/* Quick Actions */}\r\n              <div className=\"bg-gradient-to-r from-primary/10 via-surface-dark to-surface-dark rounded-2xl p-6 border border-white/5 flex flex-col md:flex-row items-center justify-between gap-6 shadow-lg shadow-black/20\">\r\n                <div className=\"flex items-start gap-4\">\r\n                  <div className=\"p-3 rounded-full bg-primary/20 text-primary border border-primary/20 shrink-0\">\r\n                    <span className=\"material-symbols-outlined\">bolt</span>\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"text-white text-lg font-bold\">Quick Actions</h3>\r\n                    <p className=\"text-white/50 text-sm max-w-md\">Access common management tasks instantly.</p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex flex-wrap gap-3 w-full md:w-auto justify-start md:justify-end\">\r\n                  <Link\r\n                    href=\"/librarian/circulation\"\r\n                    className=\"flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2.5 bg-primary text-white text-sm font-semibold rounded-lg hover:bg-primary-hover transition-all shadow-lg shadow-primary/20 active:scale-95\"\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-[18px]\">qr_code_scanner</span>\r\n                    Scan Return\r\n                  </Link>\r\n                  <Link\r\n                    href=\"/librarian/members\"\r\n                    className=\"flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2.5 bg-white/5 border border-white/10 text-white text-sm font-medium rounded-lg hover:bg-white/10 transition-colors active:scale-95\"\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-[18px]\">person_add</span>\r\n                    New User\r\n                  </Link>\r\n                  <Link\r\n                    href=\"/librarian/inventory\"\r\n                    className=\"flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2.5 bg-white/5 border border-white/10 text-white text-sm font-medium rounded-lg hover:bg-white/10 transition-colors active:scale-95\"\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-[18px]\">library_add</span>\r\n                    Add Book\r\n                  </Link>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Circulation Activity */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 overflow-hidden flex flex-col shadow-lg shadow-black/20 flex-1\">\r\n                <div className=\"p-6 border-b border-white/5 flex justify-between items-center\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <h3 className=\"text-white font-bold text-lg\">Circulation Activity</h3>\r\n                    <span className=\"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase\">Live</span>\r\n                  </div>\r\n                  <div className=\"flex gap-2\">\r\n                    <button\r\n                      onClick={() => setActivityFilter('all')}\r\n                      className={`px-3 py-1.5 text-xs font-medium rounded-lg transition-colors ${\r\n                        activityFilter === 'all'\r\n                          ? 'text-white bg-white/10 shadow-sm border border-white/5'\r\n                          : 'text-white/40 hover:text-white hover:bg-white/5'\r\n                      }`}\r\n                    >\r\n                      All\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setActivityFilter('returns')}\r\n                      className={`px-3 py-1.5 text-xs font-medium rounded-lg transition-colors ${\r\n                        activityFilter === 'returns'\r\n                          ? 'text-white bg-white/10 shadow-sm border border-white/5'\r\n                          : 'text-white/40 hover:text-white hover:bg-white/5'\r\n                      }`}\r\n                    >\r\n                      Returns\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setActivityFilter('overdue')}\r\n                      className={`px-3 py-1.5 text-xs font-medium rounded-lg transition-colors ${\r\n                        activityFilter === 'overdue'\r\n                          ? 'text-white bg-white/10 shadow-sm border border-white/5'\r\n                          : 'text-white/40 hover:text-white hover:bg-white/5'\r\n                      }`}\r\n                    >\r\n                      Overdue\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full text-left text-sm text-white/70\">\r\n                    <thead className=\"bg-surface-dark/50 text-xs uppercase font-semibold text-white/40 border-b border-white/5\">\r\n                      <tr>\r\n                        <th className=\"px-6 py-4 font-bold tracking-wider\">Book Details</th>\r\n                        <th className=\"px-6 py-4 font-bold tracking-wider\">Member</th>\r\n                        <th className=\"px-6 py-4 font-bold tracking-wider\">Status</th>\r\n                        <th className=\"px-6 py-4 text-right font-bold tracking-wider\">Processed</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-white/5\">\r\n                      {loading ? (\r\n                        <tr>\r\n                          <td colSpan=\"4\" className=\"px-6 py-8 text-center text-white/40\">\r\n                            <div className=\"flex justify-center\">\r\n                              <Loader />\r\n                            </div>\r\n                          </td>\r\n                        </tr>\r\n                      ) : filteredActivity.length === 0 ? (\r\n                        <tr>\r\n                          <td colSpan=\"4\" className=\"px-6 py-8 text-center text-white/40\">\r\n                            No activity found\r\n                          </td>\r\n                        </tr>\r\n                      ) : (\r\n                        filteredActivity.slice(0, 5).map((activity) => (\r\n                          <tr key={activity._id} className=\"hover:bg-white/[0.02] transition-colors group\">\r\n                            <td className=\"px-6 py-4\">\r\n                              <div className=\"flex items-center gap-4\">\r\n                                <div className=\"size-10 rounded-md bg-gray-800 shadow-sm group-hover:scale-105 transition-transform duration-300 overflow-hidden\">\r\n                                  {activity.book?.coverImage ? (\r\n                                    <img\r\n                                      src={activity.book.coverImage}\r\n                                      alt={activity.book.title || 'Book cover'}\r\n                                      className=\"w-full h-full object-cover\"\r\n                                      onError={(e) => {\r\n                                        e.target.style.display = 'none';\r\n                                      }}\r\n                                    />\r\n                                  ) : (\r\n                                    <div className=\"w-full h-full flex items-center justify-center\">\r\n                                      <span className=\"material-symbols-outlined text-gray-500 text-sm\">book</span>\r\n                                    </div>\r\n                                  )}\r\n                                </div>\r\n                                <div>\r\n                                  <p className=\"font-semibold text-white text-sm\">\r\n                                    {activity.book?.title || 'Unknown Book'}\r\n                                  </p>\r\n                                  <p className=\"text-xs text-white/40 mt-0.5\">\r\n                                    ISBN: {activity.book?.isbn || 'N/A'}\r\n                                  </p>\r\n                                </div>\r\n                              </div>\r\n                            </td>\r\n                            <td className=\"px-6 py-4\">\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <div className=\"size-6 rounded-full bg-primary/20 flex items-center justify-center text-[10px] text-primary font-bold\">\r\n                                  {getInitials(activity.member?.name)}\r\n                                </div>\r\n                                <span>{activity.member?.name || 'Unknown Member'}</span>\r\n                              </div>\r\n                            </td>\r\n                            <td className=\"px-6 py-4\">\r\n                              <span\r\n                                className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold border ${getStatusBadgeClass(\r\n                                  activity.statusColor\r\n                                )}`}\r\n                              >\r\n                                {activity.statusColor === 'emerald' && (\r\n                                  <span className=\"size-1.5 rounded-full bg-emerald-400 animate-pulse\"></span>\r\n                                )}\r\n                                {activity.status}\r\n                              </span>\r\n                            </td>\r\n                            <td className=\"px-6 py-4 text-right text-white/30 font-mono text-xs\">\r\n                              {activity.processedAt\r\n                                ? new Date(activity.processedAt).toLocaleTimeString('en-US', {\r\n                                    hour: '2-digit',\r\n                                    minute: '2-digit',\r\n                                  })\r\n                                : 'N/A'}\r\n                            </td>\r\n                          </tr>\r\n                        ))\r\n                      )}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n                <div className=\"p-4 border-t border-white/5 bg-white/[0.01]\">\r\n                  <Link\r\n                    href=\"/librarian/circulation\"\r\n                    className=\"w-full py-2 rounded-lg text-xs font-medium text-white/40 hover:text-white hover:bg-white/5 transition-colors block text-center\"\r\n                  >\r\n                    View Full Activity Log\r\n                  </Link>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Right Column - 1/3 width */}\r\n            <div className=\"flex flex-col gap-6\">\r\n              {/* Inventory Status */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 shadow-lg shadow-black/20\">\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                  <h3 className=\"text-white font-bold text-lg\">Inventory Status</h3>\r\n                  <button className=\"p-1 hover:bg-white/10 rounded transition-colors\">\r\n                    <span className=\"material-symbols-outlined text-white/50 text-sm\">more_horiz</span>\r\n                  </button>\r\n                </div>\r\n                <div className=\"mb-6 pb-6 border-b border-white/5 flex items-center justify-between\">\r\n                  <div className=\"flex flex-col\">\r\n                    <span className=\"text-white/40 text-xs font-medium uppercase tracking-wider\">Total Catalog</span>\r\n                    <span className=\"text-2xl font-bold text-white\">{stats.totalCatalog.toLocaleString()}</span>\r\n                  </div>\r\n                  <div className=\"size-10 rounded-full bg-primary/10 flex items-center justify-center border border-primary/20\">\r\n                    <span className=\"material-symbols-outlined text-primary text-xl\">library_books</span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex flex-col gap-6\">\r\n                  {loading && stats.inventoryStatus.length === 0 ? (\r\n                    <div className=\"text-center py-4 text-white/40 text-sm\">\r\n                      <div className=\"flex justify-center\">\r\n                        <Loader />\r\n                      </div>\r\n                    </div>\r\n                  ) : stats.inventoryStatus.length === 0 ? (\r\n                    <div className=\"text-center py-4 text-white/40 text-sm\">\r\n                      No inventory data available\r\n                    </div>\r\n                  ) : (\r\n                    <>\r\n                      {stats.inventoryStatus.map((category, index) => {\r\n                        const colors = [\r\n                          { bg: 'bg-primary', text: 'text-primary', shadow: 'shadow-[0_0_10px_rgba(170,31,239,0.5)]' },\r\n                          { bg: 'bg-emerald-400', text: 'text-emerald-400', shadow: 'shadow-[0_0_10px_rgba(52,211,153,0.3)]' },\r\n                          { bg: 'bg-yellow-400', text: 'text-yellow-400', shadow: 'shadow-[0_0_10px_rgba(250,204,21,0.3)]' },\r\n                        ];\r\n                        const color = colors[index] || colors[0];\r\n                        const categoryName = category.categoryName \r\n                          ? category.categoryName.charAt(0).toUpperCase() + category.categoryName.slice(1)\r\n                          : 'Unknown Category';\r\n                        const isLowStock = category.stockPercentage < 70;\r\n                        \r\n                        return (\r\n                          <div key={category._id || index} className=\"space-y-2\">\r\n                            <div className=\"flex justify-between text-xs font-medium\">\r\n                              <span className=\"text-white/70\">\r\n                                {categoryName}\r\n                                {index === 0 && category.totalCopies > 50 && ' (High Demand)'}\r\n                              </span>\r\n                              <span className={color.text}>\r\n                                {category.stockPercentage}% Stocked\r\n                              </span>\r\n                            </div>\r\n                            <div className=\"h-1.5 w-full bg-white/5 rounded-full overflow-hidden\">\r\n                              <div \r\n                                className={`h-full ${color.bg} rounded-full ${color.shadow}`}\r\n                                style={{ width: `${Math.min(category.stockPercentage, 100)}%` }}\r\n                              ></div>\r\n                            </div>\r\n                          </div>\r\n                        );\r\n                      })}\r\n                      {stats.inventoryStatus.some(cat => cat.stockPercentage < 70) && (\r\n                        <div className=\"p-3 bg-surface-dark/50 rounded-xl flex items-start gap-3 border border-white/5\">\r\n                          <span className=\"material-symbols-outlined text-yellow-400 text-sm mt-0.5\">lightbulb</span>\r\n                          <p className=\"text-xs text-white/60 leading-relaxed\">\r\n                            Some categories are running low on stock. Consider restocking soon.\r\n                          </p>\r\n                        </div>\r\n                      )}\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* New Members */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 flex-1 shadow-lg shadow-black/20\">\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                  <h3 className=\"text-white font-bold text-lg\">New Members</h3>\r\n                  <Link href=\"/librarian/members\" className=\"text-primary text-xs font-bold hover:underline\">\r\n                    View All\r\n                  </Link>\r\n                </div>\r\n                <div className=\"flex flex-col gap-4\">\r\n                  {loading ? (\r\n                    <div className=\"text-center py-4 text-white/40 text-sm\">\r\n                      <div className=\"flex justify-center\">\r\n                        <Loader />\r\n                      </div>\r\n                    </div>\r\n                  ) : stats.newMembers.length === 0 ? (\r\n                    <div className=\"text-center py-4 text-white/40 text-sm\">No new members</div>\r\n                  ) : (\r\n                    stats.newMembers.map((member) => (\r\n                      <div\r\n                        key={member._id}\r\n                        className=\"flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg transition-colors cursor-pointer group\"\r\n                      >\r\n                        <div className=\"relative\">\r\n                          <div className=\"size-10 rounded-full bg-center bg-cover border border-white/10 overflow-hidden bg-[#3c2348]\">\r\n                            {member.profilePhoto ? (\r\n                              <img\r\n                                src={member.profilePhoto}\r\n                                alt={member.name}\r\n                                className=\"w-full h-full object-cover\"\r\n                                onError={(e) => {\r\n                                  e.target.style.display = 'none';\r\n                                  e.target.nextSibling.style.display = 'flex';\r\n                                }}\r\n                              />\r\n                            ) : null}\r\n                            {!member.profilePhoto && (\r\n                              <div className=\"w-full h-full flex items-center justify-center text-white text-sm font-bold\">\r\n                                {getInitials(member.name)}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"absolute bottom-0 right-0 size-2.5 bg-green-500 border-2 border-card-dark rounded-full\"></div>\r\n                        </div>\r\n                        <div className=\"flex flex-col flex-1\">\r\n                          <p className=\"text-sm font-medium text-white group-hover:text-primary transition-colors\">\r\n                            {member.name}\r\n                          </p>\r\n                          <p className=\"text-xs text-white/40\">Student  #{member._id.toString().slice(-4)}</p>\r\n                        </div>\r\n                        <button className=\"opacity-0 group-hover:opacity-100 size-8 rounded-full border border-white/10 flex items-center justify-center bg-surface-dark text-white hover:bg-primary hover:border-primary transition-all\">\r\n                          <span className=\"material-symbols-outlined text-sm\">mail</span>\r\n                        </button>\r\n                      </div>\r\n                    ))\r\n                  )}\r\n                </div>\r\n                <Link\r\n                  href=\"/librarian/members\"\r\n                  className=\"w-full mt-6 py-3 rounded-lg border border-dashed border-white/10 text-white/40 text-xs font-medium hover:bg-white/5 hover:text-white hover:border-white/20 transition-all uppercase tracking-wide block text-center\"\r\n                >\r\n                  View Member Directory\r\n                </Link>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\librarian\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\librarian\\requests\\page.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":335,"column":27,"nodeType":"JSXOpeningElement","endLine":339,"endColumn":29},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":439,"column":70,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[21614,21699],"text":"This feature is coming soon. You&apos;ll be able to manage book acquisition requests here."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[21614,21699],"text":"This feature is coming soon. You&lsquo;ll be able to manage book acquisition requests here."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[21614,21699],"text":"This feature is coming soon. You&#39;ll be able to manage book acquisition requests here."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[21614,21699],"text":"This feature is coming soon. You&rsquo;ll be able to manage book acquisition requests here."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport LibrarianHeader from '@/components/LibrarianHeader';\r\nimport { showSuccess, showError, showConfirm } from '@/lib/swal';\r\nimport Link from 'next/link';\r\nimport Loader from '@/components/Loader';\r\n\r\nexport default function LibrarianRequestsPage() {\r\n  const { userData } = useAuth();\r\n  const [activeTab, setActiveTab] = useState('reservations'); // 'reservations' or 'acquisitions'\r\n  const [reservations, setReservations] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [processing, setProcessing] = useState(false);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [stats, setStats] = useState({\r\n    pendingReservations: 0,\r\n    acquisitionRequests: 0,\r\n    requiresApproval: 0,\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchReservations();\r\n    fetchStats();\r\n  }, []);\r\n\r\n  const fetchStats = async () => {\r\n    try {\r\n      const response = await fetch('/api/librarian/stats');\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setStats({\r\n          pendingReservations: data.recentReservations || 0,\r\n          acquisitionRequests: 0, // Placeholder - can be added later\r\n          requiresApproval: data.reservationsAwaitingPickup || 0,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching stats:', error);\r\n    }\r\n  };\r\n\r\n  const fetchReservations = async () => {\r\n    try {\r\n      setLoading(true);\r\n      // Fetch pending reservations\r\n      const pendingResponse = await fetch('/api/reservations?status=pending&limit=100');\r\n      // Fetch ready reservations\r\n      const readyResponse = await fetch('/api/reservations?status=ready&limit=100');\r\n      \r\n      const pendingData = pendingResponse.ok ? await pendingResponse.json() : { reservations: [] };\r\n      const readyData = readyResponse.ok ? await readyResponse.json() : { reservations: [] };\r\n      \r\n      // Combine pending and ready reservations\r\n      const allReservations = [\r\n        ...(pendingData.reservations || []),\r\n        ...(readyData.reservations || [])\r\n      ];\r\n      \r\n      // Sort by reserved date (most recent first)\r\n      allReservations.sort((a, b) => {\r\n        const dateA = new Date(a.reservedDate || 0);\r\n        const dateB = new Date(b.reservedDate || 0);\r\n        return dateB - dateA;\r\n      });\r\n      \r\n      setReservations(allReservations);\r\n    } catch (error) {\r\n      console.error('Error fetching reservations:', error);\r\n      showError('Error', 'Failed to fetch reservations');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleMarkReady = async (reservationId, bookId) => {\r\n    const result = await showConfirm(\r\n      'Mark Reservation Ready',\r\n      'Mark this reservation as ready? An available copy will be reserved for the member.'\r\n    );\r\n    if (!result.isConfirmed) return;\r\n\r\n    try {\r\n      setProcessing(true);\r\n      const response = await fetch(`/api/reservations/${reservationId}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'markReady' }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        showSuccess('Success!', 'Reservation marked as ready');\r\n        await fetchReservations();\r\n        await fetchStats(); // Refresh stats\r\n      } else {\r\n        const error = await response.json();\r\n        showError('Error', error.error || 'Failed to mark reservation as ready');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error marking reservation as ready:', error);\r\n      showError('Error', 'Failed to mark reservation as ready');\r\n    } finally {\r\n      setProcessing(false);\r\n    }\r\n  };\r\n\r\n  const handleCompleteReservation = async (reservationId) => {\r\n    const result = await showConfirm('Complete Reservation', 'Complete this reservation and create a borrowing?');\r\n    if (!result.isConfirmed) return;\r\n\r\n    try {\r\n      setProcessing(true);\r\n      const response = await fetch(`/api/reservations/${reservationId}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'complete' }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        showSuccess('Success!', 'Reservation completed successfully');\r\n        await fetchReservations();\r\n        await fetchStats(); // Refresh stats\r\n      } else {\r\n        const error = await response.json();\r\n        showError('Error', error.error || 'Failed to complete reservation');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error completing reservation:', error);\r\n      showError('Error', 'Failed to complete reservation');\r\n    } finally {\r\n      setProcessing(false);\r\n    }\r\n  };\r\n\r\n  const handleCancelReservation = async (reservationId) => {\r\n    const result = await showConfirm(\r\n      'Cancel Reservation',\r\n      'Are you sure you want to cancel this reservation? This action cannot be undone.',\r\n      {\r\n        confirmButtonText: 'Yes, Cancel',\r\n        cancelButtonText: 'Keep Reservation',\r\n        icon: 'warning',\r\n        confirmButtonColor: '#ef4444',\r\n      }\r\n    );\r\n    if (!result.isConfirmed) return;\r\n\r\n    try {\r\n      setProcessing(true);\r\n      const response = await fetch(`/api/reservations/${reservationId}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'cancel' }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        showSuccess('Success!', 'Reservation cancelled successfully');\r\n        await fetchReservations();\r\n        await fetchStats(); // Refresh stats\r\n      } else {\r\n        const error = await response.json();\r\n        showError('Error', error.error || 'Failed to cancel reservation');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error cancelling reservation:', error);\r\n      showError('Error', 'Failed to cancel reservation');\r\n    } finally {\r\n      setProcessing(false);\r\n    }\r\n  };\r\n\r\n  const filteredReservations = reservations.filter((reservation) => {\r\n    if (!searchQuery) return true;\r\n    const query = searchQuery.toLowerCase();\r\n    return (\r\n      reservation.book?.title?.toLowerCase().includes(query) ||\r\n      reservation.book?.author?.toLowerCase().includes(query) ||\r\n      reservation.book?.isbn?.toLowerCase().includes(query) ||\r\n      reservation.member?.name?.toLowerCase().includes(query) ||\r\n      reservation.member?.email?.toLowerCase().includes(query)\r\n    );\r\n  });\r\n\r\n  const getInitials = (name) => {\r\n    if (!name) return 'U';\r\n    const parts = name.split(' ');\r\n    if (parts.length >= 2) {\r\n      return (parts[0][0] + parts[1][0]).toUpperCase();\r\n    }\r\n    return name[0].toUpperCase();\r\n  };\r\n\r\n  const formatTimeAgo = (date) => {\r\n    if (!date) return 'N/A';\r\n    const now = new Date();\r\n    const then = new Date(date);\r\n    const diffMs = now - then;\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMs / 3600000);\r\n    const diffDays = Math.floor(diffMs / 86400000);\r\n\r\n    if (diffMins < 60) return `${diffMins} min${diffMins !== 1 ? 's' : ''} ago`;\r\n    if (diffHours < 24) return `${diffHours} hr${diffHours !== 1 ? 's' : ''} ago`;\r\n    return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <LibrarianHeader title=\"Book Requests\" subtitle=\"Manage pending reservations and review new book acquisition proposals.\" />\r\n      <div className=\"flex-1 overflow-y-auto p-4 md:p-8 lg:px-12\">\r\n        <div className=\"max-w-7xl mx-auto flex flex-col gap-6\">\r\n          {/* Stats Cards */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div className=\"flex flex-col gap-2 rounded-xl p-6 border border-[#553267] bg-surface-dark/30\">\r\n              <div className=\"flex justify-between items-start\">\r\n                <p className=\"text-text-secondary text-sm font-medium uppercase tracking-wider\">Pending Reservations</p>\r\n                <span className=\"material-symbols-outlined text-text-secondary\">shopping_bag</span>\r\n              </div>\r\n              <div className=\"flex items-end gap-3\">\r\n                <p className=\"text-white text-3xl font-bold leading-tight\">{stats.pendingReservations}</p>\r\n                <p className=\"text-emerald-400 text-sm font-medium mb-1 flex items-center\">\r\n                  <span className=\"material-symbols-outlined text-[16px]\">trending_up</span>\r\n                  +2%\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex flex-col gap-2 rounded-xl p-6 border border-primary/40 bg-primary/10 relative overflow-hidden\">\r\n              <div className=\"absolute -right-4 -top-4 w-24 h-24 bg-primary/20 rounded-full blur-2xl\"></div>\r\n              <div className=\"flex justify-between items-start relative z-10\">\r\n                <p className=\"text-primary text-sm font-medium uppercase tracking-wider\">Acquisition Requests</p>\r\n                <span className=\"material-symbols-outlined text-primary\">bookmark_add</span>\r\n              </div>\r\n              <div className=\"flex items-end gap-3 relative z-10\">\r\n                <p className=\"text-white text-3xl font-bold leading-tight\">{stats.acquisitionRequests}</p>\r\n                <p className=\"text-emerald-400 text-sm font-medium mb-1 flex items-center\">\r\n                  <span className=\"material-symbols-outlined text-[16px]\">trending_up</span>\r\n                  +5%\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex flex-col gap-2 rounded-xl p-6 border border-[#553267] bg-surface-dark/30\">\r\n              <div className=\"flex justify-between items-start\">\r\n                <p className=\"text-text-secondary text-sm font-medium uppercase tracking-wider\">Requires Approval</p>\r\n                <span className=\"material-symbols-outlined text-text-secondary\">gavel</span>\r\n              </div>\r\n              <div className=\"flex items-end gap-3\">\r\n                <p className=\"text-white text-3xl font-bold leading-tight\">{stats.requiresApproval}</p>\r\n                <p className=\"text-text-secondary text-sm font-medium mb-1\">Low Priority</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Tabs & Controls */}\r\n          <div className=\"flex flex-col gap-4\">\r\n            <div className=\"border-b border-[#553267] flex gap-8\">\r\n              <button\r\n                onClick={() => setActiveTab('reservations')}\r\n                className={`flex flex-col items-center justify-center border-b-[3px] pb-3 pt-2 px-1 transition-colors ${\r\n                  activeTab === 'reservations'\r\n                    ? 'border-b-primary text-white'\r\n                    : 'border-b-transparent text-text-secondary hover:text-white'\r\n                }`}\r\n              >\r\n                <p className=\"text-sm font-bold tracking-wide\">Reservations (Pickup)</p>\r\n              </button>\r\n              <button\r\n                onClick={() => setActiveTab('acquisitions')}\r\n                className={`flex flex-col items-center justify-center border-b-[3px] pb-3 pt-2 px-1 transition-colors ${\r\n                  activeTab === 'acquisitions'\r\n                    ? 'border-b-primary text-white'\r\n                    : 'border-b-transparent text-text-secondary hover:text-white'\r\n                }`}\r\n              >\r\n                <div className=\"flex items-center gap-2\">\r\n                  <p className=\"text-sm font-bold tracking-wide\">Acquisition Requests</p>\r\n                  {stats.acquisitionRequests > 0 && (\r\n                    <span className=\"bg-primary text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full\">\r\n                      {stats.acquisitionRequests}\r\n                    </span>\r\n                  )}\r\n                </div>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Filter Bar */}\r\n            <div className=\"flex flex-col md:flex-row gap-4 justify-between items-center bg-surface-dark/20 p-2 rounded-xl border border-[#553267]/50\">\r\n              <div className=\"relative flex-1 w-full\">\r\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                  <span className=\"material-symbols-outlined text-text-secondary\">search</span>\r\n                </div>\r\n                <input\r\n                  className=\"w-full bg-surface-dark text-white border-none rounded-lg py-2.5 pl-10 pr-4 placeholder:text-text-secondary focus:ring-1 focus:ring-primary focus:bg-[#4a2b5e] transition-all\"\r\n                  placeholder=\"Search by ISBN, Title, Author or Requester...\"\r\n                  type=\"text\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                />\r\n              </div>\r\n              <div className=\"flex gap-2 w-full md:w-auto\">\r\n                <button className=\"flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-surface-dark text-text-secondary hover:text-white hover:bg-[#4a2b5e] transition-colors text-sm font-medium\">\r\n                  <span className=\"material-symbols-outlined text-[18px]\">filter_list</span>\r\n                  Filter\r\n                </button>\r\n                <button className=\"flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-surface-dark text-text-secondary hover:text-white hover:bg-[#4a2b5e] transition-colors text-sm font-medium\">\r\n                  <span className=\"material-symbols-outlined text-[18px]\">sort</span>\r\n                  Sort\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Reservations Tab Content */}\r\n          {activeTab === 'reservations' && (\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 pb-12\">\r\n              {loading ? (\r\n                <div className=\"col-span-full text-center py-12 text-white/40\">\r\n                  <div className=\"flex justify-center\">\r\n                    <Loader />\r\n                  </div>\r\n                </div>\r\n              ) : filteredReservations.length === 0 ? (\r\n                <div className=\"col-span-full text-center py-12 text-white/40\">\r\n                  No {searchQuery ? 'matching ' : ''}reservations found\r\n                </div>\r\n              ) : (\r\n                filteredReservations.map((reservation) => (\r\n                  <div\r\n                    key={reservation._id}\r\n                    className=\"group flex flex-col rounded-xl bg-surface-dark border border-[#553267] overflow-hidden hover:border-primary/50 hover:shadow-lg hover:shadow-primary/5 transition-all duration-300\"\r\n                  >\r\n                    <div className=\"relative h-48 w-full overflow-hidden\">\r\n                      {reservation.book?.coverImage ? (\r\n                        <>\r\n                          <img\r\n                            className=\"h-full w-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500\"\r\n                            src={reservation.book.coverImage}\r\n                            alt={reservation.book.title}\r\n                          />\r\n                          <div className=\"absolute inset-0 bg-gradient-to-t from-surface-dark to-transparent\"></div>\r\n                        </>\r\n                      ) : (\r\n                        <div className=\"h-full w-full bg-gray-800 flex items-center justify-center\">\r\n                          <span className=\"material-symbols-outlined text-6xl text-gray-700\">image_not_supported</span>\r\n                        </div>\r\n                      )}\r\n                      <div className=\"absolute top-3 right-3 flex flex-col gap-2 items-end\">\r\n                        {reservation.status === 'ready' && (\r\n                          <div className=\"bg-emerald-500/90 backdrop-blur-md px-2 py-1 rounded text-xs font-bold text-white border border-emerald-400/50\">\r\n                            Ready for Pickup\r\n                          </div>\r\n                        )}\r\n                        {reservation.queuePosition && reservation.status === 'pending' && (\r\n                          <div className=\"bg-black/60 backdrop-blur-md px-2 py-1 rounded text-xs font-bold text-white border border-white/10\">\r\n                            Queue #{reservation.queuePosition}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"absolute bottom-3 left-4 right-4\">\r\n                        <h3 className=\"text-white font-bold text-xl leading-snug drop-shadow-md\">\r\n                          {reservation.book?.title || 'Unknown Book'}\r\n                        </h3>\r\n                        <p className=\"text-text-secondary text-sm drop-shadow-sm\">\r\n                          {reservation.book?.author || 'Unknown Author'}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"p-5 flex flex-col flex-1 gap-4\">\r\n                      <div className=\"flex flex-col gap-2\">\r\n                        <div className=\"flex items-center justify-between text-xs text-text-secondary\">\r\n                          <span className=\"flex items-center gap-1\">\r\n                            <span className=\"material-symbols-outlined text-[14px]\">calendar_today</span>\r\n                            Requested {formatTimeAgo(reservation.reservedDate)}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"bg-surface-dark/50 p-3 rounded-lg border border-[#553267]/50\">\r\n                          <div className=\"flex items-start gap-2\">\r\n                            <span className=\"material-symbols-outlined text-primary text-[18px] mt-0.5\">person</span>\r\n                            <div className=\"flex-1\">\r\n                              <p className=\"text-sm text-white font-medium\">{reservation.member?.name || 'Unknown Member'}</p>\r\n                              <p className=\"text-xs text-text-secondary mt-1\">{reservation.member?.email || ''}</p>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"mt-auto flex gap-3 pt-2\">\r\n                        {reservation.status === 'pending' && (\r\n                          <>\r\n                            <button\r\n                              onClick={() => handleMarkReady(reservation._id, reservation.book?._id)}\r\n                              disabled={processing}\r\n                              className=\"flex-1 bg-primary hover:bg-primary-hover text-white py-2.5 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors disabled:opacity-50\"\r\n                            >\r\n                              <span className=\"material-symbols-outlined text-[18px]\">check</span>\r\n                              Mark Ready\r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleCancelReservation(reservation._id)}\r\n                              disabled={processing}\r\n                              className=\"flex-1 bg-transparent border border-[#553267] hover:bg-red-500/20 hover:border-red-500 text-white py-2.5 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors disabled:opacity-50\"\r\n                            >\r\n                              <span className=\"material-symbols-outlined text-[18px]\">close</span>\r\n                              Cancel\r\n                            </button>\r\n                          </>\r\n                        )}\r\n                        {reservation.status === 'ready' && (\r\n                          <>\r\n                            <button\r\n                              onClick={() => handleCompleteReservation(reservation._id)}\r\n                              disabled={processing}\r\n                              className=\"flex-1 bg-primary hover:bg-primary-hover text-white py-2.5 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors disabled:opacity-50\"\r\n                            >\r\n                              <span className=\"material-symbols-outlined text-[18px]\">check</span>\r\n                              Complete\r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleCancelReservation(reservation._id)}\r\n                              disabled={processing}\r\n                              className=\"flex-1 bg-transparent border border-[#553267] hover:bg-red-500/20 hover:border-red-500 text-white py-2.5 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors disabled:opacity-50\"\r\n                            >\r\n                              <span className=\"material-symbols-outlined text-[18px]\">close</span>\r\n                              Cancel\r\n                            </button>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Acquisitions Tab Content */}\r\n          {activeTab === 'acquisitions' && (\r\n            <div className=\"py-12 text-center text-white/40\">\r\n              <p className=\"text-lg mb-2\">Acquisition Requests</p>\r\n              <p className=\"text-sm\">This feature is coming soon. You'll be able to manage book acquisition requests here.</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\librarian\\settings\\page.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":274,"column":23,"nodeType":"JSXOpeningElement","endLine":281,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport LibrarianHeader from '@/components/LibrarianHeader';\r\nimport { showSuccess, showError, showLoading, close } from '@/lib/swal';\r\nimport Loader from '@/components/Loader';\r\nimport { LOCATION_DATA } from '@/lib/locationData';\r\n\r\nexport default function LibrarianSettingsPage() {\r\n  const { user, userData } = useAuth();\r\n  const [activeTab, setActiveTab] = useState('profile');\r\n  const [loading, setLoading] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [activityLogs, setActivityLogs] = useState([]);\r\n  const [activityLoading, setActivityLoading] = useState(false);\r\n\r\n  // Profile form data\r\n  const [profileData, setProfileData] = useState({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    profilePhoto: null,\r\n    profilePhotoPreview: null,\r\n    address: {\r\n      division: '',\r\n      city: '',\r\n      area: '',\r\n      landmark: '',\r\n    },\r\n  });\r\n\r\n  // Preferences\r\n  const [preferences, setPreferences] = useState({\r\n    itemsPerPage: 20,\r\n    autoRefreshInterval: 30,\r\n    emailNotifications: {\r\n      overdueAlerts: true,\r\n      newMembers: true,\r\n      highPriorityRequests: true,\r\n      systemMaintenance: true,\r\n    },\r\n    inAppNotifications: true,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (userData) {\r\n      setProfileData({\r\n        name: userData.name || '',\r\n        email: userData.email || '',\r\n        phone: userData.phone || '',\r\n        profilePhoto: null,\r\n        profilePhotoPreview: userData.profilePhoto || null,\r\n        address: {\r\n          division: userData.address?.division || '',\r\n          city: userData.address?.city || '',\r\n          area: userData.address?.area || '',\r\n          landmark: userData.address?.landmark || '',\r\n        },\r\n      });\r\n    }\r\n\r\n    // Load preferences from localStorage\r\n    const savedPreferences = localStorage.getItem('librarianPreferences');\r\n    if (savedPreferences) {\r\n      try {\r\n        setPreferences(JSON.parse(savedPreferences));\r\n      } catch (error) {\r\n        console.error('Error loading preferences:', error);\r\n      }\r\n    }\r\n  }, [userData]);\r\n\r\n  useEffect(() => {\r\n    if (activeTab === 'activity') {\r\n      fetchActivityLogs();\r\n    }\r\n  }, [activeTab]);\r\n\r\n  const fetchActivityLogs = async () => {\r\n    try {\r\n      setActivityLoading(true);\r\n      const response = await fetch('/api/librarian/activity');\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setActivityLogs(data.activities || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching activity logs:', error);\r\n    } finally {\r\n      setActivityLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleProfileChange = (field, value) => {\r\n    if (field.startsWith('address.')) {\r\n      const addressField = field.split('.')[1];\r\n      setProfileData((prev) => ({\r\n        ...prev,\r\n        address: {\r\n          ...prev.address,\r\n          [addressField]: value,\r\n        },\r\n      }));\r\n    } else {\r\n      setProfileData((prev) => ({\r\n        ...prev,\r\n        [field]: value,\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleFileChange = async (e) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      showError('Invalid file type', 'Please upload a valid image file (JPG, PNG, or WEBP)');\r\n      return;\r\n    }\r\n\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      showError('File too large', 'Image must be less than 5MB');\r\n      return;\r\n    }\r\n\r\n    // Upload image\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    try {\r\n      setLoading(true);\r\n      const uploadResponse = await fetch('/api/upload', {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n\r\n      if (uploadResponse.ok) {\r\n        const uploadData = await uploadResponse.json();\r\n        setProfileData((prev) => ({\r\n          ...prev,\r\n          profilePhoto: uploadData.url,\r\n          profilePhotoPreview: uploadData.url,\r\n        }));\r\n        showSuccess('Image uploaded', 'Profile photo updated');\r\n      } else {\r\n        showError('Upload failed', 'Failed to upload image');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error uploading image:', error);\r\n      showError('Error', 'Failed to upload image');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSaveProfile = async () => {\r\n    try {\r\n      setSaving(true);\r\n      const updateData = {\r\n        name: profileData.name,\r\n        phone: profileData.phone,\r\n        address: profileData.address,\r\n      };\r\n\r\n      if (profileData.profilePhoto) {\r\n        updateData.profilePhoto = profileData.profilePhoto;\r\n      }\r\n\r\n      // Get firebaseUid from user object or userData\r\n      const firebaseUid = user?.uid || userData?.firebaseUid;\r\n      if (!firebaseUid) {\r\n        showError('Error', 'User ID not found');\r\n        return;\r\n      }\r\n\r\n      const response = await fetch(`/api/users/${firebaseUid}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(updateData),\r\n      });\r\n\r\n      if (response.ok) {\r\n        showSuccess('Profile Updated', 'Your profile has been updated successfully');\r\n        // Refresh user data\r\n        window.location.reload();\r\n      } else {\r\n        const error = await response.json();\r\n        showError('Update Failed', error.error || 'Failed to update profile');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating profile:', error);\r\n      showError('Error', 'Failed to update profile');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleSavePreferences = async () => {\r\n    try {\r\n      setSaving(true);\r\n      // Store preferences in localStorage for now (could be moved to API)\r\n      localStorage.setItem('librarianPreferences', JSON.stringify(preferences));\r\n      showSuccess('Preferences Saved', 'Your preferences have been saved');\r\n    } catch (error) {\r\n      console.error('Error saving preferences:', error);\r\n      showError('Error', 'Failed to save preferences');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const getAvailableCities = () => {\r\n    if (!profileData.address.division) return [];\r\n    return LOCATION_DATA[profileData.address.division] || {};\r\n  };\r\n\r\n  const getAvailableAreas = () => {\r\n    if (!profileData.address.city) return [];\r\n    const cities = getAvailableCities();\r\n    return cities[profileData.address.city] || [];\r\n  };\r\n\r\n  const getInitials = (name) => {\r\n    if (!name) return 'U';\r\n    const parts = name.split(' ');\r\n    if (parts.length >= 2) {\r\n      return (parts[0][0] + parts[1][0]).toUpperCase();\r\n    }\r\n    return name[0].toUpperCase();\r\n  };\r\n\r\n  const tabs = [\r\n    { id: 'profile', label: 'Profile', icon: 'person' },\r\n    { id: 'preferences', label: 'Preferences', icon: 'settings' },\r\n    { id: 'activity', label: 'Activity', icon: 'history' },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <LibrarianHeader title=\"Settings\" subtitle=\"Manage your account and preferences\" />\r\n      <div className=\"flex-1 overflow-y-auto p-6 md:p-8\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          {/* Tabs */}\r\n          <div className=\"flex gap-2 mb-8 border-b border-white/5\">\r\n            {tabs.map((tab) => (\r\n              <button\r\n                key={tab.id}\r\n                onClick={() => setActiveTab(tab.id)}\r\n                className={`px-6 py-3 flex items-center gap-2 font-medium text-sm transition-all border-b-2 ${\r\n                  activeTab === tab.id\r\n                    ? 'text-primary border-primary'\r\n                    : 'text-white/50 border-transparent hover:text-white/80 hover:border-white/20'\r\n                }`}\r\n              >\r\n                <span className=\"material-symbols-outlined text-[20px]\">{tab.icon}</span>\r\n                {tab.label}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Profile Tab */}\r\n          {activeTab === 'profile' && (\r\n            <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 md:p-8 shadow-lg\">\r\n              <h3 className=\"text-white text-xl font-bold mb-6\">Profile Information</h3>\r\n              \r\n              {/* Profile Photo */}\r\n              <div className=\"mb-8\">\r\n                <label className=\"text-white/80 text-sm font-medium mb-3 block\">Profile Photo</label>\r\n                <div className=\"flex items-center gap-6\">\r\n                  <div className=\"size-24 rounded-full bg-surface-dark border-2 border-white/10 overflow-hidden bg-gradient-to-br from-primary/20 to-purple-500/20\">\r\n                    {profileData.profilePhotoPreview ? (\r\n                      <img\r\n                        src={profileData.profilePhotoPreview}\r\n                        alt={profileData.name}\r\n                        className=\"w-full h-full object-cover\"\r\n                        onError={(e) => {\r\n                          e.target.style.display = 'none';\r\n                        }}\r\n                      />\r\n                    ) : null}\r\n                    {!profileData.profilePhotoPreview && (\r\n                      <div className=\"w-full h-full flex items-center justify-center text-white text-2xl font-bold\">\r\n                        {getInitials(profileData.name)}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex flex-col gap-2\">\r\n                    <label className=\"cursor-pointer\">\r\n                      <input\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        onChange={handleFileChange}\r\n                        className=\"hidden\"\r\n                        disabled={loading}\r\n                      />\r\n                      <span className=\"inline-flex items-center gap-2 px-4 py-2 bg-primary/20 hover:bg-primary/30 text-primary border border-primary/30 rounded-lg text-sm font-medium transition-colors\">\r\n                        <span className=\"material-symbols-outlined text-[18px]\">upload</span>\r\n                        {loading ? 'Uploading...' : 'Change Photo'}\r\n                      </span>\r\n                    </label>\r\n                    {profileData.profilePhotoPreview && (\r\n                      <button\r\n                        onClick={() => {\r\n                          setProfileData((prev) => ({\r\n                            ...prev,\r\n                            profilePhoto: null,\r\n                            profilePhotoPreview: null,\r\n                          }));\r\n                        }}\r\n                        className=\"inline-flex items-center gap-2 px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-500/30 rounded-lg text-sm font-medium transition-colors\"\r\n                      >\r\n                        <span className=\"material-symbols-outlined text-[18px]\">delete</span>\r\n                        Remove\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Name */}\r\n              <div className=\"mb-6\">\r\n                <label className=\"text-white/80 text-sm font-medium mb-2 block\">Full Name</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={profileData.name}\r\n                  onChange={(e) => handleProfileChange('name', e.target.value)}\r\n                  className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\"\r\n                  placeholder=\"Enter your full name\"\r\n                />\r\n              </div>\r\n\r\n              {/* Email (Read-only) */}\r\n              <div className=\"mb-6\">\r\n                <label className=\"text-white/80 text-sm font-medium mb-2 block\">Email Address</label>\r\n                <input\r\n                  type=\"email\"\r\n                  value={profileData.email}\r\n                  disabled\r\n                  className=\"w-full bg-surface-dark/50 border border-white/5 text-white/50 rounded-lg px-4 py-3 cursor-not-allowed\"\r\n                />\r\n                <p className=\"text-white/40 text-xs mt-1\">Email cannot be changed</p>\r\n              </div>\r\n\r\n              {/* Phone */}\r\n              <div className=\"mb-6\">\r\n                <label className=\"text-white/80 text-sm font-medium mb-2 block\">Phone Number</label>\r\n                <input\r\n                  type=\"tel\"\r\n                  value={profileData.phone}\r\n                  onChange={(e) => handleProfileChange('phone', e.target.value)}\r\n                  className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\"\r\n                  placeholder=\"Enter your phone number\"\r\n                />\r\n              </div>\r\n\r\n              {/* Address */}\r\n              <div className=\"mb-6\">\r\n                <label className=\"text-white/80 text-sm font-medium mb-4 block\">Address</label>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"text-white/60 text-xs mb-2 block\">Division</label>\r\n                    <div className=\"relative\">\r\n                      <select\r\n                        value={profileData.address.division}\r\n                        onChange={(e) => {\r\n                          handleProfileChange('address.division', e.target.value);\r\n                          handleProfileChange('address.city', '');\r\n                          handleProfileChange('address.area', '');\r\n                        }}\r\n                        className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none cursor-pointer\"\r\n                      >\r\n                        <option value=\"\">Select Division</option>\r\n                        {Object.keys(LOCATION_DATA).map((division) => (\r\n                          <option key={division} value={division}>{division}</option>\r\n                        ))}\r\n                      </select>\r\n                      <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-white/50 pointer-events-none\">expand_more</span>\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-white/60 text-xs mb-2 block\">City</label>\r\n                    <div className=\"relative\">\r\n                      <select\r\n                        value={profileData.address.city}\r\n                        onChange={(e) => {\r\n                          handleProfileChange('address.city', e.target.value);\r\n                          handleProfileChange('address.area', '');\r\n                        }}\r\n                        disabled={!profileData.address.division}\r\n                        className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                      >\r\n                        <option value=\"\">Select City</option>\r\n                        {Object.keys(getAvailableCities()).map((city) => (\r\n                          <option key={city} value={city}>{city}</option>\r\n                        ))}\r\n                      </select>\r\n                      <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-white/50 pointer-events-none\">expand_more</span>\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-white/60 text-xs mb-2 block\">Area (Thana)</label>\r\n                    <div className=\"relative\">\r\n                      <select\r\n                        value={profileData.address.area}\r\n                        onChange={(e) => handleProfileChange('address.area', e.target.value)}\r\n                        disabled={!profileData.address.city}\r\n                        className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                      >\r\n                        <option value=\"\">Select Area</option>\r\n                        {getAvailableAreas().map((area) => (\r\n                          <option key={area} value={area}>{area}</option>\r\n                        ))}\r\n                      </select>\r\n                      <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-white/50 pointer-events-none\">expand_more</span>\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-white/60 text-xs mb-2 block\">Landmark</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={profileData.address.landmark}\r\n                      onChange={(e) => handleProfileChange('address.landmark', e.target.value)}\r\n                      className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\"\r\n                      placeholder=\"e.g. Near Public Library\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Save Button */}\r\n              <div className=\"flex justify-end gap-3 pt-4 border-t border-white/5\">\r\n                <button\r\n                  onClick={handleSaveProfile}\r\n                  disabled={saving}\r\n                  className=\"px-6 py-2.5 bg-primary hover:bg-primary-hover text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                >\r\n                  {saving ? (\r\n                    <>\r\n                      <Loader />\r\n                      Saving...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <span className=\"material-symbols-outlined text-[18px]\">save</span>\r\n                      Save Changes\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Preferences Tab */}\r\n          {activeTab === 'preferences' && (\r\n            <div className=\"space-y-6\">\r\n              {/* Dashboard Preferences */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 md:p-8 shadow-lg\">\r\n                <h3 className=\"text-white text-xl font-bold mb-6\">Dashboard Preferences</h3>\r\n                \r\n                <div className=\"space-y-6\">\r\n                  <div>\r\n                    <label className=\"text-white/80 text-sm font-medium mb-2 block\">Items Per Page</label>\r\n                    <select\r\n                      value={preferences.itemsPerPage}\r\n                      onChange={(e) => setPreferences((prev) => ({ ...prev, itemsPerPage: parseInt(e.target.value) }))}\r\n                      className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\"\r\n                    >\r\n                      <option value={10}>10</option>\r\n                      <option value={20}>20</option>\r\n                      <option value={50}>50</option>\r\n                      <option value={100}>100</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"text-white/80 text-sm font-medium mb-2 block\">Auto-Refresh Interval (seconds)</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"10\"\r\n                      max=\"300\"\r\n                      value={preferences.autoRefreshInterval}\r\n                      onChange={(e) => setPreferences((prev) => ({ ...prev, autoRefreshInterval: parseInt(e.target.value) || 30 }))}\r\n                      className=\"w-full bg-surface-dark border border-white/5 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\"\r\n                    />\r\n                    <p className=\"text-white/40 text-xs mt-1\">Stats will auto-refresh every {preferences.autoRefreshInterval} seconds</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Notification Preferences */}\r\n              <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 md:p-8 shadow-lg\">\r\n                <h3 className=\"text-white text-xl font-bold mb-6\">Notification Preferences</h3>\r\n                \r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex items-center justify-between p-4 bg-surface-dark/50 rounded-lg border border-white/5\">\r\n                    <div>\r\n                      <p className=\"text-white font-medium\">Email Notifications</p>\r\n                      <p className=\"text-white/50 text-sm\">Receive notifications via email</p>\r\n                    </div>\r\n                    <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={preferences.emailNotifications.overdueAlerts}\r\n                        onChange={(e) => setPreferences((prev) => ({\r\n                          ...prev,\r\n                          emailNotifications: {\r\n                            ...prev.emailNotifications,\r\n                            overdueAlerts: e.target.checked,\r\n                          },\r\n                        }))}\r\n                        className=\"sr-only peer\"\r\n                      />\r\n                      <div className=\"w-11 h-6 bg-white/10 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary\"></div>\r\n                    </label>\r\n                  </div>\r\n\r\n                  <div className=\"pl-6 space-y-3 border-l-2 border-primary/20\">\r\n                    <label className=\"flex items-center gap-3 cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={preferences.emailNotifications.overdueAlerts}\r\n                        onChange={(e) => setPreferences((prev) => ({\r\n                          ...prev,\r\n                          emailNotifications: {\r\n                            ...prev.emailNotifications,\r\n                            overdueAlerts: e.target.checked,\r\n                          },\r\n                        }))}\r\n                        className=\"w-4 h-4 rounded border-white/20 bg-surface-dark text-primary focus:ring-primary focus:ring-2\"\r\n                      />\r\n                      <span className=\"text-white/80\">Overdue book alerts</span>\r\n                    </label>\r\n                    <label className=\"flex items-center gap-3 cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={preferences.emailNotifications.newMembers}\r\n                        onChange={(e) => setPreferences((prev) => ({\r\n                          ...prev,\r\n                          emailNotifications: {\r\n                            ...prev.emailNotifications,\r\n                            newMembers: e.target.checked,\r\n                          },\r\n                        }))}\r\n                        className=\"w-4 h-4 rounded border-white/20 bg-surface-dark text-primary focus:ring-primary focus:ring-2\"\r\n                      />\r\n                      <span className=\"text-white/80\">New member registrations</span>\r\n                    </label>\r\n                    <label className=\"flex items-center gap-3 cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={preferences.emailNotifications.highPriorityRequests}\r\n                        onChange={(e) => setPreferences((prev) => ({\r\n                          ...prev,\r\n                          emailNotifications: {\r\n                            ...prev.emailNotifications,\r\n                            highPriorityRequests: e.target.checked,\r\n                          },\r\n                        }))}\r\n                        className=\"w-4 h-4 rounded border-white/20 bg-surface-dark text-primary focus:ring-primary focus:ring-2\"\r\n                      />\r\n                      <span className=\"text-white/80\">High-priority requests</span>\r\n                    </label>\r\n                    <label className=\"flex items-center gap-3 cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={preferences.emailNotifications.systemMaintenance}\r\n                        onChange={(e) => setPreferences((prev) => ({\r\n                          ...prev,\r\n                          emailNotifications: {\r\n                            ...prev.emailNotifications,\r\n                            systemMaintenance: e.target.checked,\r\n                          },\r\n                        }))}\r\n                        className=\"w-4 h-4 rounded border-white/20 bg-surface-dark text-primary focus:ring-primary focus:ring-2\"\r\n                      />\r\n                      <span className=\"text-white/80\">System maintenance notices</span>\r\n                    </label>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center justify-between p-4 bg-surface-dark/50 rounded-lg border border-white/5 mt-4\">\r\n                    <div>\r\n                      <p className=\"text-white font-medium\">In-App Notifications</p>\r\n                      <p className=\"text-white/50 text-sm\">Show notifications in the application</p>\r\n                    </div>\r\n                    <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={preferences.inAppNotifications}\r\n                        onChange={(e) => setPreferences((prev) => ({ ...prev, inAppNotifications: e.target.checked }))}\r\n                        className=\"sr-only peer\"\r\n                      />\r\n                      <div className=\"w-11 h-6 bg-white/10 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary\"></div>\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex justify-end gap-3 pt-6 mt-6 border-t border-white/5\">\r\n                  <button\r\n                    onClick={handleSavePreferences}\r\n                    disabled={saving}\r\n                    className=\"px-6 py-2.5 bg-primary hover:bg-primary-hover text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                  >\r\n                    {saving ? (\r\n                      <>\r\n                        <Loader />\r\n                        Saving...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <span className=\"material-symbols-outlined text-[18px]\">save</span>\r\n                        Save Preferences\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Activity Tab */}\r\n          {activeTab === 'activity' && (\r\n            <div className=\"bg-card-dark rounded-2xl border border-white/5 p-6 md:p-8 shadow-lg\">\r\n              <div className=\"flex justify-between items-center mb-6\">\r\n                <h3 className=\"text-white text-xl font-bold\">Activity Log</h3>\r\n                <button\r\n                  onClick={fetchActivityLogs}\r\n                  className=\"px-4 py-2 bg-white/5 hover:bg-white/10 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2\"\r\n                >\r\n                  <span className=\"material-symbols-outlined text-[18px]\">refresh</span>\r\n                  Refresh\r\n                </button>\r\n              </div>\r\n\r\n              {activityLoading ? (\r\n                <div className=\"py-12 text-center\">\r\n                  <Loader />\r\n                </div>\r\n              ) : activityLogs.length === 0 ? (\r\n                <div className=\"py-12 text-center text-white/40\">\r\n                  <span className=\"material-symbols-outlined text-5xl mb-4 block\">history</span>\r\n                  <p>No activity logs found</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {activityLogs.map((log) => (\r\n                    <div\r\n                      key={log._id}\r\n                      className=\"p-4 bg-surface-dark/50 rounded-lg border border-white/5 hover:border-primary/20 transition-colors\"\r\n                    >\r\n                      <div className=\"flex items-start justify-between gap-4\">\r\n                        <div className=\"flex-1\">\r\n                          <p className=\"text-white font-medium\">{log.action}</p>\r\n                          <p className=\"text-white/50 text-sm mt-1\">{log.description}</p>\r\n                          <p className=\"text-white/30 text-xs mt-2\">\r\n                            {new Date(log.timestamp).toLocaleString('en-US', {\r\n                              year: 'numeric',\r\n                              month: 'short',\r\n                              day: 'numeric',\r\n                              hour: '2-digit',\r\n                              minute: '2-digit',\r\n                            })}\r\n                          </p>\r\n                        </div>\r\n                        <span className={`px-2 py-1 rounded text-xs font-medium ${\r\n                          log.type === 'checkout' ? 'bg-emerald-500/20 text-emerald-400' :\r\n                          log.type === 'return' ? 'bg-blue-500/20 text-blue-400' :\r\n                          log.type === 'renew' ? 'bg-purple-500/20 text-purple-400' :\r\n                          'bg-white/10 text-white/70'\r\n                        }`}>\r\n                          {log.type}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\login\\layout.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\login\\page.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":268,"column":9,"nodeType":"JSXOpeningElement","endLine":272,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { getRoleOverviewRoute } from '@/lib/utils';\nimport Loader from '@/components/Loader';\n\nexport default function LoginPage() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const { signIn, signInWithGoogle } = useAuth();\n  const router = useRouter();\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setError('');\n    setLoading(true);\n\n    try {\n      const result = await signIn(email, password);\n      \n      if (result.success) {\n        // Fetch user data to get role for navigation\n        try {\n          let response = await fetch(`/api/users?firebaseUid=${result.user.uid}`);\n          \n          // If user doesn't exist in MongoDB, create them automatically\n          if (response.status === 404) {\n            const createResponse = await fetch('/api/users', {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify({\n                firebaseUid: result.user.uid,\n                email: result.user.email?.toLowerCase().trim() || result.user.email,\n                name: (result.user.displayName || result.user.email?.split('@')[0] || 'User').trim(),\n                profilePhoto: result.user.photoURL || null,\n                role: 'member',\n                subscription: {\n                  type: 'free',\n                  status: 'active',\n                },\n              }),\n            });\n            \n            if (createResponse.ok) {\n              const newUserData = await createResponse.json();\n              // API returns { message, user } structure\n              // Handle both \"created\" (201) and \"already exists\" (200) cases\n              const user = newUserData.user || newUserData;\n              const role = user?.role || 'member';\n              router.push(getRoleOverviewRoute(role));\n            } else {\n              // If creation fails, try to fetch user anyway\n              const errorData = await createResponse.json().catch(() => ({}));\n              console.error('[Login] Failed to create user in MongoDB');\n              console.error('[Login] Error details:', errorData);\n              \n              // Try to fetch user as fallback\n              const fetchResponse = await fetch(`/api/users?firebaseUid=${result.user.uid}`);\n              if (fetchResponse.ok) {\n                const userData = await fetchResponse.json();\n                const role = userData.role || 'member';\n                const returnUrl = sessionStorage.getItem('returnAfterLogin');\n                if (returnUrl) {\n                  sessionStorage.removeItem('returnAfterLogin');\n                  router.push(returnUrl);\n                } else {\n                  router.push(getRoleOverviewRoute(role));\n                }\n              } else {\n                const returnUrl = sessionStorage.getItem('returnAfterLogin');\n                if (returnUrl) {\n                  sessionStorage.removeItem('returnAfterLogin');\n                  router.push(returnUrl);\n                } else {\n                  router.push('/member/overview');\n                }\n              }\n            }\n          } else if (response.ok) {\n            const userData = await response.json();\n            const role = userData.role || 'member';\n            // Check if there's a return URL after login\n            const returnUrl = sessionStorage.getItem('returnAfterLogin');\n            if (returnUrl) {\n              sessionStorage.removeItem('returnAfterLogin');\n              router.push(returnUrl);\n            } else {\n              // Navigate to role-based overview page\n              router.push(getRoleOverviewRoute(role));\n            }\n          } else {\n            // Other error - still navigate to member overview\n            console.error('[Login] Error fetching user data, status:', response.status);\n            const errorText = await response.text().catch(() => 'Unknown error');\n            console.error('[Login] Error response:', errorText);\n            const returnUrl = sessionStorage.getItem('returnAfterLogin');\n            if (returnUrl) {\n              sessionStorage.removeItem('returnAfterLogin');\n              router.push(returnUrl);\n            } else {\n              router.push('/member/overview');\n            }\n          }\n        } catch (error) {\n          console.error('[Login] Error fetching user data:', error);\n          console.error('[Login] Error stack:', error.stack);\n          // Check if there's a return URL after login\n          const returnUrl = sessionStorage.getItem('returnAfterLogin');\n          if (returnUrl) {\n            sessionStorage.removeItem('returnAfterLogin');\n            router.push(returnUrl);\n          } else {\n            // Fallback to member overview on error\n            router.push('/member/overview');\n          }\n        }\n        // Don't set loading to false here - navigation will handle it\n      } else {\n        // Display the user-friendly error message from AuthContext\n        setError(result.error || 'Failed to sign in. Please try again.');\n        setLoading(false);\n      }\n    } catch (error) {\n      console.error('Login error:', error);\n      setError('An unexpected error occurred. Please try again.');\n      setLoading(false);\n    }\n  };\n\n  const handleGoogleSignIn = async () => {\n    setError('');\n    setLoading(true);\n\n    try {\n      const result = await signInWithGoogle();\n      \n      if (result.success) {\n        // Check if user exists in MongoDB, if not create them automatically\n        try {\n          let response = await fetch(`/api/users?firebaseUid=${result.user.uid}`);\n          \n          // If user doesn't exist in MongoDB, create them automatically\n          if (response.status === 404) {\n            const createResponse = await fetch('/api/users', {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify({\n                firebaseUid: result.user.uid,\n                email: result.user.email?.toLowerCase().trim() || result.user.email,\n                name: (result.user.displayName || result.user.email?.split('@')[0] || 'User').trim(),\n                profilePhoto: result.user.photoURL || null,\n                role: 'member',\n                subscription: {\n                  type: 'free',\n                  status: 'active',\n                },\n              }),\n            });\n            \n            if (createResponse.ok) {\n              const newUserData = await createResponse.json();\n              // API returns { message, user } structure\n              // Handle both \"created\" (201) and \"already exists\" (200) cases\n              const user = newUserData.user || newUserData;\n              const role = user?.role || 'member';\n              const returnUrl = sessionStorage.getItem('returnAfterLogin');\n              if (returnUrl) {\n                sessionStorage.removeItem('returnAfterLogin');\n                router.push(returnUrl);\n              } else {\n                router.push(getRoleOverviewRoute(role));\n              }\n            } else {\n              // Log the error details for debugging\n              try {\n                const errorData = await createResponse.json();\n                console.error('[Google Login] User creation failed:', errorData);\n              } catch (e) {\n                console.error('[Google Login] User creation failed with status:', createResponse.status, 'Could not parse error response');\n              }\n              \n              // If creation fails, try to fetch user anyway in case they exist\n              // (user might have been created by another request or already exists)\n              const fetchResponse = await fetch(`/api/users?firebaseUid=${result.user.uid}`);\n              if (fetchResponse.ok) {\n                const userData = await fetchResponse.json();\n                const role = userData.role || 'member';\n                const returnUrl = sessionStorage.getItem('returnAfterLogin');\n                if (returnUrl) {\n                  sessionStorage.removeItem('returnAfterLogin');\n                  router.push(returnUrl);\n                } else {\n                  router.push(getRoleOverviewRoute(role));\n                }\n              } else {\n                // If Firebase auth succeeded but user creation/lookup failed,\n                // still redirect to member dashboard since user is authenticated\n                // The user can complete their profile later if needed\n                const returnUrl = sessionStorage.getItem('returnAfterLogin');\n                if (returnUrl) {\n                  sessionStorage.removeItem('returnAfterLogin');\n                  router.push(returnUrl);\n                } else {\n                  router.push('/member/overview');\n                }\n              }\n            }\n          } else if (response.ok) {\n            // Fetch user data to get role for navigation\n            const userData = await response.json();\n            const role = userData.role || 'member';\n            const returnUrl = sessionStorage.getItem('returnAfterLogin');\n            if (returnUrl) {\n              sessionStorage.removeItem('returnAfterLogin');\n              router.push(returnUrl);\n            } else {\n              router.push(getRoleOverviewRoute(role));\n            }\n          } else {\n            // Other error - if Firebase auth succeeded, redirect to dashboard anyway\n            console.error('[Google Login] Error fetching user data, status:', response.status);\n            // Since Firebase authentication succeeded, redirect to member dashboard\n            // User can complete profile later if needed\n            const returnUrl = sessionStorage.getItem('returnAfterLogin');\n            if (returnUrl) {\n              sessionStorage.removeItem('returnAfterLogin');\n              router.push(returnUrl);\n            } else {\n              router.push('/member/overview');\n            }\n          }\n        } catch (error) {\n          console.error('[Google Login] Error checking user:', error);\n          // Since Firebase authentication succeeded, redirect to member dashboard\n          // User can complete profile later if needed\n          const returnUrl = sessionStorage.getItem('returnAfterLogin');\n          if (returnUrl) {\n            sessionStorage.removeItem('returnAfterLogin');\n            router.push(returnUrl);\n          } else {\n            router.push('/member/overview');\n          }\n        }\n      } else {\n        setError(result.error || 'Failed to sign in with Google');\n        setLoading(false);\n      }\n    } catch (error) {\n      console.error('[Google Login] Unexpected error:', error);\n      setError('An unexpected error occurred. Please try again.');\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"bg-background-dark min-h-screen flex items-center justify-center relative overflow-hidden text-white transition-colors duration-300\">\n      {/* Background */}\n      <div className=\"absolute inset-0 z-0 overflow-hidden\">\n        <img\n          alt=\"Abstract blurred dark library bookshelf background\"\n          className=\"w-full h-full object-cover opacity-20 blur-sm scale-110\"\n          src=\"https://lh3.googleusercontent.com/aida-public/AB6AXuBrkBpYjLhjVBQK6K_A1QaUVbEISijO_-GU1oBHfIYBro1ARZUrc_1PmGPycfAMSKxGng9F-fVCW9iUQ-XIQGiZy_4ZQEfCUs6vQAOKMkTjWKJVSnVUUPmYcRyHYJuTph36eEw_-Bh9YiL1mn8aMnmExnNq8w_Teo5ttE_kctOCALUeNNLsIYo7XIE04KSz0yVZgyGoEdzPZ3-hcF7KOysKxL4AddZPanWOzeAdA1y6T4HnA9U-pgiVDVj1_u1bEO7NOFw3ve26JKg\"\n        />\n        <div className=\"absolute inset-0 bg-gradient-to-t from-background-dark via-background-dark/95 to-background-dark/80\"></div>\n        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-primary/20 rounded-full blur-[120px] pointer-events-none mix-blend-screen\"></div>\n      </div>\n\n      {/* Login Form */}\n      <main className=\"relative z-10 w-full max-w-[400px] px-4\">\n        <div className=\"glass-panel w-full rounded-2xl p-8 flex flex-col gap-6 relative\">\n          {/* Close Button */}\n          <Link\n            href=\"/\"\n            className=\"absolute top-4 right-4 z-20 flex items-center justify-center w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 border border-white/10 hover:border-primary/50 text-text-muted hover:text-white transition-all cursor-pointer\"\n            aria-label=\"Close and go to home\"\n          >\n            <span className=\"material-symbols-outlined\" style={{ fontSize: '24px' }}>\n              close\n            </span>\n          </Link>\n          \n          <div className=\"flex flex-col items-center text-center gap-1\">\n            <h1 className=\"text-3xl font-bold tracking-tight text-white drop-shadow-lg\">Bookflix</h1>\n            <p className=\"text-text-muted text-sm font-medium\">Welcome back to your digital library.</p>\n          </div>\n\n          {error && (\n            <div className=\"bg-red-500/20 border border-red-500/50 text-red-200 px-4 py-3 rounded-lg text-sm flex items-start gap-2\">\n              <span className=\"material-symbols-outlined flex-shrink-0\" style={{ fontSize: '20px' }}>\n                error\n              </span>\n              <span className=\"flex-1\">{error}</span>\n            </div>\n          )}\n\n          <form className=\"flex flex-col gap-4 mt-2\" onSubmit={handleSubmit}>\n            <div className=\"flex flex-col gap-1.5\">\n              <label className=\"text-xs font-semibold text-gray-300 uppercase tracking-wider ml-1\" htmlFor=\"email\">\n                Email\n              </label>\n              <div className=\"relative group\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <span className=\"material-symbols-outlined text-gray-500 group-focus-within:text-primary transition-colors text-[20px]\">\n                    mail\n                  </span>\n                </div>\n                <input\n                  className=\"w-full h-10 pl-10 pr-4 rounded-lg bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-transparent transition-all text-sm\"\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"user@library.edu\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  disabled={loading}\n                />\n              </div>\n            </div>\n\n            <div className=\"flex flex-col gap-1.5\">\n              <div className=\"flex justify-between items-center ml-1\">\n                <label className=\"text-xs font-semibold text-gray-300 uppercase tracking-wider\" htmlFor=\"password\">\n                  Password\n                </label>\n                <Link className=\"text-xs font-medium text-primary hover:text-primary/80 transition-colors\" href=\"#\">\n                  Forgot password?\n                </Link>\n              </div>\n              <div className=\"relative group\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <span className=\"material-symbols-outlined text-gray-500 group-focus-within:text-primary transition-colors text-[20px]\">\n                    lock\n                  </span>\n                </div>\n                <input\n                  className=\"w-full h-10 pl-10 pr-4 rounded-lg bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-transparent transition-all text-sm\"\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  disabled={loading}\n                />\n              </div>\n            </div>\n\n            <button\n              className=\"w-full h-10 mt-2 bg-primary hover:bg-primary-hover text-white font-semibold rounded-lg shadow-[0_0_15px_rgba(170,31,239,0.4)] hover:shadow-[0_0_20px_rgba(170,31,239,0.6)] transition-all transform active:scale-[0.98] flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\n              type=\"submit\"\n              disabled={loading}\n            >\n              {loading ? <Loader /> : 'Sign In'}\n            </button>\n          </form>\n\n          <div className=\"flex flex-col gap-3\">\n            <button\n              onClick={handleGoogleSignIn}\n              disabled={loading}\n              className=\"w-full h-10 flex items-center justify-center gap-3 bg-white text-slate-800 font-bold rounded-lg hover:bg-white/90 transition-all transform active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed shadow-lg\"\n              type=\"button\"\n            >\n              <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n                <path\n                  fill=\"#4285F4\"\n                  d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n                />\n                <path\n                  fill=\"#34A853\"\n                  d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n                />\n                <path\n                  fill=\"#FBBC05\"\n                  d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\n                />\n                <path\n                  fill=\"#EA4335\"\n                  d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n                />\n              </svg>\n              <span>Sign in with Google</span>\n            </button>\n\n            <div className=\"relative flex items-center py-1\">\n              <div className=\"flex-grow border-t border-white/10\"></div>\n              <span className=\"flex-shrink-0 mx-4 text-[10px] font-medium text-white/30 uppercase tracking-widest\">\n                Demo Accounts\n              </span>\n              <div className=\"flex-grow border-t border-white/10\"></div>\n            </div>\n\n            <div className=\"grid grid-cols-1 gap-2\">\n              <button\n                className=\"flex items-center justify-between px-4 h-10 rounded-lg bg-white/5 hover:bg-primary/10 border border-white/10 hover:border-primary/50 transition-all group disabled:opacity-50 disabled:cursor-not-allowed\"\n                onClick={() => {\n                  setEmail('demouser@gmail.com');\n                  setPassword('Password123');\n                  setTimeout(() => {\n                    const form = document.querySelector('form');\n                    form.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));\n                  }, 100);\n                }}\n                disabled={loading}\n                type=\"button\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  <span className=\"material-symbols-outlined text-gray-500 group-hover:text-primary transition-colors text-[20px]\">\n                    person\n                  </span>\n                  <span className=\"text-sm font-medium text-gray-300 group-hover:text-white transition-colors\">\n                    Demo User\n                  </span>\n                </div>\n                <span className=\"text-[10px] bg-white/5 px-2 py-0.5 rounded text-white/40 group-hover:text-primary/70 transition-colors uppercase tracking-wider\">Member</span>\n              </button>\n\n              <button\n                className=\"flex items-center justify-between px-4 h-10 rounded-lg bg-white/5 hover:bg-primary/10 border border-white/10 hover:border-primary/50 transition-all group disabled:opacity-50 disabled:cursor-not-allowed\"\n                onClick={() => {\n                  setEmail('demoadmin@gmail.com');\n                  setPassword('Password123');\n                  setTimeout(() => {\n                    const form = document.querySelector('form');\n                    form.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));\n                  }, 100);\n                }}\n                disabled={loading}\n                type=\"button\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  <span className=\"material-symbols-outlined text-gray-500 group-hover:text-primary transition-colors text-[20px]\">\n                    admin_panel_settings\n                  </span>\n                  <span className=\"text-sm font-medium text-gray-300 group-hover:text-white transition-colors\">\n                    Demo Admin\n                  </span>\n                </div>\n                <span className=\"text-[10px] bg-white/5 px-2 py-0.5 rounded text-white/40 group-hover:text-primary/70 transition-colors uppercase tracking-wider\">Admin</span>\n              </button>\n\n              <button\n                className=\"flex items-center justify-between px-4 h-10 rounded-lg bg-white/5 hover:bg-primary/10 border border-white/10 hover:border-primary/50 transition-all group disabled:opacity-50 disabled:cursor-not-allowed\"\n                onClick={() => {\n                  setEmail('demolibrarian@gmail.com');\n                  setPassword('Password123');\n                  setTimeout(() => {\n                    const form = document.querySelector('form');\n                    form.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));\n                  }, 100);\n                }}\n                disabled={loading}\n                type=\"button\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  <span className=\"material-symbols-outlined text-gray-500 group-hover:text-primary transition-colors text-[20px]\">\n                    local_library\n                  </span>\n                  <span className=\"text-sm font-medium text-gray-300 group-hover:text-white transition-colors\">\n                    Demo Librarian\n                  </span>\n                </div>\n                <span className=\"text-[10px] bg-white/5 px-2 py-0.5 rounded text-white/40 group-hover:text-primary/70 transition-colors uppercase tracking-wider\">Librarian</span>\n              </button>\n            </div>\n          </div>\n\n          <div className=\"text-center\">\n            <p className=\"text-sm text-text-muted\">\n              New to Bookflix?{' '}\n              <Link\n                className=\"font-semibold text-white hover:text-primary transition-colors hover:underline decoration-primary decoration-2 underline-offset-4\"\n                href=\"/register\"\n              >\n                Join Bookflix\n              </Link>\n            </p>\n          </div>\n        </div>\n\n        <div className=\"mt-8 text-center\">\n          <p className=\"text-xs text-white/20\">\n             2024 Bookflix Library Services. All rights reserved.\n          </p>\n        </div>\n      </main>\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\billing\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchFines', 'fetchPayments', 'fetchSubscription', and 'handleSubscriptionSuccess'. Either include them or remove the dependency array.","line":58,"column":6,"nodeType":"ArrayExpression","endLine":58,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [fetchFines, fetchPayments, fetchSubscription, handleSubscriptionSuccess, userData?._id]","fix":{"range":[2413,2428],"text":"[fetchFines, fetchPayments, fetchSubscription, handleSubscriptionSuccess, userData?._id]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchPayments', 'fetchSubscription', and 'refreshUserData'. Either include them or remove the dependency array.","line":106,"column":6,"nodeType":"ArrayExpression","endLine":106,"endColumn":93,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPayments, fetchSubscription, refreshUserData, userData._id, userData.subscription?.stripeCustomerId, userData.subscription.type]","fix":{"range":[4507,4594],"text":"[fetchPayments, fetchSubscription, refreshUserData, userData._id, userData.subscription?.stripeCustomerId, userData.subscription.type]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'createSubscriptionPayment' and 'userData?.subscription?.stripeCustomerId'. Either include them or remove the dependency array.","line":212,"column":6,"nodeType":"ArrayExpression","endLine":212,"endColumn":142,"suggestions":[{"desc":"Update the dependencies array to be: [userData?._id, subscription?.type, subscription?.status, userData?.subscription?.type, userData?.subscription?.status, payments.length, userData?.subscription?.stripeCustomerId, createSubscriptionPayment]","fix":{"range":[9039,9175],"text":"[userData?._id, subscription?.type, subscription?.status, userData?.subscription?.type, userData?.subscription?.status, payments.length, userData?.subscription?.stripeCustomerId, createSubscriptionPayment]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":876,"column":46,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[38716,38737],"text":"You&apos;re all caught up!"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[38716,38737],"text":"You&lsquo;re all caught up!"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[38716,38737],"text":"You&#39;re all caught up!"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[38716,38737],"text":"You&rsquo;re all caught up!"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState, useRef } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport Link from 'next/link';\r\nimport { isPremium, getSubscriptionDisplayName } from '@/lib/utils';\r\nimport { showConfirm, showSuccess, showError as showErrorAlert } from '@/lib/swal';\r\nimport Loader from '@/components/Loader';\r\nimport OptimizedImage from '@/components/OptimizedImage';\r\n\r\nexport default function BillingPage() {\r\n  const { userData, refreshUserData } = useAuth();\r\n  const [fines, setFines] = useState([]);\r\n  const [payments, setPayments] = useState([]);\r\n  const [subscription, setSubscription] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [processingPayment, setProcessingPayment] = useState(null);\r\n  const [processingSubscription, setProcessingSubscription] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [successMessage, setSuccessMessage] = useState(null);\r\n  const hasInitialized = useRef(false);\r\n  const syncTriggered = useRef(false);\r\n  const paymentSyncTriggered = useRef(false);\r\n\r\n  // Initial load - only run once when userData is available\r\n  useEffect(() => {\r\n    if (userData?._id && !hasInitialized.current) {\r\n      hasInitialized.current = true;\r\n      fetchFines();\r\n      fetchPayments();\r\n      fetchSubscription();\r\n\r\n      // Check for payment success/cancel in URL params\r\n      const params = new URLSearchParams(window.location.search);\r\n      if (params.get('payment_success') === 'true') {\r\n        showSuccess('Payment Successful', 'Your payment has been processed successfully.');\r\n        // Refresh data\r\n        setTimeout(() => {\r\n          fetchFines();\r\n          fetchPayments();\r\n          window.history.replaceState({}, '', window.location.pathname);\r\n        }, 1000);\r\n      }\r\n      if (params.get('payment_cancelled') === 'true') {\r\n        setError('Payment was cancelled.');\r\n        window.history.replaceState({}, '', window.location.pathname);\r\n      }\r\n      if (params.get('subscription_success') === 'true') {\r\n        const plan = params.get('plan') || 'monthly';\r\n        handleSubscriptionSuccess(plan);\r\n      }\r\n      if (params.get('subscription_cancelled') === 'true') {\r\n        setError('Subscription checkout was cancelled.');\r\n        // Clear URL params\r\n        window.history.replaceState({}, '', window.location.pathname);\r\n      }\r\n    }\r\n  }, [userData?._id]);\r\n\r\n  // Auto-sync subscription if user has Stripe customer ID but subscription shows as free\r\n  // This handles cases where webhook didn't process\r\n  useEffect(() => {\r\n    if (userData?._id && !syncTriggered.current) {\r\n      const shouldSync = (userData?.subscription?.stripeCustomerId && \r\n          (!userData?.subscription?.type || userData.subscription.type === 'free')) ||\r\n          // Check if we're coming from a successful checkout\r\n          (window.location.search.includes('subscription_success'));\r\n          \r\n      if (shouldSync) {\r\n        syncTriggered.current = true;\r\n        console.log('[Billing] Attempting auto-sync...', {\r\n          hasCustomerId: !!userData?.subscription?.stripeCustomerId,\r\n          subscriptionType: userData?.subscription?.type,\r\n          hasSuccessParam: window.location.search.includes('subscription_success')\r\n        });\r\n        // Delay sync slightly to avoid race conditions\r\n        setTimeout(async () => {\r\n          try {\r\n            const syncResponse = await fetch('/api/subscriptions/sync', {\r\n              method: 'POST',\r\n              headers: {\r\n                'Content-Type': 'application/json',\r\n              },\r\n              body: JSON.stringify({\r\n                userId: userData._id,\r\n              }),\r\n            });\r\n            if (syncResponse.ok) {\r\n              const syncData = await syncResponse.json();\r\n              console.log('[Billing] Auto-sync successful:', syncData);\r\n              if (syncData.subscription && syncData.subscription.type !== 'free') {\r\n                await refreshUserData();\r\n                await fetchSubscription();\r\n                await fetchPayments();\r\n              }\r\n            } else {\r\n              const errorData = await syncResponse.json().catch(() => ({}));\r\n              console.log('[Billing] Auto-sync failed (this is OK if user hasn\\'t completed checkout):', errorData);\r\n            }\r\n          } catch (error) {\r\n            console.error('[Billing] Auto-sync error:', error);\r\n          }\r\n        }, 2000);\r\n      }\r\n    }\r\n  }, [userData?._id, userData?.subscription?.stripeCustomerId, userData?.subscription?.type]);\r\n\r\n  // Function to create payment for subscription\r\n  const createSubscriptionPayment = async () => {\r\n    if (!userData?._id) return;\r\n    \r\n    console.log('[Billing] Creating payment record for subscription...');\r\n    \r\n    try {\r\n      // First try sync endpoint\r\n      const syncResponse = await fetch('/api/subscriptions/sync', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: userData._id,\r\n        }),\r\n      });\r\n      \r\n      if (syncResponse.ok) {\r\n        const syncData = await syncResponse.json();\r\n        console.log('[Billing] Sync completed:', syncData);\r\n        \r\n        // Wait a bit then fetch payments\r\n        await new Promise(resolve => setTimeout(resolve, 2000));\r\n        await fetchPayments();\r\n        await refreshUserData();\r\n        \r\n        // Check again after fetching\r\n        const paymentsResponse = await fetch(`/api/payments?memberId=${userData._id}`);\r\n        if (paymentsResponse.ok) {\r\n          const paymentsData = await paymentsResponse.json();\r\n          const currentPaymentsCount = paymentsData.payments?.length || 0;\r\n          \r\n          // If still no payments, try manual creation endpoint\r\n          if (currentPaymentsCount === 0) {\r\n            console.log('[Billing] Still no payments after sync, trying manual payment creation...');\r\n            try {\r\n              const createResponse = await fetch('/api/payments/create-subscription-payment', {\r\n                method: 'POST',\r\n                headers: {\r\n                  'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify({\r\n                  userId: userData._id,\r\n                }),\r\n              });\r\n              \r\n              if (createResponse.ok) {\r\n                const createData = await createResponse.json();\r\n                console.log('[Billing] Manual payment creation:', createData);\r\n                await fetchPayments();\r\n                showSuccess('Payment Created', 'Payment record has been created successfully.');\r\n              } else {\r\n                const errorData = await createResponse.json().catch(() => ({}));\r\n                console.error('[Billing] Manual payment creation failed:', errorData);\r\n                setError(errorData.error || 'Failed to create payment record');\r\n              }\r\n            } catch (createError) {\r\n              console.error('[Billing] Error creating payment manually:', createError);\r\n              setError('Error creating payment: ' + createError.message);\r\n            }\r\n          } else {\r\n            showSuccess('Payments Found', `Found ${currentPaymentsCount} payment(s).`);\r\n          }\r\n        }\r\n      } else {\r\n        const errorData = await syncResponse.json().catch(() => ({}));\r\n        console.error('[Billing] Sync failed:', errorData);\r\n        setError(errorData.error || 'Failed to sync subscription');\r\n      }\r\n    } catch (error) {\r\n      console.error('[Billing] Error syncing for payment creation:', error);\r\n      setError('Error: ' + error.message);\r\n    }\r\n  };\r\n\r\n  // Check if user has active subscription but no payments - trigger sync to create payment\r\n  // Only run once after initial data is loaded\r\n  useEffect(() => {\r\n    // Wait for subscription to be loaded\r\n    if (userData?._id && !paymentSyncTriggered.current) {\r\n      // Check subscription from both subscription state and userData\r\n      const subType = subscription?.type || userData?.subscription?.type;\r\n      const subStatus = subscription?.status || userData?.subscription?.status;\r\n      const hasActiveSubscription = (subType === 'monthly' || subType === 'yearly') && \r\n        subStatus === 'active';\r\n      const hasStripeCustomer = userData?.subscription?.stripeCustomerId;\r\n      \r\n      if (hasActiveSubscription && hasStripeCustomer && payments.length === 0) {\r\n        paymentSyncTriggered.current = true;\r\n        console.log('[Billing] User has active subscription but no payments, triggering sync to create payment...', {\r\n          subType,\r\n          subStatus,\r\n          hasStripeCustomer,\r\n          paymentsCount: payments.length\r\n        });\r\n        // Delay to avoid multiple calls\r\n        const timeoutId = setTimeout(() => {\r\n          createSubscriptionPayment();\r\n        }, 3000);\r\n        \r\n        return () => clearTimeout(timeoutId);\r\n      }\r\n    }\r\n  }, [userData?._id, subscription?.type, subscription?.status, userData?.subscription?.type, userData?.subscription?.status, payments.length]);\r\n\r\n  const fetchFines = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch(`/api/fines?memberId=${userData._id}&status=pending`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setFines(data.fines || []);\r\n      } else {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        console.error('Error fetching fines:', errorData.error || 'Failed to fetch fines');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching fines:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchPayments = async () => {\r\n    try {\r\n      const response = await fetch(`/api/payments?memberId=${userData._id}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        console.log('[Billing] Fetched payments:', data.payments?.length || 0, 'payments');\r\n        console.log('[Billing] Payment details:', data.payments);\r\n        setPayments(data.payments || []);\r\n      } else {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        console.error('Error fetching payments:', errorData.error || 'Failed to fetch payments');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching payments:', error);\r\n    }\r\n  };\r\n\r\n  const fetchSubscription = async () => {\r\n    try {\r\n      const response = await fetch(`/api/subscriptions?userId=${userData._id}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setSubscription(data.subscription);\r\n        \r\n        // If subscription is active but no payments, trigger payment creation immediately\r\n        const sub = data.subscription;\r\n        if (sub && (sub.type === 'monthly' || sub.type === 'yearly') && sub.status === 'active') {\r\n          // Check if we need to create payment\r\n          const paymentsResponse = await fetch(`/api/payments?memberId=${userData._id}`);\r\n          if (paymentsResponse.ok) {\r\n            const paymentsData = await paymentsResponse.json();\r\n            if (paymentsData.payments?.length === 0 && !paymentSyncTriggered.current) {\r\n              console.log('[Billing] Active subscription found but no payments, triggering creation NOW...');\r\n              paymentSyncTriggered.current = true;\r\n              // Trigger immediately - don't wait\r\n              createSubscriptionPayment().catch(err => {\r\n                console.error('[Billing] Error in createSubscriptionPayment:', err);\r\n              });\r\n            }\r\n          }\r\n        }\r\n        \r\n        return data.subscription;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching subscription:', error);\r\n    }\r\n    return null;\r\n  };\r\n\r\n  // Handle subscription success with polling/retry logic\r\n  const handleSubscriptionSuccess = async (plan) => {\r\n    setSuccessMessage('Processing your subscription...');\r\n    setError(null);\r\n    \r\n    // Clear URL params immediately\r\n    window.history.replaceState({}, '', window.location.pathname);\r\n\r\n    // First, try to sync subscription from Stripe (fallback if webhook didn't process)\r\n    try {\r\n      console.log('[Billing] Attempting to sync subscription from Stripe...');\r\n      const syncResponse = await fetch('/api/subscriptions/sync', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: userData._id,\r\n        }),\r\n      });\r\n\r\n      if (syncResponse.ok) {\r\n        const syncData = await syncResponse.json();\r\n        console.log('[Billing] Sync successful:', syncData);\r\n        \r\n        // Refresh userData and subscription after sync\r\n        await refreshUserData();\r\n        await fetchSubscription();\r\n        \r\n        // Fetch payments immediately and again after delay\r\n        await fetchPayments();\r\n        setTimeout(async () => {\r\n          await fetchPayments();\r\n        }, 2000);\r\n        \r\n        // Check if subscription is now active\r\n        if (syncData.subscription && \r\n            (syncData.subscription.type === 'monthly' || syncData.subscription.type === 'yearly') &&\r\n            syncData.subscription.status === 'active') {\r\n          setSuccessMessage(`Subscription activated successfully! Your ${getSubscriptionDisplayName(syncData.subscription.type)} plan is now active.`);\r\n          showSuccess('Subscription Activated', `Your ${getSubscriptionDisplayName(syncData.subscription.type)} subscription has been activated successfully!`);\r\n          return;\r\n        }\r\n      } else {\r\n        const errorData = await syncResponse.json().catch(() => ({}));\r\n        console.error('[Billing] Sync failed:', errorData);\r\n        // Don't stop the flow if sync fails - continue with polling\r\n      }\r\n    } catch (syncError) {\r\n      console.error('[Billing] Error syncing subscription:', syncError);\r\n      // Don't stop the flow if sync fails - continue with polling\r\n    }\r\n\r\n    // Refresh userData from AuthContext\r\n    try {\r\n      await refreshUserData();\r\n    } catch (error) {\r\n      console.error('Error refreshing user data:', error);\r\n    }\r\n\r\n    // Poll subscription API with retry logic (webhook may take a moment to process)\r\n    let attempts = 0;\r\n    const maxAttempts = 10;\r\n    const pollInterval = 2000; // 2 seconds\r\n\r\n    const pollSubscription = async () => {\r\n      attempts++;\r\n      console.log(`[Billing] Polling subscription attempt ${attempts}/${maxAttempts}`);\r\n      \r\n      // Try sync again every few attempts\r\n      if (attempts % 3 === 0) {\r\n        try {\r\n          const syncResponse = await fetch('/api/subscriptions/sync', {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({\r\n              userId: userData._id,\r\n            }),\r\n          });\r\n          if (syncResponse.ok) {\r\n            await refreshUserData();\r\n            await fetchSubscription();\r\n            await fetchPayments();\r\n          } else {\r\n            const errorData = await syncResponse.json().catch(() => ({}));\r\n            console.error('[Billing] Sync retry failed:', errorData);\r\n          }\r\n        } catch (error) {\r\n          console.error('[Billing] Error during sync retry:', error);\r\n        }\r\n      }\r\n      \r\n      const subscriptionData = await fetchSubscription();\r\n      console.log('[Billing] Subscription data:', subscriptionData);\r\n      \r\n      // Also check userData\r\n      const userDataPlan = userData?.subscription?.type;\r\n      const userDataStatus = userData?.subscription?.status;\r\n      console.log('[Billing] UserData subscription:', { type: userDataPlan, status: userDataStatus });\r\n      \r\n      // Check if subscription is active and matches the plan\r\n      const subscriptionType = subscriptionData?.type || userDataPlan;\r\n      const subscriptionStatus = subscriptionData?.status || userDataStatus;\r\n      \r\n      const isActivePremium = subscriptionType && \r\n        (subscriptionType === 'monthly' || subscriptionType === 'yearly') && \r\n        subscriptionStatus === 'active';\r\n      \r\n      console.log('[Billing] Subscription check:', { \r\n        type: subscriptionType, \r\n        status: subscriptionStatus, \r\n        isActivePremium,\r\n        expectedPlan: plan \r\n      });\r\n      \r\n      if (isActivePremium) {\r\n        setSuccessMessage(`Subscription activated successfully! Your ${getSubscriptionDisplayName(subscriptionType)} plan is now active.`);\r\n        showSuccess('Subscription Activated', `Your ${getSubscriptionDisplayName(subscriptionType)} subscription has been activated successfully!`);\r\n        \r\n        // Refresh payment history\r\n        fetchPayments();\r\n        \r\n        // Refresh userData one more time to ensure it's up to date\r\n        await refreshUserData();\r\n        return;\r\n      }\r\n\r\n      // If not found yet and haven't exceeded max attempts, retry\r\n      if (attempts < maxAttempts) {\r\n        console.log(`[Billing] Subscription not found yet, retrying in ${pollInterval}ms...`);\r\n        setTimeout(pollSubscription, pollInterval);\r\n      } else {\r\n        // After max attempts, show message but still refresh\r\n        console.log('[Billing] Max polling attempts reached, subscription may not be processed yet');\r\n        setSuccessMessage('Subscription payment received. Your subscription should be activated shortly. Please refresh the page if it doesn\\'t update.');\r\n        fetchPayments();\r\n        await refreshUserData();\r\n      }\r\n    };\r\n\r\n    // Start polling after initial delay\r\n    setTimeout(pollSubscription, 1000);\r\n  };\r\n\r\n  const handleUpgradeSubscription = async (plan) => {\r\n    try {\r\n      setProcessingSubscription(true);\r\n      setError(null);\r\n      setSuccessMessage(null);\r\n\r\n      const response = await fetch('/api/subscriptions/create-checkout', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: userData._id,\r\n          plan: plan,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Failed to create checkout session');\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // Redirect to Stripe Checkout\r\n      if (data.url) {\r\n        window.location.href = data.url;\r\n      } else {\r\n        throw new Error('No checkout URL returned');\r\n      }\r\n    } catch (err) {\r\n      setError(err.message);\r\n      console.error('Error creating subscription checkout:', err);\r\n      setProcessingSubscription(false);\r\n    }\r\n  };\r\n\r\n  const handleCancelSubscription = async () => {\r\n    const result = await showConfirm(\r\n      'Cancel Subscription',\r\n      'Are you sure you want to cancel your subscription? It will remain active until the end of the current billing period.'\r\n    );\r\n    if (!result.isConfirmed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setProcessingSubscription(true);\r\n      setError(null);\r\n      setSuccessMessage(null);\r\n\r\n      const response = await fetch('/api/subscriptions/cancel', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: userData._id,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Failed to cancel subscription');\r\n      }\r\n\r\n      setSuccessMessage('Subscription will be cancelled at the end of the current period.');\r\n      \r\n      // Refresh subscription and userData to update UI\r\n      await fetchSubscription();\r\n      await refreshUserData();\r\n      \r\n      setProcessingSubscription(false);\r\n    } catch (err) {\r\n      setError(err.message);\r\n      console.error('Error canceling subscription:', err);\r\n      setProcessingSubscription(false);\r\n    }\r\n  };\r\n\r\n  const handleReactivateSubscription = async () => {\r\n    try {\r\n      setProcessingSubscription(true);\r\n      setError(null);\r\n      setSuccessMessage(null);\r\n\r\n      const response = await fetch('/api/subscriptions/reactivate', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: userData._id,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Failed to reactivate subscription');\r\n      }\r\n\r\n      setSuccessMessage('Subscription reactivated successfully!');\r\n      fetchSubscription();\r\n      setProcessingSubscription(false);\r\n      showSuccess('Subscription Reactivated', 'Your premium subscription has been reactivated.');\r\n    } catch (err) {\r\n      const errorMessage = err.message || 'Failed to reactivate subscription. Please try again.';\r\n      setError(errorMessage);\r\n      showErrorAlert('Reactivation Failed', errorMessage);\r\n      console.error('Error reactivating subscription:', err);\r\n      setProcessingSubscription(false);\r\n    }\r\n  };\r\n\r\n  const handlePayFine = async (fine) => {\r\n    try {\r\n      setProcessingPayment(fine._id);\r\n      setError(null);\r\n\r\n      // Create payment\r\n      const paymentResponse = await fetch('/api/payments', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          fineId: fine._id,\r\n          memberId: userData._id,\r\n        }),\r\n      });\r\n\r\n      if (!paymentResponse.ok) {\r\n        const errorData = await paymentResponse.json();\r\n        throw new Error(errorData.error || 'Failed to create payment');\r\n      }\r\n\r\n      const paymentData = await paymentResponse.json();\r\n      // Get payment ID - API returns payment object in both new and existing cases\r\n      const paymentId = paymentData.payment?._id;\r\n      \r\n      if (!paymentId) {\r\n        throw new Error('Failed to get payment ID');\r\n      }\r\n\r\n      // Create Stripe Checkout session\r\n      const checkoutResponse = await fetch(`/api/payments/${paymentId}/checkout`, {\r\n        method: 'POST',\r\n      });\r\n\r\n      if (!checkoutResponse.ok) {\r\n        const errorData = await checkoutResponse.json();\r\n        throw new Error(errorData.error || 'Failed to create checkout session');\r\n      }\r\n\r\n      const checkoutData = await checkoutResponse.json();\r\n\r\n      // Redirect to Stripe Checkout\r\n      if (checkoutData.url) {\r\n        window.location.href = checkoutData.url;\r\n      } else {\r\n        throw new Error('No checkout URL returned');\r\n      }\r\n    } catch (err) {\r\n      const errorMessage = err.message || 'Failed to process payment. Please try again.';\r\n      setError(errorMessage);\r\n      showErrorAlert('Payment Error', errorMessage);\r\n      console.error('Error processing payment:', err);\r\n      setProcessingPayment(null);\r\n    }\r\n  };\r\n\r\n  const totalOutstanding = fines.reduce((sum, fine) => sum + fine.amount, 0);\r\n\r\n  return (\r\n    <div className=\"flex-1 overflow-y-auto p-6 md:p-8 pb-20 scroll-smooth\">\r\n      <div className=\"max-w-7xl mx-auto flex flex-col gap-8\">\r\n        {/* Page Header */}\r\n        <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-4\">\r\n          <div className=\"flex flex-col gap-1\">\r\n            <h2 className=\"text-3xl md:text-4xl font-black tracking-tight text-white\">Billing & Payments</h2>\r\n            <p className=\"text-text-secondary text-sm md:text-base\">\r\n              Manage your fines and payment history\r\n            </p>\r\n          </div>\r\n          {totalOutstanding > 0 && (\r\n            <div className=\"bg-alert-red/10 border border-alert-red/30 rounded-xl p-4\">\r\n              <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider mb-1\">Total Outstanding</p>\r\n              <p className=\"text-2xl font-bold text-alert-red\">{totalOutstanding.toFixed(2)} BDT</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"bg-alert-red/10 border border-alert-red/30 rounded-xl p-4\">\r\n            <p className=\"text-alert-red text-sm\">{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        {successMessage && (\r\n          <div className=\"bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4\">\r\n            <p className=\"text-emerald-400 text-sm\">{successMessage}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Subscription Management Section */}\r\n        <section className=\"flex flex-col gap-5\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h3 className=\"text-xl font-bold text-white flex items-center gap-2\">\r\n              <span className=\"material-symbols-outlined text-primary\">workspace_premium</span>\r\n              Subscription\r\n            </h3>\r\n          </div>\r\n\r\n          <div className=\"bg-surface-dark rounded-xl p-6 border border-[#3c2348]\">\r\n            {(() => {\r\n              // Check subscription from API or userData\r\n              // Prioritize subscription API data, fallback to userData\r\n              const subscriptionData = subscription || (userData?.subscription ? {\r\n                type: userData.subscription.type,\r\n                status: userData.subscription.status,\r\n                subscription: subscription?.subscription\r\n              } : null);\r\n              \r\n              // Check if user has active premium subscription\r\n              // Must have type 'monthly' or 'yearly' AND status 'active'\r\n              const hasActivePremium = subscriptionData && \r\n                (subscriptionData.type === 'monthly' || subscriptionData.type === 'yearly') && \r\n                subscriptionData.status === 'active';\r\n              \r\n              // Use subscriptionData for display\r\n              const activeSubscription = subscriptionData;\r\n              \r\n              return hasActivePremium ? (\r\n              <div className=\"flex flex-col gap-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider mb-1\">Current Plan</p>\r\n                    <p className=\"text-2xl font-bold text-white\">{getSubscriptionDisplayName(activeSubscription.type)}</p>\r\n                    {activeSubscription.subscription && (\r\n                      <p className=\"text-text-secondary text-sm mt-2\">\r\n                        Renews on {new Date(activeSubscription.subscription.currentPeriodEnd).toLocaleDateString('en-US', {\r\n                          month: 'long',\r\n                          day: 'numeric',\r\n                          year: 'numeric',\r\n                        })}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 text-xs font-bold px-3 py-1.5 rounded-lg\">\r\n                    Active\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Upgrade buttons - enabled if cancelled, disabled if active */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  {(() => {\r\n                    const isMonthlyActive = activeSubscription.type === 'monthly' && activeSubscription.status === 'active';\r\n                    const isYearlyActive = activeSubscription.type === 'yearly' && activeSubscription.status === 'active';\r\n                    \r\n                    return (\r\n                      <>\r\n                        <button\r\n                          onClick={() => handleUpgradeSubscription('monthly')}\r\n                          disabled={isMonthlyActive || processingSubscription}\r\n                          className={`${\r\n                            isMonthlyActive\r\n                              ? 'bg-primary/30 border border-primary/50 cursor-not-allowed'\r\n                              : 'bg-primary hover:bg-primary-hover'\r\n                          } text-white text-sm font-bold px-6 py-3 rounded-lg flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed transition-colors`}\r\n                        >\r\n                          <span className=\"material-symbols-outlined text-base\">workspace_premium</span>\r\n                          {isMonthlyActive ? 'Subscribed - Monthly Premium' : 'Upgrade to Monthly Premium'}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleUpgradeSubscription('yearly')}\r\n                          disabled={isYearlyActive || processingSubscription}\r\n                          className={`${\r\n                            isYearlyActive\r\n                              ? 'bg-primary/30 border border-primary/50 cursor-not-allowed'\r\n                              : 'bg-primary/10 hover:bg-primary/20 border border-primary/30'\r\n                          } text-primary text-sm font-bold px-6 py-3 rounded-lg flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed transition-colors`}\r\n                        >\r\n                          <span className=\"material-symbols-outlined text-base\">workspace_premium</span>\r\n                          {isYearlyActive ? 'Subscribed - Yearly Premium' : 'Upgrade to Yearly Premium'}\r\n                        </button>\r\n                      </>\r\n                    );\r\n                  })()}\r\n                </div>\r\n\r\n                {activeSubscription.subscription?.cancelAtPeriodEnd ? (\r\n                  <div className=\"bg-orange-500/10 border border-orange-500/30 rounded-lg p-4\">\r\n                    <p className=\"text-orange-400 text-sm mb-3\">\r\n                      Your subscription will be cancelled at the end of the current period.\r\n                    </p>\r\n                    <button\r\n                      onClick={handleReactivateSubscription}\r\n                      disabled={processingSubscription}\r\n                      className=\"bg-primary hover:bg-primary-hover disabled:bg-primary/50 disabled:cursor-not-allowed text-white text-sm font-bold px-4 py-2 rounded-lg transition-colors\"\r\n                    >\r\n                      {processingSubscription ? (\r\n                        <>\r\n                          <span className=\"material-symbols-outlined text-base animate-spin inline-block mr-2\">refresh</span>\r\n                          Processing...\r\n                        </>\r\n                      ) : (\r\n                        'Reactivate Subscription'\r\n                      )}\r\n                    </button>\r\n                  </div>\r\n                ) : (\r\n                  <button\r\n                    onClick={handleCancelSubscription}\r\n                    disabled={processingSubscription}\r\n                    className=\"bg-alert-red/10 hover:bg-alert-red/20 border border-alert-red/30 text-alert-red text-sm font-bold px-4 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  >\r\n                    {processingSubscription ? (\r\n                      <>\r\n                        <span className=\"material-symbols-outlined text-base animate-spin inline-block mr-2\">refresh</span>\r\n                        Processing...\r\n                      </>\r\n                    ) : (\r\n                      'Cancel Subscription'\r\n                    )}\r\n                  </button>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex flex-col gap-4\">\r\n                <div>\r\n                  <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider mb-1\">Current Plan</p>\r\n                  <p className=\"text-2xl font-bold text-white\">\r\n                    {(() => {\r\n                      // Show plan from subscription API or userData, fallback to Free\r\n                      const planToShow = subscription?.type || userData?.subscription?.type || 'free';\r\n                      const statusToCheck = subscription?.status || userData?.subscription?.status;\r\n                      \r\n                      // Only show premium plan if status is active\r\n                      if ((planToShow === 'monthly' || planToShow === 'yearly') && statusToCheck === 'active') {\r\n                        return getSubscriptionDisplayName(planToShow);\r\n                      }\r\n                      return 'Free';\r\n                    })()}\r\n                  </p>\r\n                  <p className=\"text-text-secondary text-sm mt-2\">\r\n                    {(() => {\r\n                      const planToShow = subscription?.type || userData?.subscription?.type || 'free';\r\n                      const statusToCheck = subscription?.status || userData?.subscription?.status;\r\n                      \r\n                      if ((planToShow === 'monthly' || planToShow === 'yearly') && statusToCheck === 'active') {\r\n                        return 'Your premium subscription is active.';\r\n                      }\r\n                      return 'Upgrade to Premium for enhanced borrowing privileges';\r\n                    })()}\r\n                  </p>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  {(() => {\r\n                    const currentPlan = subscription?.type || userData?.subscription?.type;\r\n                    const subscriptionStatus = subscription?.status || userData?.subscription?.status;\r\n                    // Only consider subscription active if status is 'active' (not 'cancelled' or 'expired')\r\n                    const isActive = subscriptionStatus === 'active' && \r\n                      (currentPlan === 'monthly' || currentPlan === 'yearly');\r\n                    const isMonthlyActive = currentPlan === 'monthly' && isActive;\r\n                    const isYearlyActive = currentPlan === 'yearly' && isActive;\r\n                    \r\n                    return (\r\n                      <>\r\n                        <button\r\n                          onClick={() => handleUpgradeSubscription('monthly')}\r\n                          disabled={isMonthlyActive || processingSubscription}\r\n                          className={`${\r\n                            isMonthlyActive \r\n                              ? 'bg-primary/30 border border-primary/50 cursor-not-allowed' \r\n                              : 'bg-primary hover:bg-primary-hover'\r\n                          } text-white text-sm font-bold px-6 py-3 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed`}\r\n                        >\r\n                          <span className=\"material-symbols-outlined text-base\">workspace_premium</span>\r\n                          {isMonthlyActive ? 'Subscribed - Monthly Premium' : 'Upgrade to Monthly Premium'}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleUpgradeSubscription('yearly')}\r\n                          disabled={isYearlyActive || processingSubscription}\r\n                          className={`${\r\n                            isYearlyActive \r\n                              ? 'bg-primary/30 border border-primary/50 cursor-not-allowed' \r\n                              : 'bg-primary/10 hover:bg-primary/20 border border-primary/30'\r\n                          } text-primary text-sm font-bold px-6 py-3 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed`}\r\n                        >\r\n                          <span className=\"material-symbols-outlined text-base\">workspace_premium</span>\r\n                          {isYearlyActive ? 'Subscribed - Yearly Premium' : 'Upgrade to Yearly Premium'}\r\n                        </button>\r\n                      </>\r\n                    );\r\n                  })()}\r\n                </div>\r\n                {/* Premium Benefits Section - only shown when user doesn't have premium */}\r\n                <div className=\"bg-primary/5 border border-primary/20 rounded-lg p-4\">\r\n                  <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider mb-2\">Premium Benefits</p>\r\n                  <ul className=\"text-text-secondary text-sm space-y-1\">\r\n                    <li className=\"flex items-center gap-2\">\r\n                      <span className=\"material-symbols-outlined text-primary text-base\">check_circle</span>\r\n                      Borrow up to 4 books at a time (vs 1 for free)\r\n                    </li>\r\n                    <li className=\"flex items-center gap-2\">\r\n                      <span className=\"material-symbols-outlined text-primary text-base\">check_circle</span>\r\n                      20-day borrowing period (vs 7 days for free)\r\n                    </li>\r\n                    <li className=\"flex items-center gap-2\">\r\n                      <span className=\"material-symbols-outlined text-primary text-base\">check_circle</span>\r\n                      Priority access to new releases\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n            );\r\n            })()}\r\n          </div>\r\n        </section>\r\n\r\n        {/* Outstanding Fines Section */}\r\n        <section className=\"flex flex-col gap-5\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h3 className=\"text-xl font-bold text-white flex items-center gap-2\">\r\n              <span className=\"material-symbols-outlined text-primary\">receipt_long</span>\r\n              Outstanding Fines\r\n            </h3>\r\n            {fines.length > 0 && (\r\n              <button\r\n                onClick={() => fetchFines()}\r\n                className=\"text-sm text-primary hover:text-white transition-colors font-medium flex items-center gap-1\"\r\n              >\r\n                <span className=\"material-symbols-outlined text-base\">refresh</span>\r\n                Refresh\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {loading ? (\r\n            <div className=\"text-center py-12 text-text-secondary\">\r\n              <div className=\"flex justify-center mb-3\">\r\n                <Loader />\r\n              </div>\r\n            </div>\r\n          ) : fines.length === 0 ? (\r\n            <div className=\"text-center py-12 text-text-secondary rounded-xl bg-surface-dark border border-[#3c2348]\">\r\n              <span className=\"material-symbols-outlined text-5xl mb-3 opacity-50\">check_circle</span>\r\n              <p className=\"text-lg\">No outstanding fines</p>\r\n              <p className=\"text-sm mt-2\">You're all caught up!</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid grid-cols-1 gap-4\">\r\n              {fines.map((fine) => (\r\n                <div\r\n                  key={fine._id}\r\n                  className=\"bg-surface-dark rounded-xl p-5 border border-alert-red/30 hover:border-alert-red/50 transition-all\"\r\n                >\r\n                  <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-start gap-4\">\r\n                        {fine.borrowing?.book?.coverImage && (\r\n                          <div className=\"w-16 h-20 rounded-lg overflow-hidden flex-shrink-0 relative\">\r\n                            <OptimizedImage\r\n                              src={fine.borrowing.book.coverImage}\r\n                              alt={fine.borrowing.book.title || 'Book cover'}\r\n                              fill\r\n                              className=\"rounded-lg\"\r\n                              objectFit=\"cover\"\r\n                            />\r\n                          </div>\r\n                        )}\r\n                        <div className=\"flex-1\">\r\n                          <h4 className=\"text-white font-bold text-lg\">\r\n                            {fine.borrowing?.book?.title || 'Book'}\r\n                          </h4>\r\n                          <p className=\"text-text-secondary text-sm mb-2\">\r\n                            {fine.borrowing?.book?.author || 'Author unknown'}\r\n                          </p>\r\n                          <div className=\"flex flex-wrap items-center gap-4 text-sm\">\r\n                            <div>\r\n                              <span className=\"text-text-secondary\">Days overdue:</span>{' '}\r\n                              <span className=\"text-alert-red font-medium\">{fine.daysOverdue}</span>\r\n                            </div>\r\n                            <div>\r\n                              <span className=\"text-text-secondary\">Issued:</span>{' '}\r\n                              <span className=\"text-white\">\r\n                                {new Date(fine.issuedDate).toLocaleDateString('en-US', {\r\n                                  month: 'short',\r\n                                  day: 'numeric',\r\n                                  year: 'numeric',\r\n                                })}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex flex-col items-end gap-3\">\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider\">Amount Due</p>\r\n                        <p className=\"text-2xl font-bold text-alert-red\">{fine.amount.toFixed(2)} BDT</p>\r\n                      </div>\r\n                      <button\r\n                        onClick={() => handlePayFine(fine)}\r\n                        disabled={processingPayment === fine._id}\r\n                        className=\"bg-alert-red hover:bg-red-600 disabled:bg-alert-red/50 disabled:cursor-not-allowed text-white text-sm font-bold px-6 py-2 rounded-lg transition-colors shadow-lg shadow-red-900/20 flex items-center gap-2\"\r\n                      >\r\n                        {processingPayment === fine._id ? (\r\n                          <>\r\n                            <span className=\"material-symbols-outlined text-base animate-spin\">refresh</span>\r\n                            Processing...\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <span className=\"material-symbols-outlined text-base\">payment</span>\r\n                            Pay Now\r\n                          </>\r\n                        )}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </section>\r\n\r\n        {/* Payment History Section */}\r\n        <section className=\"flex flex-col gap-5\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h3 className=\"text-xl font-bold text-white flex items-center gap-2\">\r\n              <span className=\"material-symbols-outlined text-primary\">history</span>\r\n              Payment History\r\n            </h3>\r\n            <div className=\"flex items-center gap-2\">\r\n              {(() => {\r\n                const subType = subscription?.type || userData?.subscription?.type;\r\n                const subStatus = subscription?.status || userData?.subscription?.status;\r\n                const hasActiveSubscription = (subType === 'monthly' || subType === 'yearly') && \r\n                  subStatus === 'active';\r\n                \r\n                // Show \"Create Payment Record\" button if user has active subscription but no payments\r\n                if (hasActiveSubscription && payments.length === 0) {\r\n                  return (\r\n                    <button\r\n                      onClick={createSubscriptionPayment}\r\n                      className=\"text-sm text-primary hover:text-white transition-colors font-medium flex items-center gap-1\"\r\n                      title=\"Create payment record for your subscription\"\r\n                    >\r\n                      <span className=\"material-symbols-outlined text-base\">add_circle</span>\r\n                      Create Payment Record\r\n                    </button>\r\n                  );\r\n                }\r\n                // Show refresh button if there are payments\r\n                if (payments.length > 0) {\r\n                  return (\r\n                    <button\r\n                      onClick={() => fetchPayments()}\r\n                      className=\"text-sm text-primary hover:text-white transition-colors font-medium flex items-center gap-1\"\r\n                    >\r\n                      <span className=\"material-symbols-outlined text-base\">refresh</span>\r\n                      Refresh\r\n                    </button>\r\n                  );\r\n                }\r\n                return null;\r\n              })()}\r\n            </div>\r\n          </div>\r\n\r\n          {loading ? (\r\n            <div className=\"text-center py-12 text-text-secondary\">\r\n              <div className=\"flex justify-center mb-3\">\r\n                <Loader />\r\n              </div>\r\n            </div>\r\n          ) : payments.length === 0 ? (\r\n            <div className=\"text-center py-12 text-text-secondary rounded-xl bg-surface-dark border border-[#3c2348]\">\r\n              <span className=\"material-symbols-outlined text-5xl mb-3 opacity-50\">receipt</span>\r\n              <p className=\"text-lg\">No payment history</p>\r\n              <p className=\"text-sm mt-2\">Payments you make will appear here</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid grid-cols-1 gap-4\">\r\n              {payments.map((payment) => (\r\n                <div\r\n                  key={payment._id}\r\n                  className={`bg-surface-dark rounded-xl p-5 border ${\r\n                    payment.status === 'completed'\r\n                      ? 'border-emerald-500/30'\r\n                      : payment.status === 'failed'\r\n                      ? 'border-alert-red/30'\r\n                      : 'border-[#3c2348]'\r\n                  }`}\r\n                >\r\n                  <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-3 mb-2\">\r\n                        <h4 className=\"text-white font-bold\">\r\n                          {(() => {\r\n                            // Check if this is a subscription payment\r\n                            // Handle metadata - could be Map, object, or Map-like\r\n                            let subscriptionType = null;\r\n                            if (payment.metadata) {\r\n                              if (payment.metadata instanceof Map) {\r\n                                subscriptionType = payment.metadata.get('subscriptionType');\r\n                              } else if (payment.metadata.get && typeof payment.metadata.get === 'function') {\r\n                                // Map-like object\r\n                                subscriptionType = payment.metadata.get('subscriptionType');\r\n                              } else if (typeof payment.metadata === 'object') {\r\n                                // Plain object\r\n                                subscriptionType = payment.metadata.subscriptionType;\r\n                              }\r\n                            }\r\n                            \r\n                            if (subscriptionType) {\r\n                              return `${getSubscriptionDisplayName(subscriptionType)} Subscription`;\r\n                            }\r\n                            // Check if it's a fine payment\r\n                            if (payment.fine?.borrowing?.book?.title) {\r\n                              return payment.fine.borrowing.book.title;\r\n                            }\r\n                            // Default\r\n                            return 'Payment';\r\n                          })()}\r\n                        </h4>\r\n                        <span\r\n                          className={`text-xs font-bold px-2 py-1 rounded ${\r\n                            payment.status === 'completed'\r\n                              ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30'\r\n                              : payment.status === 'failed'\r\n                              ? 'bg-alert-red/20 text-alert-red border border-alert-red/30'\r\n                              : 'bg-orange-500/20 text-orange-400 border border-orange-500/30'\r\n                          }`}\r\n                        >\r\n                          {payment.status.toUpperCase()}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"flex flex-wrap items-center gap-4 text-sm text-text-secondary\">\r\n                        <div>\r\n                          <span className=\"material-symbols-outlined text-base align-middle\">calendar_today</span>{' '}\r\n                          {new Date(payment.createdAt).toLocaleDateString('en-US', {\r\n                            month: 'short',\r\n                            day: 'numeric',\r\n                            year: 'numeric',\r\n                            hour: '2-digit',\r\n                            minute: '2-digit',\r\n                          })}\r\n                        </div>\r\n                        {payment.completedDate && (\r\n                          <div>\r\n                            <span className=\"material-symbols-outlined text-base align-middle\">check_circle</span>{' '}\r\n                            Completed: {new Date(payment.completedDate).toLocaleDateString('en-US', {\r\n                              month: 'short',\r\n                              day: 'numeric',\r\n                            })}\r\n                          </div>\r\n                        )}\r\n                        {payment.paymentMethod && (\r\n                          <div>\r\n                            <span className=\"material-symbols-outlined text-base align-middle\">payment</span>{' '}\r\n                            {payment.paymentMethod === 'stripe' ? 'Card' : payment.paymentMethod}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      {payment.failureReason && (\r\n                        <p className=\"text-alert-red text-sm mt-2\">{payment.failureReason}</p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider\">Amount</p>\r\n                      <p className=\"text-xl font-bold text-white\">{payment.amount.toFixed(2)} BDT</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </section>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\explore\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchBooks'. Either include it or remove the dependency array.","line":46,"column":6,"nodeType":"ArrayExpression","endLine":46,"endColumn":81,"suggestions":[{"desc":"Update the dependencies array to be: [search, selectedCategory, sortBy, availability, language, pagination.page, fetchBooks]","fix":{"range":[1557,1632],"text":"[search, selectedCategory, sortBy, availability, language, pagination.page, fetchBooks]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":575,"column":24,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[26095,26130],"text":"\n                    You&apos;ve viewed "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[26095,26130],"text":"\n                    You&lsquo;ve viewed "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[26095,26130],"text":"\n                    You&#39;ve viewed "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[26095,26130],"text":"\n                    You&rsquo;ve viewed "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState, Suspense } from 'react';\nimport { useSearchParams, useRouter } from 'next/navigation';\nimport { useAuth } from '@/contexts/AuthContext';\nimport Link from 'next/link';\nimport { showSuccess, showError, showConfirm, showInfo } from '@/lib/swal';\nimport Loader from '@/components/Loader';\n\nfunction BrowseContent() {\n  const { userData } = useAuth();\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  \n  const [books, setBooks] = useState([]);\n  const [categories, setCategories] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [borrowing, setBorrowing] = useState(false);\n  const [pagination, setPagination] = useState({\n    page: 1,\n    limit: 12,\n    total: 0,\n    pages: 0,\n  });\n\n  // Filters\n  const [search, setSearch] = useState(searchParams.get('search') || '');\n  const [selectedCategory, setSelectedCategory] = useState(searchParams.get('category') || 'all');\n  const [sortBy, setSortBy] = useState(searchParams.get('sort') || 'createdAt');\n  const [availability, setAvailability] = useState(searchParams.get('availability') || 'all');\n  const [language, setLanguage] = useState(searchParams.get('language') || 'all');\n  \n  // Dropdown states\n  const [availabilityOpen, setAvailabilityOpen] = useState(false);\n  const [sortOpen, setSortOpen] = useState(false);\n  const [languageOpen, setLanguageOpen] = useState(false);\n\n  // Fetch categories\n  useEffect(() => {\n    fetchCategories();\n  }, []);\n\n  // Fetch books\n  useEffect(() => {\n    fetchBooks();\n  }, [search, selectedCategory, sortBy, availability, language, pagination.page]);\n\n  const fetchCategories = async () => {\n    try {\n      const response = await fetch('/api/categories?isActive=true');\n      if (response.ok) {\n        const data = await response.json();\n        setCategories(data);\n      }\n    } catch (error) {\n      console.error('Error fetching categories:', error);\n    }\n  };\n\n  const fetchBooks = async () => {\n    setLoading(true);\n    try {\n      const params = new URLSearchParams({\n        page: pagination.page.toString(),\n        limit: '12',\n        sort: sortBy,\n        order: 'desc',\n      });\n\n      if (search) params.append('search', search);\n      if (selectedCategory && selectedCategory !== 'all') {\n        params.append('category', selectedCategory);\n      }\n      if (availability && availability !== 'all') {\n        params.append('availability', availability);\n      }\n      if (language && language !== 'all') {\n        params.append('language', language);\n      }\n\n      const response = await fetch(`/api/books?${params.toString()}`);\n      if (response.ok) {\n        const data = await response.json();\n        setBooks(data.books || []);\n        setPagination(data.pagination || pagination);\n      }\n    } catch (error) {\n      console.error('Error fetching books:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSearch = (value) => {\n    setSearch(value);\n    setPagination({ ...pagination, page: 1 });\n    updateURL({ search: value, page: 1 });\n  };\n\n  const handleCategoryChange = (categoryId) => {\n    setSelectedCategory(categoryId);\n    setPagination({ ...pagination, page: 1 });\n    updateURL({ category: categoryId === 'all' ? '' : categoryId, page: 1 });\n  };\n\n  const handleSortChange = (sort) => {\n    setSortBy(sort);\n    setSortOpen(false);\n    updateURL({ sort });\n  };\n\n  const handleAvailabilityChange = (avail) => {\n    setAvailability(avail);\n    setAvailabilityOpen(false);\n    setPagination({ ...pagination, page: 1 });\n    updateURL({ availability: avail === 'all' ? '' : avail, page: 1 });\n  };\n\n  const handleLanguageChange = (lang) => {\n    setLanguage(lang);\n    setLanguageOpen(false);\n    setPagination({ ...pagination, page: 1 });\n    updateURL({ language: lang === 'all' ? '' : lang, page: 1 });\n  };\n\n  const updateURL = (updates) => {\n    const params = new URLSearchParams(searchParams.toString());\n    Object.keys(updates).forEach((key) => {\n      if (updates[key]) {\n        params.set(key, updates[key]);\n      } else {\n        params.delete(key);\n      }\n    });\n    router.push(`/member/explore?${params.toString()}`, { scroll: false });\n  };\n\n  const loadMore = () => {\n    if (pagination.page < pagination.pages) {\n      setPagination({ ...pagination, page: pagination.page + 1 });\n    }\n  };\n\n  const handleBorrow = async (bookId) => {\n    if (!userData?._id) {\n      showInfo('Login Required', 'Please log in to borrow books');\n      return;\n    }\n\n    const result = await showConfirm('Borrow Book', 'Are you sure you want to borrow this book?');\n    if (!result.isConfirmed) return;\n\n    try {\n      setBorrowing(true);\n      const response = await fetch('/api/borrowings/borrow', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ memberId: userData._id, bookId }),\n      });\n\n      if (response.ok) {\n        showSuccess('Success!', 'Book borrowed successfully!');\n        // Refresh books to update available copies\n        fetchBooks();\n      } else {\n        const error = await response.json();\n        showError('Error', error.error || 'Failed to borrow book');\n      }\n    } catch (error) {\n      console.error('Error borrowing book:', error);\n      showError('Error', 'Failed to borrow book');\n    } finally {\n      setBorrowing(false);\n    }\n  };\n\n  const handleReserve = async (bookId) => {\n    if (!userData?._id) {\n      showInfo('Login Required', 'Please log in to reserve books');\n      return;\n    }\n\n    // Check if user is premium\n    const subscriptionType = userData?.subscription?.type || 'free';\n    const subscriptionStatus = userData?.subscription?.status || 'active';\n    const isPremium = (subscriptionType === 'monthly' || subscriptionType === 'yearly') && subscriptionStatus === 'active';\n    \n    if (!isPremium) {\n      showError('Premium Feature', 'Reservations are only available for premium members. Please upgrade your plan to access this feature.');\n      return;\n    }\n\n    const result = await showConfirm('Reserve Book', 'Reserve this book? You will be added to the waitlist.');\n    if (!result.isConfirmed) return;\n\n    try {\n      setBorrowing(true);\n      const response = await fetch('/api/reservations', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ memberId: userData._id, bookId }),\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        showSuccess('Reservation Created!', 'Book has been reserved successfully. You will be notified when it\\'s available.');\n        // Refresh books to update available copies and reservation status\n        fetchBooks();\n      } else {\n        const error = await response.json();\n        if (error.reserver) {\n          showError('Already Reserved', `This book is already reserved by ${error.reserver.name}.`);\n        } else {\n          showError('Error', error.error || 'Failed to reserve book');\n        }\n      }\n    } catch (error) {\n      console.error('Error reserving book:', error);\n      showError('Error', 'Failed to reserve book');\n    } finally {\n      setBorrowing(false);\n    }\n  };\n\n  return (\n    <div className=\"flex-1 overflow-y-auto p-4 md:p-10 pb-20\">\n      <div className=\"max-w-[1440px] mx-auto w-full\">\n        {/* Hero Search Section */}\n        <div className=\"relative w-full rounded-2xl overflow-hidden mb-8\">\n          <div className=\"absolute inset-0 bg-gradient-to-r from-background-dark via-background-dark/90 to-primary/20\"></div>\n          <div className=\"relative z-10 px-6 py-12 md:px-12 md:py-16 flex flex-col items-start justify-center max-w-4xl\">\n            <h1 className=\"text-3xl md:text-5xl font-bold text-white mb-6 tracking-tight\">\n              Find your next <span className=\"text-primary\">great read</span>.\n            </h1>\n            <div className=\"w-full max-w-2xl\">\n              <label className=\"flex flex-col w-full\">\n                <div className=\"flex w-full items-center rounded-xl bg-surface-dark border border-white/10 focus-within:border-primary/50 focus-within:ring-2 focus-within:ring-primary/20 transition-all h-14 shadow-lg\">\n                  <div className=\"text-gray-400 flex items-center justify-center pl-4\">\n                    <span className=\"material-symbols-outlined\">search</span>\n                  </div>\n                  <input\n                    className=\"flex w-full bg-transparent border-none text-white placeholder:text-gray-500 focus:ring-0 px-4 text-base\"\n                    placeholder=\"Search by title, author, ISBN or keyword...\"\n                    value={search}\n                    onChange={(e) => handleSearch(e.target.value)}\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => handleSearch(search)}\n                    className=\"mr-2 rounded-lg bg-primary px-4 py-2 text-sm font-bold text-white hover:bg-primary/90 transition-colors\"\n                  >\n                    Search\n                  </button>\n                </div>\n              </label>\n            </div>\n          </div>\n        </div>\n\n        {/* Filters & Categories */}\n        <div className=\"flex flex-col md:flex-row gap-4 justify-between items-center mb-8 sticky top-[72px] z-30 py-2 bg-background-dark/95 backdrop-blur-sm -mx-4 px-4 md:-mx-10 md:px-10 border-b border-white/5\">\n          {/* Category Chips */}\n          <div className=\"flex gap-3 overflow-x-auto no-scrollbar w-full md:w-auto pb-2 md:pb-0\">\n            <button\n              onClick={() => handleCategoryChange('all')}\n              className={`flex h-9 shrink-0 items-center gap-2 rounded-full px-4 transition-colors border ${\n                selectedCategory === 'all'\n                  ? 'bg-primary text-white border-primary/50'\n                  : 'bg-surface-dark-hover text-gray-200 border-white/10 hover:bg-surface-dark-hover/80'\n              }`}\n            >\n              <span className=\"material-symbols-outlined text-[18px]\">\n                {selectedCategory === 'all' ? 'check' : ''}\n              </span>\n              <span className=\"text-sm font-medium whitespace-nowrap\">All Genres</span>\n            </button>\n            {categories.map((category) => (\n              <button\n                key={category._id}\n                onClick={() => handleCategoryChange(category._id)}\n                className={`flex h-9 shrink-0 items-center gap-2 rounded-full px-4 transition-colors border ${\n                  selectedCategory === category._id\n                    ? 'bg-primary text-white border-primary/50'\n                    : 'bg-surface-dark-hover text-gray-200 border-white/10 hover:bg-surface-dark-hover/80'\n                }`}\n              >\n                <span className=\"material-symbols-outlined text-[18px]\">\n                  {category.icon || 'menu_book'}\n                </span>\n                <span className=\"text-sm font-medium whitespace-nowrap\">{category.name}</span>\n              </button>\n            ))}\n          </div>\n\n          {/* Sort & Filter Dropdowns */}\n          <div className=\"flex gap-3 shrink-0 w-full md:w-auto\">\n            {/* Availability Dropdown */}\n            <div className=\"relative flex-1 md:w-auto\">\n              <button\n                onClick={() => {\n                  setAvailabilityOpen(!availabilityOpen);\n                  setSortOpen(false);\n                  setLanguageOpen(false);\n                }}\n                className=\"flex h-9 w-full md:w-auto items-center justify-between gap-2 rounded-lg bg-surface-dark border border-white/10 px-3 hover:border-white/20 transition-colors\"\n              >\n                <span className=\"text-sm text-gray-300\">\n                  Availability: <strong>\n                    {availability === 'all' ? 'All' : availability === 'available' ? 'Available' : 'Waitlist'}\n                  </strong>\n                </span>\n                <span className={`material-symbols-outlined text-gray-400 text-[18px] transition-transform ${availabilityOpen ? 'rotate-180' : ''}`}>\n                  expand_more\n                </span>\n              </button>\n              {availabilityOpen && (\n                <>\n                  <div\n                    className=\"fixed inset-0 z-10\"\n                    onClick={() => setAvailabilityOpen(false)}\n                  ></div>\n                  <div className=\"absolute top-full left-0 mt-1 z-20 w-full md:w-48 bg-surface-dark border border-white/10 rounded-lg shadow-lg overflow-hidden\">\n                    {['all', 'available', 'waitlist'].map((option) => (\n                      <button\n                        key={option}\n                        onClick={() => handleAvailabilityChange(option)}\n                        className={`w-full text-left px-4 py-2 text-sm transition-colors ${\n                          availability === option\n                            ? 'bg-primary/20 text-primary'\n                            : 'text-gray-300 hover:bg-surface-hover'\n                        }`}\n                      >\n                        {option === 'all' ? 'All' : option === 'available' ? 'Available' : 'Waitlist'}\n                      </button>\n                    ))}\n                  </div>\n                </>\n              )}\n            </div>\n\n            {/* Sort By Dropdown */}\n            <div className=\"relative flex-1 md:w-auto\">\n              <button\n                onClick={() => {\n                  setSortOpen(!sortOpen);\n                  setAvailabilityOpen(false);\n                  setLanguageOpen(false);\n                }}\n                className=\"flex h-9 w-full md:w-auto items-center justify-between gap-2 rounded-lg bg-surface-dark border border-white/10 px-3 hover:border-white/20 transition-colors\"\n              >\n                <span className=\"text-sm text-gray-300\">\n                  Sort by: <strong>\n                    {sortBy === 'createdAt' ? 'Newest' : \n                     sortBy === 'rating' ? 'Popular' : \n                     sortBy === 'title' ? 'Title' :\n                     sortBy === 'author' ? 'Author' :\n                     sortBy === 'publishedDate' ? 'Publication Date' : 'Newest'}\n                  </strong>\n                </span>\n                <span className={`material-symbols-outlined text-gray-400 text-[18px] transition-transform ${sortOpen ? 'rotate-180' : ''}`}>\n                  expand_more\n                </span>\n              </button>\n              {sortOpen && (\n                <>\n                  <div\n                    className=\"fixed inset-0 z-10\"\n                    onClick={() => setSortOpen(false)}\n                  ></div>\n                  <div className=\"absolute top-full left-0 mt-1 z-20 w-full md:w-48 bg-surface-dark border border-white/10 rounded-lg shadow-lg overflow-hidden\">\n                    {[\n                      { value: 'createdAt', label: 'Newest' },\n                      { value: 'rating', label: 'Popular' },\n                      { value: 'title', label: 'Title' },\n                      { value: 'author', label: 'Author' },\n                      { value: 'publishedDate', label: 'Publication Date' },\n                    ].map((option) => (\n                      <button\n                        key={option.value}\n                        onClick={() => handleSortChange(option.value)}\n                        className={`w-full text-left px-4 py-2 text-sm transition-colors ${\n                          sortBy === option.value\n                            ? 'bg-primary/20 text-primary'\n                            : 'text-gray-300 hover:bg-surface-hover'\n                        }`}\n                      >\n                        {option.label}\n                      </button>\n                    ))}\n                  </div>\n                </>\n              )}\n            </div>\n\n            {/* Language Dropdown */}\n            <div className=\"relative flex-1 md:w-auto\">\n              <button\n                onClick={() => {\n                  setLanguageOpen(!languageOpen);\n                  setAvailabilityOpen(false);\n                  setSortOpen(false);\n                }}\n                className=\"flex h-9 w-full md:w-auto items-center justify-between gap-2 rounded-lg bg-surface-dark border border-white/10 px-3 hover:border-white/20 transition-colors\"\n              >\n                <span className=\"text-sm text-gray-300\">\n                  Language: <strong>\n                    {language === 'all' ? 'All' : \n                     language === 'en' ? 'English' : \n                     language === 'bn' ? 'Bangla' : language}\n                  </strong>\n                </span>\n                <span className={`material-symbols-outlined text-gray-400 text-[18px] transition-transform ${languageOpen ? 'rotate-180' : ''}`}>\n                  expand_more\n                </span>\n              </button>\n              {languageOpen && (\n                <>\n                  <div\n                    className=\"fixed inset-0 z-10\"\n                    onClick={() => setLanguageOpen(false)}\n                  ></div>\n                  <div className=\"absolute top-full left-0 mt-1 z-20 w-full md:w-48 bg-surface-dark border border-white/10 rounded-lg shadow-lg overflow-hidden\">\n                    {[\n                      { value: 'all', label: 'All Languages' },\n                      { value: 'en', label: 'English' },\n                      { value: 'bn', label: 'Bangla' },\n                    ].map((option) => (\n                      <button\n                        key={option.value}\n                        onClick={() => handleLanguageChange(option.value)}\n                        className={`w-full text-left px-4 py-2 text-sm transition-colors ${\n                          language === option.value\n                            ? 'bg-primary/20 text-primary'\n                            : 'text-gray-300 hover:bg-surface-hover'\n                        }`}\n                      >\n                        {option.label}\n                      </button>\n                    ))}\n                  </div>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Books Grid */}\n        <section className=\"mb-12\">\n          <div className=\"flex items-center gap-4 mb-6 px-2\">\n            <h2 className=\"text-white text-2xl font-bold tracking-tight\">Browse Collection</h2>\n            <div className=\"h-px bg-white/10 flex-1\"></div>\n            <span className=\"text-gray-400 text-sm\">\n              Showing {books.length} of {pagination.total} books\n            </span>\n          </div>\n\n          {loading && books.length === 0 ? (\n            <div className=\"text-center py-12 text-text-secondary\">\n              <div className=\"flex justify-center mb-3\">\n                <Loader />\n              </div>\n            </div>\n          ) : books.length === 0 ? (\n            <div className=\"text-center py-12 text-text-secondary\">\n              <span className=\"material-symbols-outlined text-5xl mb-3 opacity-50\">search</span>\n              <p className=\"text-lg\">No books found</p>\n              <p className=\"text-sm mt-2\">Try adjusting your filters</p>\n            </div>\n          ) : (\n            <>\n              <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-x-6 gap-y-10\">\n                {books.map((book) => (\n                  <div key={book._id} className=\"flex flex-col group relative\">\n                    <Link href={`/member/books/${book._id}`}>\n                      <div className=\"relative w-full aspect-[2/3] rounded-lg overflow-hidden mb-3 bg-surface-dark shadow-md group-hover:shadow-primary/20 group-hover:shadow-xl transition-all duration-300\">\n                        <div className=\"absolute top-2 left-2 z-10 flex flex-col gap-1\">\n                          {book.availableCopies > 0 ? (\n                            <span className=\"bg-emerald-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded-sm uppercase tracking-wider backdrop-blur-sm\">\n                              Available\n                            </span>\n                          ) : (\n                            <span className=\"bg-amber-500/90 text-white text-[10px] font-bold px-2 py-0.5 rounded-sm uppercase tracking-wider backdrop-blur-sm\">\n                              Waitlist\n                            </span>\n                          )}\n                        </div>\n                        <div\n                          className=\"absolute inset-0 bg-cover bg-center transition-transform duration-500 group-hover:scale-105\"\n                          style={{ backgroundImage: `url('${book.coverImage}')` }}\n                        ></div>\n                        {/* Hover Action Overlay */}\n                        <div className=\"absolute inset-0 bg-gradient-to-t from-background-dark via-background-dark/80 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex flex-col justify-end p-4 translate-y-2 group-hover:translate-y-0\">\n                          <p className=\"text-white text-xs line-clamp-3 mb-3\">\n                            {book.description || 'No description available'}\n                          </p>\n                          <div className=\"flex gap-2\">\n                            {book.availableCopies > 0 ? (\n                              <button\n                                onClick={(e) => {\n                                  e.preventDefault();\n                                  handleBorrow(book._id);\n                                }}\n                                disabled={borrowing}\n                                className=\"flex-1 bg-primary hover:bg-primary/90 text-white text-xs font-bold py-2 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                              >\n                                {borrowing ? 'Processing...' : 'Borrow'}\n                              </button>\n                            ) : (\n                              (() => {\n                                const subscriptionType = userData?.subscription?.type || 'free';\n                                const subscriptionStatus = userData?.subscription?.status || 'active';\n                                const isPremium = (subscriptionType === 'monthly' || subscriptionType === 'yearly') && subscriptionStatus === 'active';\n                                \n                                // Check if book is already reserved (we'll check this via API, but show button as enabled)\n                                // The API will return an error if already reserved\n                                \n                                return isPremium ? (\n                                  <button\n                                    onClick={(e) => {\n                                      e.preventDefault();\n                                      handleReserve(book._id);\n                                    }}\n                                    disabled={borrowing}\n                                    className=\"flex-1 bg-amber-500 hover:bg-amber-600 text-white text-xs font-bold py-2 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                                  >\n                                    {borrowing ? 'Processing...' : 'Reserve'}\n                                  </button>\n                                ) : (\n                                  <button\n                                    disabled\n                                    className=\"flex-1 bg-surface-dark/50 text-text-secondary text-xs font-bold py-2 rounded border border-surface-border cursor-not-allowed\"\n                                    title=\"Premium feature - Upgrade to reserve books\"\n                                  >\n                                    Premium Only\n                                  </button>\n                                );\n                              })()\n                            )}\n                            <button className=\"bg-white/10 hover:bg-white/20 text-white p-2 rounded transition-colors\" title=\"Add to List\">\n                              <span className=\"material-symbols-outlined text-[18px] leading-none\">bookmark_add</span>\n                            </button>\n                          </div>\n                        </div>\n                      </div>\n                    </Link>\n                    <div className=\"flex flex-col\">\n                      <h3 className=\"text-white font-semibold text-base leading-tight truncate pr-2\" title={book.title}>\n                        {book.title}\n                      </h3>\n                      <div className=\"flex items-center justify-between mt-1\">\n                        <p className=\"text-gray-400 text-sm truncate\">{book.author}</p>\n                        {book.rating > 0 && (\n                          <div className=\"flex items-center gap-0.5 text-amber-400\">\n                            <span className=\"material-symbols-outlined text-[14px] fill-current\">star</span>\n                            <span className=\"text-xs font-medium\">{book.rating.toFixed(1)}</span>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n\n              {/* Load More */}\n              {pagination.page < pagination.pages && (\n                <div className=\"mt-16 flex flex-col items-center justify-center gap-4\">\n                  <button\n                    onClick={loadMore}\n                    className=\"bg-surface-dark-hover hover:bg-primary/20 text-white font-medium py-3 px-8 rounded-lg border border-white/10 hover:border-primary/50 transition-all shadow-lg flex items-center gap-2\"\n                  >\n                    Load More Books\n                    <span className=\"material-symbols-outlined text-sm\">expand_more</span>\n                  </button>\n                  <p className=\"text-gray-500 text-sm\">\n                    You've viewed {books.length} of {pagination.total} items\n                  </p>\n                  <div className=\"w-48 h-1 bg-surface-dark rounded-full overflow-hidden\">\n                    <div\n                      className=\"h-full bg-primary transition-all\"\n                      style={{ width: `${(books.length / pagination.total) * 100}%` }}\n                    ></div>\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n        </section>\n      </div>\n    </div>\n  );\n}\n\nexport default function BrowsePage() {\n  return (\n    <Suspense fallback={\n      <div className=\"flex-1 overflow-y-auto p-4 md:p-10 pb-20\">\n        <div className=\"max-w-[1440px] mx-auto w-full text-center py-12 text-text-secondary\">\n          <div className=\"flex justify-center mb-3\">\n            <Loader />\n          </div>\n        </div>\n      </div>\n    }>\n      <BrowseContent />\n    </Suspense>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\layout.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\my-borrowings\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchBorrowings'. Either include it or remove the dependency array.","line":36,"column":6,"nodeType":"ArrayExpression","endLine":36,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchBorrowings, userData]","fix":{"range":[1164,1174],"text":"[fetchBorrowings, userData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState, Suspense } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useSearchParams, useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { showSuccess, showError, showConfirm } from '@/lib/swal';\nimport Loader from '@/components/Loader';\n\nfunction MyShelfPageContent() {\n  const { userData } = useAuth();\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const [borrowings, setBorrowings] = useState({\n    active: [],\n    overdue: [],\n    returned: [],\n  });\n  const [stats, setStats] = useState({\n    active: 0,\n    overdue: 0,\n    returned: 0,\n    total: 0,\n  });\n  const [loading, setLoading] = useState(true);\n  const [filter, setFilter] = useState('all'); // all, active, overdue, returned\n  const [processing, setProcessing] = useState(null);\n  const [reviewModal, setReviewModal] = useState({ open: false, borrowing: null });\n  const [reviewData, setReviewData] = useState({ rating: 5, comment: '' });\n  const [submittingReview, setSubmittingReview] = useState(false);\n\n  useEffect(() => {\n    if (userData?._id) {\n      fetchBorrowings();\n    }\n  }, [userData]);\n\n  const fetchBorrowings = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch(`/api/borrowings/member/${userData._id}`);\n      if (response.ok) {\n        const data = await response.json();\n        const active = data.borrowings.filter((b) => b.status === 'active');\n        const overdue = data.borrowings.filter((b) => b.status === 'overdue');\n        const returned = data.borrowings.filter((b) => b.status === 'returned');\n        setBorrowings({ active, overdue, returned });\n        setStats(data.stats);\n      }\n    } catch (error) {\n      console.error('Error fetching borrowings:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRenew = async (borrowingId) => {\n    try {\n      setProcessing(borrowingId);\n      const response = await fetch(`/api/borrowings/${borrowingId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ action: 'renew' }),\n      });\n\n      if (response.ok) {\n        showSuccess('Success!', 'Book renewed successfully!');\n        await fetchBorrowings();\n      } else {\n        const error = await response.json();\n        showError('Error', error.error || 'Failed to renew book');\n      }\n    } catch (error) {\n      console.error('Error renewing book:', error);\n      showError('Error', 'Failed to renew book');\n    } finally {\n      setProcessing(null);\n    }\n  };\n\n  const handleReturn = async (borrowingId) => {\n    const result = await showConfirm('Return Book', 'Are you sure you want to return this book?');\n    if (!result.isConfirmed) return;\n\n    try {\n      setProcessing(borrowingId);\n      const response = await fetch(`/api/borrowings/${borrowingId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ action: 'return' }),\n      });\n\n      if (response.ok) {\n        showSuccess('Success!', 'Book returned successfully!');\n        await fetchBorrowings();\n        router.push('/member/my-borrowings');\n      } else {\n        const error = await response.json();\n        showError('Error', error.error || 'Failed to return book');\n      }\n    } catch (error) {\n      console.error('Error returning book:', error);\n      showError('Error', 'Failed to return book');\n    } finally {\n      setProcessing(null);\n    }\n  };\n\n  const openReviewModal = (borrowing) => {\n    setReviewModal({ open: true, borrowing });\n    setReviewData({ rating: 5, comment: '' });\n  };\n\n  const closeReviewModal = () => {\n    setReviewModal({ open: false, borrowing: null });\n    setReviewData({ rating: 5, comment: '' });\n  };\n\n  const handleSubmitReview = async () => {\n    if (!reviewData.comment.trim()) {\n      showError('Comment Required', 'Please write a comment for your review.');\n      return;\n    }\n\n    try {\n      setSubmittingReview(true);\n      const response = await fetch('/api/reviews', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          bookId: reviewModal.borrowing.book._id,\n          userId: userData._id,\n          rating: reviewData.rating,\n          comment: reviewData.comment,\n        }),\n      });\n\n      if (response.ok) {\n        showSuccess('Review Submitted!', 'Thank you for sharing your thoughts!');\n        closeReviewModal();\n      } else {\n        const error = await response.json();\n        showError('Error', error.error || 'Failed to submit review');\n      }\n    } catch (error) {\n      console.error('Error submitting review:', error);\n      showError('Error', 'Failed to submit review');\n    } finally {\n      setSubmittingReview(false);\n    }\n  };\n\n\n  const displayBorrowings = () => {\n    if (filter === 'active') return borrowings.active;\n    if (filter === 'overdue') return borrowings.overdue;\n    if (filter === 'returned') return borrowings.returned;\n    return [...borrowings.overdue, ...borrowings.active, ...borrowings.returned];\n  };\n\n  return (\n    <div className=\"flex-1 overflow-y-auto p-8 pb-20\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"flex flex-col gap-6\">\n          <div>\n            <h2 className=\"text-3xl font-black tracking-tight text-white mb-2\">My Borrowings</h2>\n            <p className=\"text-text-secondary\">Your borrowed books and reading history</p>\n          </div>\n\n          {/* Filter Tabs */}\n          <div className=\"flex gap-2 overflow-x-auto pb-2 hide-scrollbar\">\n            <button\n              onClick={() => setFilter('all')}\n              className={`whitespace-nowrap px-4 py-2 rounded-lg text-sm font-semibold transition-all ${\n                filter === 'all'\n                  ? 'bg-primary text-white shadow-lg shadow-primary/25'\n                  : 'bg-surface-dark text-text-secondary hover:bg-surface-hover hover:text-white border border-[#3c2348]'\n              }`}\n            >\n              All ({stats.total})\n            </button>\n            <button\n              onClick={() => setFilter('active')}\n              className={`whitespace-nowrap px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${\n                filter === 'active'\n                  ? 'bg-primary text-white'\n                  : 'bg-surface-dark text-text-secondary hover:bg-surface-hover hover:text-white border border-[#3c2348]'\n              }`}\n            >\n              Active ({stats.active})\n            </button>\n            <button\n              onClick={() => setFilter('overdue')}\n              className={`whitespace-nowrap px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${\n                filter === 'overdue'\n                  ? 'bg-alert-red text-white'\n                  : 'bg-surface-dark text-text-secondary hover:bg-surface-hover hover:text-white border border-[#3c2348]'\n              }`}\n            >\n              Overdue ({stats.overdue})\n            </button>\n            <button\n              onClick={() => setFilter('returned')}\n              className={`whitespace-nowrap px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n                filter === 'returned'\n                  ? 'bg-primary text-white'\n                  : 'bg-surface-dark text-text-secondary hover:bg-surface-hover hover:text-white border border-[#3c2348]'\n              }`}\n            >\n              History ({stats.returned})\n            </button>\n          </div>\n\n          {loading ? (\n            <div className=\"text-center py-12 text-text-secondary\">\n              <div className=\"flex justify-center mb-3\">\n                <Loader />\n              </div>\n            </div>\n          ) : displayBorrowings().length === 0 ? (\n            <div className=\"text-center py-12 text-text-secondary\">\n              <span className=\"material-symbols-outlined text-5xl mb-3 opacity-50\">shelves</span>\n              <p className=\"text-lg\">\n                {filter === 'all'\n                  ? 'No books on your shelf yet'\n                  : filter === 'returned'\n                  ? 'No returned books yet'\n                  : `No ${filter} books`}\n              </p>\n              {filter !== 'returned' && (\n                <Link\n                  href=\"/member/explore\"\n                  className=\"inline-block mt-4 text-primary hover:text-white transition-colors font-medium\"\n                >\n                  Browse our collection \n                </Link>\n              )}\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {displayBorrowings().map((borrowing) => {\n                const isOverdue = borrowing.status === 'overdue';\n                const isReturned = borrowing.status === 'returned';\n\n                return (\n                  <div\n                    key={borrowing._id}\n                    className={`bg-surface-dark rounded-xl p-4 border transition-all group flex flex-col h-full ${\n                      isOverdue\n                        ? 'border-alert-red/40 hover:border-alert-red'\n                        : isReturned\n                        ? 'border-[#3c2348] opacity-80'\n                        : 'border-[#3c2348] hover:border-primary/50'\n                    }`}\n                  >\n                    <div className=\"relative w-full aspect-[16/9] mb-4 overflow-hidden rounded-lg\">\n                      <div\n                        className=\"absolute inset-0 bg-cover bg-center transition-transform duration-500 group-hover:scale-105\"\n                        style={{ backgroundImage: `url('${borrowing.book?.coverImage}')` }}\n                      ></div>\n                      <div className=\"absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors\"></div>\n                      {isOverdue && (\n                        <div className=\"absolute top-2 right-2 p-3 z-10\">\n                          <span className=\"animate-pulse size-2 rounded-full bg-alert-red block shadow-[0_0_10px_red]\"></span>\n                        </div>\n                      )}\n                      <div\n                        className={`absolute bottom-2 right-2 backdrop-blur-md text-xs font-bold px-2 py-1 rounded ${\n                          isOverdue\n                            ? 'bg-alert-red/20 border border-alert-red/30 text-alert-red'\n                            : isReturned\n                            ? 'bg-gray-500/20 border border-gray-500/30 text-gray-300'\n                            : borrowing.daysRemaining <= 3\n                            ? 'bg-orange-500/20 border border-orange-500/30 text-orange-300'\n                            : 'bg-emerald-500/20 border border-emerald-500/30 text-emerald-300'\n                        }`}\n                      >\n                        {isOverdue\n                          ? `Overdue`\n                          : isReturned\n                          ? 'Returned'\n                          : `Due ${new Date(borrowing.dueDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`}\n                      </div>\n                    </div>\n                    <div className=\"flex-1\">\n                      <h4 className=\"text-white font-bold truncate\">{borrowing.book?.title}</h4>\n                      <p className=\"text-text-secondary text-xs mb-3\">{borrowing.book?.author}</p>\n                      {!isReturned && (\n                        <div className=\"w-full bg-[#1c1022] h-1.5 rounded-full overflow-hidden mb-2\">\n                          <div\n                            className={`h-full rounded-full ${\n                              isOverdue ? 'bg-alert-red' : borrowing.daysRemaining <= 3 ? 'bg-orange-500' : 'bg-emerald-500'\n                            }`}\n                            style={{\n                              width: isOverdue\n                                ? '100%'\n                                : `${Math.min((borrowing.daysRemaining / 7) * 100, 100)}%`,\n                            }}\n                          ></div>\n                        </div>\n                      )}\n                      <p\n                        className={`text-[10px] text-right mt-1 ${\n                          isOverdue\n                            ? 'text-alert-red font-bold'\n                            : borrowing.daysRemaining <= 3\n                            ? 'text-orange-300'\n                            : 'text-text-secondary'\n                        }`}\n                      >\n                        {isOverdue\n                          ? `${borrowing.daysOverdue} day${borrowing.daysOverdue !== 1 ? 's' : ''} overdue`\n                          : isReturned\n                          ? `Returned ${new Date(borrowing.returnedDate).toLocaleDateString()}`\n                          : `${borrowing.daysRemaining} day${borrowing.daysRemaining !== 1 ? 's' : ''} left`}\n                      </p>\n                    </div>\n                    {!isReturned && (\n                      <div className=\"mt-4 flex gap-2\">\n                        {!isOverdue && borrowing.renewalCount < 2 && (\n                          <button\n                            onClick={() => handleRenew(borrowing._id)}\n                            disabled={processing === borrowing._id}\n                            className=\"flex-1 bg-primary/10 hover:bg-primary text-primary hover:text-white text-xs font-bold py-2 rounded-lg transition-colors disabled:opacity-50\"\n                          >\n                            {processing === borrowing._id ? 'Processing...' : 'Renew'}\n                          </button>\n                        )}\n                        <button\n                          onClick={() => handleReturn(borrowing._id)}\n                          disabled={processing === borrowing._id}\n                          className={`flex-1 text-xs font-bold py-2 rounded-lg transition-colors disabled:opacity-50 ${\n                            isOverdue\n                              ? 'bg-alert-red hover:bg-red-600 text-white shadow-lg shadow-red-900/20'\n                              : 'bg-[#3c2348] hover:bg-white/10 text-white'\n                          }`}\n                        >\n                          {processing === borrowing._id ? 'Processing...' : 'Return'}\n                        </button>\n                      </div>\n                    )}\n                    {isReturned && (\n                      <div className=\"mt-4\">\n                        <button\n                          onClick={() => openReviewModal(borrowing)}\n                          className=\"w-full bg-primary/10 hover:bg-primary text-primary hover:text-white text-xs font-bold py-2 rounded-lg transition-colors flex items-center justify-center gap-2\"\n                        >\n                          <span className=\"material-symbols-outlined !text-[16px]\">rate_review</span>\n                          <span>Write Review</span>\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Review Modal */}\n      {reviewModal.open && reviewModal.borrowing && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in\">\n          <div className=\"bg-surface-dark border border-surface-border rounded-2xl p-6 max-w-lg w-full shadow-2xl\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-xl font-bold text-white\">Write a Review</h3>\n              <button\n                onClick={closeReviewModal}\n                className=\"text-text-secondary hover:text-white transition-colors\"\n              >\n                <span className=\"material-symbols-outlined\">close</span>\n              </button>\n            </div>\n\n            <div className=\"mb-4\">\n              <p className=\"text-text-secondary text-sm mb-2\">Book: <span className=\"text-white font-medium\">{reviewModal.borrowing.book?.title}</span></p>\n            </div>\n\n            {/* Star Rating */}\n            <div className=\"mb-4\">\n              <label className=\"block text-text-secondary text-sm font-medium mb-2\">Rating</label>\n              <div className=\"flex gap-2\">\n                {[1, 2, 3, 4, 5].map((star) => (\n                  <button\n                    key={star}\n                    onClick={() => setReviewData({ ...reviewData, rating: star })}\n                    className=\"text-3xl transition-colors hover:scale-110 transform\"\n                  >\n                    <span className={`material-symbols-outlined ${star <= reviewData.rating ? 'fill text-yellow-400' : 'text-gray-600'}`}>\n                      star\n                    </span>\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            {/* Comment */}\n            <div className=\"mb-6\">\n              <label className=\"block text-text-secondary text-sm font-medium mb-2\">Your Review</label>\n              <textarea\n                value={reviewData.comment}\n                onChange={(e) => setReviewData({ ...reviewData, comment: e.target.value })}\n                placeholder=\"Share your thoughts about this book...\"\n                className=\"w-full bg-background-dark border border-surface-border rounded-lg p-3 text-white placeholder-text-secondary focus:border-primary focus:outline-none resize-none\"\n                rows={4}\n              />\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex gap-3\">\n              <button\n                onClick={closeReviewModal}\n                className=\"flex-1 bg-surface-dark border border-surface-border text-text-secondary hover:text-white hover:border-primary py-2 rounded-lg transition-colors font-medium\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleSubmitReview}\n                disabled={submittingReview}\n                className=\"flex-1 bg-primary hover:bg-primary-hover text-white py-2 rounded-lg transition-colors font-bold disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {submittingReview ? 'Submitting...' : 'Submit Review'}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default function MyShelfPage() {\n  return (\n    <Suspense fallback={<Loader />}>\n      <MyShelfPageContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\notifications\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNotifications'. Either include it or remove the dependency array.","line":19,"column":6,"nodeType":"ArrayExpression","endLine":19,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [userData?._id, page, fetchNotifications]","fix":{"range":[552,573],"text":"[userData?._id, page, fetchNotifications]"}}]},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Loader' is not defined.","line":184,"column":16,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":184,"endColumn":22},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":191,"column":44,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[6843,6864],"text":"You&apos;re all caught up!"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[6843,6864],"text":"You&lsquo;re all caught up!"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[6843,6864],"text":"You&#39;re all caught up!"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[6843,6864],"text":"You&rsquo;re all caught up!"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport Link from 'next/link';\n\nexport default function NotificationsPage() {\n  const { userData } = useAuth();\n  const [notifications, setNotifications] = useState([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [page, setPage] = useState(1);\n  const [hasMore, setHasMore] = useState(true);\n\n  useEffect(() => {\n    if (userData?._id) {\n      fetchNotifications();\n    }\n  }, [userData?._id, page]);\n\n  const fetchNotifications = async () => {\n    if (!userData?._id) return;\n\n    try {\n      setLoading(true);\n      const response = await fetch(`/api/notifications?userId=${userData._id}&limit=20&page=${page}`);\n      if (response.ok) {\n        const data = await response.json();\n        if (page === 1) {\n          setNotifications(data.notifications || []);\n        } else {\n          setNotifications(prev => [...prev, ...(data.notifications || [])]);\n        }\n        setUnreadCount(data.unreadCount || 0);\n        setHasMore(data.pagination.pages > page);\n      }\n    } catch (error) {\n      console.error('Error fetching notifications:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const markAsRead = async (notificationId) => {\n    try {\n      const response = await fetch(`/api/notifications/${notificationId}`, {\n        method: 'PATCH',\n      });\n      if (response.ok) {\n        setNotifications(prev =>\n          prev.map(n => n._id === notificationId ? { ...n, read: true } : n)\n        );\n        setUnreadCount(prev => Math.max(0, prev - 1));\n      }\n    } catch (error) {\n      console.error('Error marking notification as read:', error);\n    }\n  };\n\n  const markAllAsRead = async () => {\n    if (!userData?._id) return;\n\n    try {\n      const response = await fetch('/api/notifications/mark-all-read', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ userId: userData._id }),\n      });\n      if (response.ok) {\n        setNotifications(prev => prev.map(n => ({ ...n, read: true })));\n        setUnreadCount(0);\n      }\n    } catch (error) {\n      console.error('Error marking all as read:', error);\n    }\n  };\n\n  const deleteNotification = async (notificationId) => {\n    try {\n      const response = await fetch(`/api/notifications/${notificationId}`, {\n        method: 'DELETE',\n      });\n      if (response.ok) {\n        setNotifications(prev => prev.filter(n => n._id !== notificationId));\n        // Check if it was unread\n        const notification = notifications.find(n => n._id === notificationId);\n        if (notification && !notification.read) {\n          setUnreadCount(prev => Math.max(0, prev - 1));\n        }\n      }\n    } catch (error) {\n      console.error('Error deleting notification:', error);\n    }\n  };\n\n  const getNotificationIcon = (type) => {\n    const icons = {\n      borrowing_due: 'schedule',\n      borrowing_overdue: 'warning',\n      reservation_ready: 'check_circle',\n      reservation_expired: 'schedule',\n      fine_issued: 'attach_money',\n      payment_received: 'check_circle',\n      book_available: 'book',\n    };\n    return icons[type] || 'notifications';\n  };\n\n  const getNotificationColor = (type) => {\n    const colors = {\n      borrowing_due: 'bg-orange-500/10 text-orange-400 border-orange-500/20',\n      borrowing_overdue: 'bg-red-500/10 text-red-400 border-red-500/20',\n      reservation_ready: 'bg-green-500/10 text-green-400 border-green-500/20',\n      reservation_expired: 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20',\n      fine_issued: 'bg-red-500/10 text-red-400 border-red-500/20',\n      payment_received: 'bg-green-500/10 text-green-400 border-green-500/20',\n      book_available: 'bg-blue-500/10 text-blue-400 border-blue-500/20',\n    };\n    return colors[type] || 'bg-primary/10 text-primary border-primary/20';\n  };\n\n  const getActionLink = (notification) => {\n    if (notification.metadata?.borrowing) {\n      return '/member/my-borrowings';\n    }\n    if (notification.metadata?.reservation) {\n      return '/member/reservations';\n    }\n    if (notification.metadata?.fine || notification.metadata?.payment) {\n      return '/member/billing';\n    }\n    if (notification.metadata?.book) {\n      return `/member/explore?book=${notification.metadata.book}`;\n    }\n    return null;\n  };\n\n  const formatTime = (date) => {\n    const now = new Date();\n    const notificationDate = new Date(date);\n    const diffMs = now - notificationDate;\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n    const diffDays = Math.floor(diffMs / 86400000);\n\n    if (diffMins < 1) return 'Just now';\n    if (diffMins < 60) return `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;\n    if (diffHours < 24) return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;\n    if (diffDays < 7) return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;\n    return notificationDate.toLocaleDateString('en-US', { \n      month: 'short', \n      day: 'numeric',\n      year: notificationDate.getFullYear() !== now.getFullYear() ? 'numeric' : undefined,\n    });\n  };\n\n  return (\n    <div className=\"flex-1 overflow-y-auto p-6 md:p-8 pb-20 scroll-smooth\">\n      <div className=\"max-w-4xl mx-auto flex flex-col gap-6\">\n        {/* Page Header */}\n        <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-4\">\n          <div className=\"flex flex-col gap-1\">\n            <h2 className=\"text-3xl md:text-4xl font-black tracking-tight text-white\">Notifications</h2>\n            <p className=\"text-text-secondary text-sm md:text-base\">\n              {unreadCount > 0 \n                ? `${unreadCount} unread notification${unreadCount !== 1 ? 's' : ''}`\n                : 'All caught up!'}\n            </p>\n          </div>\n          {unreadCount > 0 && (\n            <button\n              onClick={markAllAsRead}\n              className=\"px-4 py-2 bg-primary/10 hover:bg-primary text-primary hover:text-white border border-primary/20 rounded-lg transition-colors text-sm font-medium\"\n            >\n              Mark all as read\n            </button>\n          )}\n        </div>\n\n        {/* Notifications List */}\n        {loading && notifications.length === 0 ? (\n          <div className=\"text-center py-12 text-text-secondary\">\n            <div className=\"flex justify-center mb-3\">\n              <Loader />\n            </div>\n          </div>\n        ) : notifications.length === 0 ? (\n          <div className=\"text-center py-12 text-text-secondary\">\n            <span className=\"material-symbols-outlined text-5xl mb-3 opacity-50\">notifications_off</span>\n            <p className=\"text-lg\">No notifications</p>\n            <p className=\"text-sm mt-2\">You're all caught up!</p>\n          </div>\n        ) : (\n          <div className=\"flex flex-col gap-3\">\n            {notifications.map((notification) => {\n              const actionLink = getActionLink(notification);\n              const NotificationContent = (\n                <div\n                  className={`bg-surface-dark rounded-xl p-5 border transition-all ${\n                    !notification.read \n                      ? 'border-primary/30 bg-primary/5' \n                      : 'border-[#3c2348] hover:border-[#3c2348]/50'\n                  }`}\n                >\n                  <div className=\"flex gap-4\">\n                    <div className={`flex-shrink-0 size-12 rounded-full border flex items-center justify-center ${getNotificationColor(notification.type)}`}>\n                      <span className=\"material-symbols-outlined\">\n                        {getNotificationIcon(notification.type)}\n                      </span>\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-start justify-between gap-2 mb-2\">\n                        <h3 className={`text-base font-bold text-white ${!notification.read ? '' : 'opacity-70'}`}>\n                          {notification.title}\n                        </h3>\n                        {!notification.read && (\n                          <span className=\"size-2 bg-primary rounded-full flex-shrink-0 mt-2\"></span>\n                        )}\n                      </div>\n                      <p className={`text-sm text-text-secondary mb-3 ${!notification.read ? '' : 'opacity-60'}`}>\n                        {notification.message}\n                      </p>\n                      <div className=\"flex items-center justify-between\">\n                        <p className=\"text-xs text-text-secondary/60\">\n                          {formatTime(notification.createdAt)}\n                        </p>\n                        <div className=\"flex items-center gap-2\">\n                          {!notification.read && (\n                            <button\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                markAsRead(notification._id);\n                              }}\n                              className=\"text-xs text-primary hover:text-white transition-colors\"\n                            >\n                              Mark as read\n                            </button>\n                          )}\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              deleteNotification(notification._id);\n                            }}\n                            className=\"text-xs text-text-secondary hover:text-red-400 transition-colors\"\n                          >\n                            Delete\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              );\n\n              return actionLink ? (\n                <Link key={notification._id} href={actionLink}>\n                  {NotificationContent}\n                </Link>\n              ) : (\n                <div key={notification._id}>\n                  {NotificationContent}\n                </div>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Load More */}\n        {hasMore && !loading && (\n          <div className=\"text-center\">\n            <button\n              onClick={() => setPage(prev => prev + 1)}\n              className=\"px-6 py-2 bg-surface-dark hover:bg-surface-hover border border-[#3c2348] rounded-lg text-white transition-colors\"\n            >\n              Load More\n            </button>\n          </div>\n        )}\n\n        {loading && notifications.length > 0 && (\n          <div className=\"text-center py-4\">\n            <span className=\"material-symbols-outlined animate-spin text-text-secondary\">refresh</span>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\overview\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchActivityFeed' and 'fetchStats'. Either include them or remove the dependency array.","line":38,"column":6,"nodeType":"ArrayExpression","endLine":38,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchActivityFeed, fetchStats, userData]","fix":{"range":[1113,1123],"text":"[fetchActivityFeed, fetchStats, userData]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":107,"column":61,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3488,3545],"text":". Here&apos;s what's happening with your library.\n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3488,3545],"text":". Here&lsquo;s what's happening with your library.\n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3488,3545],"text":". Here&#39;s what's happening with your library.\n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3488,3545],"text":". Here&rsquo;s what's happening with your library.\n            "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":107,"column":68,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3488,3545],"text":". Here's what&apos;s happening with your library.\n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3488,3545],"text":". Here's what&lsquo;s happening with your library.\n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3488,3545],"text":". Here's what&#39;s happening with your library.\n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3488,3545],"text":". Here's what&rsquo;s happening with your library.\n            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport Link from 'next/link';\nimport Loader from '@/components/Loader';\nimport { CardSkeleton } from '@/components/LoadingSkeleton';\nimport { showError } from '@/lib/swal';\nimport EmptyState from '@/components/EmptyState';\nimport OptimizedImage from '@/components/OptimizedImage';\n\nexport default function MemberOverviewPage() {\n  const { userData } = useAuth();\n  const [stats, setStats] = useState({\n    activeLoans: 0,\n    overdueLoans: 0,\n    outstandingFines: 0,\n    booksReadThisYear: 0,\n    yearlyGoal: 25,\n    goalPercentage: 0,\n    activeBorrowings: [],\n    overdueBorrowings: [],\n    monthlyBorrowingData: [],\n    favoriteGenre: null,\n    favoriteGenrePercentage: 0,\n    averageReadingTime: 0,\n    upcomingDue: [],\n  });\n  const [loading, setLoading] = useState(true);\n  const [activityFeed, setActivityFeed] = useState([]);\n  const [activityLoading, setActivityLoading] = useState(true);\n\n  useEffect(() => {\n    if (userData?._id) {\n      fetchStats();\n      fetchActivityFeed();\n    }\n  }, [userData]);\n\n  const fetchStats = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch(`/api/member/stats?memberId=${userData._id}`);\n      \n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || 'Failed to fetch statistics');\n      }\n      \n      const data = await response.json();\n      setStats({\n        ...data,\n        monthlyBorrowingData: data.monthlyBorrowingData || [],\n        favoriteGenre: data.favoriteGenre || null,\n        favoriteGenrePercentage: data.favoriteGenrePercentage || 0,\n        averageReadingTime: data.averageReadingTime || 0,\n        upcomingDue: data.upcomingDue || [],\n      });\n    } catch (error) {\n      console.error('Error fetching stats:', error);\n      showError('Error Loading Stats', error.message || 'Failed to load your statistics. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchActivityFeed = async () => {\n    if (!userData?._id) {\n      setActivityLoading(false);\n      return;\n    }\n\n    try {\n      setActivityLoading(true);\n      const response = await fetch(`/api/notifications?userId=${userData._id}&limit=3`);\n      \n      if (response.ok) {\n        const data = await response.json();\n        setActivityFeed(data.notifications || []);\n      } else {\n        // If API returns error, set empty array\n        setActivityFeed([]);\n        console.error('Failed to fetch activity feed:', response.status, response.statusText);\n      }\n    } catch (error) {\n      console.error('Error fetching activity feed:', error);\n      setActivityFeed([]);\n    } finally {\n      setActivityLoading(false);\n    }\n  };\n\n  const currentDate = new Date().toLocaleDateString('en-US', {\n    month: 'long',\n    day: 'numeric',\n    year: 'numeric',\n  });\n\n  return (\n    <div className=\"flex-1 overflow-y-auto p-6 md:p-8 pb-20 scroll-smooth\">\n      <div className=\"max-w-7xl mx-auto flex flex-col gap-8\">\n        {/* Page Header */}\n        <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-4\">\n          <div className=\"flex flex-col gap-1\">\n            <h2 className=\"text-3xl md:text-4xl font-black tracking-tight text-white\">Overview</h2>\n            <p className=\"text-text-secondary text-sm md:text-base\">\n              Welcome back, {userData?.name || 'User'}. Here's what's happening with your library.\n            </p>\n          </div>\n          <div className=\"hidden md:block text-right\">\n            <p className=\"text-xs font-bold text-primary uppercase tracking-widest mb-1\">Current Date</p>\n            <p className=\"text-white font-medium\">{currentDate}</p>\n          </div>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {/* Outstanding Fines */}\n          <div className=\"rounded-2xl bg-surface-dark border border-alert-red/30 p-5 flex items-center gap-4 relative overflow-hidden group\">\n            <div className=\"absolute inset-y-0 left-0 w-1 bg-alert-red\"></div>\n            <div className=\"size-12 rounded-full bg-alert-red/10 flex items-center justify-center text-alert-red flex-shrink-0\">\n              <span className=\"material-symbols-outlined\">attach_money</span>\n            </div>\n            <div className=\"flex flex-col\">\n              <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider\">Outstanding Fines</p>\n              <div className=\"flex items-baseline gap-2\">\n                <p className=\"text-2xl font-bold text-white\">{stats.outstandingFines.toFixed(2)} BDT</p>\n                {stats.outstandingFines > 0 && (\n                  <span className=\"text-xs text-alert-red font-medium\">Action Required</span>\n                )}\n              </div>\n            </div>\n            {stats.outstandingFines > 0 && (\n              <Link\n                href=\"/member/billing\"\n                className=\"absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity bg-alert-red text-white text-xs font-bold px-3 py-1.5 rounded-lg shadow-lg\"\n              >\n                Pay\n              </Link>\n            )}\n          </div>\n\n          {/* Active Loans */}\n          <div className=\"rounded-2xl bg-surface-dark border border-[#3c2348] p-5 flex items-center gap-4\">\n            <div className=\"size-12 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-400 flex-shrink-0\">\n              <span className=\"material-symbols-outlined\">book</span>\n            </div>\n            <div className=\"flex flex-col\">\n              <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider\">Active Loans</p>\n              <p className=\"text-2xl font-bold text-white\">\n                {stats.activeLoans} <span className=\"text-sm font-normal text-text-secondary\">/ {userData?.subscription?.type === 'free' ? '1' : '4'}</span>\n              </p>\n            </div>\n          </div>\n\n          {/* Yearly Goal */}\n          <div className=\"rounded-2xl bg-surface-dark border border-[#3c2348] p-5 flex items-center gap-4\">\n            <div className=\"size-12 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-400 flex-shrink-0\">\n              <span className=\"material-symbols-outlined\">emoji_events</span>\n            </div>\n            <div className=\"flex flex-col w-full\">\n              <div className=\"flex justify-between items-center\">\n                <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider\">Yearly Goal</p>\n                <span className=\"text-xs text-emerald-400 font-bold\">{stats.goalPercentage}%</span>\n              </div>\n              <div className=\"flex items-baseline gap-1\">\n                <p className=\"text-2xl font-bold text-white\">{stats.booksReadThisYear}</p>\n                <p className=\"text-sm text-text-secondary\">books read</p>\n              </div>\n              <div className=\"w-full bg-[#1c1022] h-1 rounded-full mt-2\">\n                <div className=\"bg-emerald-500 h-full rounded-full transition-all\" style={{ width: `${Math.min(stats.goalPercentage, 100)}%` }}></div>\n              </div>\n            </div>\n          </div>\n\n          {/* Reading Streak */}\n          <div className=\"rounded-2xl bg-surface-dark border border-[#3c2348] p-5 flex items-center gap-4\">\n            <div className=\"size-12 rounded-full bg-primary/10 flex items-center justify-center text-primary flex-shrink-0\">\n              <span className=\"material-symbols-outlined\">local_fire_department</span>\n            </div>\n            <div className=\"flex flex-col\">\n              <p className=\"text-text-secondary text-xs font-bold uppercase tracking-wider\">Reading Streak</p>\n              <p className=\"text-2xl font-bold text-white\">0 Days</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Currently Borrowed Section */}\n        <section className=\"flex flex-col gap-5\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-xl font-bold text-white flex items-center gap-2\">\n              <span className=\"material-symbols-outlined text-primary\">auto_stories</span>\n              Currently Borrowed\n            </h3>\n            <Link className=\"text-sm text-primary hover:text-white transition-colors font-medium\" href=\"/member/my-borrowings\">\n              View all loans\n            </Link>\n          </div>\n          {loading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6\">\n              <CardSkeleton count={4} />\n            </div>\n          ) : stats.activeBorrowings.length === 0 && stats.overdueBorrowings.length === 0 ? (\n            <EmptyState\n              icon=\"auto_stories\"\n              title=\"No books currently borrowed\"\n              description=\"Start exploring our collection and borrow your first book!\"\n              actionLabel=\"Browse Collection\"\n              actionHref=\"/member/explore\"\n            />\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6\">\n              {stats.overdueBorrowings.map((borrowing) => (\n                <div key={borrowing._id} className=\"bg-surface-dark rounded-xl p-4 border border-alert-red/40 hover:border-alert-red transition-all group flex flex-col h-full relative overflow-hidden\">\n                  <div className=\"absolute top-0 right-0 p-3 z-10\">\n                    <span className=\"animate-pulse size-2 rounded-full bg-alert-red block shadow-[0_0_10px_red]\"></span>\n                  </div>\n                  <div className=\"relative w-full aspect-[16/9] mb-4 overflow-hidden rounded-lg grayscale-[30%] group/image\">\n                    <OptimizedImage\n                      src={borrowing.book?.coverImage}\n                      alt={borrowing.book?.title || 'Book cover'}\n                      fill\n                      className=\"transition-transform duration-500 group-hover/image:scale-105\"\n                      objectFit=\"cover\"\n                    />\n                    <div className=\"absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors\"></div>\n                    <div className=\"absolute bottom-2 right-2 bg-alert-red/20 backdrop-blur-md border border-alert-red/30 text-alert-red text-xs font-bold px-2 py-1 rounded z-10\">\n                      Overdue\n                    </div>\n                  </div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"text-white font-bold truncate\">{borrowing.book?.title}</h4>\n                    <p className=\"text-text-secondary text-xs mb-3\">{borrowing.book?.author}</p>\n                    <div className=\"w-full bg-[#1c1022] h-1.5 rounded-full overflow-hidden\">\n                      <div className=\"bg-alert-red h-full w-full rounded-full\"></div>\n                    </div>\n                    <p className=\"text-[10px] text-right text-alert-red mt-1 font-bold\">\n                      {borrowing.daysOverdue} day{borrowing.daysOverdue !== 1 ? 's' : ''} overdue\n                    </p>\n                  </div>\n                  <div className=\"mt-4 flex gap-2\">\n                    <Link\n                      href={`/member/my-borrowings?return=${borrowing._id}`}\n                      className=\"flex-1 bg-alert-red hover:bg-red-600 text-white text-xs font-bold py-2 rounded-lg transition-colors shadow-lg shadow-red-900/20 text-center\"\n                    >\n                      Return Now\n                    </Link>\n                  </div>\n                </div>\n              ))}\n              {stats.activeBorrowings.map((borrowing) => (\n                <div key={borrowing._id} className=\"bg-surface-dark rounded-xl p-4 border border-[#3c2348] hover:border-primary/50 transition-all group flex flex-col h-full\">\n                  <div className=\"relative w-full aspect-[16/9] mb-4 overflow-hidden rounded-lg group/image\">\n                    <OptimizedImage\n                      src={borrowing.book?.coverImage}\n                      alt={borrowing.book?.title || 'Book cover'}\n                      fill\n                      className=\"transition-transform duration-500 group-hover/image:scale-105\"\n                      objectFit=\"cover\"\n                    />\n                    <div className=\"absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors\"></div>\n                    <div className={`absolute bottom-2 right-2 backdrop-blur-md text-xs font-bold px-2 py-1 rounded z-10 ${\n                      borrowing.daysRemaining <= 3\n                        ? 'bg-orange-500/20 border border-orange-500/30 text-orange-300'\n                        : 'bg-emerald-500/20 border border-emerald-500/30 text-emerald-300'\n                    }`}>\n                      Due {new Date(borrowing.dueDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\n                    </div>\n                  </div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"text-white font-bold truncate\">{borrowing.book?.title}</h4>\n                    <p className=\"text-text-secondary text-xs mb-3\">{borrowing.book?.author}</p>\n                    <div className=\"w-full bg-[#1c1022] h-1.5 rounded-full overflow-hidden\">\n                      <div\n                        className={`h-full rounded-full ${\n                          borrowing.daysRemaining <= 3 ? 'bg-orange-500' : 'bg-emerald-500'\n                        }`}\n                        style={{\n                          width: `${Math.min((borrowing.daysRemaining / 7) * 100, 100)}%`,\n                        }}\n                      ></div>\n                    </div>\n                    <p className={`text-[10px] text-right mt-1 ${\n                      borrowing.daysRemaining <= 3 ? 'text-orange-300' : 'text-text-secondary'\n                    }`}>\n                      {borrowing.daysRemaining} day{borrowing.daysRemaining !== 1 ? 's' : ''} left\n                    </p>\n                  </div>\n                  <div className=\"mt-4 flex gap-2\">\n                    <Link\n                      href={`/member/my-borrowings?return=${borrowing._id}`}\n                      className=\"flex-1 bg-[#3c2348] hover:bg-white/10 text-white text-xs font-bold py-2 rounded-lg transition-colors text-center\"\n                    >\n                      Return\n                    </Link>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </section>\n\n        {/* Bottom Section: Insights and Sidebar */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Borrowing Insights Section */}\n          <section className=\"lg:col-span-2 flex flex-col gap-5\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-xl font-bold text-white flex items-center gap-2\">\n                <span className=\"material-symbols-outlined text-primary\">analytics</span>\n                Borrowing Insights\n              </h3>\n              <select className=\"bg-surface-dark border border-[#3c2348] text-xs text-text-secondary rounded-lg px-2 py-1 focus:outline-none focus:border-primary\">\n                <option>Last 6 Months</option>\n                <option>This Year</option>\n              </select>\n            </div>\n            <div className=\"bg-surface-dark border border-[#3c2348] rounded-2xl p-6\">\n              <div className=\"flex flex-col gap-6\">\n                {/* Bar Chart */}\n                <div className=\"flex justify-between items-end gap-2 h-40 pt-4\">\n                  {stats.monthlyBorrowingData.length > 0 ? (\n                    stats.monthlyBorrowingData.map((monthData, index) => {\n                      const maxCount = Math.max(...stats.monthlyBorrowingData.map(m => m.count), 1);\n                      const heightPercentage = maxCount > 0 ? (monthData.count / maxCount) * 100 : 0;\n                      const isCurrentMonth = index === stats.monthlyBorrowingData.length - 1;\n                      \n                      return (\n                        <div key={index} className=\"flex flex-col items-center gap-2 flex-1 group cursor-pointer relative\">\n                          <div \n                            className={`w-full transition-colors rounded-t-sm relative ${\n                              isCurrentMonth\n                                ? 'bg-gradient-to-t from-primary to-fuchsia-500 shadow-[0_0_15px_rgba(170,31,239,0.3)]'\n                                : 'bg-[#3c2348] group-hover:bg-primary/50'\n                            }`}\n                            style={{ height: `${Math.max(heightPercentage, 5)}%` }}\n                          >\n                            {monthData.count > 0 && (\n                              <div className=\"absolute -top-8 left-1/2 -translate-x-1/2 bg-white text-black text-[10px] font-bold px-1.5 py-0.5 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap\">\n                                {monthData.count} {monthData.count === 1 ? 'Book' : 'Books'}\n                              </div>\n                            )}\n                          </div>\n                          <span className={`text-[10px] uppercase ${isCurrentMonth ? 'text-white font-bold' : 'text-text-secondary'}`}>\n                            {monthData.month}\n                          </span>\n                        </div>\n                      );\n                    })\n                  ) : (\n                    // Show empty bars if no data\n                    Array.from({ length: 6 }).map((_, index) => (\n                      <div key={index} className=\"flex flex-col items-center gap-2 flex-1\">\n                        <div className=\"w-full bg-[#3c2348] rounded-t-sm\" style={{ height: '5%' }}></div>\n                        <span className=\"text-[10px] text-text-secondary uppercase\">---</span>\n                      </div>\n                    ))\n                  )}\n                </div>\n\n                {/* Stats Footer */}\n                <div className=\"border-t border-[#3c2348] pt-4 flex justify-between gap-4\">\n                  <div className=\"flex gap-3\">\n                    <div className=\"flex flex-col\">\n                      <span className=\"text-xs text-text-secondary\">Favorite Genre</span>\n                      <span className=\"text-sm font-bold text-white\">\n                        {stats.favoriteGenre || 'N/A'} {stats.favoriteGenrePercentage > 0 ? `(${stats.favoriteGenrePercentage}%)` : ''}\n                      </span>\n                    </div>\n                  </div>\n                  <div className=\"flex gap-3\">\n                    <div className=\"flex flex-col text-right\">\n                      <span className=\"text-xs text-text-secondary\">Avg. Reading Time</span>\n                      <span className=\"text-sm font-bold text-white\">\n                        {stats.averageReadingTime > 0 ? `${stats.averageReadingTime} days/book` : 'N/A'}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </section>\n\n          {/* Sidebar: Upcoming Due & Activity Feed */}\n          <aside className=\"flex flex-col gap-6\">\n            {/* Upcoming Due Section */}\n            <div className=\"flex flex-col gap-3\">\n              <h3 className=\"text-xl font-bold text-white flex items-center gap-2\">\n                <span className=\"material-symbols-outlined text-primary\">event_upcoming</span>\n                Upcoming Due\n              </h3>\n              <div className=\"bg-surface-dark border border-[#3c2348] rounded-2xl overflow-hidden\">\n                {stats.upcomingDue.length === 0 ? (\n                  <div className=\"p-4 text-center text-text-secondary text-sm\">\n                    No upcoming due dates\n                  </div>\n                ) : (\n                  <>\n                    {stats.upcomingDue.map((item, index) => {\n                      const dueDate = new Date(item.dueDate);\n                      const day = dueDate.getDate();\n                      const month = dueDate.toLocaleDateString('en-US', { month: 'short' });\n                      const isOverdue = item.daysRemaining < 0;\n                      const isSoon = item.daysRemaining <= 3 && item.daysRemaining >= 0;\n                      \n                      return (\n                        <div \n                          key={item._id}\n                          className={`p-3 border-b border-[#3c2348] hover:bg-surface-hover transition-colors cursor-pointer flex items-center gap-3 ${\n                            index === stats.upcomingDue.length - 1 ? 'border-b-0' : ''\n                          }`}\n                        >\n                          <div className={`size-10 rounded-lg flex items-center justify-center font-bold text-xs shrink-0 flex-col leading-none ${\n                            isOverdue\n                              ? 'bg-alert-red/10 text-alert-red'\n                              : isSoon\n                              ? 'bg-primary/10 text-primary'\n                              : 'bg-emerald-500/10 text-emerald-500'\n                          }`}>\n                            <span>{day}</span>\n                            <span className=\"text-[8px] uppercase\">{month}</span>\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"text-sm font-bold text-white truncate\">\n                              {item.book?.title || 'Unknown Book'}\n                            </p>\n                            <p className={`text-xs font-medium ${\n                              isOverdue\n                                ? 'text-alert-red'\n                                : isSoon\n                                ? 'text-primary'\n                                : 'text-text-secondary'\n                            }`}>\n                              {isOverdue \n                                ? `Overdue (${Math.abs(item.daysRemaining)} day${Math.abs(item.daysRemaining) !== 1 ? 's' : ''} ago)`\n                                : item.daysRemaining === 0\n                                ? 'Due today'\n                                : `Due in ${item.daysRemaining} day${item.daysRemaining !== 1 ? 's' : ''}`\n                              }\n                            </p>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </>\n                )}\n              </div>\n            </div>\n\n            {/* Activity Feed Section */}\n            <div className=\"flex flex-col gap-3\">\n              <h3 className=\"text-xl font-bold text-white flex items-center gap-2\">\n                <span className=\"material-symbols-outlined text-primary\">notifications</span>\n                Activity Feed\n              </h3>\n              <div className=\"flex flex-col gap-2\">\n                {activityLoading ? (\n                  <div className=\"text-center py-8 text-text-secondary text-sm\">\n                    <Loader />\n                  </div>\n                ) : activityFeed.length === 0 ? (\n                  <div className=\"text-center py-8 text-text-secondary text-sm\">\n                    No recent activity\n                  </div>\n                ) : (\n                  activityFeed.map((activity) => {\n                    // Determine color based on notification type\n                    let dotColor = 'bg-[#3c2348]';\n                    if (activity.type === 'borrowing_overdue' || activity.type === 'fine_issued') {\n                      dotColor = 'bg-alert-red';\n                    } else if (activity.type === 'reservation_ready' || activity.type === 'payment_received') {\n                      dotColor = 'bg-primary';\n                    }\n\n                    // Format time ago\n                    const createdAt = new Date(activity.createdAt);\n                    const now = new Date();\n                    const diffMs = now - createdAt;\n                    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n                    const diffDays = Math.floor(diffHours / 24);\n                    \n                    let timeAgo = '';\n                    if (diffHours < 1) {\n                      const diffMins = Math.floor(diffMs / (1000 * 60));\n                      timeAgo = diffMins <= 1 ? 'Just now' : `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;\n                    } else if (diffHours < 24) {\n                      timeAgo = `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;\n                    } else if (diffDays === 1) {\n                      timeAgo = 'Yesterday';\n                    } else if (diffDays < 7) {\n                      timeAgo = `${diffDays} days ago`;\n                    } else {\n                      timeAgo = createdAt.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n                    }\n\n                    return (\n                      <div key={activity._id} className=\"flex gap-3 p-3 rounded-xl hover:bg-surface-hover transition-colors cursor-pointer\">\n                        <div className={`size-2 rounded-full ${dotColor} mt-2 flex-shrink-0`}></div>\n                        <div>\n                          <p className=\"text-sm text-white\">\n                            {activity.message}\n                          </p>\n                          <p className=\"text-xs text-text-secondary mt-1\">{timeAgo}</p>\n                        </div>\n                      </div>\n                    );\n                  })\n                )}\n              </div>\n            </div>\n          </aside>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\payment-processing\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\reservations\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchReservations'. Either include it or remove the dependency array.","line":27,"column":6,"nodeType":"ArrayExpression","endLine":27,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchReservations, userData]","fix":{"range":[822,832],"text":"[fetchReservations, userData]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":408,"column":54,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[20628,20665],"text":"You haven&apos;t made any reservations yet"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[20628,20665],"text":"You haven&lsquo;t made any reservations yet"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[20628,20665],"text":"You haven&#39;t made any reservations yet"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[20628,20665],"text":"You haven&rsquo;t made any reservations yet"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { RESERVATION_STATUS } from '@/lib/constants';\r\nimport { showSuccess, showError, showConfirm } from '@/lib/swal';\r\nimport Loader from '@/components/Loader';\r\nimport Link from 'next/link';\r\n\r\nexport default function ReservationsPage() {\r\n  const { userData } = useAuth();\r\n  const [reservations, setReservations] = useState({\r\n    pending: [],\r\n    ready: [],\r\n    completed: [],\r\n    expired: [],\r\n    cancelled: [],\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [processing, setProcessing] = useState(null);\r\n  const [activeTab, setActiveTab] = useState('active'); // active, completed, all\r\n\r\n  useEffect(() => {\r\n    if (userData?._id) {\r\n      fetchReservations();\r\n    }\r\n  }, [userData]);\r\n\r\n  const fetchReservations = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch(`/api/reservations/member/${userData._id}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const grouped = {\r\n          pending: data.reservations.filter((r) => r.status === RESERVATION_STATUS.PENDING),\r\n          ready: data.reservations.filter((r) => r.status === RESERVATION_STATUS.READY),\r\n          completed: data.reservations.filter((r) => r.status === RESERVATION_STATUS.COMPLETED),\r\n          expired: data.reservations.filter((r) => r.status === RESERVATION_STATUS.EXPIRED),\r\n          cancelled: data.reservations.filter((r) => r.status === RESERVATION_STATUS.CANCELLED),\r\n        };\r\n        setReservations(grouped);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching reservations:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleCancel = async (reservationId) => {\r\n    const result = await showConfirm('Cancel Reservation', 'Are you sure you want to cancel this reservation?');\r\n    if (!result.isConfirmed) return;\r\n\r\n    try {\r\n      setProcessing(reservationId);\r\n      const response = await fetch(`/api/reservations/${reservationId}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'cancel' }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        showSuccess('Success!', 'Reservation cancelled successfully');\r\n        await fetchReservations();\r\n      } else {\r\n        const error = await response.json();\r\n        showError('Error', error.error || 'Failed to cancel reservation');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error cancelling reservation:', error);\r\n      showError('Error', 'Failed to cancel reservation');\r\n    } finally {\r\n      setProcessing(null);\r\n    }\r\n  };\r\n\r\n  const handleComplete = async (reservationId) => {\r\n    const result = await showConfirm('Claim Book', 'Claim this book and borrow it now?');\r\n    if (!result.isConfirmed) return;\r\n\r\n    try {\r\n      setProcessing(reservationId);\r\n      const response = await fetch(`/api/reservations/${reservationId}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'complete' }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        showSuccess('Success!', 'Book borrowed successfully!');\r\n        await fetchReservations();\r\n      } else {\r\n        const error = await response.json();\r\n        showError('Error', error.error || 'Failed to claim book');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error completing reservation:', error);\r\n      showError('Error', 'Failed to claim book');\r\n    } finally {\r\n      setProcessing(null);\r\n    }\r\n  };\r\n\r\n  const getDaysUntilExpiry = (expiryDate) => {\r\n    const now = new Date();\r\n    const expiry = new Date(expiryDate);\r\n    const diffTime = expiry - now;\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n    return diffDays > 0 ? diffDays : 0;\r\n  };\r\n\r\n  const activeReservations = [...reservations.pending, ...reservations.ready];\r\n  const allReservations = [\r\n    ...reservations.pending,\r\n    ...reservations.ready,\r\n    ...reservations.completed,\r\n    ...reservations.expired,\r\n    ...reservations.cancelled,\r\n  ];\r\n\r\n  // Check if user is premium\r\n  const subscriptionType = userData?.subscription?.type || 'free';\r\n  const subscriptionStatus = userData?.subscription?.status || 'active';\r\n  const isPremiumMember = (subscriptionType === 'monthly' || subscriptionType === 'yearly') && subscriptionStatus === 'active';\r\n\r\n  // If not premium, show upgrade message\r\n  if (!isPremiumMember) {\r\n    return (\r\n      <div className=\"flex-1 overflow-y-auto p-8 pb-20\">\r\n        <div className=\"max-w-6xl mx-auto\">\r\n          <div className=\"bg-surface-dark rounded-xl p-8 border border-[#3c2348] text-center\">\r\n            <span className=\"material-symbols-outlined text-5xl text-primary mb-4\">lock</span>\r\n            <h2 className=\"text-2xl font-bold text-white mb-2\">Premium Feature</h2>\r\n            <p className=\"text-text-secondary mb-6\">Reservations are only available for premium members.</p>\r\n            <Link\r\n              href=\"/member/upgrade\"\r\n              className=\"inline-block bg-primary hover:bg-primary-hover text-white font-bold px-6 py-3 rounded-lg transition-colors\"\r\n            >\r\n              Upgrade to Premium\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex-1 overflow-y-auto p-8 pb-20\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        <h2 className=\"text-3xl font-black tracking-tight text-white mb-2\">Reservations</h2>\r\n        <p className=\"text-text-secondary mb-8\">Track your hold requests, manage queue positions, and claim available books.</p>\r\n\r\n        {/* Tabs */}\r\n        <div className=\"flex gap-2 mb-6 border-b border-[#3c2348]\">\r\n          <button\r\n            onClick={() => setActiveTab('active')}\r\n            className={`px-4 py-2 text-sm font-semibold border-b-2 transition-colors ${\r\n              activeTab === 'active'\r\n                ? 'border-primary text-primary'\r\n                : 'border-transparent text-text-secondary hover:text-white'\r\n            }`}\r\n          >\r\n            Active ({activeReservations.length})\r\n          </button>\r\n          <button\r\n            onClick={() => setActiveTab('completed')}\r\n            className={`px-4 py-2 text-sm font-semibold border-b-2 transition-colors ${\r\n              activeTab === 'completed'\r\n                ? 'border-primary text-primary'\r\n                : 'border-transparent text-text-secondary hover:text-white'\r\n            }`}\r\n          >\r\n            Completed ({reservations.completed.length})\r\n          </button>\r\n          <button\r\n            onClick={() => setActiveTab('all')}\r\n            className={`px-4 py-2 text-sm font-semibold border-b-2 transition-colors ${\r\n              activeTab === 'all'\r\n                ? 'border-primary text-primary'\r\n                : 'border-transparent text-text-secondary hover:text-white'\r\n            }`}\r\n          >\r\n            All ({allReservations.length})\r\n          </button>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"text-center py-12 text-text-secondary\">\r\n            <div className=\"flex justify-center mb-3\">\r\n              <Loader />\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {/* Active Reservations */}\r\n            {(activeTab === 'active' || activeTab === 'all') && (\r\n              <section className=\"mb-8\">\r\n                <h3 className=\"text-xl font-bold text-white mb-4 flex items-center gap-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">schedule</span>\r\n                  Active Reservations ({activeReservations.length})\r\n                </h3>\r\n                {activeReservations.length === 0 ? (\r\n                  <div className=\"text-center py-12 text-text-secondary bg-surface-dark rounded-xl border border-[#3c2348]\">\r\n                    <span className=\"material-symbols-outlined text-5xl mb-3 opacity-50\">event_seat</span>\r\n                    <p className=\"text-lg\">No active reservations</p>\r\n                    <p className=\"text-sm mt-2\">Reserve books that are currently unavailable</p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    {/* Ready Reservations */}\r\n                    {reservations.ready.map((reservation) => {\r\n                      const daysLeft = getDaysUntilExpiry(reservation.expiryDate);\r\n                      return (\r\n                        <div\r\n                          key={reservation._id}\r\n                          className=\"bg-surface-dark rounded-xl p-5 border-2 border-emerald-500/30 hover:border-emerald-500/50 transition-all\"\r\n                        >\r\n                          <div className=\"flex gap-4\">\r\n                            <div\r\n                              className=\"w-20 h-28 bg-cover bg-center rounded-lg flex-shrink-0\"\r\n                              style={{ backgroundImage: `url('${reservation.book?.coverImage}')` }}\r\n                            ></div>\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <div className=\"flex items-start justify-between gap-2 mb-2\">\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                  <h4 className=\"text-white font-bold truncate\">{reservation.book?.title}</h4>\r\n                                  <p className=\"text-text-secondary text-xs truncate\">{reservation.book?.author}</p>\r\n                                </div>\r\n                                <span className=\"bg-emerald-500/20 text-emerald-300 text-xs font-bold px-2 py-1 rounded flex-shrink-0\">\r\n                                  Ready\r\n                                </span>\r\n                              </div>\r\n                              <div className=\"space-y-2 mb-4\">\r\n                                <p className=\"text-xs text-text-secondary\">\r\n                                  <span className=\"material-symbols-outlined text-sm align-middle\">event</span>{' '}\r\n                                  Ready since: {new Date(reservation.readyDate).toLocaleDateString()}\r\n                                </p>\r\n                                <p className={`text-xs font-bold ${daysLeft <= 1 ? 'text-alert-red' : daysLeft <= 2 ? 'text-orange-400' : 'text-emerald-400'}`}>\r\n                                  <span className=\"material-symbols-outlined text-sm align-middle\">schedule</span>{' '}\r\n                                  {daysLeft === 0\r\n                                    ? 'Expires today!'\r\n                                    : daysLeft === 1\r\n                                    ? 'Expires tomorrow'\r\n                                    : `${daysLeft} days left to claim`}\r\n                                </p>\r\n                              </div>\r\n                              <div className=\"flex gap-2\">\r\n                                <button\r\n                                  onClick={() => handleComplete(reservation._id)}\r\n                                  disabled={processing === reservation._id}\r\n                                  className=\"flex-1 bg-emerald-500 hover:bg-emerald-600 text-white text-xs font-bold py-2 rounded-lg transition-colors disabled:opacity-50\"\r\n                                >\r\n                                  {processing === reservation._id ? 'Processing...' : 'Claim & Borrow'}\r\n                                </button>\r\n                                <button\r\n                                  onClick={() => handleCancel(reservation._id)}\r\n                                  disabled={processing === reservation._id}\r\n                                  className=\"bg-[#3c2348] hover:bg-white/10 text-white text-xs font-bold py-2 px-3 rounded-lg transition-colors disabled:opacity-50\"\r\n                                >\r\n                                  Cancel\r\n                                </button>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n\r\n                    {/* Pending Reservations */}\r\n                    {reservations.pending.map((reservation) => (\r\n                      <div\r\n                        key={reservation._id}\r\n                        className=\"bg-surface-dark rounded-xl p-5 border border-[#3c2348] hover:border-primary/50 transition-all\"\r\n                      >\r\n                        <div className=\"flex gap-4\">\r\n                          <div\r\n                            className=\"w-20 h-28 bg-cover bg-center rounded-lg flex-shrink-0\"\r\n                            style={{ backgroundImage: `url('${reservation.book?.coverImage}')` }}\r\n                          ></div>\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"flex items-start justify-between gap-2 mb-2\">\r\n                              <div className=\"flex-1 min-w-0\">\r\n                                <h4 className=\"text-white font-bold truncate\">{reservation.book?.title}</h4>\r\n                                <p className=\"text-text-secondary text-xs truncate\">{reservation.book?.author}</p>\r\n                              </div>\r\n                              <span className=\"bg-amber-500/20 text-amber-300 text-xs font-bold px-2 py-1 rounded flex-shrink-0\">\r\n                                Pending\r\n                              </span>\r\n                            </div>\r\n                            <div className=\"space-y-2 mb-4\">\r\n                              <p className=\"text-xs text-text-secondary\">\r\n                                <span className=\"material-symbols-outlined text-sm align-middle\">queue</span>{' '}\r\n                                Queue position: <strong className=\"text-white\">#{reservation.queuePosition}</strong>\r\n                              </p>\r\n                              <p className=\"text-xs text-text-secondary\">\r\n                                <span className=\"material-symbols-outlined text-sm align-middle\">event</span>{' '}\r\n                                Reserved: {new Date(reservation.reservedDate).toLocaleDateString()}\r\n                              </p>\r\n                            </div>\r\n                            <button\r\n                              onClick={() => handleCancel(reservation._id)}\r\n                              disabled={processing === reservation._id}\r\n                              className=\"w-full bg-[#3c2348] hover:bg-white/10 text-white text-xs font-bold py-2 rounded-lg transition-colors disabled:opacity-50\"\r\n                            >\r\n                              {processing === reservation._id ? 'Processing...' : 'Cancel Reservation'}\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </section>\r\n            )}\r\n\r\n            {/* Completed Reservations */}\r\n            {(activeTab === 'completed' || activeTab === 'all') && reservations.completed.length > 0 && (\r\n              <section className=\"mb-8\">\r\n                <h3 className=\"text-xl font-bold text-white mb-4 flex items-center gap-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">check_circle</span>\r\n                  Completed ({reservations.completed.length})\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  {reservations.completed.map((reservation) => (\r\n                    <div\r\n                      key={reservation._id}\r\n                      className=\"bg-surface-dark rounded-xl p-5 border border-[#3c2348] opacity-75\"\r\n                    >\r\n                      <div className=\"flex gap-4\">\r\n                        <div\r\n                          className=\"w-20 h-28 bg-cover bg-center rounded-lg flex-shrink-0\"\r\n                          style={{ backgroundImage: `url('${reservation.book?.coverImage}')` }}\r\n                        ></div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex items-start justify-between gap-2 mb-2\">\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <h4 className=\"text-white font-bold truncate\">{reservation.book?.title}</h4>\r\n                              <p className=\"text-text-secondary text-xs truncate\">{reservation.book?.author}</p>\r\n                            </div>\r\n                            <span className=\"bg-emerald-500/20 text-emerald-300 text-xs font-bold px-2 py-1 rounded flex-shrink-0\">\r\n                              Completed\r\n                            </span>\r\n                          </div>\r\n                          <p className=\"text-xs text-text-secondary\">\r\n                            Completed: {new Date(reservation.completedDate).toLocaleDateString()}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </section>\r\n            )}\r\n\r\n            {/* Expired/Cancelled (only in All tab) */}\r\n            {activeTab === 'all' && (reservations.expired.length > 0 || reservations.cancelled.length > 0) && (\r\n              <section className=\"mb-8\">\r\n                <h3 className=\"text-xl font-bold text-white mb-4 flex items-center gap-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">history</span>\r\n                  History ({reservations.expired.length + reservations.cancelled.length})\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  {[...reservations.expired, ...reservations.cancelled].map((reservation) => (\r\n                    <div\r\n                      key={reservation._id}\r\n                      className=\"bg-surface-dark rounded-xl p-5 border border-[#3c2348] opacity-60\"\r\n                    >\r\n                      <div className=\"flex gap-4\">\r\n                        <div\r\n                          className=\"w-20 h-28 bg-cover bg-center rounded-lg flex-shrink-0 grayscale\"\r\n                          style={{ backgroundImage: `url('${reservation.book?.coverImage}')` }}\r\n                        ></div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex items-start justify-between gap-2 mb-2\">\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <h4 className=\"text-white font-bold truncate\">{reservation.book?.title}</h4>\r\n                              <p className=\"text-text-secondary text-xs truncate\">{reservation.book?.author}</p>\r\n                            </div>\r\n                            <span\r\n                              className={`text-xs font-bold px-2 py-1 rounded flex-shrink-0 ${\r\n                                reservation.status === RESERVATION_STATUS.EXPIRED\r\n                                  ? 'bg-alert-red/20 text-alert-red'\r\n                                  : 'bg-gray-500/20 text-gray-400'\r\n                              }`}\r\n                            >\r\n                              {reservation.status === RESERVATION_STATUS.EXPIRED ? 'Expired' : 'Cancelled'}\r\n                            </span>\r\n                          </div>\r\n                          <p className=\"text-xs text-text-secondary\">\r\n                            {reservation.status === RESERVATION_STATUS.EXPIRED\r\n                              ? `Expired: ${new Date(reservation.expiryDate).toLocaleDateString()}`\r\n                              : `Cancelled: ${new Date(reservation.cancelledDate).toLocaleDateString()}`}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </section>\r\n            )}\r\n\r\n            {/* Empty state for all tab */}\r\n            {activeTab === 'all' && allReservations.length === 0 && (\r\n              <div className=\"text-center py-12 text-text-secondary bg-surface-dark rounded-xl border border-[#3c2348]\">\r\n                <span className=\"material-symbols-outlined text-5xl mb-3 opacity-50\">event_seat</span>\r\n                <p className=\"text-lg\">No reservations</p>\r\n                <p className=\"text-sm mt-2\">You haven't made any reservations yet</p>\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\settings\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSubscription'. Either include it or remove the dependency array.","line":67,"column":6,"nodeType":"ArrayExpression","endLine":67,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSubscription, userData]","fix":{"range":[2164,2174],"text":"[fetchSubscription, userData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { LOCATION_DATA } from '@/lib/locationData';\r\nimport { validateForm, isValidPhone, validatePassword } from '@/lib/validation';\r\nimport { showSuccess, showError, showConfirm, showToast } from '@/lib/swal';\r\nimport OptimizedImage from '@/components/OptimizedImage';\r\nimport Loader from '@/components/Loader';\r\n\r\nexport default function MemberSettingsPage() {\r\n  const { userData, user, changePassword, setUserData } = useAuth();\r\n  const [activeTab, setActiveTab] = useState('profile');\r\n  const [loading, setLoading] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n  const fileInputRef = useRef(null);\r\n\r\n  // Profile form state\r\n  const [profileForm, setProfileForm] = useState({\r\n    name: '',\r\n    phone: '',\r\n    division: '',\r\n    city: '',\r\n    area: '',\r\n    landmark: '',\r\n  });\r\n  const [profilePhotoUrl, setProfilePhotoUrl] = useState(null);\r\n  const [profileErrors, setProfileErrors] = useState({});\r\n\r\n  // Password form state\r\n  const [passwordForm, setPasswordForm] = useState({\r\n    currentPassword: '',\r\n    newPassword: '',\r\n    confirmPassword: '',\r\n  });\r\n  const [showPasswords, setShowPasswords] = useState({\r\n    current: false,\r\n    new: false,\r\n    confirm: false,\r\n  });\r\n  const [passwordErrors, setPasswordErrors] = useState({});\r\n\r\n  // Subscription state\r\n  const [subscription, setSubscription] = useState(null);\r\n  const [subscriptionLoading, setSubscriptionLoading] = useState(true);\r\n\r\n  // Initialize form data from userData\r\n  useEffect(() => {\r\n    if (userData) {\r\n      setProfileForm({\r\n        name: userData.name || '',\r\n        phone: userData.phone || '',\r\n        division: userData.address?.division || '',\r\n        city: userData.address?.city || '',\r\n        area: userData.address?.area || '',\r\n        landmark: userData.address?.landmark || '',\r\n      });\r\n      setProfilePhotoUrl(userData.profilePhoto || null);\r\n    }\r\n  }, [userData]);\r\n\r\n  // Fetch subscription data\r\n  useEffect(() => {\r\n    if (userData?._id) {\r\n      fetchSubscription();\r\n    }\r\n  }, [userData]);\r\n\r\n  const fetchSubscription = async () => {\r\n    try {\r\n      setSubscriptionLoading(true);\r\n      const response = await fetch(`/api/subscriptions?userId=${userData._id}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setSubscription(data.subscription);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching subscription:', error);\r\n    } finally {\r\n      setSubscriptionLoading(false);\r\n    }\r\n  };\r\n\r\n  // Get available cities based on selected division\r\n  const getAvailableCities = () => {\r\n    if (!profileForm.division || !LOCATION_DATA[profileForm.division]) {\r\n      return [];\r\n    }\r\n    return Object.keys(LOCATION_DATA[profileForm.division]);\r\n  };\r\n\r\n  // Get available areas based on selected division and city\r\n  const getAvailableAreas = () => {\r\n    if (!profileForm.division || !profileForm.city || !LOCATION_DATA[profileForm.division]) {\r\n      return [];\r\n    }\r\n    return LOCATION_DATA[profileForm.division][profileForm.city] || [];\r\n  };\r\n\r\n  const handleProfileInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    \r\n    // Handle cascading dropdowns\r\n    if (name === 'division') {\r\n      setProfileForm(prev => ({\r\n        ...prev,\r\n        division: value,\r\n        city: '',\r\n        area: '',\r\n      }));\r\n    } else if (name === 'city') {\r\n      setProfileForm(prev => ({\r\n        ...prev,\r\n        city: value,\r\n        area: '',\r\n      }));\r\n    } else {\r\n      setProfileForm(prev => ({\r\n        ...prev,\r\n        [name]: value,\r\n      }));\r\n    }\r\n    // Clear error for this field\r\n    if (profileErrors[name]) {\r\n      setProfileErrors(prev => {\r\n        const newErrors = { ...prev };\r\n        delete newErrors[name];\r\n        return newErrors;\r\n      });\r\n    }\r\n  };\r\n\r\n  const handlePhotoChange = async (e) => {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      showError('Image Upload Failed', 'Image size must be less than 5MB');\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('image', file);\r\n\r\n      const response = await fetch('/api/upload', {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to upload image');\r\n      }\r\n\r\n      const data = await response.json();\r\n      setProfilePhotoUrl(data.url);\r\n      showToast('Profile photo uploaded successfully', 'success');\r\n    } catch (error) {\r\n      showError('Upload Failed', 'Failed to upload image. Please try again.');\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleProfileSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setProfileErrors({});\r\n    setLoading(true);\r\n\r\n    // Validation\r\n    const validationRules = {\r\n      name: { required: true, label: 'Name', minLength: 2 },\r\n      phone: { required: false, label: 'Phone', custom: (value) => {\r\n        if (value && !isValidPhone(value)) {\r\n          return { isValid: false, message: 'Please enter a valid phone number' };\r\n        }\r\n        return { isValid: true };\r\n      }},\r\n      division: { required: true, label: 'Division' },\r\n      city: { required: true, label: 'City' },\r\n      area: { required: true, label: 'Area' },\r\n    };\r\n\r\n    const validation = validateForm(profileForm, validationRules);\r\n    if (!validation.isValid) {\r\n      setProfileErrors(validation.errors);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const updateData = {\r\n        name: profileForm.name.trim(),\r\n        phone: profileForm.phone?.trim() || '',\r\n        profilePhoto: profilePhotoUrl,\r\n        address: {\r\n          division: profileForm.division,\r\n          city: profileForm.city,\r\n          area: profileForm.area,\r\n          landmark: profileForm.landmark?.trim() || '',\r\n        },\r\n      };\r\n\r\n      const response = await fetch(`/api/users/${user.uid}`, {\r\n        method: 'PATCH',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(updateData),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Failed to update profile');\r\n      }\r\n\r\n      const data = await response.json();\r\n      setUserData(data.user);\r\n      showSuccess('Profile Updated', 'Your profile has been updated successfully.');\r\n    } catch (error) {\r\n      console.error('Error updating profile:', error);\r\n      showError('Update Failed', error.message || 'Failed to update profile. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handlePasswordInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setPasswordForm(prev => ({\r\n      ...prev,\r\n      [name]: value,\r\n    }));\r\n    // Clear error for this field\r\n    if (passwordErrors[name]) {\r\n      setPasswordErrors(prev => {\r\n        const newErrors = { ...prev };\r\n        delete newErrors[name];\r\n        return newErrors;\r\n      });\r\n    }\r\n  };\r\n\r\n  const handlePasswordSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setPasswordErrors({});\r\n    setLoading(true);\r\n\r\n    // Validation\r\n    const errors = {};\r\n    \r\n    if (!passwordForm.currentPassword) {\r\n      errors.currentPassword = ['Current password is required'];\r\n    }\r\n\r\n    const newPasswordValidation = validatePassword(passwordForm.newPassword);\r\n    if (!newPasswordValidation.isValid) {\r\n      errors.newPassword = [newPasswordValidation.message];\r\n    }\r\n\r\n    if (passwordForm.newPassword !== passwordForm.confirmPassword) {\r\n      errors.confirmPassword = ['Passwords do not match'];\r\n    }\r\n\r\n    if (passwordForm.currentPassword === passwordForm.newPassword) {\r\n      errors.newPassword = ['New password must be different from current password'];\r\n    }\r\n\r\n    if (Object.keys(errors).length > 0) {\r\n      setPasswordErrors(errors);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await changePassword(passwordForm.currentPassword, passwordForm.newPassword);\r\n      \r\n      if (result.success) {\r\n        setPasswordForm({\r\n          currentPassword: '',\r\n          newPassword: '',\r\n          confirmPassword: '',\r\n        });\r\n        showSuccess('Password Changed', 'Your password has been changed successfully.');\r\n      } else {\r\n        showError('Password Change Failed', result.error || 'Failed to change password. Please try again.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error changing password:', error);\r\n      showError('Password Change Failed', 'Failed to change password. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleUpgradeSubscription = async (plan) => {\r\n    try {\r\n      const response = await fetch('/api/subscriptions/create-checkout', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: userData._id,\r\n          plan: plan,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Failed to create checkout session');\r\n      }\r\n\r\n      const data = await response.json();\r\n      if (data.url) {\r\n        window.location.href = data.url;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error creating checkout:', error);\r\n      showError('Subscription Error', error.message || 'Failed to start subscription upgrade. Please try again.');\r\n    }\r\n  };\r\n\r\n  const handleCancelSubscription = async () => {\r\n    const confirmed = await showConfirm(\r\n      'Cancel Subscription',\r\n      'Are you sure you want to cancel your premium subscription? You will lose access to premium features at the end of your billing period.',\r\n      {\r\n        confirmButtonText: 'Yes, Cancel',\r\n        cancelButtonText: 'Keep Subscription',\r\n      }\r\n    );\r\n\r\n    if (!confirmed.isConfirmed) return;\r\n\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch('/api/subscriptions/cancel', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: userData._id,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Failed to cancel subscription');\r\n      }\r\n\r\n      await fetchSubscription();\r\n      showSuccess('Subscription Cancelled', 'Your subscription will remain active until the end of the current billing period.');\r\n    } catch (error) {\r\n      console.error('Error cancelling subscription:', error);\r\n      showError('Cancellation Failed', error.message || 'Failed to cancel subscription. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleReactivateSubscription = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch('/api/subscriptions/reactivate', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: userData._id,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Failed to reactivate subscription');\r\n      }\r\n\r\n      await fetchSubscription();\r\n      showSuccess('Subscription Reactivated', 'Your premium subscription has been reactivated.');\r\n    } catch (error) {\r\n      console.error('Error reactivating subscription:', error);\r\n      showError('Reactivation Failed', error.message || 'Failed to reactivate subscription. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const isPremium = subscription?.type === 'monthly' || subscription?.type === 'yearly';\r\n  const subscriptionStatus = subscription?.status || 'active';\r\n\r\n  const tabs = [\r\n    { id: 'profile', label: 'Profile', icon: 'person' },\r\n    { id: 'security', label: 'Security', icon: 'lock' },\r\n    { id: 'subscription', label: 'Subscription', icon: 'stars' },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"flex-1 overflow-y-auto p-6 md:p-8 pb-20 scroll-smooth\">\r\n      <div className=\"max-w-5xl mx-auto flex flex-col gap-8\">\r\n        {/* Page Header */}\r\n        <div className=\"flex flex-col gap-2\">\r\n          <h2 className=\"text-3xl md:text-4xl font-black tracking-tight text-white\">Settings</h2>\r\n          <p className=\"text-text-secondary text-sm md:text-base\">\r\n            Manage your account settings and preferences\r\n          </p>\r\n        </div>\r\n\r\n        {/* Tabs */}\r\n        <div className=\"flex gap-2 border-b border-[#3c2348]\">\r\n          {tabs.map((tab) => (\r\n            <button\r\n              key={tab.id}\r\n              onClick={() => setActiveTab(tab.id)}\r\n              className={`flex items-center gap-2 px-4 py-3 font-medium transition-colors relative ${\r\n                activeTab === tab.id\r\n                  ? 'text-primary'\r\n                  : 'text-text-secondary hover:text-white'\r\n              }`}\r\n            >\r\n              <span className=\"material-symbols-outlined\" style={{ fontSize: '20px' }}>\r\n                {tab.icon}\r\n              </span>\r\n              <span>{tab.label}</span>\r\n              {activeTab === tab.id && (\r\n                <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-primary\"></div>\r\n              )}\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Profile Tab */}\r\n        {activeTab === 'profile' && (\r\n          <form onSubmit={handleProfileSubmit} className=\"flex flex-col gap-6\">\r\n            <div className=\"bg-surface-dark rounded-2xl border border-[#3c2348] p-6 md:p-8\">\r\n              <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\r\n                <span className=\"material-symbols-outlined text-primary\">person</span>\r\n                Profile Information\r\n              </h3>\r\n\r\n              {/* Profile Photo */}\r\n              <div className=\"flex items-center gap-5 p-4 rounded-xl bg-[#1c1022] border border-[#3c2348] mb-6\">\r\n                <div className=\"relative h-20 w-20 md:h-24 md:w-24 shrink-0 rounded-full border border-[#3c2348] bg-[#1c1022] flex items-center justify-center overflow-hidden\">\r\n                  {profilePhotoUrl ? (\r\n                    <OptimizedImage\r\n                      src={profilePhotoUrl}\r\n                      alt=\"Profile\"\r\n                      width={96}\r\n                      height={96}\r\n                      className=\"rounded-full\"\r\n                    />\r\n                  ) : (\r\n                    <span className=\"material-symbols-outlined text-text-secondary text-4xl\">person</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex flex-col flex-1 gap-2\">\r\n                  <label className=\"text-white text-sm font-medium\">Profile Photo</label>\r\n                  <div className=\"flex flex-wrap items-center gap-3\">\r\n                    <label className=\"flex items-center gap-2 px-4 h-10 bg-primary/10 hover:bg-primary/20 border border-primary/30 hover:border-primary text-primary hover:text-white rounded-lg cursor-pointer transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed\">\r\n                      <span className=\"material-symbols-outlined\" style={{ fontSize: '18px' }}>\r\n                        cloud_upload\r\n                      </span>\r\n                      <span>{uploading ? 'Uploading...' : 'Change Photo'}</span>\r\n                      <input\r\n                        ref={fileInputRef}\r\n                        accept=\"image/*\"\r\n                        className=\"hidden\"\r\n                        type=\"file\"\r\n                        onChange={handlePhotoChange}\r\n                        disabled={uploading || loading}\r\n                      />\r\n                    </label>\r\n                    <span className=\"text-xs text-text-secondary\">Max 5MB. JPG, PNG</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Form Fields */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n                <label className=\"flex flex-col\">\r\n                  <span className=\"text-white text-sm font-medium mb-2\">Full Name *</span>\r\n                  <input\r\n                    className=\"form-input flex w-full rounded-lg text-white focus:outline-0 focus:ring-0 border border-[#3c2348] bg-[#1c1022] focus:border-primary h-12 placeholder:text-text-secondary px-4 py-3 text-base transition-colors\"\r\n                    placeholder=\"John Doe\"\r\n                    type=\"text\"\r\n                    name=\"name\"\r\n                    value={profileForm.name}\r\n                    onChange={handleProfileInputChange}\r\n                    disabled={loading}\r\n                  />\r\n                  {profileErrors.name && (\r\n                    <span className=\"text-red-400 text-xs mt-1\">{profileErrors.name[0]}</span>\r\n                  )}\r\n                </label>\r\n\r\n                <label className=\"flex flex-col\">\r\n                  <span className=\"text-white text-sm font-medium mb-2\">Email</span>\r\n                  <input\r\n                    className=\"flex w-full rounded-lg text-text-secondary border border-[#3c2348] bg-[#1c1022] h-12 px-4 py-3 text-base cursor-not-allowed opacity-50\"\r\n                    type=\"email\"\r\n                    value={userData?.email || ''}\r\n                    disabled\r\n                  />\r\n                  <span className=\"text-text-secondary text-xs mt-1\">Email cannot be changed</span>\r\n                </label>\r\n\r\n                <label className=\"flex flex-col\">\r\n                  <span className=\"text-white text-sm font-medium mb-2\">Phone Number</span>\r\n                  <input\r\n                    className=\"form-input flex w-full rounded-lg text-white focus:outline-0 focus:ring-0 border border-[#3c2348] bg-[#1c1022] focus:border-primary h-12 placeholder:text-text-secondary px-4 py-3 text-base transition-colors\"\r\n                    placeholder=\"+880 1234 567890\"\r\n                    type=\"tel\"\r\n                    name=\"phone\"\r\n                    value={profileForm.phone}\r\n                    onChange={handleProfileInputChange}\r\n                    disabled={loading}\r\n                  />\r\n                  {profileErrors.phone && (\r\n                    <span className=\"text-red-400 text-xs mt-1\">{profileErrors.phone[0]}</span>\r\n                  )}\r\n                </label>\r\n\r\n                <label className=\"flex flex-col\">\r\n                  <span className=\"text-white text-sm font-medium mb-2\">Division *</span>\r\n                  <select\r\n                    className=\"form-input flex w-full rounded-lg text-white focus:outline-0 focus:ring-0 border border-[#3c2348] bg-[#1c1022] focus:border-primary h-12 px-4 py-3 text-base transition-colors cursor-pointer\"\r\n                    name=\"division\"\r\n                    value={profileForm.division}\r\n                    onChange={handleProfileInputChange}\r\n                    disabled={loading}\r\n                  >\r\n                    <option value=\"\" className=\"bg-[#1c1022] text-white\">Select Division</option>\r\n                    {Object.keys(LOCATION_DATA).map((division) => (\r\n                      <option key={division} value={division} className=\"bg-[#1c1022] text-white\">\r\n                        {division}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  {profileErrors.division && (\r\n                    <span className=\"text-red-400 text-xs mt-1\">{profileErrors.division[0]}</span>\r\n                  )}\r\n                </label>\r\n\r\n                <label className=\"flex flex-col\">\r\n                  <span className=\"text-white text-sm font-medium mb-2\">City *</span>\r\n                  <select\r\n                    className=\"form-input flex w-full rounded-lg text-white focus:outline-0 focus:ring-0 border border-[#3c2348] bg-[#1c1022] focus:border-primary h-12 px-4 py-3 text-base transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    name=\"city\"\r\n                    value={profileForm.city}\r\n                    onChange={handleProfileInputChange}\r\n                    disabled={loading || !profileForm.division}\r\n                  >\r\n                    <option value=\"\" className=\"bg-[#1c1022] text-white\">Select City</option>\r\n                    {getAvailableCities().map((city) => (\r\n                      <option key={city} value={city} className=\"bg-[#1c1022] text-white\">\r\n                        {city}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  {profileErrors.city && (\r\n                    <span className=\"text-red-400 text-xs mt-1\">{profileErrors.city[0]}</span>\r\n                  )}\r\n                </label>\r\n\r\n                <label className=\"flex flex-col\">\r\n                  <span className=\"text-white text-sm font-medium mb-2\">Area *</span>\r\n                  <select\r\n                    className=\"form-input flex w-full rounded-lg text-white focus:outline-0 focus:ring-0 border border-[#3c2348] bg-[#1c1022] focus:border-primary h-12 px-4 py-3 text-base transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    name=\"area\"\r\n                    value={profileForm.area}\r\n                    onChange={handleProfileInputChange}\r\n                    disabled={loading || !profileForm.city}\r\n                  >\r\n                    <option value=\"\" className=\"bg-[#1c1022] text-white\">Select Area</option>\r\n                    {getAvailableAreas().map((area) => (\r\n                      <option key={area} value={area} className=\"bg-[#1c1022] text-white\">\r\n                        {area}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  {profileErrors.area && (\r\n                    <span className=\"text-red-400 text-xs mt-1\">{profileErrors.area[0]}</span>\r\n                  )}\r\n                </label>\r\n\r\n                <label className=\"flex flex-col md:col-span-2\">\r\n                  <span className=\"text-white text-sm font-medium mb-2\">Landmark</span>\r\n                  <input\r\n                    className=\"form-input flex w-full rounded-lg text-white focus:outline-0 focus:ring-0 border border-[#3c2348] bg-[#1c1022] focus:border-primary h-12 placeholder:text-text-secondary px-4 py-3 text-base transition-colors\"\r\n                    placeholder=\"Near Public Library\"\r\n                    type=\"text\"\r\n                    name=\"landmark\"\r\n                    value={profileForm.landmark}\r\n                    onChange={handleProfileInputChange}\r\n                    disabled={loading}\r\n                  />\r\n                </label>\r\n              </div>\r\n\r\n              <div className=\"mt-6 flex justify-end\">\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                  disabled={loading || uploading}\r\n                >\r\n                  {loading ? (\r\n                    <span className=\"flex items-center gap-2\">\r\n                      <span className=\"material-symbols-outlined animate-spin\" style={{ fontSize: '20px' }}>\r\n                        sync\r\n                      </span>\r\n                      <span>Saving...</span>\r\n                    </span>\r\n                  ) : (\r\n                    <>\r\n                      <span className=\"material-symbols-outlined\" style={{ fontSize: '20px' }}>\r\n                        save\r\n                      </span>\r\n                      <span>Save Changes</span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        )}\r\n\r\n        {/* Security Tab */}\r\n        {activeTab === 'security' && (\r\n          <form onSubmit={handlePasswordSubmit} className=\"flex flex-col gap-6\">\r\n            <div className=\"bg-surface-dark rounded-2xl border border-[#3c2348] p-6 md:p-8\">\r\n              <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\r\n                <span className=\"material-symbols-outlined text-primary\">lock</span>\r\n                Change Password\r\n              </h3>\r\n\r\n              <div className=\"flex flex-col gap-5 max-w-md\">\r\n                <label className=\"flex flex-col\">\r\n                  <span className=\"text-white text-sm font-medium mb-2\">Current Password *</span>\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      className=\"form-input flex w-full rounded-lg text-white focus:outline-0 focus:ring-0 border border-[#3c2348] bg-[#1c1022] focus:border-primary h-12 placeholder:text-text-secondary px-4 py-3 pr-12 text-base transition-colors\"\r\n                      placeholder=\"\"\r\n                      type={showPasswords.current ? 'text' : 'password'}\r\n                      name=\"currentPassword\"\r\n                      value={passwordForm.currentPassword}\r\n                      onChange={handlePasswordInputChange}\r\n                      disabled={loading}\r\n                    />\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"absolute right-0 top-0 h-full flex items-center pr-4 text-text-secondary hover:text-white transition-colors\"\r\n                      onClick={() => setShowPasswords(prev => ({ ...prev, current: !prev.current }))}\r\n                    >\r\n                      <span className=\"material-symbols-outlined\" style={{ fontSize: '20px' }}>\r\n                        {showPasswords.current ? 'visibility_off' : 'visibility'}\r\n                      </span>\r\n                    </button>\r\n                  </div>\r\n                  {passwordErrors.currentPassword && (\r\n                    <span className=\"text-red-400 text-xs mt-1\">{passwordErrors.currentPassword[0]}</span>\r\n                  )}\r\n                </label>\r\n\r\n                <label className=\"flex flex-col\">\r\n                  <span className=\"text-white text-sm font-medium mb-2\">New Password *</span>\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      className=\"form-input flex w-full rounded-lg text-white focus:outline-0 focus:ring-0 border border-[#3c2348] bg-[#1c1022] focus:border-primary h-12 placeholder:text-text-secondary px-4 py-3 pr-12 text-base transition-colors\"\r\n                      placeholder=\"\"\r\n                      type={showPasswords.new ? 'text' : 'password'}\r\n                      name=\"newPassword\"\r\n                      value={passwordForm.newPassword}\r\n                      onChange={handlePasswordInputChange}\r\n                      disabled={loading}\r\n                    />\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"absolute right-0 top-0 h-full flex items-center pr-4 text-text-secondary hover:text-white transition-colors\"\r\n                      onClick={() => setShowPasswords(prev => ({ ...prev, new: !prev.new }))}\r\n                    >\r\n                      <span className=\"material-symbols-outlined\" style={{ fontSize: '20px' }}>\r\n                        {showPasswords.new ? 'visibility_off' : 'visibility'}\r\n                      </span>\r\n                    </button>\r\n                  </div>\r\n                  {passwordErrors.newPassword && (\r\n                    <span className=\"text-red-400 text-xs mt-1\">{passwordErrors.newPassword[0]}</span>\r\n                  )}\r\n                  <span className=\"text-text-secondary text-xs mt-1\">Must be at least 6 characters</span>\r\n                </label>\r\n\r\n                <label className=\"flex flex-col\">\r\n                  <span className=\"text-white text-sm font-medium mb-2\">Confirm New Password *</span>\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      className=\"form-input flex w-full rounded-lg text-white focus:outline-0 focus:ring-0 border border-[#3c2348] bg-[#1c1022] focus:border-primary h-12 placeholder:text-text-secondary px-4 py-3 pr-12 text-base transition-colors\"\r\n                      placeholder=\"\"\r\n                      type={showPasswords.confirm ? 'text' : 'password'}\r\n                      name=\"confirmPassword\"\r\n                      value={passwordForm.confirmPassword}\r\n                      onChange={handlePasswordInputChange}\r\n                      disabled={loading}\r\n                    />\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"absolute right-0 top-0 h-full flex items-center pr-4 text-text-secondary hover:text-white transition-colors\"\r\n                      onClick={() => setShowPasswords(prev => ({ ...prev, confirm: !prev.confirm }))}\r\n                    >\r\n                      <span className=\"material-symbols-outlined\" style={{ fontSize: '20px' }}>\r\n                        {showPasswords.confirm ? 'visibility_off' : 'visibility'}\r\n                      </span>\r\n                    </button>\r\n                  </div>\r\n                  {passwordErrors.confirmPassword && (\r\n                    <span className=\"text-red-400 text-xs mt-1\">{passwordErrors.confirmPassword[0]}</span>\r\n                  )}\r\n                </label>\r\n              </div>\r\n\r\n              <div className=\"mt-6 flex justify-end\">\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                  disabled={loading}\r\n                >\r\n                  {loading ? (\r\n                    <span className=\"flex items-center gap-2\">\r\n                      <span className=\"material-symbols-outlined animate-spin\" style={{ fontSize: '20px' }}>\r\n                        sync\r\n                      </span>\r\n                      <span>Changing...</span>\r\n                    </span>\r\n                  ) : (\r\n                    <>\r\n                      <span className=\"material-symbols-outlined\" style={{ fontSize: '20px' }}>\r\n                        lock_reset\r\n                      </span>\r\n                      <span>Change Password</span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        )}\r\n\r\n        {/* Subscription Tab */}\r\n        {activeTab === 'subscription' && (\r\n          <div className=\"flex flex-col gap-6\">\r\n            <div className=\"bg-surface-dark rounded-2xl border border-[#3c2348] p-6 md:p-8\">\r\n              <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\r\n                <span className=\"material-symbols-outlined text-primary\">stars</span>\r\n                Membership & Subscription\r\n              </h3>\r\n\r\n              {subscriptionLoading ? (\r\n                <div className=\"flex items-center justify-center py-12\">\r\n                  <Loader />\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  {/* Current Membership Status */}\r\n                  <div className=\"bg-[#1c1022] rounded-xl border border-[#3c2348] p-6 mb-6\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                      <div>\r\n                        <h4 className=\"text-lg font-bold text-white mb-1\">\r\n                          {isPremium ? 'Premium Member' : 'General Member'}\r\n                        </h4>\r\n                        <p className=\"text-text-secondary text-sm\">\r\n                          {isPremium \r\n                            ? subscription?.type === 'monthly' \r\n                              ? 'Monthly Premium Plan'\r\n                              : 'Yearly Premium Plan'\r\n                            : 'Free membership with basic features'\r\n                          }\r\n                        </p>\r\n                      </div>\r\n                      <div className={`px-4 py-2 rounded-lg font-bold text-sm ${\r\n                        isPremium && subscriptionStatus === 'active'\r\n                          ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30'\r\n                          : 'bg-blue-500/20 text-blue-400 border border-blue-500/30'\r\n                      }`}>\r\n                        {subscriptionStatus === 'active' ? 'Active' : subscriptionStatus || 'Active'}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {isPremium && subscription?.endDate && (\r\n                      <p className=\"text-text-secondary text-sm\">\r\n                        {subscriptionStatus === 'cancelled' ? 'Expires' : 'Renews'} on{' '}\r\n                        {new Date(subscription.endDate).toLocaleDateString('en-US', {\r\n                          year: 'numeric',\r\n                          month: 'long',\r\n                          day: 'numeric',\r\n                        })}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Membership Benefits */}\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\r\n                    <div className=\"bg-[#1c1022] rounded-xl border border-[#3c2348] p-4\">\r\n                      <div className=\"flex items-center gap-3 mb-2\">\r\n                        <span className=\"material-symbols-outlined text-primary\" style={{ fontSize: '24px' }}>\r\n                          book\r\n                        </span>\r\n                        <span className=\"text-white font-bold\">Borrowing Limit</span>\r\n                      </div>\r\n                      <p className=\"text-text-secondary text-sm\">\r\n                        {isPremium ? '4 books' : '1 book'} at once\r\n                      </p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-[#1c1022] rounded-xl border border-[#3c2348] p-4\">\r\n                      <div className=\"flex items-center gap-3 mb-2\">\r\n                        <span className=\"material-symbols-outlined text-primary\" style={{ fontSize: '24px' }}>\r\n                          event\r\n                        </span>\r\n                        <span className=\"text-white font-bold\">Borrowing Period</span>\r\n                      </div>\r\n                      <p className=\"text-text-secondary text-sm\">\r\n                        {isPremium ? '20 days' : '7 days'} per book\r\n                      </p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-[#1c1022] rounded-xl border border-[#3c2348] p-4\">\r\n                      <div className=\"flex items-center gap-3 mb-2\">\r\n                        <span className=\"material-symbols-outlined text-primary\" style={{ fontSize: '24px' }}>\r\n                          attach_money\r\n                        </span>\r\n                        <span className=\"text-white font-bold\">Late Fine Rate</span>\r\n                      </div>\r\n                      <p className=\"text-text-secondary text-sm\">\r\n                        {isPremium ? '15 BDT/day' : '30 BDT/day'}\r\n                      </p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-[#1c1022] rounded-xl border border-[#3c2348] p-4\">\r\n                      <div className=\"flex items-center gap-3 mb-2\">\r\n                        <span className=\"material-symbols-outlined text-primary\" style={{ fontSize: '24px' }}>\r\n                          star\r\n                        </span>\r\n                        <span className=\"text-white font-bold\">Premium Features</span>\r\n                      </div>\r\n                      <p className=\"text-text-secondary text-sm\">\r\n                        {isPremium ? 'All features unlocked' : 'Limited features'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Subscription Actions */}\r\n                  <div className=\"flex flex-col gap-4\">\r\n                    {!isPremium ? (\r\n                      <div className=\"flex flex-col gap-4\">\r\n                        <p className=\"text-white font-medium\">Upgrade to Premium</p>\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                          <button\r\n                            onClick={() => handleUpgradeSubscription('monthly')}\r\n                            className=\"bg-primary/10 hover:bg-primary/20 border border-primary/30 hover:border-primary text-primary hover:text-white rounded-xl p-6 transition-all text-left flex flex-col gap-2\"\r\n                            disabled={loading}\r\n                          >\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <span className=\"font-bold text-lg\">Monthly Plan</span>\r\n                              <span className=\"material-symbols-outlined text-primary\">arrow_forward</span>\r\n                            </div>\r\n                            <p className=\"text-text-secondary text-sm\">Best for regular readers</p>\r\n                          </button>\r\n\r\n                          <button\r\n                            onClick={() => handleUpgradeSubscription('yearly')}\r\n                            className=\"bg-primary/10 hover:bg-primary/20 border border-primary/30 hover:border-primary text-primary hover:text-white rounded-xl p-6 transition-all text-left flex flex-col gap-2\"\r\n                            disabled={loading}\r\n                          >\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <span className=\"font-bold text-lg\">Yearly Plan</span>\r\n                              <span className=\"material-symbols-outlined text-primary\">arrow_forward</span>\r\n                            </div>\r\n                            <p className=\"text-text-secondary text-sm\">Save more with annual subscription</p>\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    ) : subscriptionStatus === 'cancelled' ? (\r\n                      <button\r\n                        onClick={handleReactivateSubscription}\r\n                        className=\"w-full bg-primary hover:bg-primary-hover text-white font-bold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        disabled={loading}\r\n                      >\r\n                        {loading ? 'Reactivating...' : 'Reactivate Subscription'}\r\n                      </button>\r\n                    ) : (\r\n                      <button\r\n                        onClick={handleCancelSubscription}\r\n                        className=\"w-full bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 hover:border-red-500/50 text-red-400 hover:text-red-300 font-bold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        disabled={loading}\r\n                      >\r\n                        {loading ? 'Cancelling...' : 'Cancel Subscription'}\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\upgrade\\page.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":313,"column":110,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[14357,14532],"text":"\r\n                After selecting a plan and completing payment, your account will be upgraded immediately. You&apos;ll have instant access to all premium features.\r\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[14357,14532],"text":"\r\n                After selecting a plan and completing payment, your account will be upgraded immediately. You&lsquo;ll have instant access to all premium features.\r\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[14357,14532],"text":"\r\n                After selecting a plan and completing payment, your account will be upgraded immediately. You&#39;ll have instant access to all premium features.\r\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[14357,14532],"text":"\r\n                After selecting a plan and completing payment, your account will be upgraded immediately. You&rsquo;ll have instant access to all premium features.\r\n              "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport { showError } from '@/lib/swal';\r\nimport Link from 'next/link';\r\n\r\nexport default function UpgradePlanPage() {\r\n  const { userData, loading: authLoading } = useAuth();\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(false);\r\n  const [selectedPlan, setSelectedPlan] = useState(null);\r\n\r\n  // Check if user is already premium and redirect if so\r\n  useEffect(() => {\r\n    if (userData && !authLoading) {\r\n      const subscriptionType = userData?.subscription?.type || 'free';\r\n      const subscriptionStatus = userData?.subscription?.status || 'active';\r\n      const isPremium = (subscriptionType === 'monthly' || subscriptionType === 'yearly') && subscriptionStatus === 'active';\r\n      \r\n      if (isPremium) {\r\n        // User is already premium, redirect to settings\r\n        router.push('/member/settings?tab=subscription');\r\n      }\r\n    }\r\n  }, [userData, router, authLoading]);\r\n\r\n  // Handle scrolling to \"Choose Your Plan\" section when hash is present\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined' && window.location.hash === '#choose-plan') {\r\n      // Small delay to ensure the page is fully rendered\r\n      setTimeout(() => {\r\n        const element = document.getElementById('choose-plan');\r\n        if (element) {\r\n          element.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n        }\r\n      }, 300);\r\n    }\r\n  }, []);\r\n\r\n  const handleUpgrade = async (plan) => {\r\n    if (!userData?._id) {\r\n      showError('Error', 'User data not available. Please try again.');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setSelectedPlan(plan);\r\n\r\n    try {\r\n      const response = await fetch('/api/subscriptions/create-checkout', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: userData._id,\r\n          plan: plan,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Failed to create checkout session');\r\n      }\r\n\r\n      const data = await response.json();\r\n      if (data.url) {\r\n        // Redirect to Stripe checkout\r\n        window.location.href = data.url;\r\n      } else {\r\n        throw new Error('No checkout URL received');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error creating checkout:', error);\r\n      showError('Subscription Error', error.message || 'Failed to start subscription upgrade. Please try again.');\r\n      setLoading(false);\r\n      setSelectedPlan(null);\r\n    }\r\n  };\r\n\r\n  const plans = [\r\n    {\r\n      id: 'monthly',\r\n      name: 'Monthly Premium',\r\n      price: 'Monthly',\r\n      period: 'Billed monthly',\r\n      icon: 'calendar_month',\r\n      popular: false,\r\n      features: [\r\n        'Borrow up to 4 books at once',\r\n        'Extended borrowing period (20 days)',\r\n        '50% discount on late fines (15 BDT/day)',\r\n        'Priority reservation access',\r\n        'Access to premium book collection',\r\n        'Cancel anytime',\r\n      ],\r\n    },\r\n    {\r\n      id: 'yearly',\r\n      name: 'Yearly Premium',\r\n      price: 'Yearly',\r\n      period: 'Billed annually (best value)',\r\n      icon: 'workspace_premium',\r\n      popular: true,\r\n      features: [\r\n        'All monthly features included',\r\n        'Borrow up to 4 books at once',\r\n        'Extended borrowing period (20 days)',\r\n        '50% discount on late fines (15 BDT/day)',\r\n        'Priority reservation access',\r\n        'Access to premium book collection',\r\n        'Save more with annual billing',\r\n      ],\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"flex-1 overflow-y-auto p-6 md:p-8 pb-20 scroll-smooth\">\r\n      <div className=\"max-w-6xl mx-auto flex flex-col gap-8\">\r\n        {/* Page Header */}\r\n        <div className=\"flex flex-col gap-4 text-center\">\r\n          <div className=\"flex items-center justify-center gap-3 mb-2\">\r\n            <div className=\"bg-primary/20 p-3 rounded-xl\">\r\n              <span className=\"material-symbols-outlined text-primary text-4xl\" style={{ fontVariationSettings: \"'FILL' 1\" }}>\r\n                stars\r\n              </span>\r\n            </div>\r\n            <h2 className=\"text-3xl md:text-5xl font-black tracking-tight text-white\">Upgrade to Premium</h2>\r\n          </div>\r\n          <p className=\"text-text-secondary text-lg md:text-xl max-w-2xl mx-auto\">\r\n            Unlock unlimited access to our premium library features and enjoy enhanced reading experience\r\n          </p>\r\n        </div>\r\n\r\n        {/* Benefits Comparison */}\r\n        <div className=\"bg-surface-dark rounded-2xl border border-[#3c2348] p-6 md:p-8\">\r\n          <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\r\n            <span className=\"material-symbols-outlined text-primary\">compare_arrows</span>\r\n            Standard vs Premium\r\n          </h3>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div className=\"bg-[#1c1022] rounded-xl border border-[#3c2348] p-5\">\r\n              <div className=\"flex items-center gap-3 mb-4\">\r\n                <span className=\"material-symbols-outlined text-text-secondary\">person</span>\r\n                <h4 className=\"text-lg font-bold text-white\">Standard Member</h4>\r\n              </div>\r\n              <ul className=\"flex flex-col gap-3\">\r\n                <li className=\"flex items-start gap-3\">\r\n                  <span className=\"material-symbols-outlined text-text-secondary text-xl\">book</span>\r\n                  <div>\r\n                    <p className=\"text-white text-sm font-medium\">1 book at once</p>\r\n                    <p className=\"text-text-secondary text-xs\">Limited borrowing capacity</p>\r\n                  </div>\r\n                </li>\r\n                <li className=\"flex items-start gap-3\">\r\n                  <span className=\"material-symbols-outlined text-text-secondary text-xl\">event</span>\r\n                  <div>\r\n                    <p className=\"text-white text-sm font-medium\">7 days borrowing period</p>\r\n                    <p className=\"text-text-secondary text-xs\">Shorter reading time</p>\r\n                  </div>\r\n                </li>\r\n                <li className=\"flex items-start gap-3\">\r\n                  <span className=\"material-symbols-outlined text-text-secondary text-xl\">attach_money</span>\r\n                  <div>\r\n                    <p className=\"text-white text-sm font-medium\">30 BDT/day late fine</p>\r\n                    <p className=\"text-text-secondary text-xs\">Standard fine rate</p>\r\n                  </div>\r\n                </li>\r\n              </ul>\r\n            </div>\r\n\r\n            <div className=\"bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl border-2 border-primary/30 p-5 relative overflow-hidden\">\r\n              <div className=\"absolute top-4 right-4 bg-primary text-white text-xs font-bold px-3 py-1 rounded-full\">\r\n                RECOMMENDED\r\n              </div>\r\n              <div className=\"flex items-center gap-3 mb-4\">\r\n                <span className=\"material-symbols-outlined text-primary\" style={{ fontVariationSettings: \"'FILL' 1\" }}>stars</span>\r\n                <h4 className=\"text-lg font-bold text-white\">Premium Member</h4>\r\n              </div>\r\n              <ul className=\"flex flex-col gap-3\">\r\n                <li className=\"flex items-start gap-3\">\r\n                  <span className=\"material-symbols-outlined text-primary text-xl\" style={{ fontVariationSettings: \"'FILL' 1\" }}>book</span>\r\n                  <div>\r\n                    <p className=\"text-white text-sm font-bold\">4 books at once</p>\r\n                    <p className=\"text-text-secondary text-xs\">4x more borrowing capacity</p>\r\n                  </div>\r\n                </li>\r\n                <li className=\"flex items-start gap-3\">\r\n                  <span className=\"material-symbols-outlined text-primary text-xl\" style={{ fontVariationSettings: \"'FILL' 1\" }}>event</span>\r\n                  <div>\r\n                    <p className=\"text-white text-sm font-bold\">20 days borrowing period</p>\r\n                    <p className=\"text-text-secondary text-xs\">Nearly 3x longer reading time</p>\r\n                  </div>\r\n                </li>\r\n                <li className=\"flex items-start gap-3\">\r\n                  <span className=\"material-symbols-outlined text-primary text-xl\" style={{ fontVariationSettings: \"'FILL' 1\" }}>attach_money</span>\r\n                  <div>\r\n                    <p className=\"text-white text-sm font-bold\">15 BDT/day late fine</p>\r\n                    <p className=\"text-text-secondary text-xs\">50% discount on fines</p>\r\n                  </div>\r\n                </li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Pricing Plans */}\r\n        <div id=\"choose-plan\">\r\n          <h3 className=\"text-2xl font-bold text-white mb-6 text-center\">Choose Your Plan</h3>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto\">\r\n            {plans.map((plan) => (\r\n              <div\r\n                key={plan.id}\r\n                className={`bg-surface-dark rounded-2xl border-2 p-6 md:p-8 relative transition-all hover:scale-105 ${\r\n                  plan.popular\r\n                    ? 'border-primary/50 bg-gradient-to-br from-primary/5 to-transparent'\r\n                    : 'border-[#3c2348] hover:border-primary/30'\r\n                }`}\r\n              >\r\n                {plan.popular && (\r\n                  <div className=\"absolute -top-4 left-1/2 -translate-x-1/2 bg-primary text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg\">\r\n                    MOST POPULAR\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"flex flex-col items-center text-center mb-6\">\r\n                  <div className={`p-4 rounded-xl mb-4 ${\r\n                    plan.popular ? 'bg-primary/20' : 'bg-[#1c1022]'\r\n                  }`}>\r\n                    <span className={`material-symbols-outlined text-5xl ${\r\n                      plan.popular ? 'text-primary' : 'text-text-secondary'\r\n                    }`} style={{ fontVariationSettings: plan.popular ? \"'FILL' 1\" : \"'FILL' 0\" }}>\r\n                      {plan.icon}\r\n                    </span>\r\n                  </div>\r\n                  <h4 className=\"text-2xl font-black text-white mb-2\">{plan.name}</h4>\r\n                  <p className=\"text-text-secondary text-sm mb-1\">{plan.period}</p>\r\n                </div>\r\n\r\n                <div className=\"flex flex-col gap-4 mb-6\">\r\n                  {plan.features.map((feature, index) => (\r\n                    <div key={index} className=\"flex items-start gap-3\">\r\n                      <span className={`material-symbols-outlined flex-shrink-0 mt-0.5 ${\r\n                        plan.popular ? 'text-primary' : 'text-text-secondary'\r\n                      }`} style={{ fontVariationSettings: \"'FILL' 1\", fontSize: '20px' }}>\r\n                        check_circle\r\n                      </span>\r\n                      <span className=\"text-text-secondary text-sm\">{feature}</span>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n\r\n                <button\r\n                  onClick={() => handleUpgrade(plan.id)}\r\n                  disabled={loading}\r\n                  className={`w-full py-4 rounded-xl font-bold text-base transition-all ${\r\n                    plan.popular\r\n                      ? 'bg-primary hover:bg-primary-hover text-white shadow-lg shadow-primary/30'\r\n                      : 'bg-primary/10 hover:bg-primary/20 text-primary border-2 border-primary/30 hover:border-primary/50'\r\n                  } disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2`}\r\n                >\r\n                  {loading && selectedPlan === plan.id ? (\r\n                    <>\r\n                      <span className=\"material-symbols-outlined animate-spin\" style={{ fontSize: '20px' }}>\r\n                        sync\r\n                      </span>\r\n                      <span>Processing...</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <span>Upgrade Now</span>\r\n                      <span className=\"material-symbols-outlined\" style={{ fontSize: '20px' }}>\r\n                        arrow_forward\r\n                      </span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Additional Info */}\r\n        <div className=\"bg-surface-dark rounded-2xl border border-[#3c2348] p-6 md:p-8\">\r\n          <h3 className=\"text-xl font-bold text-white mb-4 flex items-center gap-2\">\r\n            <span className=\"material-symbols-outlined text-primary\">info</span>\r\n            Frequently Asked Questions\r\n          </h3>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div>\r\n              <h4 className=\"text-white font-bold mb-2\">Can I cancel anytime?</h4>\r\n              <p className=\"text-text-secondary text-sm\">\r\n                Yes, you can cancel your subscription at any time from your settings page. Your premium features will remain active until the end of your billing period.\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <h4 className=\"text-white font-bold mb-2\">What payment methods do you accept?</h4>\r\n              <p className=\"text-text-secondary text-sm\">\r\n                We accept all major credit and debit cards through our secure Stripe payment gateway. Your payment information is encrypted and secure.\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <h4 className=\"text-white font-bold mb-2\">Will I lose access to borrowed books?</h4>\r\n              <p className=\"text-text-secondary text-sm\">\r\n                No, you can keep all currently borrowed books until their due dates, even if you cancel your premium subscription.\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <h4 className=\"text-white font-bold mb-2\">How does the upgrade work?</h4>\r\n              <p className=\"text-text-secondary text-sm\">\r\n                After selecting a plan and completing payment, your account will be upgraded immediately. You'll have instant access to all premium features.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Back Link */}\r\n        <div className=\"text-center\">\r\n          <Link\r\n            href=\"/member/settings\"\r\n            className=\"inline-flex items-center gap-2 text-text-secondary hover:text-white transition-colors text-sm font-medium\"\r\n          >\r\n            <span className=\"material-symbols-outlined\" style={{ fontSize: '20px' }}>\r\n              arrow_back\r\n            </span>\r\n            <span>Back to Settings</span>\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\member\\wishlist\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\not-found.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":26,"column":31,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1272,1343],"text":"\n                Looks like you&apos;ve wandered off the map.\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1272,1343],"text":"\n                Looks like you&lsquo;ve wandered off the map.\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1272,1343],"text":"\n                Looks like you&#39;ve wandered off the map.\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1272,1343],"text":"\n                Looks like you&rsquo;ve wandered off the map.\n              "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":140,"column":13,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8196,8280],"text":"\n            &quot;Bookflix\" is a fictional service created for demonstration.\n          "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8196,8280],"text":"\n            &ldquo;Bookflix\" is a fictional service created for demonstration.\n          "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8196,8280],"text":"\n            &#34;Bookflix\" is a fictional service created for demonstration.\n          "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8196,8280],"text":"\n            &rdquo;Bookflix\" is a fictional service created for demonstration.\n          "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":140,"column":22,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8196,8280],"text":"\n            \"Bookflix&quot; is a fictional service created for demonstration.\n          "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8196,8280],"text":"\n            \"Bookflix&ldquo; is a fictional service created for demonstration.\n          "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8196,8280],"text":"\n            \"Bookflix&#34; is a fictional service created for demonstration.\n          "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8196,8280],"text":"\n            \"Bookflix&rdquo; is a fictional service created for demonstration.\n          "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from 'next/link';\nimport ErrorNavbar from '@/components/ErrorNavbar';\n\nexport default function NotFound() {\n\n  return (\n    <div className=\"bg-background-light dark:bg-background-dark min-h-screen flex flex-col font-display text-gray-900 dark:text-white overflow-x-hidden\">\n      <ErrorNavbar />\n      \n      <main className=\"flex-grow flex flex-col items-center justify-center px-4 py-12 md:py-20\">\n        <div className=\"layout-content-container flex flex-col max-w-[960px] w-full items-center gap-12\">\n          {/* 404 Hero */}\n          <div className=\"flex flex-col items-center text-center gap-8 w-full animate-in fade-in slide-in-from-bottom-4 duration-700\">\n            <div className=\"relative\">\n              <h1 className=\"text-[120px] md:text-[180px] font-black leading-none tracking-tighter text-transparent bg-clip-text bg-gradient-to-b from-white/90 to-white/10 select-none\">\n                404\n              </h1>\n              {/* Decorative glow */}\n              <div className=\"absolute inset-0 bg-primary/20 blur-[100px] rounded-full -z-10\"></div>\n            </div>\n            \n            <div className=\"space-y-4 max-w-[600px]\">\n              <h2 className=\"text-2xl md:text-4xl font-bold tracking-tight text-white\">\n                Looks like you've wandered off the map.\n              </h2>\n              <p className=\"text-gray-400 text-lg leading-relaxed\">\n                The chapter you are looking for is missing from our collection. It might have been moved, deleted, or perhaps it never existed in this timeline.\n              </p>\n            </div>\n            \n            {/* Primary Actions */}\n            <div className=\"flex flex-col sm:flex-row gap-4 w-full max-w-[480px] mt-2\">\n              <Link\n                href=\"/\"\n                className=\"flex-1 cursor-pointer items-center justify-center rounded-lg h-12 px-6 bg-primary text-white text-base font-bold shadow-lg shadow-primary/30 hover:bg-primary/90 hover:scale-[1.02] active:scale-[0.98] transition-all duration-200 flex\"\n              >\n                Go to Homepage\n              </Link>\n              <Link\n                href=\"/contact\"\n                className=\"flex-1 cursor-pointer items-center justify-center rounded-lg h-12 px-6 bg-[#2b1934] border border-[#3c2348] text-white text-base font-bold hover:bg-[#3c2348] hover:border-[#553267] transition-all duration-200 flex\"\n              >\n                Contact Support\n              </Link>\n            </div>\n          </div>\n          \n          {/* Search Bar Integration */}\n          <div className=\"w-full max-w-[560px] relative group\">\n            <div className=\"absolute -inset-0.5 bg-gradient-to-r from-primary to-[#553267] rounded-lg opacity-30 group-hover:opacity-60 transition duration-500 blur\"></div>\n            <div className=\"relative flex w-full items-center bg-[#1c1122] rounded-lg h-14 border border-[#3c2348] shadow-2xl\">\n              <div className=\"pl-4 pr-3 text-[#b791ca]\">\n                <span className=\"material-symbols-outlined text-2xl\">search</span>\n              </div>\n              <input\n                type=\"text\"\n                className=\"w-full bg-transparent border-none text-white placeholder-[#7a5c8a] focus:ring-0 text-base h-full rounded-r-lg\"\n                placeholder=\"Search for titles, authors, or genres to get back on track...\"\n              />\n            </div>\n          </div>\n          \n          {/* Helpful Links Grid */}\n          <div className=\"w-full mt-8\">\n            <div className=\"flex flex-col gap-6\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"h-px bg-[#3c2348] flex-1\"></div>\n                <span className=\"text-[#b791ca] text-sm uppercase tracking-wider font-semibold\">Or jump to a section</span>\n                <div className=\"h-px bg-[#3c2348] flex-1\"></div>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                {/* Card 1 */}\n                <Link\n                  href=\"/member/explore\"\n                  className=\"group relative flex flex-col gap-3 rounded-xl border border-[#3c2348] bg-[#2b1934]/50 p-6 transition-all duration-300 hover:bg-[#2b1934] hover:border-primary/50 hover:shadow-lg hover:shadow-primary/10 hover:-translate-y-1\"\n                >\n                  <div className=\"bg-primary/10 rounded-lg w-12 h-12 flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-colors duration-300 text-primary\">\n                    <span className=\"material-symbols-outlined text-2xl\">menu_book</span>\n                  </div>\n                  <div className=\"flex flex-col gap-1\">\n                    <h3 className=\"text-white text-lg font-bold group-hover:text-primary transition-colors\">Browse Books</h3>\n                    <p className=\"text-gray-400 text-sm\">Explore our vast collection of digital books and magazines.</p>\n                  </div>\n                </Link>\n                \n                {/* Card 2 */}\n                <Link\n                  href=\"/dashboard\"\n                  className=\"group relative flex flex-col gap-3 rounded-xl border border-[#3c2348] bg-[#2b1934]/50 p-6 transition-all duration-300 hover:bg-[#2b1934] hover:border-primary/50 hover:shadow-lg hover:shadow-primary/10 hover:-translate-y-1\"\n                >\n                  <div className=\"bg-primary/10 rounded-lg w-12 h-12 flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-colors duration-300 text-primary\">\n                    <span className=\"material-symbols-outlined text-2xl\">dashboard</span>\n                  </div>\n                  <div className=\"flex flex-col gap-1\">\n                    <h3 className=\"text-white text-lg font-bold group-hover:text-primary transition-colors\">My Dashboard</h3>\n                    <p className=\"text-gray-400 text-sm\">Check your current loans, holds, and reading history.</p>\n                  </div>\n                </Link>\n                \n                {/* Card 3 */}\n                <Link\n                  href=\"/member/explore?sort=new\"\n                  className=\"group relative flex flex-col gap-3 rounded-xl border border-[#3c2348] bg-[#2b1934]/50 p-6 transition-all duration-300 hover:bg-[#2b1934] hover:border-primary/50 hover:shadow-lg hover:shadow-primary/10 hover:-translate-y-1\"\n                >\n                  <div className=\"bg-primary/10 rounded-lg w-12 h-12 flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-colors duration-300 text-primary\">\n                    <span className=\"material-symbols-outlined text-2xl\">auto_awesome</span>\n                  </div>\n                  <div className=\"flex flex-col gap-1\">\n                    <h3 className=\"text-white text-lg font-bold group-hover:text-primary transition-colors\">New Arrivals</h3>\n                    <p className=\"text-gray-400 text-sm\">See the latest additions freshly added to the library.</p>\n                  </div>\n                </Link>\n              </div>\n            </div>\n          </div>\n        </div>\n      </main>\n      \n      {/* Footer */}\n      <footer className=\"border-t border-[#3c2348] bg-[#1a0f20] py-10 mt-auto\">\n        <div className=\"max-w-[960px] mx-auto px-5 flex flex-col gap-6 text-center\">\n          <div className=\"flex flex-wrap items-center justify-center gap-x-8 gap-y-4\">\n            <Link href=\"/help\" className=\"text-[#b791ca] text-sm hover:text-white transition-colors\">\n              Help Center\n            </Link>\n            <Link href=\"/terms\" className=\"text-[#b791ca] text-sm hover:text-white transition-colors\">\n              Terms of Service\n            </Link>\n            <Link href=\"/privacy\" className=\"text-[#b791ca] text-sm hover:text-white transition-colors\">\n              Privacy Policy\n            </Link>\n            <Link href=\"/cookies\" className=\"text-[#b791ca] text-sm hover:text-white transition-colors\">\n              Cookie Settings\n            </Link>\n          </div>\n          <p className=\"text-gray-500 text-xs\">\n             2024 Bookflix Library Services. All rights reserved. <br/>\n            \"Bookflix\" is a fictional service created for demonstration.\n          </p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'stats.activeMembers', 'stats.totalBooks', and 'stats.totalLibraries'. Either include them or remove the dependency array.","line":144,"column":6,"nodeType":"ArrayExpression","endLine":144,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [loadingStats, loadingBooks, stats.totalBooks, stats.activeMembers, stats.totalLibraries]","fix":{"range":[4365,4393],"text":"[loadingStats, loadingBooks, stats.totalBooks, stats.activeMembers, stats.totalLibraries]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport Link from \"next/link\";\nimport Image from \"next/image\";\nimport { useRouter } from \"next/navigation\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport Navbar from \"@/components/Navbar\";\nimport Footer from \"@/components/Footer\";\nimport HeroSlider from \"@/components/HeroSlider\";\nimport Features from \"@/components/Features\";\nimport CategoriesGrid from \"@/components/CategoriesGrid\";\nimport Testimonials from \"@/components/Testimonials\";\nimport FAQ from \"@/components/FAQ\";\nimport Newsletter from \"@/components/Newsletter\";\nimport { showError } from \"@/lib/swal\";\nimport { USER_ROLES } from \"@/lib/constants\";\nimport gsap from \"gsap\";\nimport { ScrollTrigger } from \"gsap/ScrollTrigger\";\n\nif (typeof window !== \"undefined\") {\n  gsap.registerPlugin(ScrollTrigger);\n}\n\nexport default function Home() {\n  const [pricingModalOpen, setPricingModalOpen] = useState(false);\n  const [countdown, setCountdown] = useState(5);\n  const [processingSubscription, setProcessingSubscription] = useState(false);\n  const { user, userData } = useAuth();\n  const router = useRouter();\n  const [scrollY, setScrollY] = useState(0);\n  const statsRef = useRef(null);\n  const sectionsRef = useRef([]);\n  const topBorrowedRef = useRef(null);\n  const arrivalsRef = useRef(null);\n  const banglaRef = useRef(null);\n  const englishRef = useRef(null);\n\n  // Stats state\n  const [stats, setStats] = useState({\n    totalBooks: 0,\n    activeMembers: 0,\n    totalLibraries: 0,\n  });\n  const [loadingStats, setLoadingStats] = useState(true);\n\n  // Book sections state\n  const [topBorrowedBooks, setTopBorrowedBooks] = useState([]);\n  const [newArrivalsBooks, setNewArrivalsBooks] = useState([]);\n  const [banglaBooks, setBanglaBooks] = useState([]);\n  const [englishBooks, setEnglishBooks] = useState([]);\n  const [loadingBooks, setLoadingBooks] = useState({\n    topBorrowed: true,\n    newArrivals: true,\n    bangla: true,\n    english: true,\n  });\n\n  // Determine if user is a general member (member role, not premium, not admin/librarian)\n  const isGeneralMember =\n    user &&\n    userData &&\n    userData.role === USER_ROLES.MEMBER &&\n    (!userData.subscription?.type ||\n      userData.subscription.type === \"free\" ||\n      userData.subscription.status !== \"active\" ||\n      ![\"monthly\", \"yearly\"].includes(userData.subscription.type));\n\n  // GSAP Animations\n  useEffect(() => {\n    // Stats Number Counting Animation\n    if (statsRef.current && !loadingStats) {\n      const statsTargets = {\n        books: 0,\n        members: 0,\n        libraries: 0,\n      };\n\n      gsap.to(statsTargets, {\n        books: stats.totalBooks,\n        members: stats.activeMembers,\n        libraries: stats.totalLibraries,\n        duration: 2.5,\n        ease: \"power2.out\",\n        scrollTrigger: {\n          trigger: statsRef.current,\n          start: \"top 85%\",\n        },\n        onUpdate: () => {\n          setStats((prev) => ({\n            ...prev,\n            displayBooks: Math.floor(statsTargets.books),\n            displayMembers: Math.floor(statsTargets.members),\n            displayLibraries: Math.floor(statsTargets.libraries),\n          }));\n        },\n      });\n    }\n\n    // Advanced Text Reveal Animation\n    const headings = document.querySelectorAll(\"h2, h3:not(.hero-title)\");\n    headings.forEach((heading) => {\n      gsap.fromTo(\n        heading,\n        { opacity: 0, y: 30, clipPath: \"inset(0 0 100% 0)\" },\n        {\n          opacity: 1,\n          y: 0,\n          clipPath: \"inset(0 0 0% 0)\",\n          duration: 1.2,\n          ease: \"power4.out\",\n          scrollTrigger: {\n            trigger: heading,\n            start: \"top 90%\",\n          },\n        },\n      );\n    });\n\n    // Global animate-on-scroll elements (Staggered)\n    const sections = document.querySelectorAll(\".animate-section\");\n    sections.forEach((section) => {\n      const children = section.querySelectorAll(\".animate-on-scroll\");\n      gsap.fromTo(\n        children,\n        { opacity: 0, y: 40 },\n        {\n          opacity: 1,\n          y: 0,\n          duration: 0.8,\n          stagger: 0.1,\n          ease: \"power2.out\",\n          scrollTrigger: {\n            trigger: section,\n            start: \"top 85%\",\n          },\n        },\n      );\n    });\n\n    return () => {\n      ScrollTrigger.getAll().forEach((t) => t.kill());\n    };\n  }, [loadingStats, loadingBooks]);\n\n  // Handle scroll for parallax\n  useEffect(() => {\n    const handleScroll = () => {\n      setScrollY(window.scrollY);\n    };\n\n    window.addEventListener(\"scroll\", handleScroll);\n    return () => window.removeEventListener(\"scroll\", handleScroll);\n  }, []);\n\n  // Auto-close pricing modal and redirect after 5 seconds\n  useEffect(() => {\n    let interval;\n    if (pricingModalOpen) {\n      setCountdown(5); // Reset countdown when modal opens\n      interval = setInterval(() => {\n        setCountdown((prev) => {\n          if (prev <= 1) {\n            clearInterval(interval);\n            setPricingModalOpen(false);\n            router.push(\"/register\");\n            return 0;\n          }\n          return prev - 1;\n        });\n      }, 1000);\n    }\n    return () => {\n      if (interval) clearInterval(interval);\n    };\n  }, [pricingModalOpen, router]);\n\n  // Fetch statistics\n  useEffect(() => {\n    const fetchStats = async () => {\n      try {\n        const response = await fetch(\"/api/stats\");\n        if (response.ok) {\n          const data = await response.json();\n          setStats({\n            totalBooks: data.totalBooks || 0,\n            activeMembers: data.activeMembers || 0,\n            totalLibraries: data.totalLibraries || 0,\n          });\n        }\n      } catch (error) {\n        console.error(\"Error fetching stats:\", error);\n      } finally {\n        setLoadingStats(false);\n      }\n    };\n    fetchStats();\n  }, []);\n\n  // Fetch top borrowed books\n  useEffect(() => {\n    const fetchTopBorrowed = async () => {\n      try {\n        const response = await fetch(\"/api/books/top-borrowed?limit=10\");\n        if (response.ok) {\n          const data = await response.json();\n          setTopBorrowedBooks(data.books || []);\n        }\n      } catch (error) {\n        console.error(\"Error fetching top borrowed books:\", error);\n      } finally {\n        setLoadingBooks((prev) => ({ ...prev, topBorrowed: false }));\n      }\n    };\n    fetchTopBorrowed();\n  }, []);\n\n  // Fetch new arrivals books\n  useEffect(() => {\n    const fetchNewArrivals = async () => {\n      try {\n        const response = await fetch(\n          \"/api/books?limit=20&sort=createdAt&order=desc\",\n        );\n        if (response.ok) {\n          const data = await response.json();\n          setNewArrivalsBooks(data.books || []);\n        }\n      } catch (error) {\n        console.error(\"Error fetching new arrivals books:\", error);\n      } finally {\n        setLoadingBooks((prev) => ({ ...prev, newArrivals: false }));\n      }\n    };\n    fetchNewArrivals();\n  }, []);\n\n  // Fetch Bangla books\n  useEffect(() => {\n    const fetchBanglaBooks = async () => {\n      try {\n        const response = await fetch(\n          \"/api/books/by-language?language=bn&limit=20\",\n        );\n        if (response.ok) {\n          const data = await response.json();\n          setBanglaBooks(data.books || []);\n        }\n      } catch (error) {\n        console.error(\"Error fetching Bangla books:\", error);\n      } finally {\n        setLoadingBooks((prev) => ({ ...prev, bangla: false }));\n      }\n    };\n    fetchBanglaBooks();\n  }, []);\n\n  // Fetch English books\n  useEffect(() => {\n    const fetchEnglishBooks = async () => {\n      try {\n        const response = await fetch(\n          \"/api/books/by-language?language=en&limit=20\",\n        );\n        if (response.ok) {\n          const data = await response.json();\n          setEnglishBooks(data.books || []);\n        }\n      } catch (error) {\n        console.error(\"Error fetching English books:\", error);\n      } finally {\n        setLoadingBooks((prev) => ({ ...prev, english: false }));\n      }\n    };\n    fetchEnglishBooks();\n  }, []);\n\n  const togglePricingModal = () => {\n    setPricingModalOpen(!pricingModalOpen);\n  };\n\n  const handleFreeRegistration = () => {\n    setPricingModalOpen(false);\n    router.push(\"/member/overview\");\n  };\n\n  const handlePlanSelection = (plan) => {\n    setPricingModalOpen(false);\n    router.push(\"/member/upgrade#choose-plan\");\n  };\n\n  const handleUpgradeSubscription = async (plan) => {\n    if (!user || !userData) {\n      // Redirect to login if not logged in\n      window.location.href = \"/login\";\n      return;\n    }\n\n    // Validate plan value\n    if (!plan || ![\"monthly\", \"yearly\"].includes(plan)) {\n      showError(\"Invalid Plan\", \"Please select a valid subscription plan.\");\n      return;\n    }\n\n    // Validate user ID\n    if (!userData._id) {\n      showError(\n        \"User Error\",\n        \"User information is incomplete. Please try logging in again.\",\n      );\n      return;\n    }\n\n    try {\n      setProcessingSubscription(true);\n\n      const response = await fetch(\"/api/subscriptions/create-checkout\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          userId: userData._id,\n          plan: plan,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to create checkout session\");\n      }\n\n      const data = await response.json();\n\n      // Redirect to Stripe Checkout\n      if (data.url) {\n        window.location.href = data.url;\n      } else {\n        throw new Error(\"No checkout URL returned\");\n      }\n    } catch (err) {\n      console.error(\"Error creating subscription checkout:\", err);\n      showError(\n        \"Subscription Error\",\n        err.message || \"Failed to start subscription. Please try again.\",\n      );\n      setProcessingSubscription(false);\n    }\n  };\n\n  // Format number with K suffix for thousands\n  const formatNumber = (num) => {\n    if (num >= 1000) {\n      return (num / 1000).toFixed(1).replace(/\\.0$/, \"\") + \"k\";\n    }\n    return num.toString();\n  };\n\n  // Scroll Carousel function\n  const scrollCarousel = (ref, direction) => {\n    if (ref.current) {\n      const scrollAmount = 600;\n      ref.current.scrollBy({\n        left: direction === \"left\" ? -scrollAmount : scrollAmount,\n        behavior: \"smooth\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"relative min-h-screen flex flex-col bg-background-light dark:bg-background-dark text-slate-900 dark:text-white font-display overflow-x-hidden\">\n      <Navbar togglePricingModal={togglePricingModal} />\n      <HeroSlider />\n\n      {/* Main Content */}\n      <main className=\"relative z-20 -mt-20 pb-20 space-y-24 px-6 md:px-12 max-w-[1600px] mx-auto w-full\">\n        {/* Stats */}\n        <div\n          ref={statsRef}\n          className=\"glass-panel w-full rounded-[2rem] p-3 border border-white/10 shadow-2xl backdrop-blur-xl bg-black/40 mb-8\"\n        >\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-8 divide-y md:divide-y-0 md:divide-x divide-white/10 text-center\">\n            <div className=\"flex flex-col items-center justify-center p-4\">\n              <span className=\"text-4xl md:text-5xl lg:text-6xl font-black text-white mb-2 tracking-tight\">\n                {!loadingStats\n                  ? (stats.displayBooks || 0) >= 1000\n                    ? formatNumber(stats.displayBooks || 0)\n                    : stats.displayBooks || 0\n                  : \"0\"}\n              </span>\n              <span className=\"text-sm text-primary font-bold uppercase tracking-[0.2em] flex items-center gap-2\">\n                <span className=\"material-symbols-outlined text-lg\">\n                  auto_stories\n                </span>\n                Books\n              </span>\n            </div>\n            <div className=\"flex flex-col items-center justify-center p-4\">\n              <span className=\"text-4xl md:text-5xl lg:text-6xl font-black text-white mb-2 tracking-tight\">\n                {!loadingStats\n                  ? (stats.displayMembers || 0) >= 1000\n                    ? formatNumber(stats.displayMembers || 0)\n                    : stats.displayMembers || 0\n                  : \"0\"}\n              </span>\n              <span className=\"text-sm text-primary font-bold uppercase tracking-[0.2em] flex items-center gap-2\">\n                <span className=\"material-symbols-outlined text-lg\">group</span>\n                Active Members\n              </span>\n            </div>\n            <div className=\"flex flex-col items-center justify-center p-4\">\n              <span className=\"text-4xl md:text-5xl lg:text-6xl font-black text-white mb-2 tracking-tight\">\n                {!loadingStats ? stats.displayLibraries || 0 : \"0\"}\n              </span>\n              <span className=\"text-sm text-primary font-bold uppercase tracking-[0.2em] flex items-center gap-2\">\n                <span className=\"material-symbols-outlined text-lg\">\n                  domain\n                </span>\n                Libraries\n              </span>\n            </div>\n            <div className=\"flex flex-col items-center justify-center p-4\">\n              <span className=\"text-4xl md:text-5xl lg:text-6xl font-black text-white mb-2 tracking-tight\">\n                24/7\n              </span>\n              <span className=\"text-sm text-primary font-bold uppercase tracking-[0.2em] flex items-center gap-2\">\n                <span className=\"material-symbols-outlined text-lg\">\n                  public\n                </span>\n                Access\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Features Section */}\n        <div className=\"animate-section\">\n          <Features />\n        </div>\n\n        {/* Categories Section */}\n        <div className=\"animate-section\">\n          <CategoriesGrid />\n        </div>\n\n        {/* Top Borrowed Section */}\n        <div\n          ref={(el) => (sectionsRef.current[0] = el)}\n          className=\"flex flex-col gap-4 animate-section\"\n        >\n          <div className=\"flex items-end justify-between px-2\">\n            <h2 className=\"text-white text-xl md:text-2xl font-bold tracking-tight\">\n              Top Borrowed This Week\n            </h2>\n            <Link\n              className=\"text-xs font-semibold text-primary hover:text-white uppercase tracking-wider flex items-center gap-1 hover:gap-2 transition-all\"\n              href=\"/explore?sort=rating&order=desc\"\n            >\n              View All{\" \"}\n              <span className=\"material-symbols-outlined text-sm\">\n                arrow_forward\n              </span>\n            </Link>\n          </div>\n          <div className=\"relative group/carousel\">\n            {/* Carousel Navigation Buttons */}\n            <button\n              onClick={() => scrollCarousel(topBorrowedRef, \"left\")}\n              className=\"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-12 h-12 rounded-full bg-black/60 backdrop-blur-xl border border-white/10 text-white flex items-center justify-center opacity-0 group-hover/carousel:opacity-100 group-hover/carousel:translate-x-4 transition-all duration-300 hover:bg-primary\"\n            >\n              <span className=\"material-symbols-outlined\">chevron_left</span>\n            </button>\n            <button\n              onClick={() => scrollCarousel(topBorrowedRef, \"right\")}\n              className=\"absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 z-30 w-12 h-12 rounded-full bg-black/60 backdrop-blur-xl border border-white/10 text-white flex items-center justify-center opacity-0 group-hover/carousel:opacity-100 group-hover/carousel:-translate-x-4 transition-all duration-300 hover:bg-primary\"\n            >\n              <span className=\"material-symbols-outlined\">chevron_right</span>\n            </button>\n\n            <div\n              ref={topBorrowedRef}\n              className=\"flex overflow-x-auto gap-4 md:gap-6 pb-8 pt-4 px-4 md:px-6 no-scrollbar scroll-smooth snap-x\"\n            >\n              {loadingBooks.topBorrowed ? (\n                <div className=\"flex items-center justify-center w-full py-8 text-gray-400\">\n                  Loading...\n                </div>\n              ) : topBorrowedBooks.length === 0 ? (\n                <div className=\"flex items-center justify-center w-full py-8 text-gray-400\">\n                  No books borrowed this week yet.\n                </div>\n              ) : (\n                topBorrowedBooks.map((book, index) => (\n                  <Link\n                    key={book._id}\n                    href={`/book/${book._id}`}\n                    className=\"flex-none w-[160px] md:w-[200px] snap-start group cursor-pointer animate-on-scroll\"\n                  >\n                    <div className=\"card-hover-effect relative aspect-[2/3] rounded-md overflow-hidden shadow-lg shadow-black/50 transform transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-primary/20\">\n                      <Image\n                        src={book.coverImage || \"/placeholder-book.png\"}\n                        alt={`${book.title} by ${book.author}`}\n                        fill\n                        className=\"object-cover transition-transform duration-500 group-hover:scale-110\"\n                        sizes=\"(max-width: 768px) 160px, 200px\"\n                      />\n                      <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4\">\n                        <div className=\"bg-primary/20 backdrop-blur-md border border-white/20 text-white font-medium py-2 px-4 rounded-sm text-sm text-center\">\n                          View Details\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"mt-3\">\n                      <h3 className=\"text-white text-sm font-semibold truncate\">\n                        {book.title}\n                      </h3>\n                      <p className=\"text-gray-400 text-xs\">{book.author}</p>\n                    </div>\n                  </Link>\n                ))\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Fresh New Arrivals Section */}\n        <div\n          ref={(el) => (sectionsRef.current[1] = el)}\n          className=\"flex flex-col gap-4 animate-section\"\n        >\n          <div className=\"flex items-end justify-between px-2\">\n            <h2 className=\"text-white text-xl md:text-2xl font-bold tracking-tight\">\n              Fresh New Arrivals\n            </h2>\n            <Link\n              className=\"text-xs font-semibold text-primary hover:text-white uppercase tracking-wider flex items-center gap-1 hover:gap-2 transition-all\"\n              href=\"/explore?sort=createdAt&order=desc\"\n            >\n              View All{\" \"}\n              <span className=\"material-symbols-outlined text-sm\">\n                arrow_forward\n              </span>\n            </Link>\n          </div>\n          <div className=\"relative group/carousel\">\n            {/* Carousel Navigation Buttons */}\n            <button\n              onClick={() => scrollCarousel(arrivalsRef, \"left\")}\n              className=\"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-12 h-12 rounded-full bg-black/60 backdrop-blur-xl border border-white/10 text-white flex items-center justify-center opacity-0 group-hover/carousel:opacity-100 group-hover/carousel:translate-x-4 transition-all duration-300 hover:bg-primary\"\n            >\n              <span className=\"material-symbols-outlined\">chevron_left</span>\n            </button>\n            <button\n              onClick={() => scrollCarousel(arrivalsRef, \"right\")}\n              className=\"absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 z-30 w-12 h-12 rounded-full bg-black/60 backdrop-blur-xl border border-white/10 text-white flex items-center justify-center opacity-0 group-hover/carousel:opacity-100 group-hover/carousel:-translate-x-4 transition-all duration-300 hover:bg-primary\"\n            >\n              <span className=\"material-symbols-outlined\">chevron_right</span>\n            </button>\n\n            <div\n              ref={arrivalsRef}\n              className=\"overflow-x-auto no-scrollbar scroll-smooth snap-x\"\n            >\n              <div className=\"flex flex-col gap-4 md:gap-6 pb-8 pt-4 px-4 md:px-6 w-fit\">\n                {loadingBooks.newArrivals ? (\n                  <div className=\"flex items-center justify-center w-full py-8 text-gray-400\">\n                    Loading...\n                  </div>\n                ) : newArrivalsBooks.length === 0 ? (\n                  <div className=\"flex items-center justify-center w-full py-8 text-gray-400\">\n                    No new books available yet.\n                  </div>\n                ) : (\n                  <div className=\"flex gap-4 md:gap-6\">\n                    {newArrivalsBooks.map((book) => (\n                      <Link\n                        key={book._id}\n                        href={`/book/${book._id}`}\n                        className=\"flex-none w-[160px] md:w-[200px] snap-start group cursor-pointer animate-on-scroll\"\n                      >\n                        <div className=\"card-hover-effect relative aspect-[2/3] rounded-md overflow-hidden shadow-lg shadow-black/50 transform transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-primary/20\">\n                          <Image\n                            src={book.coverImage || \"/placeholder-book.png\"}\n                            alt={`${book.title} by ${book.author}`}\n                            fill\n                            className=\"object-cover transition-transform duration-500 group-hover:scale-110\"\n                            sizes=\"(max-width: 768px) 160px, 200px\"\n                          />\n                          <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4\">\n                            <div className=\"bg-primary/20 backdrop-blur-md border border-white/20 text-white font-medium py-2 px-4 rounded-sm text-sm text-center\">\n                              View Details\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"mt-3\">\n                          <h3 className=\"text-white text-sm font-semibold truncate\">\n                            {book.title}\n                          </h3>\n                          <p className=\"text-gray-400 text-xs\">{book.author}</p>\n                        </div>\n                      </Link>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Bangla Books Section */}\n        <div\n          ref={(el) => (sectionsRef.current[2] = el)}\n          className=\"flex flex-col gap-4 animate-section\"\n        >\n          <div className=\"flex items-end justify-between px-2\">\n            <h2 className=\"text-white text-xl md:text-2xl font-bold tracking-tight\">\n              Bangla Books\n            </h2>\n            <Link\n              className=\"text-xs font-semibold text-primary hover:text-white uppercase tracking-wider flex items-center gap-1 hover:gap-2 transition-all\"\n              href=\"/explore?language=bn\"\n            >\n              View All{\" \"}\n              <span className=\"material-symbols-outlined text-sm\">\n                arrow_forward\n              </span>\n            </Link>\n          </div>\n          <div className=\"relative group/carousel\">\n            {/* Carousel Navigation Buttons */}\n            <button\n              onClick={() => scrollCarousel(banglaRef, \"left\")}\n              className=\"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-12 h-12 rounded-full bg-black/60 backdrop-blur-xl border border-white/10 text-white flex items-center justify-center opacity-0 group-hover/carousel:opacity-100 group-hover/carousel:translate-x-4 transition-all duration-300 hover:bg-primary\"\n            >\n              <span className=\"material-symbols-outlined\">chevron_left</span>\n            </button>\n            <button\n              onClick={() => scrollCarousel(banglaRef, \"right\")}\n              className=\"absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 z-30 w-12 h-12 rounded-full bg-black/60 backdrop-blur-xl border border-white/10 text-white flex items-center justify-center opacity-0 group-hover/carousel:opacity-100 group-hover/carousel:-translate-x-4 transition-all duration-300 hover:bg-primary\"\n            >\n              <span className=\"material-symbols-outlined\">chevron_right</span>\n            </button>\n\n            <div\n              ref={banglaRef}\n              className=\"overflow-x-auto no-scrollbar scroll-smooth snap-x\"\n            >\n              <div className=\"flex flex-col gap-4 md:gap-6 pb-8 pt-4 px-4 md:px-6 w-fit\">\n                {loadingBooks.bangla ? (\n                  <div className=\"flex items-center justify-center w-full py-8 text-gray-400\">\n                    Loading...\n                  </div>\n                ) : banglaBooks.length === 0 ? (\n                  <div className=\"flex items-center justify-center w-full py-8 text-gray-400\">\n                    No Bangla books available yet.\n                  </div>\n                ) : (\n                  <div className=\"flex gap-4 md:gap-6\">\n                    {banglaBooks.map((book) => (\n                      <Link\n                        key={book._id}\n                        href={`/book/${book._id}`}\n                        className=\"flex-none w-[160px] md:w-[200px] snap-start group cursor-pointer animate-on-scroll\"\n                      >\n                        <div className=\"card-hover-effect relative aspect-[2/3] rounded-md overflow-hidden shadow-lg shadow-black/50 transform transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-primary/20\">\n                          <Image\n                            src={book.coverImage || \"/placeholder-book.png\"}\n                            alt={`${book.title} by ${book.author}`}\n                            fill\n                            className=\"object-cover transition-transform duration-500 group-hover:scale-110\"\n                            sizes=\"(max-width: 768px) 160px, 200px\"\n                          />\n                          <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4\">\n                            <div className=\"bg-primary/20 backdrop-blur-md border border-white/20 text-white font-medium py-2 px-4 rounded-sm text-sm text-center\">\n                              View Details\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"mt-3\">\n                          <h3 className=\"text-white text-sm font-semibold truncate\">\n                            {book.title}\n                          </h3>\n                          <p className=\"text-gray-400 text-xs\">{book.author}</p>\n                        </div>\n                      </Link>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* English Books Section */}\n        <div\n          ref={(el) => (sectionsRef.current[3] = el)}\n          className=\"flex flex-col gap-4 animate-section\"\n        >\n          <div className=\"flex items-end justify-between px-2\">\n            <h2 className=\"text-white text-xl md:text-2xl font-bold tracking-tight\">\n              English Books\n            </h2>\n            <Link\n              className=\"text-xs font-semibold text-primary hover:text-white uppercase tracking-wider flex items-center gap-1 hover:gap-2 transition-all\"\n              href=\"/explore?language=en\"\n            >\n              View All{\" \"}\n              <span className=\"material-symbols-outlined text-sm\">\n                arrow_forward\n              </span>\n            </Link>\n          </div>\n          <div className=\"relative group/carousel\">\n            {/* Carousel Navigation Buttons */}\n            <button\n              onClick={() => scrollCarousel(englishRef, \"left\")}\n              className=\"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-12 h-12 rounded-full bg-black/60 backdrop-blur-xl border border-white/10 text-white flex items-center justify-center opacity-0 group-hover/carousel:opacity-100 group-hover/carousel:translate-x-4 transition-all duration-300 hover:bg-primary\"\n            >\n              <span className=\"material-symbols-outlined\">chevron_left</span>\n            </button>\n            <button\n              onClick={() => scrollCarousel(englishRef, \"right\")}\n              className=\"absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 z-30 w-12 h-12 rounded-full bg-black/60 backdrop-blur-xl border border-white/10 text-white flex items-center justify-center opacity-0 group-hover/carousel:opacity-100 group-hover/carousel:-translate-x-4 transition-all duration-300 hover:bg-primary\"\n            >\n              <span className=\"material-symbols-outlined\">chevron_right</span>\n            </button>\n\n            <div\n              ref={englishRef}\n              className=\"overflow-x-auto no-scrollbar scroll-smooth snap-x\"\n            >\n              <div className=\"flex flex-col gap-4 md:gap-6 pb-8 pt-4 px-4 md:px-6 w-fit\">\n                {loadingBooks.english ? (\n                  <div className=\"flex items-center justify-center w-full py-8 text-gray-400\">\n                    Loading...\n                  </div>\n                ) : englishBooks.length === 0 ? (\n                  <div className=\"flex items-center justify-center w-full py-8 text-gray-400\">\n                    No English books available yet.\n                  </div>\n                ) : (\n                  <div className=\"flex gap-4 md:gap-6\">\n                    {englishBooks.map((book) => (\n                      <Link\n                        key={book._id}\n                        href={`/book/${book._id}`}\n                        className=\"flex-none w-[160px] md:w-[200px] snap-start group cursor-pointer animate-on-scroll\"\n                      >\n                        <div className=\"card-hover-effect relative aspect-[2/3] rounded-md overflow-hidden shadow-lg shadow-black/50 transform transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-primary/20\">\n                          <Image\n                            src={book.coverImage || \"/placeholder-book.png\"}\n                            alt={`${book.title} by ${book.author}`}\n                            fill\n                            className=\"object-cover transition-transform duration-500 group-hover:scale-110\"\n                            sizes=\"(max-width: 768px) 160px, 200px\"\n                          />\n                          <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4\">\n                            <div className=\"bg-primary/20 backdrop-blur-md border border-white/20 text-white font-medium py-2 px-4 rounded-sm text-sm text-center\">\n                              View Details\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"mt-3\">\n                          <h3 className=\"text-white text-sm font-semibold truncate\">\n                            {book.title}\n                          </h3>\n                          <p className=\"text-gray-400 text-xs\">{book.author}</p>\n                        </div>\n                      </Link>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* CTA Section - Show for general members and non-logged-in users */}\n        {(isGeneralMember || !user) && (\n          <div\n            ref={(el) => (sectionsRef.current[4] = el)}\n            className={`relative rounded-[3rem] overflow-hidden mt-12 group animate-section`}\n          >\n            <div className=\"absolute inset-0 bg-gradient-to-r from-primary to-purple-900 opacity-20 group-hover:opacity-30 transition-opacity duration-500\"></div>\n            <div className=\"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10\"></div>\n            <div className=\"relative z-10 px-8 py-16 md:px-20 md:py-24 flex flex-col lg:flex-row items-center justify-between gap-12 text-center lg:text-left border border-white/10 rounded-[3rem] bg-background-dark/60 backdrop-blur-xl transform transition-all duration-500 hover:scale-[1.01]\">\n              <div className=\"max-w-2xl space-y-6\">\n                <h2 className=\"text-4xl md:text-5xl font-black text-white tracking-tight leading-tight\">\n                  Ready to Reimagine Your{\" \"}\n                  <span className=\"text-primary\">Reading?</span>\n                </h2>\n                <p className=\"text-gray-300 text-xl font-light leading-relaxed\">\n                  Join Bookflix today and get instant access to our curated\n                  collection. No late fees, no hassles, just pure stories.\n                </p>\n                <div className=\"flex flex-wrap items-center justify-center lg:justify-start gap-6 text-sm text-gray-400 pt-4\">\n                  <span className=\"flex items-center gap-2\">\n                    <span className=\"material-symbols-outlined text-green-400\">\n                      check_circle\n                    </span>\n                    Cancel anytime\n                  </span>\n                  <span className=\"flex items-center gap-2\">\n                    <span className=\"material-symbols-outlined text-green-400\">\n                      check_circle\n                    </span>\n                    Free 7-day trial\n                  </span>\n                  <span className=\"flex items-center gap-2\">\n                    <span className=\"material-symbols-outlined text-green-400\">\n                      check_circle\n                    </span>\n                    15k+ Titles\n                  </span>\n                </div>\n              </div>\n              <button\n                className=\"shrink-0 bg-primary hover:bg-primary-hover text-white px-12 py-6 rounded-full font-bold text-xl transition-all shadow-glow hover:scale-105 active:scale-95 flex items-center gap-3\"\n                onClick={togglePricingModal}\n              >\n                Get Started Now{\" \"}\n                <span className=\"material-symbols-outlined\">arrow_forward</span>\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Testimonials Section */}\n        <Testimonials />\n\n        {/* FAQ Section */}\n        <FAQ />\n\n        {/* Newsletter Section */}\n        <Newsletter />\n      </main>\n\n      <Footer />\n\n      {/* Pricing Modal */}\n      {pricingModalOpen && (\n        <div\n          aria-labelledby=\"modal-title\"\n          aria-modal=\"true\"\n          className=\"fixed inset-0 z-[100]\"\n          id=\"pricing-modal\"\n          role=\"dialog\"\n        >\n          <div\n            className=\"fixed inset-0 bg-black/90 backdrop-blur-sm transition-opacity\"\n            onClick={togglePricingModal}\n          ></div>\n          <div className=\"fixed inset-0 z-10 overflow-y-auto\">\n            <div className=\"flex min-h-full items-center justify-center p-4 text-center sm:p-0\">\n              <div className=\"relative transform overflow-hidden rounded-2xl bg-background-dark border border-white/10 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-5xl\">\n                <div className=\"absolute top-4 right-4 z-20\">\n                  <button\n                    className=\"text-gray-400 hover:text-white transition-colors\"\n                    onClick={togglePricingModal}\n                    type=\"button\"\n                  >\n                    <span className=\"material-symbols-outlined text-2xl\">\n                      close\n                    </span>\n                  </button>\n                </div>\n                <div className=\"px-8 py-10 sm:p-12\">\n                  <div className=\"text-center mb-10\">\n                    <h2 className=\"text-3xl font-bold text-white mb-2\">\n                      Choose Your Plan\n                    </h2>\n                    <p className=\"text-gray-400\">\n                      Unlock the full potential of your library experience.\n                    </p>\n                  </div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                    {/* Free Plan */}\n                    <div className=\"rounded-xl border border-white/10 bg-surface-dark p-6 hover:border-primary/50 transition-colors flex flex-col\">\n                      <h3 className=\"text-xl font-bold text-white\">\n                        Free Plan\n                      </h3>\n                      <div className=\"mt-4 flex items-baseline text-white\">\n                        <span className=\"text-4xl font-black tracking-tight\">\n                          0 \n                        </span>\n                        <span className=\"ml-1 text-sm text-gray-400\">\n                          /month\n                        </span>\n                      </div>\n                      <ul className=\"mt-6 space-y-4 flex-1 text-sm text-gray-300\">\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          7-day borrowing\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          15% standard late fine\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          Basic reservation queue\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          In-library pickup only\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          Email notifications\n                        </li>\n                      </ul>\n                      <button\n                        onClick={handleFreeRegistration}\n                        className=\"mt-8 w-full rounded-md border border-white/20 bg-transparent px-4 py-2 text-sm font-bold text-white hover:bg-white/5 transition-colors\"\n                      >\n                        Free registration\n                      </button>\n                    </div>\n\n                    {/* Monthly Premium */}\n                    <div className=\"rounded-xl border border-primary bg-purple-200 p-6 relative flex flex-col transform md:-translate-y-2 shadow-[0_4px_20px_rgba(170,31,239,0.15)]\">\n                      <div className=\"absolute -top-3 left-1/2 -translate-x-1/2 bg-primary text-white text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-wide\">\n                        Popular\n                      </div>\n                      <h3 className=\"text-xl font-bold text-white\">\n                        Monthly Premium\n                      </h3>\n                      <div className=\"mt-4 flex items-baseline text-white\">\n                        <span className=\"text-4xl font-black tracking-tight\">\n                          200 \n                        </span>\n                        <span className=\"ml-1 text-sm text-gray-400\">\n                          /month\n                        </span>\n                      </div>\n                      <ul className=\"mt-6 space-y-4 flex-1 text-sm text-gray-300\">\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          20-day borrowing\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          5% late fine discount\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          Advance reservation\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          Home delivery\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          Push & SMS notifications\n                        </li>\n                      </ul>\n                      <button\n                        onClick={() => handlePlanSelection(\"monthly\")}\n                        className=\"mt-8 w-full rounded-md bg-primary px-4 py-2 text-sm font-bold text-white hover:bg-primary-hover transition-colors shadow-lg shadow-primary/25\"\n                      >\n                        {user ? \"Get Monthly\" : \"Sign Up for Monthly\"}\n                      </button>\n                    </div>\n\n                    {/* Yearly Premium */}\n                    <div className=\"rounded-xl border border-white/10 bg-surface-dark p-6 hover:border-primary/50 transition-colors flex flex-col\">\n                      <h3 className=\"text-xl font-bold text-white\">\n                        Yearly Premium\n                      </h3>\n                      <div className=\"mt-4 flex flex-col text-white\">\n                        <div className=\"flex items-baseline\">\n                          <span className=\"text-4xl font-black tracking-tight\">\n                            2,000 \n                          </span>\n                          <span className=\"ml-1 text-sm text-gray-400\">\n                            /year\n                          </span>\n                        </div>\n                        <span className=\"text-xs text-green-400 mt-1 font-semibold\">\n                          Save 17%\n                        </span>\n                      </div>\n                      <ul className=\"mt-6 space-y-4 flex-1 text-sm text-gray-300\">\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          20-day borrowing\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          10% late fine discount\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          Priority advance reservation\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          Free home delivery\n                        </li>\n                        <li className=\"flex items-start\">\n                          <span className=\"material-symbols-outlined text-primary text-lg mr-2 shrink-0\">\n                            check\n                          </span>\n                          Push, SMS & priority support\n                        </li>\n                      </ul>\n                      <button\n                        onClick={() => handlePlanSelection(\"yearly\")}\n                        className=\"mt-8 w-full rounded-md border border-white/20 bg-transparent px-4 py-2 text-sm font-bold text-white hover:bg-white/5 transition-colors\"\n                      >\n                        {user ? \"Get Yearly\" : \"Sign Up for Yearly\"}\n                      </button>\n                    </div>\n                  </div>\n                  <div className=\"mt-10 pt-6 border-t border-white/5 text-center\">\n                    <p className=\"text-gray-500 text-md\">\n                      Redirecting to registration in{\" \"}\n                      <span className=\"text-primary font-bold\">\n                        {countdown}\n                      </span>{\" \"}\n                      seconds...\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\pricing\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'router' and 'userData?.subscription?.status'. Either include them or remove the dependency array.","line":67,"column":6,"nodeType":"ArrayExpression","endLine":67,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [router, userData?.subscription?.status]","fix":{"range":[1849,1851],"text":"[router, userData?.subscription?.status]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport Navbar from '@/components/Navbar';\r\nimport Footer from '@/components/Footer';\r\nimport FAQ from '@/components/FAQ';\r\nimport Testimonials from '@/components/Testimonials';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport gsap from 'gsap';\r\nimport { ScrollTrigger } from 'gsap/ScrollTrigger';\r\n\r\nif (typeof window !== 'undefined') {\r\n  gsap.registerPlugin(ScrollTrigger);\r\n}\r\n\r\nexport default function PricingPage() {\r\n  const { user, userData } = useAuth();\r\n  const router = useRouter();\r\n  const titleRef = useRef(null);\r\n  const cardsRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    // Redirect if already premium\r\n    if (userData?.subscription?.status === 'active') {\r\n      router.replace('/');\r\n      return;\r\n    }\r\n    // Title Animation\r\n    gsap.fromTo(titleRef.current,\r\n      { opacity: 0, scale: 0.9, y: 50 },\r\n      { opacity: 1, scale: 1, y: 0, duration: 1.2, ease: 'power4.out' }\r\n    );\r\n\r\n    // Cards Staggered Entry\r\n    const cards = cardsRef.current.children;\r\n    gsap.fromTo(cards,\r\n      { opacity: 0, y: 60 },\r\n      { \r\n        opacity: 1, \r\n        y: 0, \r\n        duration: 0.8, \r\n        stagger: 0.2, \r\n        ease: 'back.out(1.7)',\r\n        scrollTrigger: {\r\n          trigger: cardsRef.current,\r\n          start: 'top 80%',\r\n        }\r\n      }\r\n    );\r\n\r\n    // Global animate-on-scroll elements\r\n    const scrollElements = document.querySelectorAll('.animate-on-scroll');\r\n    scrollElements.forEach((el) => {\r\n      gsap.to(el, {\r\n        opacity: 1,\r\n        y: 0,\r\n        duration: 1,\r\n        ease: 'power3.out',\r\n        scrollTrigger: {\r\n          trigger: el,\r\n          start: 'top 85%',\r\n          toggleActions: 'play none none none'\r\n        }\r\n      });\r\n    });\r\n  }, []);\r\n\r\n  const handlePlanSelection = (plan) => {\r\n    if (user) {\r\n      router.push('/member/upgrade#choose-plan');\r\n    } else {\r\n      router.push('/register');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-background-dark min-h-screen flex flex-col font-display selection:bg-primary selection:text-white\">\r\n      <Navbar />\r\n      \r\n      <main className=\"flex-grow pt-32 pb-20\">\r\n        {/* Header */}\r\n        <section className=\"px-6 text-center max-w-4xl mx-auto mb-20\">\r\n          <div ref={titleRef} className=\"opacity-0\">\r\n            <h1 className=\"text-sm font-bold text-primary uppercase tracking-[0.4em] mb-4\">Pricing Plans</h1>\r\n            <h2 className=\"text-4xl md:text-7xl font-black text-white tracking-tighter mb-6\">\r\n              Choose the <span className=\"text-primary italic\">Perfect </span> Fit\r\n            </h2>\r\n            <p className=\"text-gray-400 text-xl font-light leading-relaxed\">\r\n              Unlock unlimited possibilities with our flexible membership tiers. \r\n              Find the right level of access for your reading journey.\r\n            </p>\r\n          </div>\r\n        </section>\r\n\r\n        {/* Pricing Cards */}\r\n        <section className=\"px-6 max-w-[1400px] mx-auto\">\r\n          <div ref={cardsRef} className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n            {/* Free Plan */}\r\n            <div className=\"rounded-[2.5rem] border border-white/10 bg-surface-dark/50 p-10 flex flex-col transition-all duration-300 hover:border-primary/30 group opacity-0\">\r\n              <div className=\"mb-8\">\r\n                <span className=\"material-symbols-outlined text-4xl text-gray-400 mb-4 group-hover:scale-110 transition-transform\">eco</span>\r\n                <h3 className=\"text-2xl font-bold text-white mb-2\">Free Explorer</h3>\r\n                <p className=\"text-gray-500 text-sm\">Perfect for occasional readers starting their journey.</p>\r\n              </div>\r\n              <div className=\"mb-10 flex items-baseline gap-1\">\r\n                <span className=\"text-5xl font-black text-white\">0</span>\r\n                <span className=\"text-gray-500 font-medium\">/month</span>\r\n              </div>\r\n              <ul className=\"space-y-5 mb-12 flex-grow\">\r\n                {[\r\n                  '7-day standard borrowing',\r\n                  '15% standard late fine',\r\n                  'Basic reservation queue',\r\n                  'In-library pickup only',\r\n                  'Email notifications'\r\n                ].map((item, i) => (\r\n                  <li key={i} className=\"flex items-center gap-3 text-gray-300 text-sm\">\r\n                    <span className=\"material-symbols-outlined text-primary text-xl\">check_circle</span>\r\n                    {item}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n              <button \r\n                onClick={() => router.push('/register')}\r\n                className=\"w-full py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-bold hover:bg-white/10 transition-all active:scale-95\"\r\n              >\r\n                Join for Free\r\n              </button>\r\n            </div>\r\n\r\n            {/* Monthly Premium */}\r\n            <div className=\"rounded-[2.5rem] border-2 border-primary bg-primary/5 p-10 flex flex-col relative shadow-[0_0_50px_rgba(170,31,239,0.1)] transform md:-translate-y-4 opacity-0\">\r\n              <div className=\"absolute top-0 right-10 -translate-y-1/2 bg-primary text-white text-xs font-black uppercase tracking-widest px-6 py-2 rounded-full\">\r\n                Most Popular\r\n              </div>\r\n              <div className=\"mb-8\">\r\n                <span className=\"material-symbols-outlined text-4xl text-primary mb-4 drop-shadow-[0_0_10px_rgba(170,31,239,0.5)]\">auto_awesome</span>\r\n                <h3 className=\"text-2xl font-bold text-white mb-2\">Monthly Pro</h3>\r\n                <p className=\"text-gray-500 text-sm\">Advanced features for active library members.</p>\r\n              </div>\r\n              <div className=\"mb-10 flex items-baseline gap-1\">\r\n                <span className=\"text-5xl font-black text-white\">200</span>\r\n                <span className=\"text-gray-500 font-medium\">/month</span>\r\n              </div>\r\n              <ul className=\"space-y-5 mb-12 flex-grow\">\r\n                {[\r\n                  '20-day extended borrowing',\r\n                  '5% late fine discount',\r\n                  'Advance reservation perks',\r\n                  'Home delivery available',\r\n                  'SMS & Push notifications'\r\n                ].map((item, i) => (\r\n                  <li key={i} className=\"flex items-center gap-3 text-gray-100 text-sm\">\r\n                    <span className=\"material-symbols-outlined text-primary text-xl\">check_circle</span>\r\n                    {item}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n              <button \r\n                onClick={() => handlePlanSelection('monthly')}\r\n                className=\"w-full py-4 rounded-2xl bg-primary text-white font-bold hover:bg-primary-hover shadow-lg shadow-primary/30 transition-all active:scale-95\"\r\n              >\r\n                Get Premium\r\n              </button>\r\n            </div>\r\n\r\n            {/* Yearly Premium */}\r\n            <div className=\"rounded-[2.5rem] border border-white/10 bg-surface-dark/50 p-10 flex flex-col transition-all duration-300 hover:border-primary/30 group opacity-0\">\r\n              <div className=\"mb-8 flex justify-between items-start\">\r\n                <div>\r\n                  <span className=\"material-symbols-outlined text-4xl text-amber-400 mb-4 group-hover:scale-110 transition-transform\">military_tech</span>\r\n                  <h3 className=\"text-2xl font-bold text-white mb-2\">Elite Yearly</h3>\r\n                </div>\r\n                <div className=\"bg-green-500/20 text-green-400 text-[10px] font-black uppercase px-2 py-1 rounded\">Save 17%</div>\r\n              </div>\r\n              <p className=\"text-gray-500 text-sm mb-8\">The ultimate library experience with maximum savings.</p>\r\n              <div className=\"mb-10 flex flex-col\">\r\n                <div className=\"flex items-baseline gap-1\">\r\n                  <span className=\"text-5xl font-black text-white\">2,000</span>\r\n                  <span className=\"text-gray-500 font-medium\">/year</span>\r\n                </div>\r\n                <span className=\"text-xs text-gray-500 mt-1 italic\">Equivalent to 166/month</span>\r\n              </div>\r\n              <ul className=\"space-y-5 mb-12 flex-grow\">\r\n                {[\r\n                  '20-day extended borrowing',\r\n                  '10% late fine discount',\r\n                  'Priority reservation queue',\r\n                  'Free home delivery',\r\n                  'Priority support access'\r\n                ].map((item, i) => (\r\n                  <li key={i} className=\"flex items-center gap-3 text-gray-300 text-sm\">\r\n                    <span className=\"material-symbols-outlined text-primary text-xl\">check_circle</span>\r\n                    {item}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n              <button \r\n                onClick={() => handlePlanSelection('yearly')}\r\n                className=\"w-full py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-bold hover:bg-white/10 transition-all active:scale-95\"\r\n              >\r\n                Go Elite\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </section>\r\n\r\n        {/* FAQ Integration */}\r\n        <FAQ />\r\n\r\n        {/* Social Proof */}\r\n        <Testimonials />\r\n      </main>\r\n\r\n      <Footer />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\register\\layout.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\app\\register\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'profilePhotoUrl'. Either include it or remove the dependency array.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [completeRegistration, profilePhotoUrl, user]","fix":{"range":[1756,1784],"text":"[completeRegistration, profilePhotoUrl, user]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useAuth\" is called in function \"handleSubmit\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".","line":272,"column":33,"nodeType":"Identifier","endLine":272,"endColumn":40},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":365,"column":29,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[13045,13120],"text":"\n              Join the world&apos;s largest digital library today.\n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[13045,13120],"text":"\n              Join the world&lsquo;s largest digital library today.\n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[13045,13120],"text":"\n              Join the world&#39;s largest digital library today.\n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[13045,13120],"text":"\n              Join the world&rsquo;s largest digital library today.\n            "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":397,"column":21,"nodeType":"JSXOpeningElement","endLine":397,"endColumn":103}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef, useEffect, Suspense } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport Link from 'next/link';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { LOCATION_DATA } from '@/lib/locationData';\nimport { getRoleOverviewRoute } from '@/lib/utils';\nimport Loader from '@/components/Loader';\nimport { isValidEmail, validatePassword, isValidPhone, validateForm } from '@/lib/validation';\n\nfunction RegisterPageContent() {\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    password: '',\n    division: '',\n    city: '',\n    area: '',\n    landmark: '',\n  });\n  const [profilePhoto, setProfilePhoto] = useState(null);\n  const [profilePhotoUrl, setProfilePhotoUrl] = useState(null);\n  const [showPassword, setShowPassword] = useState(false);\n  const [termsAccepted, setTermsAccepted] = useState(false);\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [fieldErrors, setFieldErrors] = useState({});\n  const fileInputRef = useRef(null);\n  const { signUp, signInWithGoogle, user } = useAuth();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const completeRegistration = searchParams.get('complete') === 'true';\n\n  // If user is already logged in and completing registration\n  useEffect(() => {\n    if (completeRegistration && user) {\n      setFormData(prev => ({\n        ...prev,\n        email: user.email || '',\n        name: user.displayName || '',\n      }));\n      // Set Google profile photo if available\n      if (user.photoURL && !profilePhotoUrl) {\n        setProfilePhotoUrl(user.photoURL);\n      }\n    }\n  }, [completeRegistration, user]);\n\n  const handleInputChange = (e) => {\n    const { name, value } = e.target;\n    \n    // Handle cascading dropdowns\n    if (name === 'division') {\n      setFormData(prev => ({\n        ...prev,\n        division: value,\n        city: '', // Reset city when division changes\n        area: '', // Reset area when division changes\n      }));\n    } else if (name === 'city') {\n      setFormData(prev => ({\n        ...prev,\n        city: value,\n        area: '', // Reset area when city changes\n      }));\n    } else {\n      setFormData(prev => ({\n        ...prev,\n        [name]: value,\n      }));\n    }\n  };\n\n  // Get available cities based on selected division\n  const getAvailableCities = () => {\n    if (!formData.division || !LOCATION_DATA[formData.division]) {\n      return [];\n    }\n    return Object.keys(LOCATION_DATA[formData.division]);\n  };\n\n  // Get available areas based on selected division and city\n  const getAvailableAreas = () => {\n    if (!formData.division || !formData.city || !LOCATION_DATA[formData.division]) {\n      return [];\n    }\n    return LOCATION_DATA[formData.division][formData.city] || [];\n  };\n\n  const handlePhotoChange = async (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    if (file.size > 5 * 1024 * 1024) {\n      setError('Image size must be less than 5MB');\n      return;\n    }\n\n    setProfilePhoto(file);\n    setUploading(true);\n    setError('');\n\n    try {\n      const formData = new FormData();\n      formData.append('image', file);\n\n      const response = await fetch('/api/upload', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to upload image');\n      }\n\n      const data = await response.json();\n      setProfilePhotoUrl(data.url);\n    } catch (error) {\n      setError('Failed to upload image. Please try again.');\n      setProfilePhoto(null);\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setError('');\n    setFieldErrors({});\n\n    if (!termsAccepted) {\n      setError('Please accept the Terms & Conditions and Privacy Policy');\n      return;\n    }\n\n    // Client-side validation\n    const validationRules = {\n      name: { required: true, label: 'Name', minLength: 2 },\n      email: { required: true, label: 'Email', email: true },\n      password: { required: true, label: 'Password', password: true },\n      phone: { required: false, label: 'Phone', custom: (value) => {\n        if (value && !isValidPhone(value)) {\n          return { isValid: false, message: 'Please enter a valid phone number' };\n        }\n        return { isValid: true };\n      }},\n      division: { required: true, label: 'Division' },\n      city: { required: true, label: 'City' },\n      area: { required: true, label: 'Area' },\n    };\n\n    const validation = validateForm(formData, validationRules);\n    if (!validation.isValid) {\n      setFieldErrors(validation.errors);\n      setError('Please fix the errors below');\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      let firebaseUser;\n      \n      if (completeRegistration && user) {\n        // User already authenticated via Google, just save to MongoDB\n        firebaseUser = user;\n      } else {\n        // Additional validation\n        if (!formData.email || !formData.email.trim()) {\n          setError('Email is required.');\n          setLoading(false);\n          return;\n        }\n\n        if (!formData.password || !formData.password.trim()) {\n          setError('Password is required.');\n          setLoading(false);\n          return;\n        }\n\n        // Validate email format\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (!emailRegex.test(formData.email.trim())) {\n          setError('Please enter a valid email address.');\n          setLoading(false);\n          return;\n        }\n\n        // Validate password before attempting signup\n        if (formData.password.length < 6) {\n          setError('Password must be at least 6 characters long.');\n          setLoading(false);\n          return;\n        }\n\n        // Create Firebase account\n        try {\n          const result = await signUp(formData.email.trim(), formData.password, formData.name?.trim());\n          if (!result.success) {\n            // Check if email is already in use\n            if (result.code === 'auth/email-already-in-use' || \n                result.error?.includes('email-already-in-use') || \n                result.error?.includes('already in use') || \n                result.error?.includes('already registered') ||\n                result.error?.includes('EMAIL_EXISTS')) {\n              setError('already_registered');\n            } else {\n              // Display the user-friendly error message\n              setError(result.error || 'Failed to create account. Please check your email and password.');\n            }\n            setLoading(false);\n            return;\n          }\n          firebaseUser = result.user;\n        } catch (signupError) {\n          console.error('Signup error:', signupError);\n          setError(signupError.message || 'Failed to create account. Please try again.');\n          setLoading(false);\n          return;\n        }\n      }\n\n      // Save user to MongoDB\n      const userData = {\n        firebaseUid: firebaseUser.uid,\n        email: formData.email,\n        name: formData.name,\n        phone: formData.phone,\n        profilePhoto: profilePhotoUrl || firebaseUser.photoURL || null, // Use Google photo if available\n        address: {\n          division: formData.division,\n          city: formData.city,\n          area: formData.area,\n          landmark: formData.landmark,\n        },\n      };\n\n      const response = await fetch('/api/users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(userData),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        \n        // Check if user already exists\n        if (response.status === 409 || errorData.error === 'User already exists') {\n          setError('already_registered');\n          setLoading(false);\n          return;\n        }\n        \n        const errorMessage = errorData.details \n          ? `${errorData.error}: ${errorData.details}`\n          : errorData.error || 'Failed to create user profile';\n        throw new Error(errorMessage);\n      }\n\n      // Fetch user data to get role for navigation\n      const userResponse = await fetch(`/api/users?firebaseUid=${firebaseUser.uid}`);\n      if (userResponse.ok) {\n        const userData = await userResponse.json();\n        const role = userData.role || 'member';\n        \n        // Update local userData in context immediately\n        const { setUserData } = useAuth();\n        // Note: we can't use setUserData here because we're inside the handleSubmit function\n        // and it was already destuctured at the top. Wait, let me check the destructuring.\n        // Actually, let's just use what's available.\n        \n        router.push(getRoleOverviewRoute(role));\n      } else {\n        // Fallback to dashboard if user data fetch fails\n        router.push('/dashboard');\n      }\n    } catch (error) {\n      console.error('Registration error:', error);\n      setError(error.message || 'Failed to register. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleGoogleSignUp = async () => {\n    setError('');\n    setLoading(true);\n\n    try {\n      const result = await signInWithGoogle();\n      \n      if (result.success && result.user) {\n        // Check if user exists in MongoDB\n        try {\n          const response = await fetch(`/api/users?firebaseUid=${encodeURIComponent(result.user.uid)}`);\n          \n          if (response.ok) {\n            // User exists, redirect to dashboard\n            const userData = await response.json();\n            const role = userData.role || 'member';\n            router.push(getRoleOverviewRoute(role));\n          } else if (response.status === 404) {\n            // User doesn't exist in MongoDB, redirect to complete registration\n            router.push('/register?complete=true');\n          } else {\n            // Other error, still redirect to complete registration as fallback\n            console.error('Error checking user:', response.status, await response.text().catch(() => ''));\n            router.push('/register?complete=true');\n          }\n        } catch (error) {\n          console.error('Error fetching user:', error);\n          // On error, redirect to complete registration\n          router.push('/register?complete=true');\n        }\n      } else {\n        setError(result.error || 'Failed to sign up with Google');\n        setLoading(false);\n      }\n    } catch (error) {\n      console.error('Google sign up error:', error);\n      setError(error.message || 'Failed to sign up with Google');\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"bg-background-light dark:bg-background-dark font-display text-white relative min-h-screen flex flex-col overflow-x-hidden selection:bg-primary selection:text-white\">\n      {/* Background Effects */}\n      <div className=\"fixed inset-0 overflow-hidden pointer-events-none -z-10\">\n        <div className=\"absolute -top-[10%] -left-[10%] w-[600px] h-[600px] bg-primary/20 rounded-full blur-[120px] opacity-40 mix-blend-screen\"></div>\n        <div className=\"absolute -bottom-[10%] -right-[10%] w-[600px] h-[600px] bg-purple-50/40 rounded-full blur-[120px] opacity-40\"></div>\n        <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150\"></div>\n      </div>\n\n      <div className=\"layout-container flex grow flex-col items-center justify-center p-4 py-12 md:py-16\">\n        <div className=\"relative w-full max-w-[900px] flex flex-col rounded-2xl border border-border-dark bg-purple-300/80 backdrop-blur-xl shadow-2xl overflow-hidden\">\n          {/* Close Button */}\n          <Link\n            href=\"/\"\n            className=\"absolute top-4 right-4 z-20 flex items-center justify-center w-10 h-10 rounded-full bg-card-dark/50 hover:bg-card-dark border border-border-dark hover:border-primary/50 text-text-muted hover:text-white transition-all cursor-pointer\"\n            aria-label=\"Close and go to home\"\n          >\n            <span className=\"material-symbols-outlined\" style={{ fontSize: '24px' }}>\n              close\n            </span>\n          </Link>\n          \n          {/* Header */}\n          <div className=\"flex flex-col items-center justify-center pt-10 pb-6 px-6 text-center z-10\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <span className=\"material-symbols-outlined text-primary text-4xl\" style={{ fontVariationSettings: \"'FILL' 1\" }}>\n                auto_stories\n              </span>\n              <h1 className=\"text-3xl font-black tracking-tight text-white\">Bookflix</h1>\n            </div>\n            <p className=\"text-white tracking-tight text-2xl md:text-3xl font-bold leading-tight\">\n              Start your reading journey\n            </p>\n            <p className=\"text-text-muted text-sm font-normal leading-normal mt-2\">\n              Join the world's largest digital library today.\n            </p>\n          </div>\n\n          {/* Form */}\n          <div className=\"layout-content-container flex flex-col w-full p-6 md:p-10 md:pt-2\">\n            {error && (\n              <div className={`${error === 'already_registered' ? 'bg-blue-500/20 border-blue-500/50 text-blue-200' : 'bg-red-500/20 border-red-500/50 text-red-200'} px-4 py-3 rounded-lg text-sm mb-4 flex items-start gap-2`}>\n                <span className=\"material-symbols-outlined flex-shrink-0\" style={{ fontSize: '20px' }}>\n                  {error === 'already_registered' ? 'info' : 'error'}\n                </span>\n                <div className=\"flex-1\">\n                  {error === 'already_registered' ? (\n                    <span>\n                      You are already registered. Please{' '}\n                      <Link className=\"text-primary hover:text-white font-medium transition-colors underline\" href=\"/login\">\n                        login\n                      </Link>\n                      {' '}instead.\n                    </span>\n                  ) : (\n                    <span>{error}</span>\n                  )}\n                </div>\n              </div>\n            )}\n\n            <form className=\"flex flex-col gap-6\" onSubmit={handleSubmit}>\n              {/* Profile Photo */}\n              <div className=\"flex items-center gap-5 p-4 rounded-xl bg-card-dark/30 border border-border-dark/30\">\n                <div className=\"relative h-16 w-16 md:h-20 md:w-20 shrink-0 rounded-full border border-border-dark bg-card-dark flex items-center justify-center overflow-hidden\">\n                  {profilePhotoUrl ? (\n                    <img src={profilePhotoUrl} alt=\"Profile\" className=\"w-full h-full object-cover\" />\n                  ) : (\n                    <span className=\"material-symbols-outlined text-text-muted text-3xl md:text-4xl\">person</span>\n                  )}\n                </div>\n                <div className=\"flex flex-col flex-1 gap-1.5\">\n                  <label className=\"text-white text-sm font-medium ml-1\">Profile Photo</label>\n                  <div className=\"flex flex-wrap items-center gap-3\">\n                    <label className=\"flex items-center gap-2 px-4 h-10 bg-card-dark hover:bg-border-dark/50 border border-border-dark hover:border-primary/50 rounded-lg cursor-pointer transition-colors text-sm text-white font-medium group disabled:opacity-50 disabled:cursor-not-allowed\">\n                      <span className=\"material-symbols-outlined text-primary group-hover:text-white transition-colors\" style={{ fontSize: '20px' }}>\n                        cloud_upload\n                      </span>\n                      <span>{uploading ? 'Uploading...' : 'Upload'}</span>\n                      <input\n                        ref={fileInputRef}\n                        accept=\"image/*\"\n                        className=\"hidden\"\n                        type=\"file\"\n                        onChange={handlePhotoChange}\n                        disabled={uploading || loading}\n                      />\n                    </label>\n                    <span className=\"text-xs text-text-muted\">Max 5MB.</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Form Fields */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\n                <label className=\"flex flex-col flex-1\">\n                  <p className=\"text-white text-sm font-medium leading-normal pb-2 ml-1\">Full Name</p>\n                  <input\n                    className=\"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-border-dark bg-card-dark focus:border-primary h-12 placeholder:text-text-muted px-4 py-3 text-base font-normal leading-normal transition-colors\"\n                    placeholder=\"John Doe\"\n                    type=\"text\"\n                    name=\"name\"\n                    value={formData.name}\n                    onChange={handleInputChange}\n                    required\n                    disabled={loading || completeRegistration}\n                  />\n                </label>\n\n                <label className=\"flex flex-col flex-1\">\n                  <p className=\"text-white text-sm font-medium leading-normal pb-2 ml-1\">Phone Number</p>\n                  <input\n                    className=\"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-border-dark bg-card-dark focus:border-primary h-12 placeholder:text-text-muted px-4 py-3 text-base font-normal leading-normal transition-colors\"\n                    placeholder=\"+1 (555) 000-0000\"\n                    type=\"tel\"\n                    name=\"phone\"\n                    value={formData.phone}\n                    onChange={handleInputChange}\n                    disabled={loading}\n                  />\n                </label>\n\n                <label className=\"flex flex-col flex-1\">\n                  <p className=\"text-white text-sm font-medium leading-normal pb-2 ml-1\">Email Address</p>\n                  <input\n                    className=\"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-border-dark bg-card-dark focus:border-primary h-12 placeholder:text-text-muted px-4 py-3 text-base font-normal leading-normal transition-colors\"\n                    placeholder=\"you@example.com\"\n                    type=\"email\"\n                    name=\"email\"\n                    value={formData.email}\n                    onChange={handleInputChange}\n                    required\n                    disabled={loading || completeRegistration}\n                  />\n                </label>\n\n                {!completeRegistration && (\n                  <label className=\"flex flex-col flex-1\">\n                    <p className=\"text-white text-sm font-medium leading-normal pb-2 ml-1\">Password</p>\n                    <div className=\"flex w-full flex-1 items-stretch rounded-lg relative group\">\n                      <input\n                        className=\"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-border-dark bg-card-dark focus:border-primary h-12 placeholder:text-text-muted px-4 py-3 pr-12 text-base font-normal leading-normal transition-colors\"\n                        placeholder=\"\"\n                        type={showPassword ? 'text' : 'password'}\n                        name=\"password\"\n                        value={formData.password}\n                        onChange={handleInputChange}\n                        required\n                        minLength={6}\n                        disabled={loading}\n                      />\n                      <div\n                        className=\"absolute right-0 top-0 h-full flex items-center pr-4 text-text-muted cursor-pointer hover:text-white transition-colors\"\n                        onClick={() => setShowPassword(!showPassword)}\n                      >\n                        <span className=\"material-symbols-outlined\" style={{ fontSize: '20px' }}>\n                          {showPassword ? 'visibility_off' : 'visibility'}\n                        </span>\n                      </div>\n                    </div>\n                    {formData.password && formData.password.length < 6 && (\n                      <p className=\"text-xs text-red-400 mt-1 ml-1\">Password must be at least 6 characters</p>\n                    )}\n                  </label>\n                )}\n\n                <label className=\"flex flex-col flex-1\">\n                  <p className=\"text-white text-sm font-medium leading-normal pb-2 ml-1\">Division</p>\n                  <select\n                    className=\"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-border-dark bg-card-dark focus:border-primary h-12 placeholder:text-text-muted px-4 py-3 text-base font-normal leading-normal transition-colors cursor-pointer\"\n                    name=\"division\"\n                    value={formData.division}\n                    onChange={handleInputChange}\n                    disabled={loading}\n                  >\n                    <option value=\"\" className=\"bg-card-dark text-white\">Select Division</option>\n                    {Object.keys(LOCATION_DATA).map((division) => (\n                      <option key={division} value={division} className=\"bg-card-dark text-white\">\n                        {division}\n                      </option>\n                    ))}\n                  </select>\n                </label>\n\n                <label className=\"flex flex-col flex-1\">\n                  <p className=\"text-white text-sm font-medium leading-normal pb-2 ml-1\">City</p>\n                  <select\n                    className=\"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-border-dark bg-card-dark focus:border-primary h-12 placeholder:text-text-muted px-4 py-3 text-base font-normal leading-normal transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n                    name=\"city\"\n                    value={formData.city}\n                    onChange={handleInputChange}\n                    disabled={loading || !formData.division}\n                  >\n                    <option value=\"\" className=\"bg-card-dark text-white\">Select City</option>\n                    {getAvailableCities().map((city) => (\n                      <option key={city} value={city} className=\"bg-card-dark text-white\">\n                        {city}\n                      </option>\n                    ))}\n                  </select>\n                </label>\n\n                <label className=\"flex flex-col flex-1\">\n                  <p className=\"text-white text-sm font-medium leading-normal pb-2 ml-1\">Area</p>\n                  <select\n                    className=\"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-border-dark bg-card-dark focus:border-primary h-12 placeholder:text-text-muted px-4 py-3 text-base font-normal leading-normal transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n                    name=\"area\"\n                    value={formData.area}\n                    onChange={handleInputChange}\n                    disabled={loading || !formData.city}\n                  >\n                    <option value=\"\" className=\"bg-card-dark text-white\">Select Area</option>\n                    {getAvailableAreas().map((area) => (\n                      <option key={area} value={area} className=\"bg-card-dark text-white\">\n                        {area}\n                      </option>\n                    ))}\n                  </select>\n                </label>\n\n                <label className=\"flex flex-col flex-1\">\n                  <p className=\"text-white text-sm font-medium leading-normal pb-2 ml-1\">Landmark</p>\n                  <input\n                    className=\"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-border-dark bg-card-dark focus:border-primary h-12 placeholder:text-text-muted px-4 py-3 text-base font-normal leading-normal transition-colors\"\n                    placeholder=\"Near Public Library\"\n                    type=\"text\"\n                    name=\"landmark\"\n                    value={formData.landmark}\n                    onChange={handleInputChange}\n                    disabled={loading}\n                  />\n                </label>\n              </div>\n\n              {/* Terms Checkbox */}\n              <div className=\"flex items-center gap-3 px-1 mt-2\">\n                <input\n                  className=\"w-5 h-5 rounded border-border-dark bg-card-dark text-primary focus:ring-primary focus:ring-offset-0 cursor-pointer transition-all\"\n                  id=\"terms\"\n                  type=\"checkbox\"\n                  checked={termsAccepted}\n                  onChange={(e) => setTermsAccepted(e.target.checked)}\n                  disabled={loading}\n                />\n                <label className=\"text-sm text-text-muted select-none cursor-pointer\" htmlFor=\"terms\">\n                  I agree to the{' '}\n                  <Link className=\"text-primary hover:text-white transition-colors hover:underline\" href=\"#\">\n                    Terms & Conditions\n                  </Link>{' '}\n                  and{' '}\n                  <Link className=\"text-primary hover:text-white transition-colors hover:underline\" href=\"#\">\n                    Privacy Policy\n                  </Link>\n                </label>\n              </div>\n\n              {/* Submit Buttons */}\n              <div className=\"flex flex-col items-center gap-4 mt-2\">\n                <button\n                  className=\"flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-xl h-14 bg-primary hover:bg-primary-hover transition-colors text-white text-base font-bold leading-normal tracking-wide shadow-lg shadow-primary/20 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  type=\"submit\"\n                  disabled={loading || uploading}\n                >\n                  {loading ? <Loader /> : 'Join Bookflix'}\n                </button>\n\n                {!completeRegistration && (\n                  <button\n                    className=\"relative flex w-full cursor-pointer items-center justify-center gap-3 overflow-hidden rounded-xl h-14 bg-card-dark border border-border-dark hover:bg-purple-100 hover:border-primary/30 transition-all duration-200 text-white text-base font-medium leading-normal disabled:opacity-50 disabled:cursor-not-allowed\"\n                    type=\"button\"\n                    onClick={handleGoogleSignUp}\n                    disabled={loading || uploading}\n                  >\n                    <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n                      <path\n                        d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n                        fill=\"#4285F4\"\n                      />\n                      <path\n                        d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n                        fill=\"#34A853\"\n                      />\n                      <path\n                        d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\n                        fill=\"#FBBC05\"\n                      />\n                      <path\n                        d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n                        fill=\"#EA4335\"\n                      />\n                    </svg>\n                    <span>Sign up with Google</span>\n                  </button>\n                )}\n\n                <p className=\"text-text-muted text-sm font-normal\">\n                  Already have an account?{' '}\n                  <Link className=\"text-primary hover:text-white font-medium transition-colors ml-1\" href=\"/login\">\n                    Sign In instead\n                  </Link>\n                </p>\n              </div>\n            </form>\n          </div>\n        </div>\n\n        <div className=\"mt-8 text-center\">\n          <p className=\"text-xs text-gray-600 dark:text-gray-500\"> 2024 Bookflix Inc. All rights reserved.</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function RegisterPage() {\n  return (\n    <Suspense fallback={<Loader />}>\n      <RegisterPageContent />\n    </Suspense>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\AddBookModal.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":526,"column":21,"nodeType":"JSXOpeningElement","endLine":530,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useRef } from 'react';\nimport { showError, showSuccess, showLoading, close } from '@/lib/swal';\n\nexport default function AddBookModal({ isOpen, onClose, onBookAdded }) {\n  const [formData, setFormData] = useState({\n    title: '',\n    author: '',\n    isbn: '',\n    publishedYear: '',\n    genre: '',\n    shelfLocation: '',\n    stockCount: 1,\n    description: '',\n    coverImage: null,\n    coverImagePreview: null,\n    bookLanguage: 'en',\n  });\n  const [categories, setCategories] = useState([]);\n  const [uploading, setUploading] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const [showAddGenreModal, setShowAddGenreModal] = useState(false);\n  const [newGenreName, setNewGenreName] = useState('');\n  const [addingGenre, setAddingGenre] = useState(false);\n  const fileInputRef = useRef(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      fetchCategories();\n    }\n  }, [isOpen]);\n\n  const fetchCategories = async () => {\n    try {\n      const response = await fetch('/api/categories?isActive=true');\n      if (response.ok) {\n        const data = await response.json();\n        setCategories(data);\n      }\n    } catch (error) {\n      console.error('Error fetching categories:', error);\n    }\n  };\n\n  const handleAddGenre = async () => {\n    if (!newGenreName.trim()) {\n      showError('Validation Error', 'Genre name is required');\n      return;\n    }\n\n    setAddingGenre(true);\n    const loadingSwal = showLoading('Adding Genre...', 'Please wait while we add the new genre.');\n\n    try {\n      const response = await fetch('/api/categories', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          name: newGenreName.trim(),\n        }),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || 'Failed to create genre');\n      }\n\n      close();\n      showSuccess('Genre Added!', 'The new genre has been successfully added.');\n      \n      // Refresh categories list\n      await fetchCategories();\n      \n      // Set the newly created genre as selected\n      const newCategory = result.category || result;\n      if (newCategory && newCategory._id) {\n        setFormData(prev => ({\n          ...prev,\n          genre: newCategory._id,\n        }));\n      }\n      \n      // Reset and close modal\n      setNewGenreName('');\n      setShowAddGenreModal(false);\n    } catch (error) {\n      close();\n      showError('Error', error.message || 'Failed to add genre. Please try again.');\n    } finally {\n      setAddingGenre(false);\n    }\n  };\n\n  const handleInputChange = (e) => {\n    const { name, value } = e.target;\n    \n    setFormData(prev => ({\n      ...prev,\n      [name]: value,\n    }));\n  };\n\n  const handleStockChange = (delta) => {\n    setFormData(prev => ({\n      ...prev,\n      stockCount: Math.max(1, prev.stockCount + delta),\n    }));\n  };\n\n  const handleFileChange = async (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/svg+xml'];\n    if (!allowedTypes.includes(file.type)) {\n      showError('Invalid file type', 'Please upload a valid image file (JPG, PNG, WEBP, or SVG)');\n      return;\n    }\n\n    // Validate file size (5MB max)\n    if (file.size > 5 * 1024 * 1024) {\n      showError('File too large', 'Image must be less than 5MB');\n      return;\n    }\n\n    // Create preview\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setFormData(prev => ({\n        ...prev,\n        coverImage: file,\n        coverImagePreview: reader.result,\n      }));\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      const fakeEvent = { target: { files: [file] } };\n      handleFileChange(fakeEvent);\n    }\n  };\n\n  const uploadImage = async (file) => {\n    const formData = new FormData();\n    formData.append('image', file);\n\n    const response = await fetch('/api/upload', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.error || 'Failed to upload image');\n    }\n\n    const data = await response.json();\n    return data.url;\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    // Validation\n    if (!formData.title.trim()) {\n      showError('Validation Error', 'Book title is required');\n      return;\n    }\n    if (!formData.author.trim()) {\n      showError('Validation Error', 'Author is required');\n      return;\n    }\n    if (!formData.genre) {\n      showError('Validation Error', 'Please select a genre');\n      return;\n    }\n    if (!formData.coverImage) {\n      showError('Validation Error', 'Please upload a cover image');\n      return;\n    }\n\n    setSubmitting(true);\n    const loadingSwal = showLoading('Creating book...', 'Please wait while we add the book to the catalog.');\n\n    try {\n      // Upload image first\n      const imageUrl = await uploadImage(formData.coverImage);\n\n      // Prepare book data\n      const bookData = {\n        title: formData.title.trim(),\n        author: formData.author.trim(),\n        category: formData.genre,\n        coverImage: imageUrl,\n        copies: formData.stockCount,\n        description: formData.description.trim() || undefined,\n        isbn: formData.isbn.trim() || undefined,\n        publishedDate: formData.publishedYear ? `${formData.publishedYear}-01-01` : undefined,\n        bookLanguage: formData.bookLanguage || 'en',\n      };\n\n      // Create book\n      const response = await fetch('/api/books', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(bookData),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || 'Failed to create book');\n      }\n\n      close();\n      showSuccess('Book Created!', 'The book has been successfully added to the catalog.');\n      \n      // Reset form\n      setFormData({\n        title: '',\n        author: '',\n        isbn: '',\n        publishedYear: '',\n        genre: '',\n        shelfLocation: '',\n        stockCount: 1,\n        description: '',\n        coverImage: null,\n        coverImagePreview: null,\n        bookLanguage: 'en',\n      });\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n\n      // Notify parent to refresh book list\n      if (onBookAdded) {\n        onBookAdded();\n      }\n      onClose();\n    } catch (error) {\n      close();\n      showError('Error', error.message || 'Failed to create book. Please try again.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (submitting) return;\n    setFormData({\n      title: '',\n      author: '',\n      isbn: '',\n      publishedYear: '',\n      genre: '',\n      shelfLocation: '',\n      stockCount: 1,\n      description: '',\n      coverImage: null,\n      coverImagePreview: null,\n      bookLanguage: 'en',\n    });\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n    onClose();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-background-dark/80 backdrop-blur-sm\"\n        onClick={handleClose}\n      />\n      \n      {/* Modal Card */}\n      <div className=\"relative z-10 flex flex-col w-full max-w-6xl max-h-[90vh] bg-[#1c1022] rounded-2xl shadow-2xl border border-white/10 overflow-hidden animate-fade-in-up\">\n        {/* Modal Header */}\n        <div className=\"flex items-center justify-between px-8 py-5 border-b border-border-dark bg-[#1c1022]\">\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight text-white\">Add New Book</h1>\n            <p className=\"text-sm text-text-muted mt-1\">Enter the details below to add a new title to the catalog.</p>\n          </div>\n          <button \n            onClick={handleClose}\n            disabled={submitting}\n            className=\"group p-2 rounded-full hover:bg-white/5 transition-colors disabled:opacity-50\"\n          >\n            <span className=\"material-symbols-outlined text-text-muted group-hover:text-white transition-colors\">close</span>\n          </button>\n        </div>\n\n        {/* Modal Body (Scrollable) */}\n        <form onSubmit={handleSubmit} className=\"flex flex-col lg:flex-row h-full overflow-y-auto custom-scrollbar bg-[#1c1022]\">\n          {/* Left Column: Form Fields */}\n          <div className=\"flex-1 p-8 space-y-6\">\n            {/* Title */}\n            <div className=\"flex flex-col gap-2\">\n              <label className=\"text-white text-sm font-semibold tracking-wide\">Book Title</label>\n              <input \n                name=\"title\"\n                value={formData.title}\n                onChange={handleInputChange}\n                className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                placeholder=\"e.g. The Great Gatsby\" \n                type=\"text\"\n                required\n                disabled={submitting}\n              />\n            </div>\n\n            {/* Author */}\n            <div className=\"flex flex-col gap-2\">\n              <label className=\"text-white text-sm font-semibold tracking-wide\">Author</label>\n              <div className=\"relative\">\n                <span className=\"material-symbols-outlined absolute left-3 top-3.5 text-text-muted text-[20px]\">person</span>\n                <input \n                  name=\"author\"\n                  value={formData.author}\n                  onChange={handleInputChange}\n                  className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted pl-10 pr-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                  placeholder=\"e.g. F. Scott Fitzgerald\" \n                  type=\"text\"\n                  required\n                  disabled={submitting}\n                />\n              </div>\n            </div>\n\n            {/* Grid Row: ISBN & Year */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"flex flex-col gap-2\">\n                <label className=\"text-white text-sm font-semibold tracking-wide\">ISBN-13</label>\n                <div className=\"relative\">\n                  <span className=\"material-symbols-outlined absolute left-3 top-3.5 text-text-muted text-[20px]\">qr_code_2</span>\n                  <input \n                    name=\"isbn\"\n                    value={formData.isbn}\n                    onChange={handleInputChange}\n                    className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted pl-10 pr-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                    placeholder=\"978-3-16-148410-0\" \n                    type=\"text\"\n                    disabled={submitting}\n                  />\n                </div>\n              </div>\n              <div className=\"flex flex-col gap-2\">\n                <label className=\"text-white text-sm font-semibold tracking-wide\">Publication Year</label>\n                <div className=\"relative\">\n                  <span className=\"material-symbols-outlined absolute left-3 top-3.5 text-text-muted text-[20px]\">calendar_today</span>\n                  <input \n                    name=\"publishedYear\"\n                    value={formData.publishedYear}\n                    onChange={handleInputChange}\n                    className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted pl-10 pr-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                    placeholder=\"YYYY\" \n                    type=\"number\"\n                    min=\"1000\"\n                    max={new Date().getFullYear()}\n                    disabled={submitting}\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* Grid Row: Genre, Shelf, Stock */}\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              <div className=\"flex flex-col gap-2\">\n                <div className=\"flex items-center justify-between\">\n                  <label className=\"text-white text-sm font-semibold tracking-wide\">Genre</label>\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowAddGenreModal(true)}\n                    disabled={submitting}\n                    className=\"text-xs text-primary hover:text-primary-hover font-medium flex items-center gap-1 transition-colors disabled:opacity-50\"\n                    title=\"Add New Genre\"\n                  >\n                    <span className=\"material-symbols-outlined text-[16px]\">add</span>\n                    Add Genre\n                  </button>\n                </div>\n                <div className=\"relative\">\n                  <select \n                    name=\"genre\"\n                    value={formData.genre}\n                    onChange={handleInputChange}\n                    className=\"w-full appearance-none rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm cursor-pointer\"\n                    required\n                    disabled={submitting}\n                  >\n                    <option disabled value=\"\">Select Genre</option>\n                    {categories.map((cat) => (\n                      <option key={cat._id} value={cat._id}>\n                        {cat.name.charAt(0).toUpperCase() + cat.name.slice(1)}\n                      </option>\n                    ))}\n                  </select>\n                  <span className=\"material-symbols-outlined absolute right-3 top-3.5 text-text-muted pointer-events-none\">expand_more</span>\n                </div>\n              </div>\n              <div className=\"flex flex-col gap-2\">\n                <label className=\"text-white text-sm font-semibold tracking-wide\">Shelf Location</label>\n                <input \n                  name=\"shelfLocation\"\n                  value={formData.shelfLocation}\n                  onChange={handleInputChange}\n                  className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                  placeholder=\"e.g. A-12\" \n                  type=\"text\"\n                  disabled={submitting}\n                />\n              </div>\n              <div className=\"flex flex-col gap-2\">\n                <label className=\"text-white text-sm font-semibold tracking-wide\">Stock Count</label>\n                <div className=\"flex items-center h-[50px] rounded-lg bg-surface-dark border border-border-dark overflow-hidden\">\n                  <button \n                    type=\"button\"\n                    onClick={() => handleStockChange(-1)}\n                    disabled={submitting || formData.stockCount <= 1}\n                    className=\"h-full px-3 text-text-muted hover:text-white hover:bg-white/5 transition-colors border-r border-border-dark disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    <span className=\"material-symbols-outlined text-[18px]\">remove</span>\n                  </button>\n                  <input \n                    name=\"stockCount\"\n                    value={formData.stockCount}\n                    onChange={(e) => {\n                      const value = parseInt(e.target.value) || 1;\n                      setFormData(prev => ({ ...prev, stockCount: Math.max(1, value) }));\n                    }}\n                    className=\"w-full h-full bg-transparent text-center text-white focus:outline-none text-base font-medium appearance-none m-0\" \n                    type=\"number\" \n                    min=\"1\"\n                    disabled={submitting}\n                  />\n                  <button \n                    type=\"button\"\n                    onClick={() => handleStockChange(1)}\n                    disabled={submitting}\n                    className=\"h-full px-3 text-text-muted hover:text-white hover:bg-white/5 transition-colors border-l border-border-dark disabled:opacity-50\"\n                  >\n                    <span className=\"material-symbols-outlined text-[18px]\">add</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            {/* Language Field */}\n            <div className=\"flex flex-col gap-2\">\n              <label className=\"text-white text-sm font-semibold tracking-wide\">Language</label>\n              <div className=\"relative\">\n                <span className=\"material-symbols-outlined absolute left-3 top-3.5 text-text-muted text-[20px]\">language</span>\n                    <select \n                      name=\"bookLanguage\"\n                      value={formData.bookLanguage}\n                      onChange={handleInputChange}\n                  className=\"w-full appearance-none rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted pl-10 pr-10 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm cursor-pointer\"\n                  required\n                  disabled={submitting}\n                >\n                  <option value=\"en\">English</option>\n                  <option value=\"bn\">Bangla</option>\n                </select>\n                <span className=\"material-symbols-outlined absolute right-3 top-3.5 text-text-muted pointer-events-none\">expand_more</span>\n              </div>\n            </div>\n\n            {/* Description */}\n            <div className=\"flex flex-col gap-2\">\n              <label className=\"text-white text-sm font-semibold tracking-wide\">Synopsis</label>\n              <textarea \n                name=\"description\"\n                value={formData.description}\n                onChange={handleInputChange}\n                className=\"w-full min-h-[120px] rounded-lg bg-surface-dark border border-border-dark text-white mb-7 placeholder-text-muted px-4 py-2 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm resize-none leading-relaxed\" \n                placeholder=\"Write a brief description of the book...\"\n                disabled={submitting}\n              />\n            </div>\n          </div>\n\n          {/* Right Column: Image Upload */}\n          <div className=\"w-full lg:w-[400px] bg-[#22132b]/50 p-8 border-t lg:border-t-0 lg:border-l border-border-dark flex flex-col gap-6\">\n            <div className=\"flex flex-col gap-2\">\n              <h3 className=\"text-white font-semibold\">Cover Image</h3>\n              <p className=\"text-text-muted text-sm\">Upload a high-quality book cover to be displayed in the catalog.</p>\n            </div>\n\n            {/* Upload Box */}\n            <div className=\"flex-1 flex flex-col\">\n              <div \n                className={`group relative flex flex-1 flex-col items-center justify-center gap-4 rounded-xl border-2 border-dashed border-border-dark bg-surface-dark/50 hover:bg-surface-dark hover:border-primary transition-all cursor-pointer min-h-[300px] ${submitting ? 'opacity-50 cursor-not-allowed' : ''}`}\n                onDragOver={handleDragOver}\n                onDrop={handleDrop}\n                onClick={(e) => {\n                  if (!formData.coverImagePreview && !submitting && fileInputRef.current) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    fileInputRef.current.click();\n                  }\n                }}\n              >\n                {formData.coverImagePreview ? (\n                  <div className=\"relative w-full h-full flex items-center justify-center\">\n                    <img \n                      src={formData.coverImagePreview} \n                      alt=\"Cover preview\" \n                      className=\"max-w-full max-h-[300px] object-contain rounded-lg\"\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setFormData(prev => ({ ...prev, coverImage: null, coverImagePreview: null }));\n                        if (fileInputRef.current) fileInputRef.current.value = '';\n                      }}\n                      className=\"absolute top-2 right-2 p-2 bg-red-500/80 hover:bg-red-500 text-white rounded-full transition-colors\"\n                      disabled={submitting}\n                    >\n                      <span className=\"material-symbols-outlined text-[18px]\">close</span>\n                    </button>\n                  </div>\n                ) : (\n                  <>\n                    {/* Illustration/Icon */}\n                    <div className=\"relative flex items-center justify-center\">\n                      <div className=\"absolute inset-0 bg-primary/20 blur-xl rounded-full\"></div>\n                      <div className=\"relative h-16 w-16 rounded-full bg-surface-dark border border-border-dark flex items-center justify-center group-hover:scale-110 transition-transform duration-300 shadow-lg\">\n                        <span className=\"material-symbols-outlined text-primary text-3xl\">cloud_upload</span>\n                      </div>\n                    </div>\n                    <div className=\"text-center space-y-1 px-4\">\n                      <p className=\"text-white font-medium group-hover:text-primary transition-colors\">Click to upload or drag & drop</p>\n                      <p className=\"text-text-muted text-xs\">SVG, PNG, JPG or WEBP (MAX. 800x1200px)</p>\n                    </div>\n                  </>\n                )}\n              </div>\n              {/* Hidden Input - moved outside to prevent double trigger */}\n              <input \n                ref={fileInputRef}\n                className=\"hidden\" \n                type=\"file\"\n                accept=\"image/*\"\n                onChange={handleFileChange}\n                disabled={submitting}\n              />\n            </div>\n\n            {/* Preview / Hint Area */}\n            <div className=\"bg-surface-dark border border-border-dark rounded-lg p-4 flex items-start gap-3\">\n              <span className=\"material-symbols-outlined text-primary mt-0.5\">info</span>\n              <div className=\"text-xs text-text-muted leading-relaxed\">\n                Recommended aspect ratio is <span className=\"text-white font-medium\">1:1.5</span>. Images will be automatically resized to fit the catalog grid.\n              </div>\n            </div>\n          </div>\n        </form>\n\n        {/* Modal Footer */}\n        <div className=\"px-8 py-5 border-t border-border-dark bg-[#1c1022] flex flex-col-reverse sm:flex-row justify-end items-center gap-4\">\n          <button \n            type=\"button\"\n            onClick={handleClose}\n            disabled={submitting}\n            className=\"w-full sm:w-auto px-6 py-2.5 rounded-lg border border-border-dark text-white font-medium hover:bg-surface-dark hover:border-white/20 transition-all text-sm tracking-wide disabled:opacity-50\"\n          >\n            Cancel\n          </button>\n          <button \n            type=\"submit\"\n            onClick={handleSubmit}\n            disabled={submitting}\n            className=\"w-full sm:w-auto px-8 py-2.5 rounded-lg bg-primary text-white font-bold hover:bg-primary-hover shadow-[0_0_20px_rgba(170,31,239,0.3)] hover:shadow-[0_0_25px_rgba(170,31,239,0.5)] transition-all flex items-center justify-center gap-2 text-sm tracking-wide transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            <span className=\"material-symbols-outlined text-[18px]\">save</span>\n            {submitting ? 'Saving...' : 'Save Book'}\n          </button>\n        </div>\n      </div>\n\n      {/* Add Genre Modal */}\n      {showAddGenreModal && (\n        <div className=\"fixed inset-0 z-[60] flex items-center justify-center p-4\">\n          <div \n            className=\"absolute inset-0 bg-background-dark/90 backdrop-blur-sm\"\n            onClick={() => !addingGenre && setShowAddGenreModal(false)}\n          />\n          <div className=\"relative z-10 w-full max-w-md bg-[#1c1022] rounded-2xl shadow-2xl border border-white/10 overflow-hidden animate-fade-in-up\">\n            <div className=\"px-6 py-5 border-b border-border-dark bg-[#1c1022] flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-xl font-bold tracking-tight text-white\">Add New Genre</h2>\n                <p className=\"text-sm text-text-muted mt-1\">Create a new genre category for books.</p>\n              </div>\n              <button \n                onClick={() => !addingGenre && setShowAddGenreModal(false)}\n                disabled={addingGenre}\n                className=\"group p-2 rounded-full hover:bg-white/5 transition-colors disabled:opacity-50\"\n              >\n                <span className=\"material-symbols-outlined text-text-muted group-hover:text-white transition-colors\">close</span>\n              </button>\n            </div>\n            <div className=\"p-6 space-y-4\">\n              <div className=\"flex flex-col gap-2\">\n                <label className=\"text-white text-sm font-semibold tracking-wide\">Genre Name</label>\n                <input \n                  value={newGenreName}\n                  onChange={(e) => setNewGenreName(e.target.value)}\n                  className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                  placeholder=\"e.g. Science Fiction, Mystery, Biography\"\n                  type=\"text\"\n                  disabled={addingGenre}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' && !addingGenre && newGenreName.trim()) {\n                      e.preventDefault();\n                      handleAddGenre();\n                    }\n                  }}\n                />\n              </div>\n            </div>\n            <div className=\"px-6 py-5 border-t border-border-dark bg-[#1c1022] flex flex-col-reverse sm:flex-row justify-end items-center gap-4\">\n              <button \n                type=\"button\"\n                onClick={() => setShowAddGenreModal(false)}\n                disabled={addingGenre}\n                className=\"w-full sm:w-auto px-6 py-2.5 rounded-lg border border-border-dark text-white font-medium hover:bg-surface-dark hover:border-white/20 transition-all text-sm tracking-wide disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n              <button \n                type=\"button\"\n                onClick={handleAddGenre}\n                disabled={addingGenre || !newGenreName.trim()}\n                className=\"w-full sm:w-auto px-8 py-2.5 rounded-lg bg-primary text-white font-bold hover:bg-primary-hover shadow-[0_0_20px_rgba(170,31,239,0.3)] hover:shadow-[0_0_25px_rgba(170,31,239,0.5)] transition-all flex items-center justify-center gap-2 text-sm tracking-wide transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <span className=\"material-symbols-outlined text-[18px]\">add</span>\n                {addingGenre ? 'Adding...' : 'Add Genre'}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\AddNewMemberModal.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":261,"column":23,"nodeType":"JSXOpeningElement","endLine":261,"endColumn":118}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { showError, showSuccess, showLoading, close } from '@/lib/swal';\r\nimport { LOCATION_DATA } from '@/lib/locationData';\r\n\r\nexport default function AddNewMemberModal({ isOpen, onClose, onMemberAdded }) {\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    division: '',\r\n    city: '',\r\n    area: '',\r\n    landmark: '',\r\n    tier: 'premium',\r\n    password: 'Library123!',\r\n    profilePhoto: null,\r\n    profilePhotoPreview: null,\r\n  });\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n  const fileInputRef = useRef(null);\r\n\r\n  // Reset form when modal opens/closes\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      setFormData({\r\n        name: '',\r\n        email: '',\r\n        phone: '',\r\n        division: '',\r\n        city: '',\r\n        area: '',\r\n        landmark: '',\r\n        tier: 'premium',\r\n        password: 'Library123!',\r\n        profilePhoto: null,\r\n        profilePhotoPreview: null,\r\n      });\r\n      setShowPassword(false);\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = '';\r\n      }\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    \r\n    // Handle cascading dropdowns like register page\r\n    if (name === 'division') {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        division: value,\r\n        city: '', // Reset city when division changes\r\n        area: '', // Reset area when division changes\r\n      }));\r\n    } else if (name === 'city') {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        city: value,\r\n        area: '', // Reset area when city changes\r\n      }));\r\n    } else {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: value,\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Get available cities based on selected division\r\n  const getAvailableCities = () => {\r\n    if (!formData.division || !LOCATION_DATA[formData.division]) {\r\n      return [];\r\n    }\r\n    return Object.keys(LOCATION_DATA[formData.division]);\r\n  };\r\n\r\n  // Get available areas based on selected division and city\r\n  const getAvailableAreas = () => {\r\n    if (!formData.division || !formData.city || !LOCATION_DATA[formData.division]) {\r\n      return [];\r\n    }\r\n    return LOCATION_DATA[formData.division][formData.city] || [];\r\n  };\r\n\r\n  const handleFileChange = async (e) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      showError('Invalid file type', 'Please upload a valid image file (JPG, PNG, or WEBP)');\r\n      return;\r\n    }\r\n\r\n    // Validate file size (2MB max)\r\n    if (file.size > 2 * 1024 * 1024) {\r\n      showError('File too large', 'Image must be less than 2MB');\r\n      return;\r\n    }\r\n\r\n    // Create preview\r\n    const reader = new FileReader();\r\n    reader.onloadend = () => {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        profilePhoto: file,\r\n        profilePhotoPreview: reader.result,\r\n      }));\r\n    };\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  const uploadImage = async (file) => {\r\n    const formDataToUpload = new FormData();\r\n    formDataToUpload.append('image', file);\r\n\r\n    const response = await fetch('/api/upload', {\r\n      method: 'POST',\r\n      body: formDataToUpload,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      throw new Error(error.error || 'Failed to upload image');\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.url;\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    // Validation\r\n    if (!formData.name.trim()) {\r\n      showError('Validation Error', 'Full name is required');\r\n      return;\r\n    }\r\n\r\n    if (!formData.email.trim()) {\r\n      showError('Validation Error', 'Email address is required');\r\n      return;\r\n    }\r\n\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    if (!emailRegex.test(formData.email.trim())) {\r\n      showError('Validation Error', 'Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    const loadingSwal = showLoading('Creating member...', 'Please wait while we add the new member.');\r\n\r\n    try {\r\n      let profilePhotoUrl = null;\r\n      \r\n      // Upload image if one was selected\r\n      if (formData.profilePhoto) {\r\n        setUploading(true);\r\n        profilePhotoUrl = await uploadImage(formData.profilePhoto);\r\n        setUploading(false);\r\n      }\r\n\r\n      // Prepare address object (matching User model structure)\r\n      const address = {\r\n        division: formData.division || undefined,\r\n        city: formData.city || undefined,\r\n        area: formData.area || undefined,\r\n        landmark: formData.landmark || undefined,\r\n      };\r\n\r\n      const response = await fetch('/api/admin/members', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          name: formData.name.trim(),\r\n          email: formData.email.trim(),\r\n          phone: formData.phone.trim() || undefined,\r\n          profilePhoto: profilePhotoUrl,\r\n          address: address,\r\n          tier: formData.tier,\r\n        }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!response.ok) {\r\n        throw new Error(result.error || 'Failed to create member');\r\n      }\r\n\r\n      close();\r\n      showSuccess(\r\n        'Member Created!',\r\n        'The member has been successfully added to the library system.'\r\n      );\r\n\r\n      // Notify parent to refresh members list\r\n      if (onMemberAdded) {\r\n        onMemberAdded();\r\n      }\r\n      onClose();\r\n    } catch (error) {\r\n      close();\r\n      showError('Error', error.message || 'Failed to create member. Please try again.');\r\n    } finally {\r\n      setSubmitting(false);\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    if (submitting) return;\r\n    onClose();\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 lg:p-8\">\r\n      {/* Backdrop */}\r\n      <div \r\n        className=\"absolute inset-0 z-0 bg-background-dark/80 backdrop-blur-sm transition-opacity\"\r\n        onClick={handleClose}\r\n      />\r\n      \r\n      {/* Modal Container */}\r\n      <div className=\"relative z-10 w-full max-w-5xl rounded-2xl border border-border-dark shadow-2xl flex flex-col max-h-[90vh] overflow-hidden animate-fade-in-up\" style={{ background: 'rgba(43, 25, 52, 0.95)', backdropFilter: 'blur(12px)', WebkitBackdropFilter: 'blur(12px)' }}>\r\n        {/* Modal Header */}\r\n        <div className=\"flex items-center justify-between px-8 py-6 border-b border-border-dark bg-[#150c19]/50\">\r\n          <div className=\"flex flex-col gap-1\">\r\n            <h2 className=\"text-white text-2xl font-bold tracking-tight\">Add New Member</h2>\r\n            <p className=\"text-white/60 text-sm font-normal\">Create a new user profile for the Bookflix library system.</p>\r\n          </div>\r\n          <button \r\n            onClick={handleClose}\r\n            disabled={submitting}\r\n            className=\"text-white/40 hover:text-white transition-colors p-2 rounded-full hover:bg-white/5 disabled:opacity-50\"\r\n          >\r\n            <span className=\"material-symbols-outlined text-2xl\">close</span>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Modal Content (Scrollable) */}\r\n        <div className=\"flex-1 overflow-y-auto px-8 py-8 custom-scrollbar\">\r\n          <form className=\"grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12\" onSubmit={handleSubmit}>\r\n            {/* Left Column: Avatar & Basic Info */}\r\n            <div className=\"lg:col-span-4 flex flex-col gap-6\">\r\n              {/* Avatar Section */}\r\n              <div className=\"flex flex-col items-center gap-4 p-6 bg-[#150c19]/30 rounded-xl border border-border-dark/50\">\r\n                <div className=\"relative group cursor-pointer\" onClick={() => !submitting && fileInputRef.current?.click()}>\r\n                  <div className=\"w-32 h-32 rounded-full bg-[#150c19] border-4 border-border-dark flex items-center justify-center overflow-hidden relative\">\r\n                    {formData.profilePhotoPreview ? (\r\n                      <img src={formData.profilePhotoPreview} alt=\"Profile\" className=\"w-full h-full object-cover\" />\r\n                    ) : (\r\n                      <span className=\"material-symbols-outlined text-white/20 text-5xl group-hover:hidden\">person</span>\r\n                    )}\r\n                    {/* Overlay on Hover */}\r\n                    <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                      <span className=\"material-symbols-outlined text-white text-3xl\">upload</span>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"absolute bottom-1 right-1 bg-primary text-white rounded-full p-2 border-4 border-surface-dark flex items-center justify-center shadow-lg\">\r\n                    <span className=\"material-symbols-outlined text-sm font-bold\">add_a_photo</span>\r\n                  </div>\r\n                  <input \r\n                    ref={fileInputRef}\r\n                    type=\"file\"\r\n                    accept=\"image/jpeg,image/jpg,image/png,image/webp\"\r\n                    onChange={handleFileChange}\r\n                    className=\"hidden\"\r\n                    disabled={submitting}\r\n                  />\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <h3 className=\"text-white font-medium text-sm\">Profile Photo</h3>\r\n                  <p className=\"text-white/40 text-xs mt-1\">Accepts .jpg, .png, .webp up to 2MB</p>\r\n                </div>\r\n                <button \r\n                  type=\"button\"\r\n                  onClick={() => !submitting && fileInputRef.current?.click()}\r\n                  className=\"w-full py-2 px-4 rounded-lg border border-border-dark bg-transparent hover:bg-white/5 text-white text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                  disabled={submitting}\r\n                >\r\n                  <span className=\"material-symbols-outlined text-lg\">upload_file</span>\r\n                  Upload Photo\r\n                </button>\r\n              </div>\r\n\r\n              {/* Membership Tier Selector */}\r\n              <div className=\"flex flex-col gap-3\">\r\n                <label className=\"text-white/80 text-sm font-semibold uppercase tracking-wider\">Membership Tier</label>\r\n                <div className=\"grid grid-cols-1 gap-3\">\r\n                  {/* Standard Option */}\r\n                  <label className={`relative flex cursor-pointer rounded-xl border border-border-dark p-4 shadow-sm hover:border-primary/50 focus:outline-none transition-all ${formData.tier === 'standard' ? 'border-primary bg-primary/10' : ''}`}>\r\n                    <input \r\n                      className=\"peer sr-only\" \r\n                      name=\"tier\" \r\n                      type=\"radio\" \r\n                      value=\"standard\"\r\n                      checked={formData.tier === 'standard'}\r\n                      onChange={handleInputChange}\r\n                      disabled={submitting}\r\n                    />\r\n                    <span className=\"flex flex-1\">\r\n                      <span className=\"flex flex-col\">\r\n                        <span className=\"block text-sm font-medium text-white\">Standard</span>\r\n                        <span className=\"mt-1 flex items-center text-xs text-white/50\">Basic catalog access  2 books/mo</span>\r\n                      </span>\r\n                    </span>\r\n                    <span className={`material-symbols-outlined text-xl self-center ${formData.tier === 'standard' ? 'text-primary' : 'text-white/20'}`}>check_circle</span>\r\n                  </label>\r\n                  {/* Premium Option */}\r\n                  <label className={`relative flex cursor-pointer rounded-xl border border-border-dark p-4 shadow-sm hover:border-primary/50 focus:outline-none transition-all ${formData.tier === 'premium' ? 'border-primary bg-primary/10' : ''}`}>\r\n                    <input \r\n                      className=\"peer sr-only\" \r\n                      name=\"tier\" \r\n                      type=\"radio\" \r\n                      value=\"premium\"\r\n                      checked={formData.tier === 'premium'}\r\n                      onChange={handleInputChange}\r\n                      disabled={submitting}\r\n                    />\r\n                    <span className=\"flex flex-1\">\r\n                      <span className=\"flex flex-col\">\r\n                        <span className=\"block text-sm font-medium text-white\">Premium</span>\r\n                        <span className=\"mt-1 flex items-center text-xs text-white/50\">Full access  Offline mode  Unlimited</span>\r\n                      </span>\r\n                    </span>\r\n                    <span className={`material-symbols-outlined text-xl self-center ${formData.tier === 'premium' ? 'text-primary' : 'text-white/20'}`}>check_circle</span>\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Right Column: Form Inputs */}\r\n            <div className=\"lg:col-span-8 flex flex-col gap-8\">\r\n              {/* Personal Details Section */}\r\n              <div className=\"space-y-4\">\r\n                <h3 className=\"text-white text-lg font-semibold flex items-center gap-2 border-b border-border-dark pb-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">person</span>\r\n                  Personal Details\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Full Name</span>\r\n                    <input \r\n                      name=\"name\"\r\n                      value={formData.name}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\" \r\n                      placeholder=\"e.g. Jane Doe\" \r\n                      type=\"text\"\r\n                      required\r\n                      disabled={submitting}\r\n                    />\r\n                  </label>\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Phone Number</span>\r\n                    <input \r\n                      name=\"phone\"\r\n                      value={formData.phone}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\" \r\n                      placeholder=\"e.g. +1 (555) 000-0000\" \r\n                      type=\"tel\"\r\n                      disabled={submitting}\r\n                    />\r\n                  </label>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Division</span>\r\n                    <div className=\"relative\">\r\n                      <select \r\n                        name=\"division\"\r\n                        value={formData.division}\r\n                        onChange={handleInputChange}\r\n                        className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none cursor-pointer\"\r\n                        disabled={submitting}\r\n                      >\r\n                        <option value=\"\" className=\"bg-[#150c19]\">Select Division</option>\r\n                        {Object.keys(LOCATION_DATA).map((division) => (\r\n                          <option key={division} value={division} className=\"bg-[#150c19]\">\r\n                            {division}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                      <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-white/50 pointer-events-none\">expand_more</span>\r\n                    </div>\r\n                  </label>\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">City</span>\r\n                    <div className=\"relative\">\r\n                      <select \r\n                        name=\"city\"\r\n                        value={formData.city}\r\n                        onChange={handleInputChange}\r\n                        className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        disabled={submitting || !formData.division}\r\n                      >\r\n                        <option value=\"\" className=\"bg-[#150c19]\">Select City</option>\r\n                        {getAvailableCities().map((city) => (\r\n                          <option key={city} value={city} className=\"bg-[#150c19]\">\r\n                            {city}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                      <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-white/50 pointer-events-none\">expand_more</span>\r\n                    </div>\r\n                  </label>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Area (Thana)</span>\r\n                    <div className=\"relative\">\r\n                      <select \r\n                        name=\"area\"\r\n                        value={formData.area}\r\n                        onChange={handleInputChange}\r\n                        className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        disabled={submitting || !formData.city}\r\n                      >\r\n                        <option value=\"\" className=\"bg-[#150c19]\">Select Area</option>\r\n                        {getAvailableAreas().map((area) => (\r\n                          <option key={area} value={area} className=\"bg-[#150c19]\">\r\n                            {area}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                      <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-white/50 pointer-events-none\">expand_more</span>\r\n                    </div>\r\n                  </label>\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Landmark</span>\r\n                    <input \r\n                      name=\"landmark\"\r\n                      value={formData.landmark}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\" \r\n                      placeholder=\"e.g. Near Public Library\" \r\n                      type=\"text\"\r\n                      disabled={submitting}\r\n                    />\r\n                  </label>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Account Details Section */}\r\n              <div className=\"space-y-4\">\r\n                <h3 className=\"text-white text-lg font-semibold flex items-center gap-2 border-b border-border-dark pb-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">lock</span>\r\n                  Account Credentials\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Email Address</span>\r\n                    <input \r\n                      name=\"email\"\r\n                      value={formData.email}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\" \r\n                      placeholder=\"name@example.com\" \r\n                      type=\"email\"\r\n                      required\r\n                      disabled={submitting}\r\n                    />\r\n                  </label>\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Temporary Password</span>\r\n                    <div className=\"relative\">\r\n                      <input \r\n                        name=\"password\"\r\n                        value={formData.password}\r\n                        onChange={handleInputChange}\r\n                        className=\"w-full bg-surface-darker border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all pr-10\" \r\n                        placeholder=\"\" \r\n                        type={showPassword ? 'text' : 'password'}\r\n                        disabled={submitting}\r\n                      />\r\n                      <button \r\n                        type=\"button\"\r\n                        onClick={() => setShowPassword(!showPassword)}\r\n                        className=\"absolute right-3 top-1/2 -translate-y-1/2 text-white/40 hover:text-white transition-colors\"\r\n                        disabled={submitting}\r\n                      >\r\n                        <span className=\"material-symbols-outlined text-xl\">\r\n                          {showPassword ? 'visibility_off' : 'visibility'}\r\n                        </span>\r\n                      </button>\r\n                    </div>\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        {/* Modal Footer (Action Bar) */}\r\n        <div className=\"flex items-center justify-end gap-3 px-8 py-5 border-t border-border-dark bg-[#150c19]/80 backdrop-blur-md\">\r\n          <button \r\n            type=\"button\"\r\n            onClick={handleClose}\r\n            disabled={submitting}\r\n            className=\"px-6 py-2.5 rounded-lg text-white/70 hover:text-white hover:bg-white/5 transition-all text-sm font-medium disabled:opacity-50\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button \r\n            type=\"submit\"\r\n            onClick={handleSubmit}\r\n            disabled={submitting || uploading}\r\n            className=\"px-6 py-2.5 rounded-lg bg-primary hover:bg-[#8a19c2] text-white shadow-[0_0_15px_rgba(170,31,239,0.3)] hover:shadow-[0_0_20px_rgba(170,31,239,0.5)] transition-all text-sm font-bold flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            <span className=\"material-symbols-outlined text-lg\">save</span>\r\n            {submitting ? 'Saving...' : 'Save Member'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\AddStaffModal.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":288,"column":21,"nodeType":"JSXOpeningElement","endLine":292,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef } from 'react';\r\nimport { showError, showSuccess, showLoading, close } from '@/lib/swal';\r\n\r\nexport default function AddStaffModal({ isOpen, onClose, onStaffAdded }) {\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    role: '',\r\n    password: '',\r\n    profilePhoto: null,\r\n    profilePhotoPreview: null,\r\n  });\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n  const fileInputRef = useRef(null);\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value,\r\n    }));\r\n  };\r\n\r\n  const handleFileChange = async (e) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      showError('Invalid file type', 'Please upload a valid image file (JPG, PNG, or WEBP)');\r\n      return;\r\n    }\r\n\r\n    // Validate file size (2MB max)\r\n    if (file.size > 2 * 1024 * 1024) {\r\n      showError('File too large', 'Image must be less than 2MB');\r\n      return;\r\n    }\r\n\r\n    // Create preview\r\n    const reader = new FileReader();\r\n    reader.onloadend = () => {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        profilePhoto: file,\r\n        profilePhotoPreview: reader.result,\r\n      }));\r\n    };\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  const uploadImage = async (file) => {\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    const response = await fetch('/api/upload', {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      throw new Error(error.error || 'Failed to upload image');\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.url;\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    // Validation\r\n    if (!formData.name.trim()) {\r\n      showError('Validation Error', 'Full name is required');\r\n      return;\r\n    }\r\n\r\n    if (!formData.email.trim()) {\r\n      showError('Validation Error', 'Email address is required');\r\n      return;\r\n    }\r\n\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    if (!emailRegex.test(formData.email.trim())) {\r\n      showError('Validation Error', 'Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    if (!formData.role) {\r\n      showError('Validation Error', 'Please select a role');\r\n      return;\r\n    }\r\n\r\n    if (!formData.password || formData.password.length < 6) {\r\n      showError('Validation Error', 'Password must be at least 6 characters');\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    const loadingSwal = showLoading('Creating staff member...', 'Please wait while we add the new staff member.');\r\n\r\n    try {\r\n      let profilePhotoUrl = null;\r\n      \r\n      // Upload image if one was selected\r\n      if (formData.profilePhoto) {\r\n        setUploading(true);\r\n        profilePhotoUrl = await uploadImage(formData.profilePhoto);\r\n        setUploading(false);\r\n      }\r\n\r\n      const response = await fetch('/api/admin/staff', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          name: formData.name.trim(),\r\n          email: formData.email.trim(),\r\n          phone: formData.phone.trim() || undefined,\r\n          role: formData.role,\r\n          password: formData.password,\r\n          profilePhoto: profilePhotoUrl,\r\n        }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!response.ok) {\r\n        throw new Error(result.error || 'Failed to create staff member');\r\n      }\r\n\r\n      close();\r\n      showSuccess(\r\n        'Staff Member Created!',\r\n        `The staff member has been successfully added. Temporary password: ${result.tempPassword || formData.password}`\r\n      );\r\n\r\n      // Reset form\r\n      setFormData({\r\n        name: '',\r\n        email: '',\r\n        phone: '',\r\n        role: '',\r\n        password: '',\r\n        profilePhoto: null,\r\n        profilePhotoPreview: null,\r\n      });\r\n      setShowPassword(false);\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = '';\r\n      }\r\n\r\n      // Notify parent to refresh staff list\r\n      if (onStaffAdded) {\r\n        onStaffAdded();\r\n      }\r\n      onClose();\r\n    } catch (error) {\r\n      close();\r\n      showError('Error', error.message || 'Failed to create staff member. Please try again.');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    if (submitting) return;\r\n      setFormData({\r\n        name: '',\r\n        email: '',\r\n        phone: '',\r\n        role: '',\r\n        password: '',\r\n        profilePhoto: null,\r\n        profilePhotoPreview: null,\r\n      });\r\n      setShowPassword(false);\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = '';\r\n      }\r\n      onClose();\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6\">\r\n      {/* Backdrop */}\r\n      <div \r\n        className=\"absolute inset-0 bg-[#0f0913]/80 backdrop-blur-sm z-40 transition-opacity\"\r\n        onClick={handleClose}\r\n      />\r\n      \r\n      {/* Modal Container */}\r\n      <div className=\"relative z-50 w-full max-w-2xl bg-background-dark border border-white/10 rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden transform transition-all animate-fade-in-up box-border ring-1 ring-white/10\">\r\n        {/* Modal Header */}\r\n        <div className=\"flex items-start justify-between p-6 md:px-8 pt-8 pb-4 bg-background-dark\">\r\n          <div className=\"flex flex-col gap-2\">\r\n            <h2 className=\"text-white text-[28px] font-bold leading-tight tracking-tight\">Add New Staff</h2>\r\n            <p className=\"text-text-muted text-sm font-normal\">Grant access permissions to a new team member.</p>\r\n          </div>\r\n          <button \r\n            aria-label=\"Close modal\"\r\n            onClick={handleClose}\r\n            disabled={submitting}\r\n            className=\"group text-text-muted hover:text-white transition-colors p-1.5 rounded-lg hover:bg-surface-dark disabled:opacity-50\"\r\n          >\r\n            <span className=\"material-symbols-outlined text-[24px]\">close</span>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Modal Body / Form */}\r\n        <div className=\"flex-1 overflow-y-auto p-6 md:px-8 py-2 custom-scrollbar\">\r\n          <form className=\"flex flex-col gap-6\" onSubmit={handleSubmit}>\r\n            {/* Full Name */}\r\n            <div className=\"flex flex-col gap-2\">\r\n              <label className=\"text-white text-sm font-medium leading-normal ml-1\">Full Name</label>\r\n              <div className=\"relative group\">\r\n                <input \r\n                  name=\"name\"\r\n                  value={formData.name}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full h-14 rounded-lg bg-surface-dark border border-white/5 text-white placeholder-text-muted/60 px-[15px] text-base font-normal leading-normal focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200\" \r\n                  placeholder=\"Enter full name\" \r\n                  type=\"text\"\r\n                  required\r\n                  disabled={submitting}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Email & Phone Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n              <div className=\"flex flex-col gap-2\">\r\n                <label className=\"text-white text-sm font-medium leading-normal ml-1\">Email Address</label>\r\n                <div className=\"relative group\">\r\n                  <input \r\n                    name=\"email\"\r\n                    value={formData.email}\r\n                    onChange={handleInputChange}\r\n                    className=\"w-full h-14 rounded-lg bg-surface-dark border border-white/5 text-white placeholder-text-muted/60 px-[15px] pr-12 text-base font-normal leading-normal focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200\" \r\n                    placeholder=\"colleague@bookflix.com\" \r\n                    type=\"email\"\r\n                    required\r\n                    disabled={submitting}\r\n                  />\r\n                  <div className=\"absolute right-4 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none group-focus-within:text-primary transition-colors\">\r\n                    <span className=\"material-symbols-outlined text-[20px]\">mail</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex flex-col gap-2\">\r\n                <label className=\"text-white text-sm font-medium leading-normal ml-1\">Phone Number</label>\r\n                <div className=\"relative group\">\r\n                  <input \r\n                    name=\"phone\"\r\n                    value={formData.phone}\r\n                    onChange={handleInputChange}\r\n                    className=\"w-full h-14 rounded-lg bg-surface-dark border border-white/5 text-white placeholder-text-muted/60 px-[15px] pr-12 text-base font-normal leading-normal focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200\" \r\n                    placeholder=\"+1 (555) 000-0000\" \r\n                    type=\"tel\"\r\n                    disabled={submitting}\r\n                  />\r\n                  <div className=\"absolute right-4 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none group-focus-within:text-primary transition-colors\">\r\n                    <span className=\"material-symbols-outlined text-[20px]\">call</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Profile Photo */}\r\n            <div className=\"flex flex-col gap-2\">\r\n              <label className=\"text-white text-sm font-medium leading-normal ml-1\">Profile Photo</label>\r\n              <div className=\"relative\">\r\n                <div \r\n                  className=\"w-full h-32 rounded-lg bg-surface-dark border border-white/5 flex items-center justify-center cursor-pointer hover:border-primary transition-colors overflow-hidden\"\r\n                  onClick={() => !submitting && fileInputRef.current?.click()}\r\n                >\r\n                  {formData.profilePhotoPreview ? (\r\n                    <img \r\n                      src={formData.profilePhotoPreview} \r\n                      alt=\"Profile preview\" \r\n                      className=\"w-full h-full object-cover\"\r\n                    />\r\n                  ) : (\r\n                    <div className=\"flex flex-col items-center gap-2 text-text-muted\">\r\n                      <span className=\"material-symbols-outlined text-4xl\">add_photo_alternate</span>\r\n                      <span className=\"text-sm\">Click to upload photo</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <input \r\n                  ref={fileInputRef}\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={handleFileChange}\r\n                  className=\"hidden\"\r\n                  disabled={submitting}\r\n                />\r\n                {formData.profilePhotoPreview && (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      setFormData(prev => ({ ...prev, profilePhoto: null, profilePhotoPreview: null }));\r\n                      if (fileInputRef.current) fileInputRef.current.value = '';\r\n                    }}\r\n                    className=\"absolute top-2 right-2 p-2 bg-red-500/80 hover:bg-red-500 text-white rounded-full transition-colors\"\r\n                    disabled={submitting}\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-[18px]\">close</span>\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Role & Password Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n              {/* Role Select */}\r\n              <div className=\"flex flex-col gap-2\">\r\n                <label className=\"text-white text-sm font-medium leading-normal ml-1\">Assign Role</label>\r\n                <div className=\"relative group\">\r\n                  <select \r\n                    name=\"role\"\r\n                    value={formData.role}\r\n                    onChange={handleInputChange}\r\n                    className=\"w-full h-14 rounded-lg bg-surface-dark border border-white/5 text-white px-[15px] pr-12 text-base font-normal leading-normal focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200 cursor-pointer appearance-none\"\r\n                    required\r\n                    disabled={submitting}\r\n                  >\r\n                    <option disabled value=\"\">Select a role</option>\r\n                    <option value=\"librarian\">Librarian</option>\r\n                    <option value=\"admin\">Administrator</option>\r\n                  </select>\r\n                  <div className=\"absolute right-4 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none group-focus-within:text-primary transition-colors\">\r\n                    <span className=\"material-symbols-outlined text-[24px]\">expand_more</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              {/* Password Input */}\r\n              <div className=\"flex flex-col gap-2\">\r\n                <label className=\"text-white text-sm font-medium leading-normal ml-1\">Temporary Password</label>\r\n                <div className=\"relative group\">\r\n                  <input \r\n                    name=\"password\"\r\n                    value={formData.password}\r\n                    onChange={handleInputChange}\r\n                    className=\"w-full h-14 rounded-lg bg-surface-dark border border-white/5 text-white placeholder-text-muted/60 px-[15px] pr-12 text-base font-normal leading-normal focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200\" \r\n                    placeholder=\"Create a password\" \r\n                    type={showPassword ? 'text' : 'password'}\r\n                    required\r\n                    disabled={submitting}\r\n                  />\r\n                  <button \r\n                    type=\"button\"\r\n                    onClick={() => setShowPassword(!showPassword)}\r\n                    className=\"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-text-muted hover:text-white hover:bg-[#3d254a] rounded-md transition-colors\"\r\n                    disabled={submitting}\r\n                  >\r\n                    <span className=\"material-symbols-outlined text-[20px] block\">\r\n                      {showPassword ? 'visibility_off' : 'visibility'}\r\n                    </span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        {/* Modal Footer */}\r\n        <div className=\"p-6 md:px-8 bg-background-dark border-t border-border-dark flex flex-col-reverse md:flex-row justify-end gap-3 mt-2\">\r\n          <button \r\n            type=\"button\"\r\n            onClick={handleClose}\r\n            disabled={submitting}\r\n            className=\"h-11 px-6 rounded-lg text-sm font-medium text-text-muted hover:text-white hover:bg-surface-dark transition-all duration-200 disabled:opacity-50\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button \r\n            type=\"submit\"\r\n            onClick={handleSubmit}\r\n            disabled={submitting}\r\n            className=\"h-11 px-6 rounded-lg text-sm font-semibold text-white bg-primary hover:bg-[#901bc9] active:scale-[0.98] transition-all duration-200 shadow-glow hover:shadow-glow-active flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            <span className=\"material-symbols-outlined text-[18px]\">check_circle</span>\r\n            {submitting ? 'Creating...' : 'Save Staff Member'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\AdminHeader.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\AdminSidebar.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":73,"column":15,"nodeType":"JSXOpeningElement","endLine":81,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from 'next/link';\nimport { usePathname } from 'next/navigation';\nimport { useAuth } from '@/contexts/AuthContext';\n\nexport default function AdminSidebar() {\n  const pathname = usePathname();\n  const { userData } = useAuth();\n\n  const isActive = (path) => {\n    return pathname === path || pathname?.startsWith(path + '/');\n  };\n\n  const navItems = [\n    { href: '/admin/overview', label: 'Overview', icon: 'dashboard' },\n    { href: '/admin/members', label: 'Member Management', icon: 'group' },\n    { href: '/admin/books', label: 'Books Management', icon: 'library_books' },\n    { href: '/admin/staff', label: 'Staff Management', icon: 'badge' },\n    { href: '/admin/finance', label: 'Finances', icon: 'payments' },\n    { href: '/admin/config', label: 'System Configuration', icon: 'settings' },\n  ];\n\n  return (\n    <aside className=\"w-72 h-full hidden lg:flex flex-col border-r border-white/5 bg-[#1a1021] shrink-0 transition-all duration-300 relative z-20\">\n      <div className=\"p-6 flex items-center gap-3\">\n        <div className=\"relative group\">\n          <div className=\"absolute inset-0 bg-primary blur opacity-40 group-hover:opacity-60 transition-opacity duration-500 rounded-lg\"></div>\n          <div className=\"relative bg-gradient-to-br from-primary to-purple-800 size-10 rounded-lg flex items-center justify-center shadow-xl shadow-primary/20 border border-white/10\">\n            <span className=\"material-symbols-outlined text-white\">auto_stories</span>\n          </div>\n        </div>\n        <div className=\"flex flex-col\">\n          <h1 className=\"text-white text-lg font-bold tracking-tight\">Bookflix</h1>\n          <p className=\"text-white/40 text-xs font-medium uppercase tracking-wider\">Admin Console</p>\n        </div>\n      </div>\n      <nav className=\"flex-1 px-4 py-2 flex flex-col gap-1 overflow-y-auto\">\n        <div className=\"px-4 py-2\">\n          <p className=\"text-[10px] font-bold text-white/30 uppercase tracking-widest\">Main Menu</p>\n        </div>\n        <Link\n          href=\"/\"\n          className=\"flex items-center gap-3 px-4 py-3 rounded-xl transition-all group text-white/60 hover:bg-white/5 hover:text-white\"\n        >\n          <span className=\"material-symbols-outlined text-[20px] group-hover:scale-110 transition-transform\">home</span>\n          <span className=\"text-sm font-medium\">Home</span>\n        </Link>\n        {navItems.map((item) => {\n          const active = isActive(item.href);\n          return (\n            <Link\n              key={item.href}\n              href={item.href}\n              className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all group ${\n                active\n                  ? 'bg-primary/10 text-primary border border-primary/10'\n                  : 'text-white/60 hover:bg-white/5 hover:text-white'\n              }`}\n            >\n              <span className={`material-symbols-outlined text-[20px] ${active ? 'fill' : ''} ${!active ? 'group-hover:scale-110 transition-transform' : ''}`}>\n                {item.icon}\n              </span>\n              <span className={`text-sm ${active ? 'font-semibold' : 'font-medium'}`}>{item.label}</span>\n            </Link>\n          );\n        })}\n      </nav>\n      <div className=\"p-4 border-t border-white/5\">\n        <div className=\"flex items-center gap-3 p-3 rounded-xl bg-[#2a1d33] border border-white/5 hover:border-white/10 hover:bg-white/10 cursor-pointer transition-all\">\n          <div className=\"size-9 rounded-full border border-white/10 ring-2 ring-transparent group-hover:ring-primary/50 transition-all overflow-hidden bg-[#3c2348] flex items-center justify-center\">\n            {userData?.profilePhoto ? (\n              <img\n                src={`/api/image-proxy?url=${encodeURIComponent(userData.profilePhoto)}`}\n                alt={userData?.name || 'Admin'}\n                className=\"w-full h-full rounded-full object-cover\"\n                onError={(e) => {\n                  e.target.style.display = 'none';\n                  e.target.nextElementSibling.style.display = 'flex';\n                }}\n              />\n            ) : null}\n            <div \n              className={`w-full h-full flex items-center justify-center text-white text-sm font-bold ${userData?.profilePhoto ? 'hidden' : ''}`}\n            >\n              {userData?.name?.charAt(0)?.toUpperCase() || 'A'}\n            </div>\n          </div>\n          <div className=\"flex flex-col overflow-hidden\">\n            <p className=\"text-sm font-semibold text-white truncate\">{userData?.name || 'Admin'}</p>\n            <p className=\"text-[11px] text-white/40 truncate\">System Administrator</p>\n          </div>\n          <span className=\"material-symbols-outlined text-white/30 ml-auto text-sm\">expand_more</span>\n        </div>\n      </div>\n    </aside>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\BookStatusInfo.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":15,"column":17,"nodeType":"JSXOpeningElement","endLine":23,"endColumn":19},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":59,"column":15,"nodeType":"JSXOpeningElement","endLine":67,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nexport default function BookStatusInfo({ currentBorrower, currentReserver, isPremium }) {\n  if (!currentBorrower && !currentReserver) {\n    return null;\n  }\n\n  return (\n    <div className=\"bg-surface-dark/40 border border-surface-border rounded-xl p-4 mb-6 backdrop-blur-sm\">\n      {currentBorrower && (\n        <div className=\"flex items-center gap-3 mb-3 pb-3 border-b border-surface-border/50\">\n          <div className=\"flex items-center gap-3 flex-1\">\n            <div className=\"relative size-12 rounded-full overflow-hidden bg-surface-dark border border-surface-border flex-shrink-0\">\n              {currentBorrower.member.profilePhoto ? (\n                <img\n                  src={currentBorrower.member.profilePhoto}\n                  alt={currentBorrower.member.name}\n                  className=\"w-full h-full object-cover\"\n                  onError={(e) => {\n                    e.target.style.display = 'none';\n                    e.target.nextElementSibling.style.display = 'flex';\n                  }}\n                />\n              ) : null}\n              <div \n                className={`w-full h-full flex items-center justify-center text-white text-lg font-bold bg-primary/20 ${currentBorrower.member.profilePhoto ? 'hidden' : ''}`}\n              >\n                {currentBorrower.member.name?.charAt(0)?.toUpperCase() || 'U'}\n              </div>\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-xs font-semibold uppercase text-text-secondary tracking-wider mb-1\">\n                Currently Borrowed By\n              </p>\n              <p className=\"text-white font-medium truncate\">{currentBorrower.member.name}</p>\n              <div className=\"flex items-center gap-2 mt-1\">\n                {currentBorrower.daysOverdue > 0 ? (\n                  <span className=\"text-xs text-alert-red font-bold\">\n                    {currentBorrower.daysOverdue} day{currentBorrower.daysOverdue !== 1 ? 's' : ''} overdue\n                  </span>\n                ) : (\n                  <span className=\"text-xs text-emerald-400\">\n                    Due in {currentBorrower.daysRemaining} day{currentBorrower.daysRemaining !== 1 ? 's' : ''}\n                  </span>\n                )}\n                <span className=\"text-text-secondary text-xs\">\n                  ({new Date(currentBorrower.dueDate).toLocaleDateString()})\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {currentReserver && isPremium && (\n        <div className=\"flex items-center gap-3\">\n          <div className=\"relative size-12 rounded-full overflow-hidden bg-surface-dark border border-surface-border flex-shrink-0\">\n            {currentReserver.member.profilePhoto ? (\n              <img\n                src={currentReserver.member.profilePhoto}\n                alt={currentReserver.member.name}\n                className=\"w-full h-full object-cover\"\n                onError={(e) => {\n                  e.target.style.display = 'none';\n                  e.target.nextElementSibling.style.display = 'flex';\n                }}\n              />\n            ) : null}\n            <div \n              className={`w-full h-full flex items-center justify-center text-white text-lg font-bold bg-amber-500/20 ${currentReserver.member.profilePhoto ? 'hidden' : ''}`}\n            >\n              {currentReserver.member.name?.charAt(0)?.toUpperCase() || 'U'}\n            </div>\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-xs font-semibold uppercase text-text-secondary tracking-wider mb-1\">\n              Reserved By\n            </p>\n            <p className=\"text-white font-medium truncate\">{currentReserver.member.name}</p>\n            <p className=\"text-xs text-text-secondary mt-1\">\n              Reserved on {new Date(currentReserver.reservedDate).toLocaleDateString()}\n            </p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\CategoriesGrid.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\EditBookModal.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchBookData'. Either include it or remove the dependency array.","line":30,"column":6,"nodeType":"ArrayExpression","endLine":30,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, bookId, fetchBookData]","fix":{"range":[810,826],"text":"[isOpen, bookId, fetchBookData]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":497,"column":23,"nodeType":"JSXOpeningElement","endLine":501,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useRef } from 'react';\nimport { showError, showSuccess, showLoading, close } from '@/lib/swal';\n\nexport default function EditBookModal({ isOpen, onClose, onBookUpdated, bookId }) {\n  const [formData, setFormData] = useState({\n    title: '',\n    author: '',\n    isbn: '',\n    publishedYear: '',\n    genre: '',\n    shelfLocation: '',\n    description: '',\n    coverImage: null,\n    coverImagePreview: null,\n    existingCoverImage: null,\n    bookLanguage: 'en',\n  });\n  const [categories, setCategories] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const fileInputRef = useRef(null);\n\n  useEffect(() => {\n    if (isOpen && bookId) {\n      fetchCategories();\n      fetchBookData();\n    }\n  }, [isOpen, bookId]);\n\n\n  const fetchCategories = async () => {\n    try {\n      const response = await fetch('/api/categories?isActive=true');\n      if (response.ok) {\n        const data = await response.json();\n        setCategories(data);\n      }\n    } catch (error) {\n      console.error('Error fetching categories:', error);\n    }\n  };\n\n  const fetchBookData = async () => {\n    if (!bookId) return;\n    \n    setLoading(true);\n    try {\n      const response = await fetch(`/api/books/${bookId}`);\n      if (response.ok) {\n        const book = await response.json();\n        \n        // Extract year from publishedDate if available\n        let publishedYear = '';\n        if (book.publishedDate) {\n          const date = new Date(book.publishedDate);\n          publishedYear = date.getFullYear().toString();\n        }\n\n        // Ensure bookLanguage is properly set - handle both 'language' and 'bookLanguage' field names\n        // Check both field names to handle database inconsistencies\n        const languageValue = book.bookLanguage || book.language;\n        \n        let bookLanguage = 'en'; // default\n        if (languageValue === 'bn' || languageValue === 'en') {\n          bookLanguage = languageValue;\n        } else if (languageValue) {\n          // If there's a value but it's not 'en' or 'bn', normalize it\n          const normalized = String(languageValue).trim().toLowerCase();\n          if (normalized === 'bangla' || normalized === 'bn') {\n            bookLanguage = 'bn';\n          } else {\n            bookLanguage = 'en';\n          }\n        }\n\n        // Get shelf location - the API returns shelfLocation explicitly\n        // Handle both empty string and undefined/null cases\n        const shelfLocation = book.shelfLocation !== undefined && book.shelfLocation !== null \n          ? String(book.shelfLocation).trim() \n          : (book.location ? String(book.location).trim() : '');\n\n        setFormData({\n          title: book.title || '',\n          author: book.author || '',\n          isbn: book.isbn || '',\n          publishedYear: publishedYear,\n          genre: book.category?._id || book.category || '',\n          shelfLocation: shelfLocation,\n          description: book.description || '',\n          coverImage: null,\n          coverImagePreview: book.coverImage || null,\n          existingCoverImage: book.coverImage || null,\n          bookLanguage: bookLanguage,\n        });\n      } else {\n        const error = await response.json();\n        showError('Error', error.error || 'Failed to load book data');\n        onClose();\n      }\n    } catch (error) {\n      console.error('Error fetching book:', error);\n      showError('Error', 'Failed to load book data. Please try again.');\n      onClose();\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleInputChange = (e) => {\n    const { name, value } = e.target;\n    \n    setFormData(prev => {\n      const updated = {\n        ...prev,\n        [name]: value,\n      };\n      // Ensure bookLanguage is always set to a valid value\n      if (name === 'bookLanguage' && value !== 'en' && value !== 'bn') {\n        updated.bookLanguage = 'en';\n      }\n      return updated;\n    });\n  };\n\n  const handleFileChange = async (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/svg+xml'];\n    if (!allowedTypes.includes(file.type)) {\n      showError('Invalid file type', 'Please upload a valid image file (JPG, PNG, WEBP, or SVG)');\n      return;\n    }\n\n    // Validate file size (5MB max)\n    if (file.size > 5 * 1024 * 1024) {\n      showError('File too large', 'Image must be less than 5MB');\n      return;\n    }\n\n    // Create preview\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setFormData(prev => ({\n        ...prev,\n        coverImage: file,\n        coverImagePreview: reader.result,\n      }));\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      const fakeEvent = { target: { files: [file] } };\n      handleFileChange(fakeEvent);\n    }\n  };\n\n  const uploadImage = async (file) => {\n    const formData = new FormData();\n    formData.append('image', file);\n\n    const response = await fetch('/api/upload', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.error || 'Failed to upload image');\n    }\n\n    const data = await response.json();\n    return data.url;\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    // Validation\n    if (!formData.title.trim()) {\n      showError('Validation Error', 'Book title is required');\n      return;\n    }\n    if (!formData.author.trim()) {\n      showError('Validation Error', 'Author is required');\n      return;\n    }\n    if (!formData.genre) {\n      showError('Validation Error', 'Please select a genre');\n      return;\n    }\n\n    setSubmitting(true);\n    const loadingSwal = showLoading('Updating book...', 'Please wait while we update the book details.');\n\n    try {\n      let coverImageUrl = formData.existingCoverImage;\n\n      // Upload new image if one was selected\n      if (formData.coverImage) {\n        coverImageUrl = await uploadImage(formData.coverImage);\n      }\n\n      // Prepare book data\n      // Ensure bookLanguage is always included and valid ('en' or 'bn')\n      // Explicitly convert to string and validate\n      let bookLanguage = String(formData.bookLanguage || 'en').trim();\n      if (bookLanguage !== 'bn' && bookLanguage !== 'en') {\n        bookLanguage = 'en';\n      }\n      \n      const bookData = {\n        title: formData.title.trim(),\n        author: formData.author.trim(),\n        category: formData.genre,\n        coverImage: coverImageUrl,\n        description: formData.description.trim() || undefined,\n        isbn: formData.isbn.trim() || undefined,\n        publishedDate: formData.publishedYear ? `${formData.publishedYear}-01-01` : undefined,\n        bookLanguage: bookLanguage, // Always include, always valid\n        shelfLocation: formData.shelfLocation ? formData.shelfLocation.trim() : '', // Always include shelf location (even if empty)\n      };\n      \n      console.log('Sending bookData with shelfLocation:', bookData.shelfLocation);\n\n\n      // Update book\n      const response = await fetch(`/api/books/${bookId}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(bookData),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || 'Failed to update book');\n      }\n\n      close();\n      showSuccess('Book Updated!', 'The book has been successfully updated.');\n      \n      // Notify parent to refresh book list\n      if (onBookUpdated) {\n        onBookUpdated();\n      }\n      onClose();\n    } catch (error) {\n      close();\n      showError('Error', error.message || 'Failed to update book. Please try again.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (submitting || loading) return;\n    setFormData({\n      title: '',\n      author: '',\n      isbn: '',\n      publishedYear: '',\n      genre: '',\n      shelfLocation: '',\n      description: '',\n      coverImage: null,\n      coverImagePreview: null,\n      existingCoverImage: null,\n      bookLanguage: 'en',\n    });\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n    onClose();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-background-dark/80 backdrop-blur-sm\"\n        onClick={handleClose}\n      />\n      \n      {/* Modal Card */}\n      <div className=\"relative z-10 flex flex-col w-full max-w-6xl max-h-[90vh] bg-[#1c1022] rounded-2xl shadow-2xl border border-white/10 overflow-hidden animate-fade-in-up\">\n        {/* Modal Header */}\n        <div className=\"flex items-center justify-between px-8 py-5 border-b border-border-dark bg-[#1c1022]\">\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight text-white\">Edit Book</h1>\n            <p className=\"text-sm text-text-muted mt-1\">Update the book details below.</p>\n          </div>\n          <button \n            onClick={handleClose}\n            disabled={submitting || loading}\n            className=\"group p-2 rounded-full hover:bg-white/5 transition-colors disabled:opacity-50\"\n          >\n            <span className=\"material-symbols-outlined text-text-muted group-hover:text-white transition-colors\">close</span>\n          </button>\n        </div>\n\n        {/* Modal Body (Scrollable) */}\n        {loading ? (\n          <div className=\"flex items-center justify-center p-12\">\n            <div className=\"text-center\">\n              <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4\"></div>\n              <p className=\"text-text-secondary\">Loading book data...</p>\n            </div>\n          </div>\n        ) : (\n          <form onSubmit={handleSubmit} className=\"flex flex-col lg:flex-row h-full overflow-y-auto custom-scrollbar bg-[#1c1022]\">\n            {/* Left Column: Form Fields */}\n            <div className=\"flex-1 p-8 space-y-6\">\n              {/* Title */}\n              <div className=\"flex flex-col gap-2\">\n                <label className=\"text-white text-sm font-semibold tracking-wide\">Book Title</label>\n                <input \n                  name=\"title\"\n                  value={formData.title}\n                  onChange={handleInputChange}\n                  className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                  placeholder=\"e.g. The Great Gatsby\" \n                  type=\"text\"\n                  required\n                  disabled={submitting}\n                />\n              </div>\n\n              {/* Author */}\n              <div className=\"flex flex-col gap-2\">\n                <label className=\"text-white text-sm font-semibold tracking-wide\">Author</label>\n                <div className=\"relative\">\n                  <span className=\"material-symbols-outlined absolute left-3 top-3.5 text-text-muted text-[20px]\">person</span>\n                  <input \n                    name=\"author\"\n                    value={formData.author}\n                    onChange={handleInputChange}\n                    className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted pl-10 pr-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                    placeholder=\"e.g. F. Scott Fitzgerald\" \n                    type=\"text\"\n                    required\n                    disabled={submitting}\n                  />\n                </div>\n              </div>\n\n              {/* Grid Row: ISBN & Year */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div className=\"flex flex-col gap-2\">\n                  <label className=\"text-white text-sm font-semibold tracking-wide\">ISBN-13</label>\n                  <div className=\"relative\">\n                    <span className=\"material-symbols-outlined absolute left-3 top-3.5 text-text-muted text-[20px]\">qr_code_2</span>\n                    <input \n                      name=\"isbn\"\n                      value={formData.isbn}\n                      onChange={handleInputChange}\n                      className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted pl-10 pr-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                      placeholder=\"978-3-16-148410-0\" \n                      type=\"text\"\n                      disabled={submitting}\n                    />\n                  </div>\n                </div>\n                <div className=\"flex flex-col gap-2\">\n                  <label className=\"text-white text-sm font-semibold tracking-wide\">Publication Year</label>\n                  <div className=\"relative\">\n                    <span className=\"material-symbols-outlined absolute left-3 top-3.5 text-text-muted text-[20px]\">calendar_today</span>\n                    <input \n                      name=\"publishedYear\"\n                      value={formData.publishedYear}\n                      onChange={handleInputChange}\n                      className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted pl-10 pr-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                      placeholder=\"YYYY\" \n                      type=\"number\"\n                      min=\"1000\"\n                      max={new Date().getFullYear()}\n                      disabled={submitting}\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Grid Row: Genre, Language */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div className=\"flex flex-col gap-2\">\n                  <label className=\"text-white text-sm font-semibold tracking-wide\">Genre</label>\n                  <div className=\"relative\">\n                    <select \n                      name=\"genre\"\n                      value={formData.genre}\n                      onChange={handleInputChange}\n                      className=\"w-full appearance-none rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm cursor-pointer\"\n                      required\n                      disabled={submitting}\n                    >\n                      <option disabled value=\"\">Select Genre</option>\n                      {categories.map((cat) => (\n                        <option key={cat._id} value={cat._id}>\n                          {cat.name.charAt(0).toUpperCase() + cat.name.slice(1)}\n                        </option>\n                      ))}\n                    </select>\n                    <span className=\"material-symbols-outlined absolute right-3 top-3.5 text-text-muted pointer-events-none\">expand_more</span>\n                  </div>\n                </div>\n                <div className=\"flex flex-col gap-2\">\n                  <label className=\"text-white text-sm font-semibold tracking-wide\">Language</label>\n                  <div className=\"relative\">\n                    <span className=\"material-symbols-outlined absolute left-3 top-3.5 text-text-muted text-[20px]\">language</span>\n                    <select \n                      name=\"bookLanguage\"\n                      value={formData.bookLanguage || 'en'}\n                      onChange={handleInputChange}\n                      className=\"w-full appearance-none rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted pl-10 pr-10 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm cursor-pointer\"\n                      required\n                      disabled={submitting || loading}\n                      key={`language-${bookId}-${formData.bookLanguage || 'en'}`}\n                    >\n                      <option value=\"en\">English</option>\n                      <option value=\"bn\">Bangla</option>\n                    </select>\n                    <span className=\"material-symbols-outlined absolute right-3 top-3.5 text-text-muted pointer-events-none\">expand_more</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Shelf Location */}\n              <div className=\"flex flex-col gap-2\">\n                <label className=\"text-white text-sm font-semibold tracking-wide\">Shelf Location</label>\n                <input \n                  name=\"shelfLocation\"\n                  value={formData.shelfLocation}\n                  onChange={handleInputChange}\n                  className=\"w-full rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm\" \n                  placeholder=\"e.g. A-12\" \n                  type=\"text\"\n                  disabled={submitting}\n                />\n              </div>\n\n              {/* Description */}\n              <div className=\"flex flex-col gap-2\">\n                <label className=\"text-white text-sm font-semibold tracking-wide\">Synopsis</label>\n                <textarea \n                  name=\"description\"\n                  value={formData.description}\n                  onChange={handleInputChange}\n                  className=\"w-full min-h-[120px] rounded-lg bg-surface-dark border border-border-dark text-white placeholder-text-muted px-4 py-3 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary transition-all shadow-sm resize-none leading-relaxed\" \n                  placeholder=\"Write a brief description of the book...\"\n                  disabled={submitting}\n                />\n              </div>\n            </div>\n\n            {/* Right Column: Image Upload */}\n            <div className=\"w-full lg:w-[400px] bg-[#22132b]/50 p-8 border-t lg:border-t-0 lg:border-l border-border-dark flex flex-col gap-6\">\n              <div className=\"flex flex-col gap-2\">\n                <h3 className=\"text-white font-semibold\">Cover Image</h3>\n                <p className=\"text-text-muted text-sm\">Upload a new cover image or keep the existing one.</p>\n              </div>\n\n              {/* Upload Box */}\n              <div className=\"flex-1 flex flex-col\">\n                <div \n                  className={`group relative flex flex-1 flex-col items-center justify-center gap-4 rounded-xl border-2 border-dashed border-border-dark bg-surface-dark/50 hover:bg-surface-dark hover:border-primary transition-all cursor-pointer min-h-[300px] ${submitting ? 'opacity-50 cursor-not-allowed' : ''}`}\n                  onDragOver={handleDragOver}\n                  onDrop={handleDrop}\n                  onClick={(e) => {\n                    // Don't trigger if clicking the remove button\n                    if (e.target.closest('button')) return;\n                    if (!submitting && fileInputRef.current) {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      fileInputRef.current.click();\n                    }\n                  }}\n                >\n                  {formData.coverImagePreview ? (\n                    <div className=\"relative w-full h-full flex items-center justify-center\">\n                      <img \n                        src={formData.coverImagePreview} \n                        alt=\"Cover preview\" \n                        className=\"max-w-full max-h-[300px] object-contain rounded-lg pointer-events-none\"\n                      />\n                      <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors rounded-lg flex items-center justify-center\">\n                        <span className=\"text-white opacity-0 group-hover:opacity-100 transition-opacity text-sm font-medium\">Click to change image</span>\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.preventDefault();\n                          e.stopPropagation();\n                          // If there's a new image, remove it and show existing\n                          // If only existing image, clear it\n                          if (formData.coverImage) {\n                            setFormData(prev => ({ \n                              ...prev, \n                              coverImage: null, \n                              coverImagePreview: prev.existingCoverImage,\n                            }));\n                          } else {\n                            setFormData(prev => ({ \n                              ...prev, \n                              coverImage: null, \n                              coverImagePreview: null,\n                              existingCoverImage: null,\n                            }));\n                          }\n                          if (fileInputRef.current) fileInputRef.current.value = '';\n                        }}\n                        className=\"absolute top-2 right-2 p-2 bg-red-500/80 hover:bg-red-500 text-white rounded-full transition-colors z-10\"\n                        disabled={submitting}\n                        title=\"Remove image\"\n                      >\n                        <span className=\"material-symbols-outlined text-[18px]\">close</span>\n                      </button>\n                    </div>\n                  ) : (\n                    <>\n                      {/* Illustration/Icon */}\n                      <div className=\"relative flex items-center justify-center\">\n                        <div className=\"absolute inset-0 bg-primary/20 blur-xl rounded-full\"></div>\n                        <div className=\"relative h-16 w-16 rounded-full bg-surface-dark border border-border-dark flex items-center justify-center group-hover:scale-110 transition-transform duration-300 shadow-lg\">\n                          <span className=\"material-symbols-outlined text-primary text-3xl\">cloud_upload</span>\n                        </div>\n                      </div>\n                      <div className=\"text-center space-y-1 px-4\">\n                        <p className=\"text-white font-medium group-hover:text-primary transition-colors\">Click to upload or drag & drop</p>\n                        <p className=\"text-text-muted text-xs\">SVG, PNG, JPG or WEBP (MAX. 800x1200px)</p>\n                      </div>\n                    </>\n                  )}\n                </div>\n                {/* Hidden Input */}\n                <input \n                  ref={fileInputRef}\n                  className=\"hidden\" \n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleFileChange}\n                  disabled={submitting}\n                />\n              </div>\n\n              {/* Preview / Hint Area */}\n              <div className=\"bg-surface-dark border border-border-dark rounded-lg p-4 flex items-start gap-3\">\n                <span className=\"material-symbols-outlined text-primary mt-0.5\">info</span>\n                <div className=\"text-xs text-text-muted leading-relaxed\">\n                  Recommended aspect ratio is <span className=\"text-white font-medium\">1:1.5</span>. Images will be automatically resized to fit the catalog grid.\n                </div>\n              </div>\n            </div>\n          </form>\n        )}\n\n        {/* Modal Footer */}\n        <div className=\"px-8 py-5 border-t border-border-dark bg-[#1c1022] flex flex-col-reverse sm:flex-row justify-end items-center gap-4\">\n          <button \n            type=\"button\"\n            onClick={handleClose}\n            disabled={submitting || loading}\n            className=\"w-full sm:w-auto px-6 py-2.5 rounded-lg border border-border-dark text-white font-medium hover:bg-surface-dark hover:border-white/20 transition-all text-sm tracking-wide disabled:opacity-50\"\n          >\n            Cancel\n          </button>\n          <button \n            type=\"submit\"\n            onClick={handleSubmit}\n            disabled={submitting || loading}\n            className=\"w-full sm:w-auto px-8 py-2.5 rounded-lg bg-primary text-white font-bold hover:bg-primary-hover shadow-[0_0_20px_rgba(170,31,239,0.3)] hover:shadow-[0_0_25px_rgba(170,31,239,0.5)] transition-all flex items-center justify-center gap-2 text-sm tracking-wide transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            <span className=\"material-symbols-outlined text-[18px]\">save</span>\n            {submitting ? 'Updating...' : 'Update Book'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\EditMemberModal.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":263,"column":23,"nodeType":"JSXOpeningElement","endLine":263,"endColumn":118}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { showError, showSuccess, showLoading, close } from '@/lib/swal';\r\nimport { LOCATION_DATA } from '@/lib/locationData';\r\n\r\nexport default function EditMemberModal({ isOpen, onClose, member, onMemberUpdated }) {\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    division: '',\r\n    city: '',\r\n    area: '',\r\n    landmark: '',\r\n    tier: 'premium',\r\n    profilePhoto: null,\r\n    profilePhotoPreview: null,\r\n    profilePhotoUrl: '',\r\n  });\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n  const fileInputRef = useRef(null);\r\n\r\n  // Load member data when modal opens\r\n  useEffect(() => {\r\n    if (isOpen && member) {\r\n      const subscriptionType = member.subscription?.type || 'free';\r\n      const tier = (subscriptionType === 'monthly' || subscriptionType === 'yearly') ? 'premium' : 'standard';\r\n      \r\n      setFormData({\r\n        name: member.name || '',\r\n        email: member.email || '',\r\n        phone: member.phone || '',\r\n        division: member.address?.division || '',\r\n        city: member.address?.city || '',\r\n        area: member.address?.area || '',\r\n        landmark: member.address?.landmark || '',\r\n        tier: tier,\r\n        profilePhoto: null,\r\n        profilePhotoPreview: member.profilePhoto || null,\r\n        profilePhotoUrl: member.profilePhoto || '',\r\n      });\r\n    }\r\n  }, [isOpen, member]);\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    \r\n    // Handle cascading dropdowns like register page\r\n    if (name === 'division') {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        division: value,\r\n        city: '', // Reset city when division changes\r\n        area: '', // Reset area when division changes\r\n      }));\r\n    } else if (name === 'city') {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        city: value,\r\n        area: '', // Reset area when city changes\r\n      }));\r\n    } else {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        [name]: value,\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Get available cities based on selected division\r\n  const getAvailableCities = () => {\r\n    if (!formData.division || !LOCATION_DATA[formData.division]) {\r\n      return [];\r\n    }\r\n    return Object.keys(LOCATION_DATA[formData.division]);\r\n  };\r\n\r\n  // Get available areas based on selected division and city\r\n  const getAvailableAreas = () => {\r\n    if (!formData.division || !formData.city || !LOCATION_DATA[formData.division]) {\r\n      return [];\r\n    }\r\n    return LOCATION_DATA[formData.division][formData.city] || [];\r\n  };\r\n\r\n  const handleFileChange = async (e) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      showError('Invalid file type', 'Please upload a valid image file (JPG, PNG, or WEBP)');\r\n      return;\r\n    }\r\n\r\n    if (file.size > 2 * 1024 * 1024) {\r\n      showError('File too large', 'Image must be less than 2MB');\r\n      return;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    reader.onloadend = () => {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        profilePhoto: file,\r\n        profilePhotoPreview: reader.result,\r\n      }));\r\n    };\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  const uploadImage = async (file) => {\r\n    const formDataToUpload = new FormData();\r\n    formDataToUpload.append('image', file);\r\n\r\n    const response = await fetch('/api/upload', {\r\n      method: 'POST',\r\n      body: formDataToUpload,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      throw new Error(error.error || 'Failed to upload image');\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.url;\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!member?._id) {\r\n      showError('Error', 'Member ID is required');\r\n      return;\r\n    }\r\n\r\n    if (!formData.name.trim()) {\r\n      showError('Validation Error', 'Full name is required');\r\n      return;\r\n    }\r\n\r\n    if (!formData.email.trim()) {\r\n      showError('Validation Error', 'Email address is required');\r\n      return;\r\n    }\r\n\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    if (!emailRegex.test(formData.email.trim())) {\r\n      showError('Validation Error', 'Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    const loadingSwal = showLoading('Updating member...', 'Please wait while we update the member information.');\r\n\r\n    try {\r\n      let profilePhotoUrl = formData.profilePhotoUrl;\r\n      \r\n      if (formData.profilePhoto) {\r\n        setUploading(true);\r\n        profilePhotoUrl = await uploadImage(formData.profilePhoto);\r\n        setUploading(false);\r\n      }\r\n\r\n      // Determine subscription type based on tier\r\n      let subscriptionType = 'free';\r\n      if (formData.tier === 'premium') {\r\n        subscriptionType = 'monthly'; // Default to monthly for premium\r\n      }\r\n\r\n      // Prepare address object (matching User model structure)\r\n      const address = {\r\n        division: formData.division || undefined,\r\n        city: formData.city || undefined,\r\n        area: formData.area || undefined,\r\n        landmark: formData.landmark || undefined,\r\n      };\r\n\r\n      const updates = {\r\n        name: formData.name.trim(),\r\n        email: formData.email.trim(),\r\n        phone: formData.phone.trim() || null,\r\n        profilePhoto: profilePhotoUrl || null,\r\n        address: address,\r\n        subscription: {\r\n          type: subscriptionType,\r\n          status: 'active',\r\n        },\r\n      };\r\n\r\n      const response = await fetch(`/api/admin/members?userId=${member._id}`, {\r\n        method: 'PATCH',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: member._id,\r\n          updates,\r\n        }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!response.ok) {\r\n        throw new Error(result.error || 'Failed to update member');\r\n      }\r\n\r\n      close();\r\n      showSuccess('Member Updated!', 'The member information has been successfully updated.');\r\n\r\n      if (onMemberUpdated) {\r\n        onMemberUpdated();\r\n      }\r\n      onClose();\r\n    } catch (error) {\r\n      close();\r\n      showError('Error', error.message || 'Failed to update member. Please try again.');\r\n    } finally {\r\n      setSubmitting(false);\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    if (submitting) return;\r\n    onClose();\r\n  };\r\n\r\n  if (!isOpen || !member) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 lg:p-8\">\r\n      <div \r\n        className=\"absolute inset-0 z-0 bg-background-dark/80 backdrop-blur-sm transition-opacity\"\r\n        onClick={handleClose}\r\n      />\r\n      \r\n      <div className=\"relative z-10 w-full max-w-5xl rounded-2xl border border-border-dark shadow-2xl flex flex-col max-h-[90vh] overflow-hidden animate-fade-in-up\" style={{ background: 'rgba(43, 25, 52, 0.95)', backdropFilter: 'blur(12px)', WebkitBackdropFilter: 'blur(12px)' }}>\r\n        <div className=\"flex items-center justify-between px-8 py-6 border-b border-border-dark bg-[#150c19]/50\">\r\n          <div className=\"flex flex-col gap-1\">\r\n            <h2 className=\"text-white text-2xl font-bold tracking-tight\">Edit Member</h2>\r\n            <p className=\"text-white/60 text-sm font-normal\">Update member information for the Bookflix library system.</p>\r\n          </div>\r\n          <button \r\n            onClick={handleClose}\r\n            disabled={submitting}\r\n            className=\"text-white/40 hover:text-white transition-colors p-2 rounded-full hover:bg-white/5 disabled:opacity-50\"\r\n          >\r\n            <span className=\"material-symbols-outlined text-2xl\">close</span>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex-1 overflow-y-auto px-8 py-8 custom-scrollbar\">\r\n          <form className=\"grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12\" onSubmit={handleSubmit}>\r\n            <div className=\"lg:col-span-4 flex flex-col gap-6\">\r\n              <div className=\"flex flex-col items-center gap-4 p-6 bg-[#150c19]/30 rounded-xl border border-border-dark/50\">\r\n                <div className=\"relative group cursor-pointer\" onClick={() => !submitting && fileInputRef.current?.click()}>\r\n                  <div className=\"w-32 h-32 rounded-full bg-[#150c19] border-4 border-border-dark flex items-center justify-center overflow-hidden relative\">\r\n                    {formData.profilePhotoPreview ? (\r\n                      <img src={formData.profilePhotoPreview} alt=\"Profile\" className=\"w-full h-full object-cover\" />\r\n                    ) : (\r\n                      <span className=\"material-symbols-outlined text-white/20 text-5xl group-hover:hidden\">person</span>\r\n                    )}\r\n                    <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                      <span className=\"material-symbols-outlined text-white text-3xl\">upload</span>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"absolute bottom-1 right-1 bg-primary text-white rounded-full p-2 border-4 border-surface-dark flex items-center justify-center shadow-lg\">\r\n                    <span className=\"material-symbols-outlined text-sm font-bold\">add_a_photo</span>\r\n                  </div>\r\n                  <input \r\n                    ref={fileInputRef}\r\n                    type=\"file\"\r\n                    accept=\"image/jpeg,image/jpg,image/png,image/webp\"\r\n                    onChange={handleFileChange}\r\n                    className=\"hidden\"\r\n                    disabled={submitting}\r\n                  />\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <h3 className=\"text-white font-medium text-sm\">Profile Photo</h3>\r\n                  <p className=\"text-white/40 text-xs mt-1\">Accepts .jpg, .png, .webp up to 2MB</p>\r\n                </div>\r\n                <button \r\n                  type=\"button\"\r\n                  onClick={() => !submitting && fileInputRef.current?.click()}\r\n                  className=\"w-full py-2 px-4 rounded-lg border border-border-dark bg-transparent hover:bg-white/5 text-white text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                  disabled={submitting}\r\n                >\r\n                  <span className=\"material-symbols-outlined text-lg\">upload_file</span>\r\n                  Upload Photo\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"flex flex-col gap-3\">\r\n                <label className=\"text-white/80 text-sm font-semibold uppercase tracking-wider\">Membership Tier</label>\r\n                <div className=\"grid grid-cols-1 gap-3\">\r\n                  <label className={`relative flex cursor-pointer rounded-xl border border-border-dark p-4 shadow-sm hover:border-primary/50 focus:outline-none transition-all ${formData.tier === 'standard' ? 'border-primary bg-primary/10' : ''}`}>\r\n                    <input \r\n                      className=\"peer sr-only\" \r\n                      name=\"tier\" \r\n                      type=\"radio\" \r\n                      value=\"standard\"\r\n                      checked={formData.tier === 'standard'}\r\n                      onChange={handleInputChange}\r\n                      disabled={submitting}\r\n                    />\r\n                    <span className=\"flex flex-1\">\r\n                      <span className=\"flex flex-col\">\r\n                        <span className=\"block text-sm font-medium text-white\">Standard</span>\r\n                        <span className=\"mt-1 flex items-center text-xs text-white/50\">Basic catalog access  2 books/mo</span>\r\n                      </span>\r\n                    </span>\r\n                    <span className={`material-symbols-outlined text-xl self-center ${formData.tier === 'standard' ? 'text-primary' : 'text-white/20'}`}>check_circle</span>\r\n                  </label>\r\n                  <label className={`relative flex cursor-pointer rounded-xl border border-border-dark p-4 shadow-sm hover:border-primary/50 focus:outline-none transition-all ${formData.tier === 'premium' ? 'border-primary bg-primary/10' : ''}`}>\r\n                    <input \r\n                      className=\"peer sr-only\" \r\n                      name=\"tier\" \r\n                      type=\"radio\" \r\n                      value=\"premium\"\r\n                      checked={formData.tier === 'premium'}\r\n                      onChange={handleInputChange}\r\n                      disabled={submitting}\r\n                    />\r\n                    <span className=\"flex flex-1\">\r\n                      <span className=\"flex flex-col\">\r\n                        <span className=\"block text-sm font-medium text-white\">Premium</span>\r\n                        <span className=\"mt-1 flex items-center text-xs text-white/50\">Full access  Offline mode  Unlimited</span>\r\n                      </span>\r\n                    </span>\r\n                    <span className={`material-symbols-outlined text-xl self-center ${formData.tier === 'premium' ? 'text-primary' : 'text-white/20'}`}>check_circle</span>\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"lg:col-span-8 flex flex-col gap-8\">\r\n              <div className=\"space-y-4\">\r\n                <h3 className=\"text-white text-lg font-semibold flex items-center gap-2 border-b border-border-dark pb-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">person</span>\r\n                  Personal Details\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Full Name</span>\r\n                    <input \r\n                      name=\"name\"\r\n                      value={formData.name}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\" \r\n                      placeholder=\"e.g. Jane Doe\" \r\n                      type=\"text\"\r\n                      required\r\n                      disabled={submitting}\r\n                    />\r\n                  </label>\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Phone Number</span>\r\n                    <input \r\n                      name=\"phone\"\r\n                      value={formData.phone}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\" \r\n                      placeholder=\"e.g. +1 (555) 000-0000\" \r\n                      type=\"tel\"\r\n                      disabled={submitting}\r\n                    />\r\n                  </label>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Division</span>\r\n                    <div className=\"relative\">\r\n                      <select \r\n                        name=\"division\"\r\n                        value={formData.division}\r\n                        onChange={handleInputChange}\r\n                        className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none cursor-pointer\"\r\n                        disabled={submitting}\r\n                      >\r\n                        <option value=\"\" className=\"bg-[#150c19]\">Select Division</option>\r\n                        {Object.keys(LOCATION_DATA).map((division) => (\r\n                          <option key={division} value={division} className=\"bg-[#150c19]\">\r\n                            {division}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                      <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-white/50 pointer-events-none\">expand_more</span>\r\n                    </div>\r\n                  </label>\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">City</span>\r\n                    <div className=\"relative\">\r\n                      <select \r\n                        name=\"city\"\r\n                        value={formData.city}\r\n                        onChange={handleInputChange}\r\n                        className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        disabled={submitting || !formData.division}\r\n                      >\r\n                        <option value=\"\" className=\"bg-[#150c19]\">Select City</option>\r\n                        {getAvailableCities().map((city) => (\r\n                          <option key={city} value={city} className=\"bg-[#150c19]\">\r\n                            {city}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                      <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-white/50 pointer-events-none\">expand_more</span>\r\n                    </div>\r\n                  </label>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Area (Thana)</span>\r\n                    <div className=\"relative\">\r\n                      <select \r\n                        name=\"area\"\r\n                        value={formData.area}\r\n                        onChange={handleInputChange}\r\n                        className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        disabled={submitting || !formData.city}\r\n                      >\r\n                        <option value=\"\" className=\"bg-[#150c19]\">Select Area</option>\r\n                        {getAvailableAreas().map((area) => (\r\n                          <option key={area} value={area} className=\"bg-[#150c19]\">\r\n                            {area}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                      <span className=\"material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-white/50 pointer-events-none\">expand_more</span>\r\n                    </div>\r\n                  </label>\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Landmark</span>\r\n                    <input \r\n                      name=\"landmark\"\r\n                      value={formData.landmark}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\" \r\n                      placeholder=\"e.g. Near Public Library\" \r\n                      type=\"text\"\r\n                      disabled={submitting}\r\n                    />\r\n                  </label>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-4\">\r\n                <h3 className=\"text-white text-lg font-semibold flex items-center gap-2 border-b border-border-dark pb-2\">\r\n                  <span className=\"material-symbols-outlined text-primary\">lock</span>\r\n                  Account Credentials\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Email Address</span>\r\n                    <input \r\n                      name=\"email\"\r\n                      value={formData.email}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all\" \r\n                      placeholder=\"name@example.com\" \r\n                      type=\"email\"\r\n                      required\r\n                      disabled={submitting}\r\n                    />\r\n                  </label>\r\n                  <label className=\"flex flex-col gap-2\">\r\n                    <span className=\"text-white/80 text-sm font-medium\">Member ID</span>\r\n                    <input \r\n                      value={member._id}\r\n                      className=\"w-full bg-[#150c19] border border-border-dark rounded-lg px-4 py-3 text-white/50 cursor-not-allowed\" \r\n                      type=\"text\"\r\n                      disabled\r\n                    />\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-end gap-3 px-8 py-5 border-t border-border-dark bg-[#150c19]/80 backdrop-blur-md\">\r\n          <button \r\n            type=\"button\"\r\n            onClick={handleClose}\r\n            disabled={submitting}\r\n            className=\"px-6 py-2.5 rounded-lg text-white/70 hover:text-white hover:bg-white/5 transition-all text-sm font-medium disabled:opacity-50\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button \r\n            type=\"submit\"\r\n            onClick={handleSubmit}\r\n            disabled={submitting || uploading}\r\n            className=\"px-6 py-2.5 rounded-lg bg-primary hover:bg-[#8a19c2] text-white shadow-[0_0_15px_rgba(170,31,239,0.3)] hover:shadow-[0_0_20px_rgba(170,31,239,0.5)] transition-all text-sm font-bold flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            <span className=\"material-symbols-outlined text-lg\">save</span>\r\n            {submitting ? 'Saving...' : 'Update Member'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\EditStaffModal.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchStaffData'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [fetchStaffData, isOpen, staffId]","fix":{"range":[713,730],"text":"[fetchStaffData, isOpen, staffId]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":305,"column":23,"nodeType":"JSXOpeningElement","endLine":309,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { showError, showSuccess, showLoading, close } from '@/lib/swal';\r\n\r\nexport default function EditStaffModal({ isOpen, onClose, onStaffUpdated, staffId }) {\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    profilePhoto: null,\r\n    profilePhotoPreview: null,\r\n    existingProfilePhoto: null,\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n  const fileInputRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && staffId) {\r\n      fetchStaffData();\r\n    }\r\n  }, [isOpen, staffId]);\r\n\r\n  const fetchStaffData = async () => {\r\n    if (!staffId) return;\r\n    \r\n    setLoading(true);\r\n    try {\r\n      const response = await fetch(`/api/admin/staff?userId=${staffId}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const staff = data.staff?.[0] || data.user;\r\n        \r\n        setFormData({\r\n          name: staff.name || '',\r\n          email: staff.email || '',\r\n          phone: staff.phone || '',\r\n          profilePhoto: null,\r\n          profilePhotoPreview: staff.profilePhoto || null,\r\n          existingProfilePhoto: staff.profilePhoto || null,\r\n        });\r\n      } else {\r\n        const error = await response.json();\r\n        showError('Error', error.error || 'Failed to load staff data');\r\n        onClose();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching staff:', error);\r\n      showError('Error', 'Failed to load staff data. Please try again.');\r\n      onClose();\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value,\r\n    }));\r\n  };\r\n\r\n  const handleFileChange = async (e) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Validate file type\r\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      showError('Invalid file type', 'Please upload a valid image file (JPG, PNG, or WEBP)');\r\n      return;\r\n    }\r\n\r\n    // Validate file size (2MB max)\r\n    if (file.size > 2 * 1024 * 1024) {\r\n      showError('File too large', 'Image must be less than 2MB');\r\n      return;\r\n    }\r\n\r\n    // Create preview\r\n    const reader = new FileReader();\r\n    reader.onloadend = () => {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        profilePhoto: file,\r\n        profilePhotoPreview: reader.result,\r\n      }));\r\n    };\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  const uploadImage = async (file) => {\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    const response = await fetch('/api/upload', {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      throw new Error(error.error || 'Failed to upload image');\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.url;\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    // Validation\r\n    if (!formData.name.trim()) {\r\n      showError('Validation Error', 'Full name is required');\r\n      return;\r\n    }\r\n\r\n    if (!formData.email.trim()) {\r\n      showError('Validation Error', 'Email address is required');\r\n      return;\r\n    }\r\n\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    if (!emailRegex.test(formData.email.trim())) {\r\n      showError('Validation Error', 'Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    const loadingSwal = showLoading('Updating staff member...', 'Please wait while we update the staff member.');\r\n\r\n    try {\r\n      let profilePhotoUrl = formData.existingProfilePhoto;\r\n\r\n      // Upload new image if one was selected\r\n      if (formData.profilePhoto) {\r\n        setUploading(true);\r\n        profilePhotoUrl = await uploadImage(formData.profilePhoto);\r\n        setUploading(false);\r\n      }\r\n\r\n      const response = await fetch('/api/admin/staff', {\r\n        method: 'PATCH',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          userId: staffId,\r\n          updates: {\r\n            name: formData.name.trim(),\r\n            email: formData.email.trim(),\r\n            phone: formData.phone.trim() || undefined,\r\n            profilePhoto: profilePhotoUrl,\r\n          },\r\n        }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!response.ok) {\r\n        throw new Error(result.error || 'Failed to update staff member');\r\n      }\r\n\r\n      close();\r\n      showSuccess('Staff Updated!', 'The staff member has been successfully updated.');\r\n\r\n      // Notify parent to refresh staff list\r\n      if (onStaffUpdated) {\r\n        onStaffUpdated();\r\n      }\r\n      onClose();\r\n    } catch (error) {\r\n      close();\r\n      showError('Error', error.message || 'Failed to update staff member. Please try again.');\r\n    } finally {\r\n      setSubmitting(false);\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    if (submitting || loading) return;\r\n    setFormData({\r\n      name: '',\r\n      email: '',\r\n      phone: '',\r\n      profilePhoto: null,\r\n      profilePhotoPreview: null,\r\n      existingProfilePhoto: null,\r\n    });\r\n    if (fileInputRef.current) {\r\n      fileInputRef.current.value = '';\r\n    }\r\n    onClose();\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6\">\r\n      {/* Backdrop */}\r\n      <div \r\n        className=\"absolute inset-0 bg-[#0f0913]/80 backdrop-blur-sm z-40 transition-opacity\"\r\n        onClick={handleClose}\r\n      />\r\n      \r\n      {/* Modal Container */}\r\n      <div className=\"relative z-50 w-full max-w-2xl bg-background-dark border border-white/10 rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden transform transition-all animate-fade-in-up box-border ring-1 ring-white/10\">\r\n        {/* Modal Header */}\r\n        <div className=\"flex items-start justify-between p-6 md:px-8 pt-8 pb-4 bg-background-dark\">\r\n          <div className=\"flex flex-col gap-2\">\r\n            <h2 className=\"text-white text-[28px] font-bold leading-tight tracking-tight\">Edit Staff Member</h2>\r\n            <p className=\"text-text-muted text-sm font-normal\">Update staff member information.</p>\r\n          </div>\r\n          <button \r\n            aria-label=\"Close modal\"\r\n            onClick={handleClose}\r\n            disabled={submitting || loading}\r\n            className=\"group text-text-muted hover:text-white transition-colors p-1.5 rounded-lg hover:bg-surface-dark disabled:opacity-50\"\r\n          >\r\n            <span className=\"material-symbols-outlined text-[24px]\">close</span>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Modal Body / Form */}\r\n        {loading ? (\r\n          <div className=\"flex items-center justify-center p-12\">\r\n            <div className=\"text-center\">\r\n              <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4\"></div>\r\n              <p className=\"text-text-secondary\">Loading staff data...</p>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex-1 overflow-y-auto p-6 md:px-8 py-2 custom-scrollbar\">\r\n            <form className=\"flex flex-col gap-6\" onSubmit={handleSubmit}>\r\n              {/* Full Name */}\r\n              <div className=\"flex flex-col gap-2\">\r\n                <label className=\"text-white text-sm font-medium leading-normal ml-1\">Full Name</label>\r\n                <div className=\"relative group\">\r\n                  <input \r\n                    name=\"name\"\r\n                    value={formData.name}\r\n                    onChange={handleInputChange}\r\n                    className=\"w-full h-14 rounded-lg bg-surface-dark border border-white/5 text-white placeholder-text-muted/60 px-[15px] text-base font-normal leading-normal focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200\" \r\n                    placeholder=\"Enter full name\" \r\n                    type=\"text\"\r\n                    required\r\n                    disabled={submitting}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Email & Phone Grid */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-5\">\r\n                <div className=\"flex flex-col gap-2\">\r\n                  <label className=\"text-white text-sm font-medium leading-normal ml-1\">Email Address</label>\r\n                  <div className=\"relative group\">\r\n                    <input \r\n                      name=\"email\"\r\n                      value={formData.email}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full h-14 rounded-lg bg-surface-dark border border-white/5 text-white placeholder-text-muted/60 px-[15px] pr-12 text-base font-normal leading-normal focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200\" \r\n                      placeholder=\"colleague@bookflix.com\" \r\n                      type=\"email\"\r\n                      required\r\n                      disabled={submitting}\r\n                    />\r\n                    <div className=\"absolute right-4 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none group-focus-within:text-primary transition-colors\">\r\n                      <span className=\"material-symbols-outlined text-[20px]\">mail</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex flex-col gap-2\">\r\n                  <label className=\"text-white text-sm font-medium leading-normal ml-1\">Phone Number</label>\r\n                  <div className=\"relative group\">\r\n                    <input \r\n                      name=\"phone\"\r\n                      value={formData.phone}\r\n                      onChange={handleInputChange}\r\n                      className=\"w-full h-14 rounded-lg bg-surface-dark border border-white/5 text-white placeholder-text-muted/60 px-[15px] pr-12 text-base font-normal leading-normal focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200\" \r\n                      placeholder=\"+1 (555) 000-0000\" \r\n                      type=\"tel\"\r\n                      disabled={submitting}\r\n                    />\r\n                    <div className=\"absolute right-4 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none group-focus-within:text-primary transition-colors\">\r\n                      <span className=\"material-symbols-outlined text-[20px]\">call</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Profile Photo */}\r\n              <div className=\"flex flex-col gap-2\">\r\n                <label className=\"text-white text-sm font-medium leading-normal ml-1\">Profile Photo</label>\r\n                <div className=\"relative\">\r\n                  <div \r\n                    className=\"w-full h-32 rounded-lg bg-surface-dark border border-white/5 flex items-center justify-center cursor-pointer hover:border-primary transition-colors overflow-hidden\"\r\n                    onClick={() => !submitting && fileInputRef.current?.click()}\r\n                  >\r\n                    {formData.profilePhotoPreview ? (\r\n                      <img \r\n                        src={formData.profilePhotoPreview} \r\n                        alt=\"Profile preview\" \r\n                        className=\"w-full h-full object-cover\"\r\n                      />\r\n                    ) : (\r\n                      <div className=\"flex flex-col items-center gap-2 text-text-muted\">\r\n                        <span className=\"material-symbols-outlined text-4xl\">add_photo_alternate</span>\r\n                        <span className=\"text-sm\">Click to upload photo</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <input \r\n                    ref={fileInputRef}\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    onChange={handleFileChange}\r\n                    className=\"hidden\"\r\n                    disabled={submitting}\r\n                  />\r\n                  {formData.profilePhotoPreview && (\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        setFormData(prev => ({ \r\n                          ...prev, \r\n                          profilePhoto: null, \r\n                          profilePhotoPreview: prev.existingProfilePhoto,\r\n                        }));\r\n                        if (fileInputRef.current) fileInputRef.current.value = '';\r\n                      }}\r\n                      className=\"absolute top-2 right-2 p-2 bg-red-500/80 hover:bg-red-500 text-white rounded-full transition-colors\"\r\n                      disabled={submitting}\r\n                    >\r\n                      <span className=\"material-symbols-outlined text-[18px]\">close</span>\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        )}\r\n\r\n        {/* Modal Footer */}\r\n        <div className=\"p-6 md:px-8 bg-background-dark border-t border-white/5 flex flex-col-reverse md:flex-row justify-end gap-3 mt-2\">\r\n          <button \r\n            type=\"button\"\r\n            onClick={handleClose}\r\n            disabled={submitting || loading}\r\n            className=\"h-11 px-6 rounded-lg text-sm font-medium text-text-muted hover:text-white hover:bg-surface-dark transition-all duration-200 disabled:opacity-50\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button \r\n            type=\"submit\"\r\n            onClick={handleSubmit}\r\n            disabled={submitting || loading}\r\n            className=\"h-11 px-6 rounded-lg text-sm font-semibold text-white bg-primary hover:bg-[#901bc9] active:scale-[0.98] transition-all duration-200 shadow-glow hover:shadow-glow-active flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            <span className=\"material-symbols-outlined text-[18px]\">check_circle</span>\r\n            {submitting ? 'Updating...' : 'Update Staff Member'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\EmptyState.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\ErrorBoundary.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":58,"column":56,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1850,1951],"text":"\r\n                We encountered an unexpected error. Don&apos;t worry, your data is safe.\r\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1850,1951],"text":"\r\n                We encountered an unexpected error. Don&lsquo;t worry, your data is safe.\r\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1850,1951],"text":"\r\n                We encountered an unexpected error. Don&#39;t worry, your data is safe.\r\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1850,1951],"text":"\r\n                We encountered an unexpected error. Don&rsquo;t worry, your data is safe.\r\n              "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { showError } from '@/lib/swal';\r\nimport Link from 'next/link';\r\n\r\nclass ErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { hasError: false, error: null, errorInfo: null };\r\n  }\r\n\r\n  static getDerivedStateFromError(error) {\r\n    // Update state so the next render will show the fallback UI\r\n    return { hasError: true };\r\n  }\r\n\r\n  componentDidCatch(error, errorInfo) {\r\n    // Log error to console in development\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.error('ErrorBoundary caught an error:', error, errorInfo);\r\n    }\r\n\r\n    // Log to error reporting service in production\r\n    // Example: logErrorToService(error, errorInfo);\r\n\r\n    this.setState({\r\n      error,\r\n      errorInfo,\r\n    });\r\n\r\n    // Show user-friendly error message\r\n    showError(\r\n      'Something went wrong',\r\n      'An unexpected error occurred. Please try refreshing the page or contact support if the problem persists.'\r\n    );\r\n  }\r\n\r\n  handleReset = () => {\r\n    this.setState({ hasError: false, error: null, errorInfo: null });\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // Custom fallback UI\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      // Default fallback UI\r\n      return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-background-dark p-6\">\r\n          <div className=\"max-w-md w-full bg-surface-dark rounded-2xl border border-white/10 p-8 text-center\">\r\n            <div className=\"mb-6\">\r\n              <span className=\"material-symbols-outlined text-6xl text-alert-red mb-4\">error</span>\r\n              <h2 className=\"text-2xl font-bold text-white mb-2\">Oops! Something went wrong</h2>\r\n              <p className=\"text-text-secondary text-sm\">\r\n                We encountered an unexpected error. Don't worry, your data is safe.\r\n              </p>\r\n            </div>\r\n\r\n            {process.env.NODE_ENV === 'development' && this.state.error && (\r\n              <div className=\"mb-6 p-4 bg-black/20 rounded-lg text-left overflow-auto max-h-48\">\r\n                <p className=\"text-alert-red text-xs font-mono mb-2\">{this.state.error.toString()}</p>\r\n                {this.state.errorInfo && (\r\n                  <pre className=\"text-xs text-text-secondary overflow-auto\">\r\n                    {this.state.errorInfo.componentStack}\r\n                  </pre>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex flex-col sm:flex-row gap-3\">\r\n              <button\r\n                onClick={this.handleReset}\r\n                className=\"flex-1 bg-primary hover:bg-primary-hover text-white px-6 py-3 rounded-lg font-bold transition-all shadow-lg shadow-primary/20\"\r\n              >\r\n                Try Again\r\n              </button>\r\n              <Link\r\n                href=\"/\"\r\n                className=\"flex-1 bg-white/5 hover:bg-white/10 text-white px-6 py-3 rounded-lg font-medium transition-colors text-center border border-white/10\"\r\n              >\r\n                Go Home\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nexport default ErrorBoundary;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\ErrorNavbar.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\FAQ.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\Features.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\Footer.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\HeroSlider.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\LibrarianHeader.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\LibrarianSidebar.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":89,"column":15,"nodeType":"JSXOpeningElement","endLine":97,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from 'next/link';\nimport { usePathname } from 'next/navigation';\nimport { useAuth } from '@/contexts/AuthContext';\n\nexport default function LibrarianSidebar() {\n  const pathname = usePathname();\n  const { userData } = useAuth();\n\n  const isActive = (path) => {\n    return pathname === path || pathname?.startsWith(path + '/');\n  };\n\n  const navItems = [\n    { href: '/librarian/overview', label: 'Overview', icon: 'dashboard' },\n    { href: '/librarian/circulation', label: 'Circulation Desk', icon: 'class' },\n    { href: '/librarian/inventory', label: 'Inventory', icon: 'inventory_2' },\n    { href: '/librarian/requests', label: 'Requests', icon: 'local_shipping' },\n    { href: '/librarian/members', label: 'Members', icon: 'group' },\n  ];\n\n  return (\n    <aside className=\"w-72 h-full hidden lg:flex flex-col border-r border-white/5 bg-[#1a1021] shrink-0 transition-all duration-300 relative z-20\">\n      <div className=\"p-6 flex items-center gap-3\">\n        <div className=\"relative group\">\n          <div className=\"absolute inset-0 bg-primary blur opacity-40 group-hover:opacity-60 transition-opacity duration-500 rounded-lg\"></div>\n          <div className=\"relative bg-gradient-to-br from-primary to-purple-800 size-10 rounded-lg flex items-center justify-center shadow-xl shadow-primary/20 border border-white/10\">\n            <span className=\"material-symbols-outlined text-white\">auto_stories</span>\n          </div>\n        </div>\n        <div className=\"flex flex-col\">\n          <h1 className=\"text-white text-lg font-bold tracking-tight\">Bookflix</h1>\n          <p className=\"text-white/40 text-xs font-medium uppercase tracking-wider\">Librarian Panel</p>\n        </div>\n      </div>\n      <nav className=\"flex-1 px-4 py-2 flex flex-col gap-1 overflow-y-auto\">\n        <div className=\"px-4 py-2\">\n          <p className=\"text-[10px] font-bold text-white/30 uppercase tracking-widest\">Main Menu</p>\n        </div>\n        <Link\n          href=\"/\"\n          className=\"flex items-center gap-3 px-4 py-3 rounded-xl transition-all group text-white/60 hover:bg-white/5 hover:text-white\"\n        >\n          <span className=\"material-symbols-outlined text-[20px] group-hover:scale-110 transition-transform\">home</span>\n          <span className=\"text-sm font-medium\">Home</span>\n        </Link>\n        {navItems.map((item) => {\n          const active = isActive(item.href);\n          return (\n            <Link\n              key={item.href}\n              href={item.href}\n              className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all group ${\n                active\n                  ? 'bg-primary/10 text-primary border border-primary/10'\n                  : 'text-white/60 hover:bg-white/5 hover:text-white'\n              }`}\n            >\n              <span className={`material-symbols-outlined text-[20px] ${active ? 'fill' : ''} ${!active ? 'group-hover:scale-110 transition-transform' : ''}`}>\n                {item.icon}\n              </span>\n              <span className={`text-sm ${active ? 'font-semibold' : 'font-medium'}`}>{item.label}</span>\n            </Link>\n          );\n        })}\n        <div className=\"px-4 py-2 mt-6\">\n          <p className=\"text-[10px] font-bold text-white/30 uppercase tracking-widest\">System</p>\n        </div>\n        <Link\n          href=\"/librarian/settings\"\n          className=\"flex items-center gap-3 px-4 py-3 rounded-xl text-white/60 hover:bg-white/5 hover:text-white transition-all group\"\n        >\n          <span className=\"material-symbols-outlined text-[20px] group-hover:scale-110 transition-transform\">settings</span>\n          <span className=\"text-sm font-medium\">Settings</span>\n        </Link>\n        <Link\n          href=\"/librarian/help\"\n          className=\"flex items-center gap-3 px-4 py-3 rounded-xl text-white/60 hover:bg-white/5 hover:text-white transition-all group\"\n        >\n          <span className=\"material-symbols-outlined text-[20px] group-hover:scale-110 transition-transform\">help</span>\n          <span className=\"text-sm font-medium\">Help & Support</span>\n        </Link>\n      </nav>\n      <div className=\"p-4 border-t border-white/5\">\n          <div className=\"flex items-center gap-3 p-3 rounded-xl bg-[#2a1d33] border border-white/5 hover:border-white/10 hover:bg-white/10 cursor-pointer transition-all\">\n          <div className=\"size-9 rounded-full border border-white/10 ring-2 ring-transparent group-hover:ring-primary/50 transition-all overflow-hidden bg-[#3c2348] flex items-center justify-center\">\n            {userData?.profilePhoto ? (\n              <img\n                src={`/api/image-proxy?url=${encodeURIComponent(userData.profilePhoto)}`}\n                alt={userData?.name || 'Librarian'}\n                className=\"w-full h-full rounded-full object-cover\"\n                onError={(e) => {\n                  e.target.style.display = 'none';\n                  e.target.nextElementSibling.style.display = 'flex';\n                }}\n              />\n            ) : null}\n            <div \n              className={`w-full h-full flex items-center justify-center text-white text-sm font-bold ${userData?.profilePhoto ? 'hidden' : ''}`}\n            >\n              {userData?.name?.charAt(0)?.toUpperCase() || 'L'}\n            </div>\n          </div>\n          <div className=\"flex flex-col overflow-hidden\">\n            <p className=\"text-sm font-semibold text-white truncate\">{userData?.name || 'Librarian'}</p>\n            <p className=\"text-[11px] text-white/40 truncate\">Head Librarian</p>\n          </div>\n          <span className=\"material-symbols-outlined text-white/30 ml-auto text-sm\">expand_more</span>\n        </div>\n      </div>\n    </aside>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\Loader.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\LoadingSkeleton.js","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":98,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":104,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\n\r\n/**\r\n * Loading skeleton component for cards\r\n */\r\nexport function CardSkeleton({ count = 1 }) {\r\n  return (\r\n    <>\r\n      {Array.from({ length: count }).map((_, index) => (\r\n        <div\r\n          key={index}\r\n          className=\"bg-surface-dark rounded-xl p-4 border border-[#3c2348] animate-pulse\"\r\n        >\r\n          <div className=\"w-full aspect-[16/9] mb-4 bg-white/5 rounded-lg\"></div>\r\n          <div className=\"h-4 bg-white/5 rounded mb-2\"></div>\r\n          <div className=\"h-3 bg-white/5 rounded w-3/4\"></div>\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n\r\n/**\r\n * Loading skeleton for table rows\r\n */\r\nexport function TableRowSkeleton({ count = 5, columns = 4 }) {\r\n  return (\r\n    <>\r\n      {Array.from({ length: count }).map((_, rowIndex) => (\r\n        <tr key={rowIndex} className=\"animate-pulse\">\r\n          {Array.from({ length: columns }).map((_, colIndex) => (\r\n            <td key={colIndex} className=\"px-6 py-4\">\r\n              <div className=\"h-4 bg-white/5 rounded w-3/4\"></div>\r\n            </td>\r\n          ))}\r\n        </tr>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n\r\n/**\r\n * Loading skeleton for stats cards\r\n */\r\nexport function StatsCardSkeleton({ count = 4 }) {\r\n  return (\r\n    <>\r\n      {Array.from({ length: count }).map((_, index) => (\r\n        <div\r\n          key={index}\r\n          className=\"rounded-2xl bg-surface-dark border border-[#3c2348] p-5 animate-pulse\"\r\n        >\r\n          <div className=\"h-4 bg-white/5 rounded w-1/2 mb-4\"></div>\r\n          <div className=\"h-8 bg-white/5 rounded w-1/3 mb-2\"></div>\r\n          <div className=\"h-3 bg-white/5 rounded w-2/3\"></div>\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n\r\n/**\r\n * Loading skeleton for list items\r\n */\r\nexport function ListItemSkeleton({ count = 5 }) {\r\n  return (\r\n    <>\r\n      {Array.from({ length: count }).map((_, index) => (\r\n        <div\r\n          key={index}\r\n          className=\"flex items-center gap-3 p-4 bg-surface-dark rounded-lg border border-white/5 animate-pulse\"\r\n        >\r\n          <div className=\"size-10 rounded-full bg-white/5\"></div>\r\n          <div className=\"flex-1\">\r\n            <div className=\"h-4 bg-white/5 rounded w-1/3 mb-2\"></div>\r\n            <div className=\"h-3 bg-white/5 rounded w-1/2\"></div>\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n\r\n/**\r\n * Generic loading skeleton\r\n */\r\nexport function Skeleton({ className = '', width = '100%', height = '1rem' }) {\r\n  return (\r\n    <div\r\n      className={`bg-white/5 rounded animate-pulse ${className}`}\r\n      style={{ width, height }}\r\n    ></div>\r\n  );\r\n}\r\n\r\nexport default {\r\n  Card: CardSkeleton,\r\n  TableRow: TableRowSkeleton,\r\n  StatsCard: StatsCardSkeleton,\r\n  ListItem: ListItemSkeleton,\r\n  Skeleton,\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\ManageRoleModal.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\MaterialSymbolsLoader.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\MemberHeader.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\MemberSidebar.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":89,"column":13,"nodeType":"JSXOpeningElement","endLine":97,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from 'next/link';\nimport { usePathname } from 'next/navigation';\nimport { useAuth } from '@/contexts/AuthContext';\n\nexport default function MemberSidebar() {\n  const pathname = usePathname();\n  const { userData } = useAuth();\n\n  const isActive = (path) => {\n    return pathname === path;\n  };\n\n  const subscriptionType = userData?.subscription?.type || 'free';\n  const subscriptionStatus = userData?.subscription?.status || 'active';\n  const isPremium = (subscriptionType === 'monthly' || subscriptionType === 'yearly') && subscriptionStatus === 'active';\n  const memberType = isPremium ? 'Premium Member' : 'Standard Member';\n\n  const navItems = [\n    { href: '/member/overview', label: 'Overview', icon: 'home' },\n    { href: '/member/explore', label: 'Browse', icon: 'explore' },\n    { href: '/member/my-borrowings', label: 'My Borrowings', icon: 'shelves' },\n    // Only show reservations for premium members\n    ...(isPremium ? [{ href: '/member/reservations', label: 'Reservations', icon: 'event_seat' }] : []),\n    { href: '/member/billing', label: 'Billing & Profile', icon: 'receipt_long' },\n    { href: '/member/settings', label: 'Settings', icon: 'settings' },\n  ];\n\n  return (\n    <aside className=\"w-64 flex-shrink-0 border-r border-[#3c2348]/50 bg-[#1c1022] hidden md:flex flex-col justify-between p-4\">\n      <div className=\"flex flex-col gap-8\">\n        <div className=\"flex items-center gap-3 px-2\">\n          <div className=\"bg-primary/20 p-2 rounded-lg text-primary\">\n            <span className=\"material-symbols-outlined text-3xl\">local_library</span>\n          </div>\n          <h1 className=\"text-white text-xl font-bold tracking-tight\">Bookflix</h1>\n        </div>\n        <nav className=\"flex flex-col gap-2\">\n          <Link\n            href=\"/\"\n            className=\"flex items-center gap-3 px-3 py-3 rounded-xl transition-colors hover:bg-surface-hover text-text-secondary hover:text-white\"\n          >\n            <span className=\"material-symbols-outlined\">home</span>\n            <p className=\"text-sm font-medium\">Home</p>\n          </Link>\n          {navItems.map((item) => {\n            const active = isActive(item.href);\n            return (\n              <Link\n                key={item.href}\n                href={item.href}\n                className={`flex items-center gap-3 px-3 py-3 rounded-xl transition-colors ${\n                  active\n                    ? 'bg-primary/10 text-primary border border-primary/20'\n                    : 'hover:bg-surface-hover text-text-secondary hover:text-white'\n                }`}\n              >\n                <span className={`material-symbols-outlined ${active ? 'fill-1' : ''}`}>\n                  {item.icon}\n                </span>\n                <p className=\"text-sm font-medium\">{item.label}</p>\n              </Link>\n            );\n          })}\n        </nav>\n\n        {/* Upgrade Plan Button - Only for Standard Members */}\n        {!isPremium && (\n          <>\n            <div className=\"border-t border-[#3c2348] my-2\"></div>\n            <Link\n              href=\"/member/upgrade\"\n              className={`flex items-center gap-3 px-3 py-3 rounded-xl transition-all duration-300 relative ${\n                isActive('/member/upgrade')\n                  ? 'bg-primary/10 text-primary border border-primary/20'\n                  : 'bg-primary/10 hover:bg-primary/20 text-primary hover:text-primary border border-primary/30 hover:border-primary/50 animate-pulse-glow'\n              }`}\n            >\n              <span className={`material-symbols-outlined ${!isActive('/member/upgrade') ? 'animate-twinkle' : ''}`}>stars</span>\n              <p className=\"text-sm font-bold\">Upgrade Plan</p>\n            </Link>\n          </>\n        )}\n      </div>\n      <div className=\"flex items-center gap-3 px-3 py-3 rounded-xl bg-surface-dark border border-[#3c2348]\">\n        <div className=\"size-10 rounded-full overflow-hidden bg-[#3c2348] flex items-center justify-center\">\n          {userData?.profilePhoto ? (\n            <img\n              src={`/api/image-proxy?url=${encodeURIComponent(userData.profilePhoto)}`}\n              alt={userData?.name || 'User'}\n              className=\"w-full h-full rounded-full object-cover\"\n              onError={(e) => {\n                e.target.style.display = 'none';\n                e.target.nextElementSibling.style.display = 'flex';\n              }}\n            />\n          ) : null}\n          <div \n            className={`w-full h-full flex items-center justify-center text-white text-lg font-bold ${userData?.profilePhoto ? 'hidden' : ''}`}\n          >\n            {userData?.name?.charAt(0)?.toUpperCase() || 'U'}\n          </div>\n        </div>\n        <div className=\"flex flex-col min-w-0 flex-1\">\n          <p className=\"text-sm font-bold text-white truncate\">\n            {userData?.name || 'User'}\n          </p>\n          <p className=\"text-xs text-text-secondary\">{memberType}</p>\n        </div>\n      </div>\n    </aside>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\Navbar.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\Newsletter.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":35,"column":48,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1626,1668],"text":"You&apos;re on the list! Welcome to the family."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1626,1668],"text":"You&lsquo;re on the list! Welcome to the family."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1626,1668],"text":"You&#39;re on the list! Welcome to the family."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1626,1668],"text":"You&rsquo;re on the list! Welcome to the family."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\n\r\nconst Newsletter = () => {\r\n  const [email, setEmail] = useState('');\r\n  const [status, setStatus] = useState('idle'); // idle, loading, success\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    if (!email) return;\r\n    setStatus('loading');\r\n    // Simulate submission\r\n    setTimeout(() => {\r\n      setStatus('success');\r\n      setEmail('');\r\n    }, 1500);\r\n  };\r\n\r\n  return (\r\n    <section className=\"py-20 px-6\" id=\"newsletter\">\r\n      <div className=\"max-w-[1400px] mx-auto\">\r\n        <div className=\"relative rounded-[3rem] overflow-hidden bg-gradient-to-br from-primary/20 to-purple-900/40 p-12 md:p-24 border border-white/10 text-center animate-on-scroll\">\r\n          <div className=\"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10\"></div>\r\n          \r\n          <div className=\"relative z-10 max-w-2xl mx-auto\">\r\n            <h2 className=\"text-3xl md:text-5xl font-black text-white mb-6\">Join the Reading Revolution</h2>\r\n            <p className=\"text-xl text-gray-300 mb-10 leading-relaxed font-light\">\r\n              Get weekly book recommendations, exclusive author interviews, and sneak peeks at new arrivals directly in your inbox.\r\n            </p>\r\n            \r\n            {status === 'success' ? (\r\n              <div className=\"animate-fade-in-up bg-green-500/20 border border-green-500/50 text-green-400 p-6 rounded-2xl flex items-center justify-center gap-3\">\r\n                <span className=\"material-symbols-outlined\">check_circle</span>\r\n                <span className=\"font-bold\">You're on the list! Welcome to the family.</span>\r\n              </div>\r\n            ) : (\r\n              <form onSubmit={handleSubmit} className=\"flex flex-col sm:flex-row gap-4\">\r\n                <input \r\n                  type=\"email\" \r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  placeholder=\"Enter your email address\"\r\n                  className=\"flex-1 bg-black/40 border border-white/10 rounded-full px-8 py-5 text-white placeholder:text-gray-500 focus:outline-none focus:border-primary transition-all text-lg\"\r\n                  required\r\n                />\r\n                <button \r\n                  type=\"submit\"\r\n                  disabled={status === 'loading'}\r\n                  className=\"bg-primary hover:bg-primary-hover text-white px-10 py-5 rounded-full font-bold text-lg transition-all shadow-glow hover:scale-105 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2\"\r\n                >\r\n                  {status === 'loading' ? 'Joining...' : (\r\n                    <>Subscribe Now <span className=\"material-symbols-outlined\">send</span></>\r\n                  )}\r\n                </button>\r\n              </form>\r\n            )}\r\n            <p className=\"mt-6 text-gray-500 text-sm\">We respect your privacy. Unsubscribe at any time.</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default Newsletter;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\NotificationBell.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchNotifications' and 'fetchUnreadCount'. Either include them or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNotifications, fetchUnreadCount, userData?._id]","fix":{"range":[1775,1790],"text":"[fetchNotifications, fetchUnreadCount, userData?._id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport Link from 'next/link';\r\nimport Loader from './Loader';\r\n\r\nexport default function NotificationBell() {\r\n  const { userData } = useAuth();\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const dropdownRef = useRef(null);\r\n\r\n  // Fetch notifications\r\n  const fetchNotifications = async () => {\r\n    if (!userData?._id) return;\r\n\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch(`/api/notifications?userId=${userData._id}&limit=10&unreadOnly=false`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setNotifications(data.notifications || []);\r\n        setUnreadCount(data.unreadCount || 0);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching notifications:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Fetch unread count only\r\n  const fetchUnreadCount = async () => {\r\n    if (!userData?._id) return;\r\n\r\n    try {\r\n      const response = await fetch(`/api/notifications/unread-count?userId=${userData._id}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setUnreadCount(data.unreadCount || 0);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching unread count:', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (userData?._id) {\r\n      fetchNotifications();\r\n      // Poll for unread count every 30 seconds\r\n      const interval = setInterval(fetchUnreadCount, 30000);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [userData?._id]);\r\n\r\n  // Close dropdown when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      document.addEventListener('mousedown', handleClickOutside);\r\n      return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const markAsRead = async (notificationId) => {\r\n    try {\r\n      const response = await fetch(`/api/notifications/${notificationId}`, {\r\n        method: 'PATCH',\r\n      });\r\n      if (response.ok) {\r\n        setNotifications(prev =>\r\n          prev.map(n => n._id === notificationId ? { ...n, read: true } : n)\r\n        );\r\n        setUnreadCount(prev => Math.max(0, prev - 1));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error marking notification as read:', error);\r\n    }\r\n  };\r\n\r\n  const markAllAsRead = async () => {\r\n    if (!userData?._id) return;\r\n\r\n    try {\r\n      const response = await fetch('/api/notifications/mark-all-read', {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId: userData._id }),\r\n      });\r\n      if (response.ok) {\r\n        setNotifications(prev => prev.map(n => ({ ...n, read: true })));\r\n        setUnreadCount(0);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error marking all as read:', error);\r\n    }\r\n  };\r\n\r\n  const getNotificationIcon = (type) => {\r\n    const icons = {\r\n      borrowing_due: 'schedule',\r\n      borrowing_overdue: 'warning',\r\n      reservation_ready: 'check_circle',\r\n      reservation_expired: 'schedule',\r\n      fine_issued: 'attach_money',\r\n      payment_received: 'check_circle',\r\n      book_available: 'book',\r\n    };\r\n    return icons[type] || 'notifications';\r\n  };\r\n\r\n  const getNotificationColor = (type) => {\r\n    const colors = {\r\n      borrowing_due: 'text-orange-400',\r\n      borrowing_overdue: 'text-red-400',\r\n      reservation_ready: 'text-green-400',\r\n      reservation_expired: 'text-yellow-400',\r\n      fine_issued: 'text-red-400',\r\n      payment_received: 'text-green-400',\r\n      book_available: 'text-blue-400',\r\n    };\r\n    return colors[type] || 'text-primary';\r\n  };\r\n\r\n  const formatTime = (date) => {\r\n    const now = new Date();\r\n    const notificationDate = new Date(date);\r\n    const diffMs = now - notificationDate;\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMs / 3600000);\r\n    const diffDays = Math.floor(diffMs / 86400000);\r\n\r\n    if (diffMins < 1) return 'Just now';\r\n    if (diffMins < 60) return `${diffMins}m ago`;\r\n    if (diffHours < 24) return `${diffHours}h ago`;\r\n    if (diffDays < 7) return `${diffDays}d ago`;\r\n    return notificationDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n  };\r\n\r\n  if (!userData?._id) return null;\r\n\r\n  return (\r\n    <div className=\"relative\" ref={dropdownRef}>\r\n      <button\r\n        onClick={() => {\r\n          setIsOpen(!isOpen);\r\n          if (!isOpen) fetchNotifications();\r\n        }}\r\n        className=\"relative p-2 text-text-secondary hover:text-white hover:bg-surface-hover rounded-full transition-colors\"\r\n      >\r\n        <span className=\"material-symbols-outlined\">notifications</span>\r\n        {unreadCount > 0 && (\r\n          <span className=\"absolute top-2 right-2 size-2 bg-primary rounded-full border-2 border-[#1c1022] animate-pulse\"></span>\r\n        )}\r\n      </button>\r\n\r\n      {isOpen && (\r\n        <div className=\"absolute right-0 top-full mt-2 w-80 md:w-96 bg-surface-dark border border-[#3c2348] rounded-xl shadow-2xl z-50 max-h-[500px] flex flex-col\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between p-4 border-b border-[#3c2348]\">\r\n            <h3 className=\"text-white font-bold\">Notifications</h3>\r\n            {unreadCount > 0 && (\r\n              <button\r\n                onClick={markAllAsRead}\r\n                className=\"text-xs text-primary hover:text-white transition-colors\"\r\n              >\r\n                Mark all as read\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Notifications List */}\r\n          <div className=\"overflow-y-auto flex-1\">\r\n            {loading ? (\r\n              <div className=\"p-8 text-center text-text-secondary\">\r\n                <div className=\"flex justify-center mb-2\">\r\n                  <Loader />\r\n                </div>\r\n              </div>\r\n            ) : notifications.length === 0 ? (\r\n              <div className=\"p-8 text-center text-text-secondary\">\r\n                <span className=\"material-symbols-outlined text-5xl mb-3 opacity-50\">notifications_off</span>\r\n                <p>No notifications</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"divide-y divide-[#3c2348]\">\r\n                {notifications.map((notification) => (\r\n                  <div\r\n                    key={notification._id}\r\n                    className={`p-4 hover:bg-surface-hover transition-colors cursor-pointer ${\r\n                      !notification.read ? 'bg-primary/5' : ''\r\n                    }`}\r\n                    onClick={() => {\r\n                      if (!notification.read) markAsRead(notification._id);\r\n                    }}\r\n                  >\r\n                    <div className=\"flex gap-3\">\r\n                      <div className={`flex-shrink-0 ${getNotificationColor(notification.type)}`}>\r\n                        <span className=\"material-symbols-outlined\">\r\n                          {getNotificationIcon(notification.type)}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <p className={`text-sm font-bold text-white mb-1 ${!notification.read ? '' : 'opacity-70'}`}>\r\n                          {notification.title}\r\n                        </p>\r\n                        <p className={`text-xs text-text-secondary mb-2 ${!notification.read ? '' : 'opacity-60'}`}>\r\n                          {notification.message}\r\n                        </p>\r\n                        <p className=\"text-[10px] text-text-secondary/60\">\r\n                          {formatTime(notification.createdAt)}\r\n                        </p>\r\n                      </div>\r\n                      {!notification.read && (\r\n                        <div className=\"flex-shrink-0\">\r\n                          <span className=\"size-2 bg-primary rounded-full block\"></span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"p-3 border-t border-[#3c2348]\">\r\n            <Link\r\n              href=\"/member/notifications\"\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"block text-center text-sm text-primary hover:text-white transition-colors font-medium\"\r\n            >\r\n              View all notifications\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\OptimizedImage.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\ProtectedRoute.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\RequireAuth.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\Testimonials.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":46,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1893,1894],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1893,1894],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1893,1894],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1893,1894],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":46,"column":92,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1905,1906],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1905,1906],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1905,1906],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1905,1906],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":48,"column":17,"nodeType":"JSXOpeningElement","endLine":48,"endColumn":114}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nconst testimonials = [\r\n  {\r\n    name: \"Sarah Jenkins\",\r\n    role: \"Literature Professor\",\r\n    content: \"Bookflix has completely transformed how I access research material. The delivery service is impeccably fast.\",\r\n    rating: 5,\r\n    avatar: \"https://i.pravatar.cc/150?u=sarah\"\r\n  },\r\n  {\r\n    name: \"David Chen\",\r\n    role: \"Regular Reader\",\r\n    content: \"The premium subscription is worth every penny. No late fees and the curated collections are outstanding.\",\r\n    rating: 5,\r\n    avatar: \"https://i.pravatar.cc/150?u=david\"\r\n  },\r\n  {\r\n    name: \"Elena Rodriguez\",\r\n    role: \"Student\",\r\n    content: \"Best digital library experience I've ever had. User interface is sleek and finding books is so easy.\",\r\n    rating: 4,\r\n    avatar: \"https://i.pravatar.cc/150?u=elena\"\r\n  }\r\n];\r\n\r\nconst Testimonials = () => {\r\n  return (\r\n    <section className=\"py-20 px-6 bg-background-dark/30\" id=\"testimonials\">\r\n      <div className=\"max-w-[1400px] mx-auto\">\r\n        <div className=\"text-center mb-16\">\r\n          <h2 className=\"text-sm font-bold text-primary uppercase tracking-[0.3em] mb-4\">Testimonials</h2>\r\n          <h3 className=\"text-3xl md:text-5xl font-black text-white\">What Our Readers Say</h3>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n          {testimonials.map((t, index) => (\r\n            <div key={index} className=\"glass-panel p-10 rounded-3xl border border-white/5 bg-white/5 relative group animate-on-scroll\">\r\n              <div className=\"flex gap-1 text-primary mb-6\">\r\n                {[...Array(5)].map((_, i) => (\r\n                  <span key={i} className=\"material-symbols-outlined text-sm\">\r\n                    {i < t.rating ? 'star' : 'star_outline'}\r\n                  </span>\r\n                ))}\r\n              </div>\r\n              <p className=\"text-gray-300 italic mb-8 text-lg leading-relaxed\">\"{t.content}\"</p>\r\n              <div className=\"flex items-center gap-4\">\r\n                <img src={t.avatar} alt={t.name} className=\"w-12 h-12 rounded-full border-2 border-primary/30\" />\r\n                <div>\r\n                  <h4 className=\"text-white font-bold\">{t.name}</h4>\r\n                  <p className=\"text-gray-500 text-sm\">{t.role}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default Testimonials;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\UserProfile.js","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":89,"column":3,"nodeType":"Identifier","endLine":89,"endColumn":12},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":102,"column":13,"nodeType":"JSXOpeningElement","endLine":121,"endColumn":15},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":141,"column":19,"nodeType":"JSXOpeningElement","endLine":149,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { USER_ROLES } from '@/lib/constants';\n\nexport default function UserProfile() {\n  const { user, userData, signOut } = useAuth();\n  const [isOpen, setIsOpen] = useState(false);\n  const [imageError, setImageError] = useState(false);\n  const dropdownRef = useRef(null);\n  const router = useRouter();\n\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n        setIsOpen(false);\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isOpen]);\n\n  const handleSignOut = async () => {\n    await signOut();\n    setIsOpen(false);\n    router.push('/');\n  };\n\n  const handleDashboardClick = (e) => {\n    e.preventDefault();\n    setIsOpen(false);\n    \n    // Redirect based on user role\n    if (!userData) {\n      router.push('/');\n      return;\n    }\n\n    const role = userData.role || USER_ROLES.MEMBER;\n    \n    switch (role) {\n      case USER_ROLES.ADMIN:\n        router.push('/admin/overview');\n        break;\n      case USER_ROLES.LIBRARIAN:\n        router.push('/librarian/overview');\n        break;\n      case USER_ROLES.MEMBER:\n      default:\n        router.push('/member/overview');\n        break;\n    }\n  };\n\n  if (!user) return null;\n\n  const displayName = userData?.name || user?.displayName || user?.email?.split('@')[0] || 'User';\n  // Prioritize userData profilePhoto, but fallback to Firebase photoURL\n  const profilePhoto = userData?.profilePhoto || user?.photoURL || null;\n  \n  // Determine member status\n  const isPremiumMember = userData?.subscription?.type && \n    ['monthly', 'yearly'].includes(userData.subscription.type) && \n    userData.subscription.status === 'active';\n  const isMember = userData?.role === USER_ROLES.MEMBER;\n  const isAdmin = userData?.role === USER_ROLES.ADMIN;\n  const isLibrarian = userData?.role === USER_ROLES.LIBRARIAN;\n  \n  // Only show member status for members, show role for admin/librarian\n  let displayStatus = null;\n  if (isMember) {\n    displayStatus = isPremiumMember ? 'Premium Member' : 'General Member';\n  } else if (isAdmin) {\n    displayStatus = 'Admin';\n  } else if (isLibrarian) {\n    displayStatus = 'Librarian';\n  }\n  \n  // Reset image error when profile photo changes\n  useEffect(() => {\n    setImageError(false);\n  }, [profilePhoto]);\n\n  return (\n    <div className=\"relative\" ref={dropdownRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10 transition-colors\"\n        type=\"button\"\n      >\n        <div className=\"relative w-10 h-10 shrink-0\">\n          {profilePhoto && !imageError ? (\n            <img\n              src={`/api/image-proxy?url=${encodeURIComponent(profilePhoto)}`}\n              alt={displayName}\n              className=\"w-10 h-10 rounded-full object-cover border-2 border-primary/50\"\n              style={{ \n                display: 'block', \n                visibility: 'visible', \n                opacity: 1,\n                width: '40px',\n                height: '40px',\n                flexShrink: 0\n              }}\n              onError={(e) => {\n                // Silently handle image load errors - fallback will be shown\n                setImageError(true);\n              }}\n              onLoad={() => {\n                // Image loaded successfully\n              }}\n            />\n          ) : (\n            <div className=\"w-10 h-10 rounded-full bg-primary/20 border-2 border-primary/50 flex items-center justify-center\">\n              <span className=\"material-symbols-outlined text-primary text-xl\">person</span>\n            </div>\n          )}\n        </div>\n        <span className=\"text-white font-medium text-sm\">{displayName}</span>\n        <span className=\"material-symbols-outlined text-white/60 text-lg\">\n          {isOpen ? 'expand_less' : 'expand_more'}\n        </span>\n      </button>\n\n      {isOpen && (\n        <div className=\"absolute right-0 mt-3 w-72 rounded-2xl bg-gradient-to-b from-surface-dark to-black/90 border border-white/20 shadow-2xl backdrop-blur-xl overflow-hidden z-[100] transition-all duration-200 opacity-100\">\n          {/* Header Section with Profile */}\n          <div className=\"relative p-5 bg-gradient-to-r from-primary/20 via-primary/10 to-transparent border-b border-white/10\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"relative shrink-0\">\n                {profilePhoto && !imageError ? (\n                  <img\n                    src={`/api/image-proxy?url=${encodeURIComponent(profilePhoto)}`}\n                    alt={displayName}\n                    className=\"w-14 h-14 rounded-full object-cover border-2 border-primary/60 shadow-lg shadow-primary/30\"\n                    onError={(e) => {\n                      // Silently handle image load errors - fallback will be shown\n                      setImageError(true);\n                    }}\n                  />\n                ) : (\n                  <div className=\"w-14 h-14 rounded-full bg-gradient-to-br from-primary/40 to-primary/20 border-2 border-primary/60 flex items-center justify-center shadow-lg shadow-primary/30\">\n                    <span className=\"material-symbols-outlined text-primary text-2xl\">person</span>\n                  </div>\n                )}\n                {isPremiumMember && isMember && (\n                  <div className=\"absolute -bottom-1 -right-1 w-5 h-5 rounded-full bg-primary border-2 border-surface-dark flex items-center justify-center\">\n                    <span className=\"material-symbols-outlined text-white text-xs\">star</span>\n                  </div>\n                )}\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-white font-bold text-sm truncate\">{displayName}</p>\n                {displayStatus && (\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold ${\n                      isPremiumMember && isMember\n                        ? 'bg-primary/20 text-primary border border-primary/40' \n                        : isAdmin || isLibrarian\n                        ? 'bg-primary/30 text-primary border border-primary/50'\n                        : 'bg-white/10 text-gray-300 border border-white/20'\n                    }`}>\n                      {isPremiumMember && isMember && (\n                        <span className=\"material-symbols-outlined text-xs\">diamond</span>\n                      )}\n                      {(isAdmin || isLibrarian) && (\n                        <span className=\"material-symbols-outlined text-xs\">admin_panel_settings</span>\n                      )}\n                      {displayStatus}\n                    </span>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Menu Items */}\n          <div className=\"py-2\">\n            <button\n              onClick={handleDashboardClick}\n              className=\"group w-full flex items-center gap-3 px-5 py-3 text-sm text-white hover:bg-gradient-to-r hover:from-primary/20 hover:to-transparent transition-all duration-200 text-left border-l-2 border-transparent hover:border-primary\"\n            >\n              <span className=\"material-symbols-outlined text-lg text-gray-400 group-hover:text-primary transition-colors\">dashboard</span>\n              <span className=\"font-medium\">Dashboard</span>\n              <span className=\"ml-auto material-symbols-outlined text-xs text-gray-500 group-hover:text-primary transition-colors\">chevron_right</span>\n            </button>\n            {userData?.role !== USER_ROLES.ADMIN && userData?.role !== USER_ROLES.LIBRARIAN && (\n              <Link\n                href=\"/member/wishlist\"\n                onClick={() => setIsOpen(false)}\n                className=\"group w-full flex items-center gap-3 px-5 py-3 text-sm text-white hover:bg-gradient-to-r hover:from-primary/20 hover:to-transparent transition-all duration-200 text-left border-l-2 border-transparent hover:border-primary\"\n              >\n                <span className=\"material-symbols-outlined text-lg text-gray-400 group-hover:text-primary transition-colors\">favorite</span>\n                <span className=\"font-medium\">My Wishlist</span>\n                <span className=\"ml-auto material-symbols-outlined text-xs text-gray-500 group-hover:text-primary transition-colors\">chevron_right</span>\n              </Link>\n            )}\n            <div className=\"h-px bg-gradient-to-r from-transparent via-white/10 to-transparent my-1\"></div>\n            <button\n              onClick={handleSignOut}\n              className=\"group w-full flex items-center gap-3 px-5 py-3 text-sm text-red-400 hover:bg-red-500/10 transition-all duration-200 text-left border-l-2 border-transparent hover:border-red-500/50\"\n            >\n              <span className=\"material-symbols-outlined text-lg\">logout</span>\n              <span className=\"font-medium\">Sign Out</span>\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\components\\ViewMemberModal.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMemberDetails'. Either include it or remove the dependency array.","line":16,"column":6,"nodeType":"ArrayExpression","endLine":16,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMemberDetails, isOpen, memberId]","fix":{"range":[457,475],"text":"[fetchMemberDetails, isOpen, memberId]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":86,"column":21,"nodeType":"JSXOpeningElement","endLine":90,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { showError } from '@/lib/swal';\r\nimport Loader from '@/components/Loader';\r\nimport { formatDate } from '@/lib/utils';\r\n\r\nexport default function ViewMemberModal({ isOpen, onClose, memberId }) {\r\n  const [member, setMember] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && memberId) {\r\n      fetchMemberDetails();\r\n    }\r\n  }, [isOpen, memberId]);\r\n\r\n  const fetchMemberDetails = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch(`/api/admin/members?userId=${memberId}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setMember(data.member);\r\n      } else {\r\n        showError('Failed to fetch member details');\r\n        onClose();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching member details:', error);\r\n      showError('Failed to fetch member details');\r\n      onClose();\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const getTierLabel = (subscriptionType) => {\r\n    if (subscriptionType === 'monthly' || subscriptionType === 'yearly') {\r\n      return 'Premium';\r\n    }\r\n    return 'Standard';\r\n  };\r\n\r\n  const getStatusLabel = (member) => {\r\n    if (!member.isActive) {\r\n      return 'Inactive';\r\n    }\r\n    return 'Active';\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 lg:p-8\">\r\n      <div \r\n        className=\"absolute inset-0 z-0 bg-background-dark/80 backdrop-blur-sm transition-opacity\"\r\n        onClick={onClose}\r\n      />\r\n      \r\n      <div className=\"relative z-10 w-full max-w-4xl rounded-2xl border border-border-dark shadow-2xl flex flex-col max-h-[90vh] overflow-hidden animate-fade-in-up\" style={{ background: 'rgba(43, 25, 52, 0.95)', backdropFilter: 'blur(12px)', WebkitBackdropFilter: 'blur(12px)' }}>\r\n        <div className=\"flex items-center justify-between px-8 py-6 border-b border-border-dark bg-[#150c19]/50\">\r\n          <div className=\"flex flex-col gap-1\">\r\n            <h2 className=\"text-white text-2xl font-bold tracking-tight\">Member Details</h2>\r\n            <p className=\"text-white/60 text-sm font-normal\">View member information and history.</p>\r\n          </div>\r\n          <button \r\n            onClick={onClose}\r\n            className=\"text-white/40 hover:text-white transition-colors p-2 rounded-full hover:bg-white/5\"\r\n          >\r\n            <span className=\"material-symbols-outlined text-2xl\">close</span>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex-1 overflow-y-auto px-8 py-8 custom-scrollbar\">\r\n          {loading ? (\r\n            <div className=\"flex justify-center items-center py-12\">\r\n              <Loader />\r\n            </div>\r\n          ) : member ? (\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n              {/* Left Column: Profile */}\r\n              <div className=\"lg:col-span-1 flex flex-col gap-6\">\r\n                <div className=\"flex flex-col items-center gap-4 p-6 bg-[#150c19]/30 rounded-xl border border-border-dark/50\">\r\n                  {member.profilePhoto ? (\r\n                    <img \r\n                      src={member.profilePhoto} \r\n                      alt={member.name || 'Member'} \r\n                      className=\"w-32 h-32 rounded-full object-cover border-4 border-border-dark\"\r\n                    />\r\n                  ) : (\r\n                    <div className=\"w-32 h-32 rounded-full bg-[#150c19] border-4 border-border-dark flex items-center justify-center\">\r\n                      <span className=\"material-symbols-outlined text-white/20 text-5xl\">person</span>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"text-center\">\r\n                    <h3 className=\"text-white font-bold text-lg\">{member.name || 'Unknown Member'}</h3>\r\n                    <p className=\"text-white/60 text-sm mt-1\">{member.email}</p>\r\n                  </div>\r\n                  <div className=\"w-full flex flex-col gap-2\">\r\n                    <div className=\"flex items-center justify-between px-4 py-2 bg-[#150c19] rounded-lg\">\r\n                      <span className=\"text-white/60 text-sm\">Status</span>\r\n                      <span className={`text-sm font-medium ${member.isActive ? 'text-emerald-400' : 'text-red-400'}`}>\r\n                        {getStatusLabel(member)}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex items-center justify-between px-4 py-2 bg-[#150c19] rounded-lg\">\r\n                      <span className=\"text-white/60 text-sm\">Tier</span>\r\n                      <span className=\"text-sm font-medium text-white\">\r\n                        {getTierLabel(member.subscription?.type)}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Right Column: Details */}\r\n              <div className=\"lg:col-span-2 flex flex-col gap-6\">\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"text-white text-lg font-semibold flex items-center gap-2 border-b border-border-dark pb-2\">\r\n                    <span className=\"material-symbols-outlined text-primary\">person</span>\r\n                    Personal Information\r\n                  </h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label className=\"text-white/60 text-xs uppercase tracking-wider\">Full Name</label>\r\n                      <p className=\"text-white text-sm mt-1\">{member.name || 'N/A'}</p>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"text-white/60 text-xs uppercase tracking-wider\">Email</label>\r\n                      <p className=\"text-white text-sm mt-1\">{member.email || 'N/A'}</p>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"text-white/60 text-xs uppercase tracking-wider\">Phone</label>\r\n                      <p className=\"text-white text-sm mt-1\">{member.phone || 'N/A'}</p>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"text-white/60 text-xs uppercase tracking-wider\">Member ID</label>\r\n                      <p className=\"text-white text-sm mt-1 font-mono\">{member._id?.slice(-8) || 'N/A'}</p>\r\n                    </div>\r\n                  </div>\r\n                  {member.address && (member.address.city || member.address.area || member.address.division) && (\r\n                    <div>\r\n                      <label className=\"text-white/60 text-xs uppercase tracking-wider\">Address</label>\r\n                      <p className=\"text-white text-sm mt-1\">\r\n                        {[\r\n                          member.address.area,\r\n                          member.address.city,\r\n                          member.address.division,\r\n                          member.address.landmark\r\n                        ].filter(Boolean).join(', ') || 'N/A'}\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"text-white text-lg font-semibold flex items-center gap-2 border-b border-border-dark pb-2\">\r\n                    <span className=\"material-symbols-outlined text-primary\">card_membership</span>\r\n                    Subscription Information\r\n                  </h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label className=\"text-white/60 text-xs uppercase tracking-wider\">Subscription Type</label>\r\n                      <p className=\"text-white text-sm mt-1 capitalize\">{member.subscription?.type || 'Free'}</p>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"text-white/60 text-xs uppercase tracking-wider\">Status</label>\r\n                      <p className=\"text-white text-sm mt-1 capitalize\">{member.subscription?.status || 'Active'}</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"text-white text-lg font-semibold flex items-center gap-2 border-b border-border-dark pb-2\">\r\n                    <span className=\"material-symbols-outlined text-primary\">calendar_today</span>\r\n                    Account Information\r\n                  </h3>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label className=\"text-white/60 text-xs uppercase tracking-wider\">Member Since</label>\r\n                      <p className=\"text-white text-sm mt-1\">\r\n                        {member.createdAt ? formatDate(new Date(member.createdAt)) : 'N/A'}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"text-white/60 text-xs uppercase tracking-wider\">Last Updated</label>\r\n                      <p className=\"text-white text-sm mt-1\">\r\n                        {member.updatedAt ? formatDate(new Date(member.updatedAt)) : 'N/A'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <span className=\"material-symbols-outlined text-yellow-400\">info</span>\r\n                    <div>\r\n                      <p className=\"text-white text-sm font-medium\">Borrowing History</p>\r\n                      <p className=\"text-white/60 text-xs mt-1\">Borrowing history and activity tracking will be available in a future update.</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-12\">\r\n              <p className=\"text-white/60\">Member not found</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-end gap-3 px-8 py-5 border-t border-border-dark bg-[#150c19]/80 backdrop-blur-md\">\r\n          <button \r\n            onClick={onClose}\r\n            className=\"px-6 py-2.5 rounded-lg bg-primary hover:bg-[#8a19c2] text-white shadow-[0_0_15px_rgba(170,31,239,0.3)] hover:shadow-[0_0_20px_rgba(170,31,239,0.5)] transition-all text-sm font-bold\"\r\n          >\r\n            Close\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\contexts\\AuthContext.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\apiErrorHandler.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\constants.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\db.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\firebase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\imgbb.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\locationData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\mongodb.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\notifications.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\resend.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\stripe.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\swal.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\utils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\lib\\validation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Book.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\BookCopy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Borrowing.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Category.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Fine.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Notification.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Payment.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Reservation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Review.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Subscription.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\User.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\src\\models\\Wishlist.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\bookfiix\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
